{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","blockingIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","call","templateUrl","controller","controllerAs","loader","title","description","joyride","reloadOnSearch","access","requiresLogin","section","redirectTo","params","pslug","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","httpResponseError","response","nextUrl","status","config","cancelable","closeAll","replace","url","indexOf","encodeURIComponent","search","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","$routeParams","redirectToBlockedPage","responseOk","blockedUrl","currentUrl","project","blocked_code","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","ljs","load","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","linewidth","pikaday","checksley","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","projectService","navigationBarService","un","user","validators","debug","$on","refresh","val","width","lines","valid","nl2br","split","every","line","length","prettyDate","isValid","updateValidators","contribPlugins","adminPlugins","filter","userSettingsPlugins","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","next","start","setSection","setProjectBySlug","cleanProject","setAll","addMobileViewport","removeMobileViewport","enableHeader","plugin","value","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","location","navUrls","q","Base","Service","Controller","addClass","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","groupBy","isImage","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","el","className","classList","add","str","breakTag","object","dependencies","methods","keys","forIn","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","ref","char","toLowerCase","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isFunction","isObject","removeKeys","chain","flatten","reduce","cartesianProduct","reduceRight","a","b","y","match","oldImmutable","newImmutable","pathObj","forEach","newValue","toJS","FiltersMixin","PageMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","members","uniq","includes","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","existing","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","LoginPage","PublicRegisterMessageDirective","RegisterDirective","currentUserService","$inject","rootscope","storage","model","http","urls","translate","currentUserService1","themeService","userModel","_currentTheme","_getUserTheme","setUserdata","userData","Immutable","fromJS","getAttrs","setUser","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","set","clear","remove","setToken","token","getToken","removeToken","auth_token","login","clone","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","acceptInvitiationWithExistingUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","templates","template","templateFn","publicRegisterEnabled","restrict","directive","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","find","decodeURIComponent","onKeyUp","target","currentTarget","iscapsLockActivated","loginFormType","preventDefault","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","trackEvent","_error_message","error","setErrors","message","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","$window","onresize","$broadcast","home","not-found","permission-denied","discover","discover-search","forgot-password","change-password","change-email","cancel-account","create-project","profile","user-profile","blocked-project","project-backlog","project-taskboard","project-kanban","project-issues","project-search","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","user-settings-contrib","$navurls","update","AnimationFrame","Autofocus","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","LightboxClose","ProjectUrl","Qqueue","QueueModelTransformation","SelectedText","Svg","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","removeClass","unObserve","unwatch","tgCheckPermission","$observe","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","negation","my_permissions","classes","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","lastPromise","qqueue","bindAdd","args","qqueue1","repo","model1","setObject","prop","attrs","cloneDeep","_attrs","_name","getObj","save","transformation","defered","comment","modified","omit","_modifiedAttrs","assign","$templateCache","lodash","tmp","svgIcon","svgTitle","svgTitleTranslate","svgTitleTranslateValues","$timeout","$element","focus","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","trimStart","host","ws","addEventListener","onOpen","onMessage","onClose","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","show","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","setInterval","error1","Error","sendMessage","cmd","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","create","feedback","finish","open","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","task","subject","html","keyCode","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","assigned_to","createTask","reset","default_task_status","openNewRelatedTask","us","$rs","_isEditable","_isVisible","loadTasks","tasks","list","usId","showRelatedTasks","$ctrl","autoSave","notAutoSave","updateRelatedTask","member","imgurl","photo","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-contacts","user-me","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","project-transfer-validate-token","project-transfer-accept","project-transfer-reject","project-transfer-request","project-transfer-start","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","milestones","userstories","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-sprint-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/us","history/issue","history/task","history/wiki","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/userstory","custom-attributes/issue","custom-attributes/task","custom-attributes-values/userstory","custom-attributes-values/issue","custom-attributes-values/task","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","stats-discover","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","scope1","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadFilters","loadProject","getBySlug","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","$route","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","$destroy","$new","parseHTML","activeSection","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","trackPage","s","o","g","r","m","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","page","category","action","label","BindScope","jQuery","CompileHtmlDirective","tgCompileHtml","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableDescriptionDirective","EditableSubjectDirective","EditableWysiwyg","ListItemAssignedtoDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","WatchersDirective","renderRange","first","second","endDate","initDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","onSelect","picker","setDate","Pikaday","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner","owner_extra_info","created_date","$modelTransform","deleteWatcher","isEditable","renderWatchers","ref1","requiredPerm","watchers","transform","watcherId","watcherIds","revert","pull","$currentUserService","renderAssignedTo","assignedObject","fullName","isIocaine","isUnassigned","assigned_to_extra_info","is_iocaine","fullNameVisible","ask","instance","is_blocked","onDeleteGoToUrl","onDeleteTitle","subtitle","hide","click","$selectedText","noDescriptionMegEditMode","noDescriptionMegReadMode","cancelEdition","is","href","$","scrollTop","offset","top","$applyAsync","noDescriptionMsg","attachmentsService","attachmentsFullService","isInEditMode","uploadFile","file","addAttachment","getIn","textarea","dataTransfer","promises","stopPropagation","originalEvent","files","markItUp","replaceWith","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","issue","tgListitemIssueStatus","issueTypeById","domNode","color","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgProgressBar","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxService","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","append","selected","icon","detailImage","svgContainer","useSVG","createElementNS","setAttributeNS","appendChild","prepend","stop","percent","body","selector","tsem","one","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","TEXT_TYPE","TYPE_CHOICES","URL_TYPE","confirm","objectId","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$templates","$storage","collapsedHash","$ctrls","collapsed","hash","requiredEditionPerm","setFocusAndSelectOnInputField","edit","editable","tgCustomAttributeValue","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","$setViewValue","mainTemplate","calculateTotalPoints","calculateRoles","$watchCollection","$qqueue","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","height","clientHeight","defaultFilter","momentFormat","momentFromNow","yesNoFilter","defaultValue","without_suffix","fromNow","HistoryController","HistoryDirective","IGNORED_FIELDS","userstories.userstory","tasks.task","issues.issue","loadHistory","history","changeModel","historyEntry","historyResult","j","len1","values_diff","description_diff","description_html","blocked_note_diff","blocked_note","blocked_note_html","comments","deleteComment","activityId","undeleteComment","checkPermissionsService","templateActivity","templateBase","templateBaseEntries","templateChangeAttachment","templateChangeDiff","templateChangeGeneric","templateChangeList","templateChangePoints","templateDeletedComment","countChanges","formatChange","getHumanizedFieldName","getPrettyDateFormat","renderActivity","renderAttachmentEntry","renderBase","renderChange","renderChangeEntries","renderChangeEntry","renderChangesHelperText","renderComment","renderComments","renderCustomAttributesEntry","renderHistory","rerender","showAllActivity","showAllComments","humanizedFieldNames","content","is_closed","finish_date","milestone","user_story","client_requirement","team_requirement","attachments","is_deprecated","order","backlog_order","sprint_order","kanban_order","taskboard_order","us_order","change","isArray","changes","diff","filename","from","to","outerHTML","customAttrsChanges","added","removed","difference","ref2","delete_comment_date","delete_comment_user","deleteCommentDate","deleteCommentUser","comment_html","canRestoreComment","pk","avatar","userFullName","userProfileUrl","creationDate","created_at","changesText","mode","deleteCommentActionTitle","canDeleteComment","entries","totalEntries","showMore","commentsVisible","historyVisible","check","ngmodel","totalComments","takeRight","totalChanges","parents","toggleClass","ImportProjectButtonDirective","LbImportErrorDirective","$lightboxFactory","$tgAuth","getRestrictionError","errorKey","maxMemberships","membersError","privateError","publicError","isPrivate","canCreatePrivateProjects","canCreatePublicProjects","max_memberships","trigger","loadProjects","errorMsg","restrictionError","class","error_message","AssignedToLightboxDirective","AttachmentPreviewLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxLeaveProjectWarningDirective","LightboxService","WatchersLightboxDirective","docEl","lightboxContent","not","firstField","activeElement","blur","code","which","removeAttr","lightboxEl","dispatch","prev","$tgrepo","block","unblock","finishCallback","watch","attachmentsToAdd","attachmentsToDelete","createAttachments","deleteAttachments","resetAttachments","createEditUs","isNew","List","attachment","deleteAttachment","statusList","usStatusList","is_archived","upload","broadcastEvent","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","string","normalizedString","toUpperCase","partial","assignedToId","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","spinner","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","statuses","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","left","fadeOut","fadeIn","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsDirective","LbTagLineDirective","TagLineDirective","TagsDirective","formatter","parser","$formatters","$parsers","backlog","kanban","taskboard","srcTags","tgColorizeTagsType","sort","tag","tags_colors","tgColorizeTags","COMMA_KEY","ENTER_KEY","autocomplete","templateTags","addValue","deleteValue","hideSaveButton","renderTags","resetInput","saveInputTag","showSaveButton","tagsColors","style","fromCharCode","Awesomplete","ESC_KEY","hideAddTagButton","hideAddTagButtonText","hideInput","renderInReadModeOnly","showAddTagButton","showAddTagButtonText","showInput","MarkitupDirective","previewTemplate","addLine","cancelablePromise","closePreviewMode","markdownTitle","prepareUrlFormatting","preview","previewDomNode","previewInProgress","renderMarkItUp","setCaretPosition","urlFormatting","markItUpDomNode","markdownDomNode","mdrender","markdown","caretPosition","scrollRelation","totalLines","createTextRange","move","selectionStart","setSelectionRange","scrollHeight","nline","cursorPosition","indices","regex","exec","index","donotparse","endIndex","startIndex","heading","n","placeHolder","markdownSettings","nameSpace","onShiftEnter","keepDefault","openWith","onEnter","afterInsert","cursorLine","emptyListItem","lastLine","markdownCaretPositon","newLineContent","markupSet","closeWith","separator","beforeInsert","markItUpRemove","textcomplete","cache","searchProps","searchTypes","res","count","BacklogFiltersDirective","templateSelected","currentFiltersType","getFiltersType","initializeSelectedFilters","reloadUserstories","renderFilters","renderSelectedFilters","selectQFilter","selectedFilters","showCategories","showFilters","toggleFilterSelection","f","loadUserstories","generateFilters","currentFilters","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","estimated_start","estimated_finish","newSprint","copy","setAttr","sprintsCounter","__all__","milestonesCounter","openSprints","sortedSprints","sprints","closed","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","analytics","rs2","modelTransform","disablePagination","firstLoadComplete","showTags","activeFilters","showGraphPlaceholder","initializeEventHandlers","getShowTags","loadProjectStats","loadSprints","loadClosedSprints","findIndex","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","loadAllPaginatedUserstories","toggleShowTags","storeShowTags","toggleActiveFilters","stats","defined_points","completedPercentage","total_milestones","closedSprints","totalClosedMilestones","user_stories","closedSprintsById","totalMilestones","totalOpenMilestones","reverse","sprintsById","currentSprint","findCurrentSprint","restoreFilters","selectedStatuses","selectedTags","oldSelectedTags","oldSelectedStatuses","filtersQ","filtersQOld","filterGrp","resetFilters","resetPagination","pageSize","loadingUserstories","httpParams","getUrlFilters","storeQueryParams","listUnassigned","header","setSearchDataFilters","loadBacklog","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","resortUserStories","items","isModified","usList","newUsIndex","newSprintId","len2","len3","movedFromClosedSprint","movedToClosedSprint","oldSprintId","splice","Array","bulkUpdateBacklogOrder","bulkUpdateSprintOrder","console","len4","isFilterSelected","searchdata","urlfilters","results1","pick","filtersData","choicesFiltersFormat","tagsFilterFormat","byIdObject","markSelectedFilters","isSelected","updateUserStoryStatus","editUserStory","$event","getByRef","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","currentDate","end","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","current_sum","domElement","assigned_points","before","rowElements","checkSelected","getUsToMove","lastChecked","moveToCurrentSprint","moveToLatestSprint","moveUssToSprint","shiftPressed","ussDom","itemScope","selectedUss","extraPoints","totalExtraPoints","ussCurrent","union","saveAll","moveToSprintDom","selectedUsDom","shiftKey","current","elements","nextAll","prevAll","nextUntil","prevUntil","elm","ussToMove","hideText","showText","sidebar","filtersSearch","numberOfRoles","roleName","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","options","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogSortableDirective","deleteElement","$tgConfirm","drake","filterError","initIsBacklog","scroll","dragula","copySortSource","isContainer","contains","moves","container","isChecked","dragMultiple","dragMultipleItems","firstElement","isBacklog","sameContainer","itemUs","autoScroll","margin","pixels","scrollWhenOutside","down","dragging","destroy","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","last","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","sprintId","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","TaskboardTaskDirective","TaskboardUserDirective","rs1","_setMeta","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","loadTaskboard","taskMove","refreshTagsColors","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","completed_points","completed_tasks","usTasks","isPlaceholder","sslug","refreshTasksOrder","resortTasks","bulkUpdateTaskTaskboardOrder","task_id","addNewTask","editTaskAssignedTo","tableBodyDom","tableHeaderDom","scrollLeft","$rs2","editingTask","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","clickable","username_label","TaskboardSortableDirective","xx","containers","itemEl","newParentScope","oldParentScope","tdom","mirrorContainer","itemIndex","itemTask","newStatusId","newUsId","oldStatusId","oldUsId","parentEl","st","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanUserDirective","KanbanUserstoryDirective","KanbanWipLimitDirective","defaultViewMode","viewModes","statusViewModes","onAssignedToChanged","loadUserStoriesForStatus","hideUserStoriesForStatus","changeUsAssignedTo","userid","status__is_archived","listAll","usByStatus","us_archived","loadKanban","generateStatusViewModes","storedStatusViewModes","getStatusViewModes","storeStatusViewModes","updateStatusViewMode","newViewMode","isMaximized","isMinimized","itemsToSave","bulkUpdateKanbanOrder","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","isArchived","userStoriesLoaded","editingUserStory","getTemplateUrl","updateTableWidth","folds","redrawWipLimit","tgKanbanWipLimit","wip_limit","wtid","tgKanbanUserAvatar","KanbanSortableDirective","IssueDetailController","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","initializeOnDeleteGoToUrl","ref3","issueSubject","issueStatus","statusById","issueType","typeById","issueSeverity","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","priorityList","issueId","commentModel","neighbors","previous","previousUrl","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","typees","severityes","priorityes","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","default_issue_status","default_issue_type","default_priority","default_severity","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssuesController","IssuesDirective","IssuesFiltersDirective","loadIssues","getFilters","storeFilters","issueStatusList","issueTypes","getUrlFilter","loadMyFilters","getMyFilters","removeNotExistingFiltersFromUrl","currentSearch","existingValues","filterName","filterValue","splittedValues","intersection","myFilters","types","assignedTo","createdBy","usersFiltersFormat","unknownOption","reformatedUsers","unknownItem","full_name","u","owners","loadIssuesRequests","urlFilters","models","paginatedBy","saveCurrentFiltersTo","newFilter","storeMyFilters","deleteMyFilter","addNewIssue","addIssuesInBulk","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","finalOrder","newOrder","reloadIssues","unwatchIssues","filterId","customFilterName","loadPromise","currentfilterstype","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","configService","usRef","usref","tribeEnabled","tribeHost","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","allClosed","loadUs","kanbanStaus","noMilestone","order_by","onTribeInfo","image","publishDesc","publishTitle","alt","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","taskId","loadUserStory","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","userRoles","lightboxFactory","leaveConfirm","confirm_leave_project_text","leave_project_text","leave","isCurrentUser","EditableWikiContentDirective","WikiDetailController","WikiSummaryDirective","projectSlug","wikiSlug","wikiTitle","linksVisible","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","loadWiki","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","checkLinksPerms","last_modifier","imgUrl","wikiPage","disableEdition","getSelectedText","switchToEditMode","switchToReadMode","button","WikiNavDirective","addWikiLinkPermission","deleteWikiLinkPermission","linkId","newLink","ChangeOwnerLightboxController","ChangeOwnerLightboxDirective","LbRequestOwnershipDirective","LightboxAddMembersController","LightboxAddMembersDirective","LightboxAddMembersWarningMessageDirective","TransferProjectStartSuccessDirective","lightboxService1","pendingMembersCount","_defaultMaxInvites","_defaultRole","submitInvites","canAddUsers","memberInvites","membersLimit","total_memberships","addSingleMember","role_id","showWarningMessage","removeSingleMember","initializeFields","invites","bulkCreateMemberships","invitationText","_onSuccessInvite","_onErrorInvite","ctrl","bindToController","confirmService","transferRequest","commentOpen","limit","getUsers","currentOwnerId","userSearch","selectUser","transferStart","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","NoMoreMembershipsExplanationDirective","lightboxFactory1","i_am_admin","httpFilters","membership","is_user_active","addNewMembers","showLimitUsersWarningMessage","pending","user_email","isOwner","is_owner","tgMembershipsRowAvatar","tgMembershipsRowAdminCheckbox","inputId","is_admin","roleList","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","AdminNavigationDirective","tgAdminNavigation","AdminProjectChangeOwnerDirective","AdminProjectRequestOwnershipDirective","AdminProjectRestrictionsDirective","CsvExporterController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectLogoDirective","ProjectLogoModelDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","tgAuth","prioritiesList","severitiesList","issueTypesList","openDeleteLightbox","newUrl","fetchProject","newVal","oldVal","videoconferences_extra_data","videoconferences","isVideoconferenceActivated","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","uuid","regenerateUuid","sectionTitle","showSizeInfo","logoAttachment","changeLogo","removeLogo","$parse","modelSetter","tgProjectLogoModel","requestOwnership","changeOwner","project-id","active-users","current-owner-id","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","maxBy","itemValue","linkDragAndDrop","linkValue","direction","cancel","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","newIndex","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","is_private","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","toPairs","request_headers","arg","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","createProjectRestrictionDirective","CreateProject","DeleteProjectDirective","$projectUrl","$cacheFactory","removeAll","error_field","selectors","creation_template","head","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","has","ContribController","ContribUserSettingsController","currentPlugin","FiltersStorageService","HttpService","cacheFactory","locationFactory","lastRoute","Model","ModelService","dataTypes","_dataTypes","setAttrs","_isModified","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","getter","self","setter","substr","enumerable","configurable","isAttributeModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNavGetParams","tgNav","fullUrl","getURLParams","getURLParamsStr","metaKey","ctrlKey","RepositoryService","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","wikipage","StorageService","_default","serializedValue","getItem","setItem","removeItem","UrlsService","fmt","mainUrl","trimEnd","resourceProvider","_get","userstory","_list","filtersHashSuffix","hashSuffix","myFiltersHashSuffix","getQueryParams","listInAllProjects","project_id","bulk_issues","ns","innerPromise","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","listByUser","invitation_extra_text","bulk_memberships","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_userstories_csv_uuid","regenerate_issues_csv_uuid","regenerate_tasks_csv_uuid","statusUpdater","complete","failed","maxFileSize","uploadComplete","uploadFailed","uploadProgress","fileName","fileSize","evt","loaded","uploadedSize","totalSize","responseText","getResponseHeader","FormData","XMLHttpRequest","setRequestHeader","transformRequest","identity","deferredAbort","get_all","noop","hashSuffixUsRowModes","userStoryId","sprint_id","bulk_tasks","changeAvatar","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","page_size","status_id","bulk_stories","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","maxFileSizeMsg","availableThemes","avatarAttachment","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","AttachmentLinkDirective","tgAttachmentLink","AttachmentGalleryDirective","onDelete","AttachmentController","editMode","mergeIn","AttachmentDirective","AttachmentsDropDirective","eventAttr","tgAttachmentsDrop","AttachmentsFullController","deprecatedsCount","attachmentsVisible","deprecatedsVisible","uploadingAttachments","objId","setMode","toggleDeprecatedsVisible","addAttachments","loadAttachments","toDeleteAttachment","errorMessage","reorderAttachment","updateAttachment","toUpdateAttachment","hasPermission","editPermission","showAttachments","AttachmentsFullDirective","AttachmentsFullService","_attachments","_deprecatedsCount","_attachmentsVisible","_deprecatedsVisible","regenerate","it","uploading","Map","oldIndex","setIn","oldAttachment","AttachmentsSimpleController","onAdd","AttachmentsSimpleDirective","AttachmentSortableDirective","tgAttachmentsSortable","AutoSelectDirective","FileChangeDirective","tgFileChange","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","getConfig","dashboard","steps","position","joyRide","joyRides","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectLogoBigSrcDirective","projectLogoService","logo","projectLogo","getDefaultProjectLogo","ProjectLogoSmallSrcDirective","ProjectMenuController","menu","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","vm","fixed","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","TribeButtonDirective","TribeLinkedDirective","gigTitle","gigId","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","WatchButtonController","openWatchers","getPerms","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","attributes","environment","DiscoverHomeOrderByController","is_open","week","month","year","currentText","currentOrderBy","orderBy","onChange","DiscoverHomeOrderByDirective","DiscoverSearchBarController","discoverProjectsService","projectsCount","fetchStats","submitFilter","DiscoverSearchBarDirective","DiscoverSearchListHeaderController","like_is_open","activity_is_open","openLike","setOrderBy","openActivity","DiscoverSearchListHeaderDirective","FeaturedProjectsController","featured","fetchFeatured","FeaturedProjectsDirective","HighlightedDirective","highlighted","MostActiveController","mostActive","getOrderBy","fetch","fetchMostActive","MostActiveDirective","MostLikedController","mostLiked","fetchMostLiked","MostLikedDirective","DiscoverHomeController","onSubmit","DiscoverSearchController","routeParams","searchResult","nextSearchPage","loadingGlobal","loadingList","loadingPagination","resetSearchList","fetchByGlobalSearch","fetchByOrderBy","getFilter","fetchSearch","is_looking_for_people","onChangeFilter","updateParams","onChangeOrder","DiscoverSearchDirective","DiscoverProjectsService","projectsService","_mostLiked","_mostActive","_featured","_searchResult","_projectsCount","decorate","_decorate","_nextSearchPage","_discoverParams","discover_mode","_params","getProjects","is_featured","ExternalAppController","externalAppsService","xhrError","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","DutyDirective","navurls","duty","getDutyType","HomeController","HomeService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","_getValidDutiesAndAttachProjectInfo","watching","objType","duties","dutyType","getWorkInProgress","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_us","projectsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","p","status__is_closed","HomeProjectListDirective","newProject","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","DropdownProjectListDirective","DropdownUserDirective","authService","locationService","navUrlsService","isFeedbackEnabled","userMenu","NavigationBarDirective","isEnabledHeader","NavigationBarService","enabledHeader","ProfileBarController","userService","loadStats","getStats","ProfileBarDirective","ProfileContactsController","loadContacts","getContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileLikedController","ProfileVotedController","ProfileWatchedController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","scrollDisabled","_page","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","getLiked","getVoted","getWatched","ProfileLikedDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","transclude","tab","tabIcon","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","notFound","userUsername","BlockedProjectExplanationDirective","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","ProjectsListingController","ProjectController","activeMembers","setfn","metas","ProjectsService","projectUrl","getProjectBySlug","getProjectStats","paginate","colorized_tags","transferValidateToken","transferAccept","reason","transferReject","CantOwnProjectExplanationDirective","TransferProject","showAddComment","_refreshUserData","_validateToken","_setProjectData","_checkOwnerData","canBeOwnedByUser","canOwnProject","ownerMessage","maxProjects","currentProjects","validNumberOfMemberships","loadingAccept","loadingReject","addComment","hideComment","TransferProjectDirective","Resource","urlsService","urlname","object_id","x-disable-pagination","progressMessage","progressPercent","pagination","paginateResponseService","x-lazy-pagination","getTimeline","only_relevant","Resources","services","serviceFn","serviceName","serviceProperty","warm","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","getProfileTimeline","getUserTimeline","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","AttachmentsService","getMaxFileSize","maxFileSizeFormated","sizeError","saveError","ChekcPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","LightboxFactory","compile","scopeAttrs","PaginateResponse","paginateResponse","ProjectLogoService","modulo","COLORS","IMAGES","logos","murmurhash3_32_gc","ProjectService","_project","_section","_sectionsBreadcrumb","_activeMembers","ThemeService","themeName","stylesheetEl","UserService","pageNumber","objectType","textQuery","contactsFiltered","contact","contactId","permissionDenied","UserTimelineAttachmentDirective","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","timeline","title_attr","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","span","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","getType","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","invalid","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","blocked","moveInBacklog","deleteIn","_addEntyAttributes","filterNot"],"mappings":"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","file":"app.js","sourceRoot":"/source/","sourcesContent":["\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, blockingIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      controller: \"Home\",\n      controllerAs: \"vm\",\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/discover\", {\n      templateUrl: \"discover/discover-home/discover-home.html\",\n      controller: \"DiscoverHome\",\n      controllerAs: \"vm\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true\n    });\n    $routeProvider.when(\"/discover/search\", {\n      templateUrl: \"discover/discover-search/discover-search.html\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true,\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/blocked-project/:pslug/\", {\n      templateUrl: \"projects/project/blocked-project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/project/:pslug/transfer/:token\", {\n      templateUrl: \"projects/transfer/transfer-page.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/user-settings/contrib/:plugin\", {\n      templateUrl: \"contrib/user-settings.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true,\n      controller: \"LoginPage\"\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      redirectTo: \"/not-found\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          $location.path($navUrls.resolve(\"error\"));\n          $location.replace();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = encodeURIComponent($location.url());\n          $location.url($navUrls.resolve(\"login\")).search(\"next=\" + nextUrl);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    blockingIntercept = function($q, $routeParams, $location, $navUrls) {\n      var redirectToBlockedPage, responseError, responseOk;\n      redirectToBlockedPage = function() {\n        var blockedUrl, currentUrl, pslug;\n        pslug = $routeParams.pslug;\n        blockedUrl = $navUrls.resolve(\"blocked-project\", {\n          project: pslug\n        });\n        currentUrl = $location.url();\n        if (currentUrl.indexOf(blockedUrl) === -1) {\n          return $location.replace().path(blockedUrl);\n        }\n      };\n      responseOk = function(response) {\n        if (response.data.blocked_code) {\n          redirectToBlockedPage();\n        }\n        return response;\n      };\n      responseError = function(response) {\n        if (response.status === 451) {\n          redirectToBlockedPage();\n        }\n        return $q.reject(response);\n      };\n      return {\n        response: responseOk,\n        responseError: responseError\n      };\n    };\n    $provide.factory(\"blockingIntercept\", [\"$q\", \"$routeParams\", \"$location\", \"$tgNavUrls\", blockingIntercept]);\n    $httpProvider.interceptors.push(\"blockingIntercept\");\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    if (lang !== 'en') {\n      ljs.load((\"/\" + window._version + \"/locales/moment-locales/\") + lang + \".js\");\n    }\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\"),\n      linewidth: $translate.instant(\"COMMON.FORM_ERRORS.LINEWIDTH\"),\n      pikaday: $translate.instant(\"COMMON.FORM_ERRORS.PIKADAY\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, projectService, loaderService, navigationBarService) {\n    var un, user, validators;\n    $log.debug(\"Initialize application\");\n    $rootscope.$on('$translatePartialLoaderStructureChanged', function() {\n      return $translate.refresh();\n    });\n    validators = {\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      },\n      pikaday: function(val) {\n        var prettyDate;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        return moment(val, prettyDate).isValid();\n      }\n    };\n    checksley.updateValidators(validators);\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.userSettingsPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"userSettings\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      projectService.setSection(next.section);\n      if (next.params.pslug) {\n        projectService.setProjectBySlug(next.params.pslug);\n      } else {\n        projectService.cleanProject();\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"taigaDiscover\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\"].concat(_.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  }));\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgProjectService\", \"tgLoader\", \"tgNavigationBarService\", \"$route\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.location.path(this.navUrls.resolve(\"not-found\"));\n          this.location.replace();\n        } else if (xhr.status === 403) {\n          this.location.path(this.navUrls.resolve(\"permission-denied\"));\n          this.location.replace();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var addClass, bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, groupBy, isImage, joinStr, mixOf, nl2br, patch, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  addClass = function(el, className) {\n    if (el.classList) {\n      return el.classList.add(className);\n    } else {\n      return el.className += ' ' + className;\n    }\n  };\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return data.toString().toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, '-and-').replace(/[^\\w\\-]+/g, '').replace(/\\-\\-+/g, '-');\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return coll.join(str);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    },\n    cartesianProduct: function() {\n      return _.reduceRight(arguments, function(a, b) {\n        return _.flatten(_.map(a, function(x) {\n          return _.map(b, function(y) {\n            return [y].concat(x);\n          });\n        }), true);\n      }, [[]]);\n    }\n  });\n\n  isImage = function(name) {\n    return name.match(/\\.(jpe?g|png|gif|gifv|webm)/i) !== null;\n  };\n\n  patch = function(oldImmutable, newImmutable) {\n    var pathObj;\n    pathObj = {};\n    newImmutable.forEach(function(newValue, key) {\n      if (newValue !== oldImmutable.get(key)) {\n        if (newValue.toJS) {\n          return pathObj[key] = newValue.toJS();\n        } else {\n          return pathObj[key] = newValue;\n        }\n      }\n    });\n    return pathObj;\n  };\n\n  taiga = this.taiga;\n\n  taiga.addClass = addClass;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n  taiga.isImage = isImage;\n\n  taiga.patch = patch;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.includes(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, LoginPage, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  LoginPage = (function() {\n    LoginPage.$inject = ['tgCurrentUserService', '$location', '$tgNavUrls', '$routeParams'];\n\n    function LoginPage(currentUserService, $location, $navUrls, $routeParams) {\n      var url;\n      if (currentUserService.isAuthenticated()) {\n        url = $navUrls.resolve(\"home\");\n        if ($routeParams['next']) {\n          url = $routeParams['next'];\n          $location.search('next', null);\n        }\n        $location.path(url);\n      }\n    }\n\n    return LoginPage;\n\n  })();\n\n  module.controller('LoginPage', LoginPage);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config, translate, currentUserService1, themeService) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config;\n      this.translate = translate;\n      this.currentUserService = currentUserService1;\n      this.themeService = themeService;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        return this.currentUserService.setUser(this.userData);\n      } else {\n        return this.userData = null;\n      }\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.refresh = function() {\n      var url;\n      url = this.urls.resolve(\"user-me\");\n      return this.http.get(url).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = data.data;\n          user.token = _this.getUser().auth_token;\n          user = _this.model.make_model(\"users\", user);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      return this._setLocales();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.acceptInvitiationWithExistingUser = function(data) {\n      return this.register(data, \"private\", true);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, $routeParams, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var nextUrl, publicRegisterEnabled, url;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      url = $navUrls.resolve(\"register\");\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"register\")) {\n        nextUrl = encodeURIComponent($routeParams['next']);\n        url += \"?next=\" + nextUrl;\n      }\n      return template({\n        url: url\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$routeParams\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccess = function(response) {\n        $events.setupConnection();\n        return $location.url($scope.nextUrl);\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      $scope.onKeyUp = function(event) {\n        var target, value;\n        target = angular.element(event.currentTarget);\n        value = target.val();\n        $scope.iscapsLockActivated = false;\n        if (value !== value.toLowerCase()) {\n          return $scope.iscapsLockActivated = true;\n        }\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $routeParams, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      $scope.nextUrl = $navUrls.resolve(\"home\");\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        return $location.url($scope.nextUrl);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$routeParams\", \"$tgAnalytics\", \"$translate\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var message, title;\n        $location.path($navUrls.resolve(\"login\"));\n        title = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TITLE\");\n        message = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TEXT\");\n        return $confirm.success(title, message);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $params, $navUrls, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        return $scope.invitation = invitation;\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        return $confirm.notify(\"light-error\", response.data._error_message);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithExistingUser($scope.dataLogin);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              return $location.path($navUrls.resolve(\"home\"));\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"discover\": \"/discover\",\n    \"discover-search\": \"/discover/search\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/create-project\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"blocked-project\": \"/blocked-project/:project\",\n    \"project\": \"/project/:project\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\",\n    \"user-settings-contrib\": \"/user-settings/contrib/:plugin\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Autofocus, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, LightboxClose, ProjectUrl, Qqueue, QueueModelTransformation, SelectedText, Svg, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function(projectService) {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project && permission) {\n        if (project.get('my_permissions').indexOf(permission) > -1) {\n          return $el.removeClass('hidden');\n        }\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission, unObserve, unwatch;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      unwatch = $scope.$watch(function() {\n        return projectService.project;\n      }, function() {\n        if (!projectService.project) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unwatch();\n      });\n      unObserve = $attrs.$observe(\"tgCheckPermission\", function(permission) {\n        if (!permission) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unObserve();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CheckPermissionDirective.$inject = [\"tgProjectService\"];\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  QueueModelTransformation = (function(superClass) {\n    extend(QueueModelTransformation, superClass);\n\n    QueueModelTransformation.$inject = [\"$tgQqueue\", \"$tgRepo\", \"$q\", \"$tgModel\"];\n\n    function QueueModelTransformation(qqueue1, repo, q, model1) {\n      this.qqueue = qqueue1;\n      this.repo = repo;\n      this.q = q;\n      this.model = model1;\n    }\n\n    QueueModelTransformation.prototype.setObject = function(scope, prop) {\n      this.scope = scope;\n      this.prop = prop;\n    };\n\n    QueueModelTransformation.prototype.clone = function() {\n      var attrs, model;\n      attrs = _.cloneDeep(this.scope[this.prop]._attrs);\n      model = this.model.make_model(this.scope[this.prop]._name, attrs);\n      return model;\n    };\n\n    QueueModelTransformation.prototype.getObj = function() {\n      return this.scope[this.prop];\n    };\n\n    QueueModelTransformation.prototype.save = function(transformation) {\n      var defered;\n      defered = this.q.defer();\n      this.qqueue.add((function(_this) {\n        return function() {\n          var clone, comment, modified, obj, success;\n          obj = _this.getObj();\n          comment = obj.comment;\n          obj.comment = '';\n          clone = _this.clone();\n          modified = _.omit(obj._modifiedAttrs, ['version']);\n          clone = _.assign(clone, modified);\n          transformation(clone);\n          if (comment.length) {\n            clone.comment = comment;\n          }\n          success = function() {\n            _this.scope[_this.prop] = clone;\n            return defered.resolve.apply(null, arguments);\n          };\n          return _this.repo.save(clone).then(success, defered.reject);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    return QueueModelTransformation;\n\n  })(taiga.Service);\n\n  module.service(\"$tgQueueModelTransformation\", QueueModelTransformation);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function() {\n    var template;\n    template = \"<tg-svg class=\\\"capslock\\\" ng-if=\\\"capslockIcon && iscapsLockActivated\\\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgCapslock\", [Capslock]);\n\n  LightboxClose = function() {\n    var template;\n    template = \"<a class=\\\"close\\\" href=\\\"\\\" title=\\\"{{'COMMON.CLOSE' | translate}}\\\">\\n    <tg-svg svg-icon=\\\"icon-close\\\"></tg-svg>\\n</a>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgLightboxClose\", [LightboxClose]);\n\n  Svg = function() {\n    var template;\n    template = \"<svg class=\\\"{{ 'icon ' + svgIcon }}\\\">\\n    <use xlink:href=\\\"\\\" ng-attr-xlink:href=\\\"{{ '#' + svgIcon }}\\\">\\n        <title ng-if=\\\"svgTitle\\\">{{svgTitle}}</title>\\n        <title\\n            ng-if=\\\"svgTitleTranslate\\\"\\n            translate=\\\"{{svgTitleTranslate}}\\\"\\n            translate-values=\\\"{{svgTitleTranslateValues}}\\\"\\n            ></title>\\n    </use>\\n</svg>\";\n    return {\n      scope: {\n        svgIcon: \"@\",\n        svgTitle: \"@\",\n        svgTitleTranslate: \"@\",\n        svgTitleTranslateValues: \"=\"\n      },\n      template: template\n    };\n  };\n\n  module.directive(\"tgSvg\", [Svg]);\n\n  Autofocus = function($timeout) {\n    return {\n      restrict: 'A',\n      link: function($scope, $element) {\n        return $timeout(function() {\n          return $element[0].focus();\n        });\n      }\n    };\n  };\n\n  module.directive('tgAutofocus', ['$timeout', Autofocus]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.trimStart(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e, error1;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.stopHeartBeatMessages();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.startHeartBeatMessages();\n      this.notifications();\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      return this.error = true;\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      return this.stopHeartBeatMessages();\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        $el.html($compile(templateEdit({\n          task: task\n        }))($scope));\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".save-task\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        $el.off();\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".edit-task\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $analytics) {\n    var link, newTask;\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render, reset;\n      createTask = function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          return $scope.$emit(\"related-tasks:add\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      };\n      close = function() {\n        $el.off();\n        return $scope.openNewRelatedTask = false;\n      };\n      reset = function() {\n        newTask = {\n          subject: \"\",\n          assigned_to: null\n        };\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        return $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n      };\n      render = function() {\n        $scope.openNewRelatedTask = true;\n        return $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              reset();\n              return $el.find('input').focus();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n      };\n      $scope.save = function() {\n        return createTask(newTask).then(function() {\n          return close();\n        });\n      };\n      taiga.bindOnce($scope, \"us\", reset);\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return $scope.$apply(render);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      templateUrl: 'task/related-task-create-form.html'\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$tgAnalytics\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel, $template) {\n    var link, template;\n    template = $template.get(\"common/components/add-button.html\", true);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".add-button\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgTemplate\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var _isEditable, _isVisible, loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, 'ref');\n            return tasks;\n          };\n        })(this));\n      };\n      _isVisible = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"view_tasks\") !== -1;\n        }\n        return false;\n      };\n      _isEditable = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n        }\n        return false;\n      };\n      $scope.showRelatedTasks = function() {\n        var ref;\n        return _isVisible() && (_isEditable() || ((ref = $scope.tasks) != null ? ref.length : void 0));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[task.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $scope.$watch($attrs.tgRelatedTaskAssignedToInlineEdition, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n        return updateRelatedTask(task);\n      });\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"user-me\": \"/users/me\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"project-transfer-validate-token\": \"/projects/%s/transfer_validate_token\",\n    \"project-transfer-accept\": \"/projects/%s/transfer_accept\",\n    \"project-transfer-reject\": \"/projects/%s/transfer_reject\",\n    \"project-transfer-request\": \"/projects/%s/transfer_request\",\n    \"project-transfer-start\": \"/projects/%s/transfer_start\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"milestones\": \"/milestones\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-sprint-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\",\n    \"stats-discover\": \"/stats/discover\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate) {\n      var loadSearchData, promise;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.scope.sectionName = \"Search\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          return _this.fillUsersAndRoles(project.members, project.roles);\n        };\n      })(this));\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\".search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          tabsDom.find(\"li.\" + name).show();\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          return $location.search(\"text\", searchTerm);\n        }\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      return this.initialized = true;\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableDescriptionDirective, EditableSubjectDirective, EditableWysiwyg, ListItemAssignedtoDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0],\n          onSelect: (function(_this) {\n            return function(date) {\n              return selectedDate = date;\n            };\n          })(this),\n          onOpen: (function(_this) {\n            return function() {\n              if (selectedDate != null) {\n                return $el.picker.setDate(selectedDate);\n              }\n            };\n          })(this)\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          return initialize();\n        };\n      })(this));\n      $scope.$watch($attrs.ngModel, function(val) {\n        if ((val != null) && !$el.picker) {\n          initialize();\n        }\n        if (val != null) {\n          return $el.picker.setDate(val);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var ref;\n        if (model != null) {\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\"),\n            photo: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", CreatedByDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $modelTransform, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/watchers.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(watchers) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watchers;\n          return item;\n        });\n        transform.then(function() {\n          watchers = _.map(watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      deleteWatcher = function(watcherIds) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watcherIds;\n          return item;\n        });\n        transform.then(function() {\n          var item, watchers;\n          item = $modelTransform.getObj();\n          watchers = _.map(item.watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          item.revert();\n          return $confirm.notify(\"error\");\n        });\n      };\n      renderWatchers = function(watchers) {\n        var ctx, html;\n        ctx = {\n          watchers: watchers,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $modelTransform, $template, $translate, $compile, $currentUserService) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(userId) {\n        var currentLoading, item, transform;\n        item = $model.$modelValue.clone();\n        item.assigned_to = userId;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(item) {\n          item.assigned_to = userId;\n          return item;\n        });\n        transform.then(function() {\n          currentLoading.finish();\n          renderAssignedTo($modelTransform.getObj());\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        });\n        return transform;\n      };\n      renderAssignedTo = function(assignedObject) {\n        var ctx, fullName, html, isIocaine, isUnassigned, photo;\n        if ((assignedObject != null ? assignedObject.assigned_to : void 0) != null) {\n          fullName = assignedObject.assigned_to_extra_info.full_name_display;\n          photo = assignedObject.assigned_to_extra_info.photo;\n          isUnassigned = false;\n        } else {\n          fullName = $translate.instant(\"COMMON.ASSIGNED_TO.ASSIGN\");\n          photo = \"/\" + window._version + \"/images/unnamed.png\";\n          isUnassigned = true;\n        }\n        isIocaine = assignedObject != null ? assignedObject.is_iocaine : void 0;\n        ctx = {\n          fullName: fullName,\n          photo: photo,\n          isUnassigned: isUnassigned,\n          isEditable: isEditable(),\n          isIocaine: isIocaine,\n          fullNameVisible: !(isUnassigned && !$currentUserService.isAuthenticated())\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".assign-to-me\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        $model.$modelValue.assigned_to = $currentUserService.getUser().get('id');\n        return save($currentUserService.getUser().get('id'));\n      });\n      $el.on(\"click\", \".remove-user\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$translate\", \"$compile\", \"tgCurrentUserService\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').removeClass('is-active');\n          return $el.find('.item-unblock').addClass('is-active');\n        } else {\n          $el.find('.item-block').addClass('is-active');\n          return $el.find('.item-unblock').removeClass('is-active');\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableSubjectDirective = function($rootscope, $repo, $confirm, $loading, $modelTransform, $template) {\n    var link, template;\n    template = $template.get(\"common/components/editable-subject.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-subject').hide();\n        return $el.find('.view-subject').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = function(subject) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('.save-container')).start();\n        transform = $modelTransform.save(function(item) {\n          item.subject = subject;\n          return item;\n        });\n        transform.then((function(_this) {\n          return function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-subject').hide();\n            return $el.find('.view-subject').show();\n          };\n        })(this));\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n        return transform;\n      };\n      $el.click(function() {\n        if (!isEditable()) {\n          return;\n        }\n        $el.find('.edit-subject').show();\n        $el.find('.view-subject').hide();\n        return $el.find('input').focus();\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var subject;\n        e.preventDefault();\n        subject = $scope.item.subject;\n        return save(subject);\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var subject;\n        if (event.keyCode === 13) {\n          subject = $scope.item.subject;\n          return save(subject);\n        } else if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $model.$modelValue.revert();\n            };\n          })(this));\n          $el.find('.edit-subject').hide();\n          return $el.find('.view-subject').show();\n        }\n      });\n      $el.find('.edit-subject').hide();\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (!isEditable()) {\n          return $el.find('.view-subject .edit').remove();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableSubject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", EditableSubjectDirective]);\n\n  EditableDescriptionDirective = function($rootscope, $repo, $confirm, $compile, $loading, $selectedText, $modelTransform, $template, $translate) {\n    var link, noDescriptionMegEditMode, noDescriptionMegReadMode, template;\n    template = $template.get(\"common/components/editable-description.html\");\n    noDescriptionMegEditMode = $template.get(\"common/components/editable-description-msg-edit-mode.html\");\n    noDescriptionMegReadMode = $template.get(\"common/components/editable-description-msg-read-mode.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, isEditable, save;\n      $el.find('.edit-description').hide();\n      $el.find('.view-description .edit').hide();\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = function(description) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('.save-container')).start();\n        transform = $modelTransform.save(function(item) {\n          item.description = description;\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          $rootscope.$broadcast(\"object:updated\");\n          $el.find('.edit-description').hide();\n          return $el.find('.view-description').show();\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      };\n      cancelEdition = function() {\n        $scope.item.revert();\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      };\n      $el.on(\"mouseup\", \".view-description\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        $el.find('.edit-description').show();\n        $el.find('.view-description').hide();\n        return $el.find('textarea').focus();\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var description;\n        e.preventDefault();\n        description = $scope.item.description;\n        return save(description);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode !== 27) {\n          return;\n        }\n        return $scope.$applyAsync(function() {\n          var message, title;\n          title = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE\");\n          message = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE\");\n          return $confirm.ask(title, null, message).then(function(askResponse) {\n            cancelEdition();\n            return askResponse.finish();\n          });\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (isEditable()) {\n          $el.find('.view-description .edit').show();\n          $el.find('.view-description .us-content').addClass('editable');\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegEditMode)($scope);\n        } else {\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegReadMode)($scope);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableDescription\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", \"$tgLoading\", \"$selectedText\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$translate\", EditableDescriptionDirective]);\n\n  EditableWysiwyg = function(attachmentsService, attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var isInEditMode, uploadFile;\n      isInEditMode = function() {\n        return $el.find('textarea').is(':visible');\n      };\n      uploadFile = function(file, type) {\n        if (!attachmentsService.validate(file)) {\n          return;\n        }\n        return attachmentsFullService.addAttachment($model.$modelValue.project, $model.$modelValue.id, type, file).then(function(result) {\n          if (taiga.isImage(result.getIn(['file', 'name']))) {\n            return '![' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          } else {\n            return '[' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          }\n        });\n      };\n      $el.on('dragover', function(e) {\n        var textarea;\n        textarea = $el.find('textarea').focus();\n        return false;\n      });\n      return $el.on('drop', function(e) {\n        var dataTransfer, promises, textarea, type;\n        e.stopPropagation();\n        e.preventDefault();\n        if (isInEditMode()) {\n          dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n          textarea = $el.find('textarea');\n          textarea.addClass('in-progress');\n          type = $model.$modelValue['_name'];\n          if (type === \"userstories\") {\n            type = \"us\";\n          } else if (type === \"tasks\") {\n            type = \"task\";\n          } else if (type === \"issues\") {\n            type = \"issue\";\n          } else if (type === \"wiki\") {\n            type = \"wiki_page\";\n          }\n          promises = _.map(dataTransfer.files, function(file) {\n            return uploadFile(file, type);\n          });\n          return Promise.all(promises).then(function(result) {\n            textarea = $el.find('textarea');\n            $.markItUp({\n              replaceWith: result.join(' ')\n            });\n            return textarea.removeClass('in-progress');\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEditableWysiwyg\", [\"tgAttachmentsService\", \"tgAttachmentsFullService\", EditableWysiwyg]);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = usersById[item.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", \"$translate\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = i18nSectionName;\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      if (title) {\n        el.find(\".title\").text(title);\n      }\n      if (subtitle) {\n        el.find(\".subtitle\").text(subtitle);\n      }\n      if (message) {\n        el.find(\".message\").text(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").text(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").text(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        value = _.escape(value);\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\".title\").html(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message, icon) {\n      var defered, detailImage, el, svgContainer, useSVG;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      el.find(\"img\").remove();\n      el.find(\"svg\").remove();\n      if (icon) {\n        if (icon.type === \"img\") {\n          detailImage = $('<img>').addClass('lb-icon').attr('src', icon.name);\n        } else if (icon.type === \"svg\") {\n          detailImage = document.createElement(\"div\");\n          taiga.addClass(detailImage, \"icon\");\n          taiga.addClass(detailImage, icon.name);\n          taiga.addClass(detailImage, \"lb-icon\");\n          svgContainer = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n          useSVG = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n          useSVG.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + icon.name);\n          detailImage.appendChild(svgContainer).appendChild(useSVG);\n        }\n        if (detailImage) {\n          el.find('section').prepend(detailImage);\n        }\n      }\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message) {\n      var el;\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\".title\").html(title);\n            }\n            if (message) {\n              el.find(\".message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive').one('animationend', function() {\n            return $(this).removeClass('inactive');\n          });\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-close, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope, rootscope, repo, rs, confirm, q) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $el.on(\"click\", \".custom-fields-header .collapse\", function() {\n        var collapsed, hash;\n        hash = collapsedHash($attrs.type);\n        collapsed = !($storage.get(hash) || false);\n        $storage.set(hash, collapsed);\n        if (collapsed) {\n          $el.find(\".custom-fields-header .icon\").removeClass(\"open\");\n          return $el.find(\".custom-fields-body\").removeClass(\"open\");\n        } else {\n          $el.find(\".custom-fields-header .icon\").addClass(\"open\");\n          return $el.find(\".custom-fields-body\").addClass(\"open\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var collapsed;\n      collapsed = $storage.get(collapsedHash($attrs.type)) || false;\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm,\n        collapsed: collapsed\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)($scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)($scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, input;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          input = $el.find(\"input[name=value], textarea[name='value']\");\n          attributeValue.value = input.val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode span a\", function(event) {\n        return event.stopPropagation();\n      });\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \".js-edit-description\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".js-save-description\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile, $modelTransform, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = function(points) {\n        var onError, transform;\n        transform = $modelTransform.save((function(_this) {\n          return function(us) {\n            us.points = points;\n            return us;\n          };\n        })(this));\n        onError = (function(_this) {\n          return function() {\n            return $confirm.notify(\"error\");\n          };\n        })(this);\n        return transform.then(null, onError);\n      };\n      $scope.$watchCollection(function() {\n        return $model.$modelValue && $model.$modelValue.points;\n      }, function() {\n        var estimationProcess, us;\n        us = $model.$modelValue;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            return save(points).then(function() {\n              return $rootScope.$broadcast(\"object:updated\");\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", \"$tgQueueModelTransformation\", \"$tgConfirm\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $repo, $confirm, $q, $qqueue) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              return deferred.resolve();\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"?\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            return _this.onSelectedPointForRole(roleId, pointId, points);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgRepo\", \"$tgConfirm\", \"$q\", \"$tgQqueue\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var defaultFilter, module, momentFormat, momentFromNow, sizeFormat, taiga, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n  sizeFormat = (function(_this) {\n    return function() {\n      return _this.taiga.sizeFormat;\n    };\n  })(this);\n\n  module.filter(\"sizeFormat\", sizeFormat);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/history.coffee\n */\n\n(function() {\n  var HistoryController, HistoryDirective, IGNORED_FIELDS, bindOnce, debounce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  IGNORED_FIELDS = {\n    \"userstories.userstory\": [\"watchers\", \"kanban_order\", \"backlog_order\", \"sprint_order\", \"finish_date\", \"tribe_gig\"],\n    \"tasks.task\": [\"watchers\", \"us_order\", \"taskboard_order\"],\n    \"issues.issue\": [\"watchers\"]\n  };\n\n  HistoryController = (function(superClass) {\n    extend(HistoryController, superClass);\n\n    HistoryController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\"];\n\n    function HistoryController(scope, repo, rs) {\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n    }\n\n    HistoryController.prototype.initialize = function(type, objectId) {\n      this.type = type;\n      return this.objectId = objectId;\n    };\n\n    HistoryController.prototype.loadHistory = function(type, objectId) {\n      return this.rs.history.get(type, objectId).then((function(_this) {\n        return function(history) {\n          var changeModel, historyEntry, historyResult, i, j, len, len1;\n          for (i = 0, len = history.length; i < len; i++) {\n            historyResult = history[i];\n            if (historyResult.values_diff.description_diff != null) {\n              historyResult.values_diff.description = historyResult.values_diff.description_diff;\n            }\n            delete historyResult.values_diff.description_html;\n            delete historyResult.values_diff.description_diff;\n            if (historyResult.values_diff.blocked_note_diff != null) {\n              historyResult.values_diff.blocked_note = historyResult.values_diff.blocked_note_diff;\n            }\n            delete historyResult.values_diff.blocked_note_html;\n            delete historyResult.values_diff.blocked_note_diff;\n          }\n          for (j = 0, len1 = history.length; j < len1; j++) {\n            historyEntry = history[j];\n            changeModel = historyEntry.key.split(\":\")[0];\n            if (IGNORED_FIELDS[changeModel] != null) {\n              historyEntry.values_diff = _.removeKeys(historyEntry.values_diff, IGNORED_FIELDS[changeModel]);\n            }\n          }\n          _this.scope.history = _.filter(history, function(item) {\n            return Object.keys(item.values_diff).length > 0;\n          });\n          return _this.scope.comments = _.filter(history, function(item) {\n            return item.comment !== \"\";\n          });\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.deleteComment = function(type, objectId, activityId) {\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.undeleteComment = function(type, objectId, activityId) {\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    return HistoryController;\n\n  })(taiga.Controller);\n\n  HistoryDirective = function($log, $loading, $qqueue, $template, $confirm, $translate, $compile, $navUrls, $rootScope, checkPermissionsService) {\n    var link, templateActivity, templateBase, templateBaseEntries, templateChangeAttachment, templateChangeDiff, templateChangeGeneric, templateChangeList, templateChangePoints, templateDeletedComment;\n    templateChangeDiff = $template.get(\"common/history/history-change-diff.html\", true);\n    templateChangePoints = $template.get(\"common/history/history-change-points.html\", true);\n    templateChangeGeneric = $template.get(\"common/history/history-change-generic.html\", true);\n    templateChangeAttachment = $template.get(\"common/history/history-change-attachment.html\", true);\n    templateChangeList = $template.get(\"common/history/history-change-list.html\", true);\n    templateDeletedComment = $template.get(\"common/history/history-deleted-comment.html\", true);\n    templateActivity = $template.get(\"common/history/history-activity.html\", true);\n    templateBaseEntries = $template.get(\"common/history/history-base-entries.html\", true);\n    templateBase = $template.get(\"common/history/history-base.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var countChanges, formatChange, getHumanizedFieldName, getPrettyDateFormat, objectId, renderActivity, renderAttachmentEntry, renderBase, renderChange, renderChangeEntries, renderChangeEntry, renderChangesHelperText, renderComment, renderComments, renderCustomAttributesEntry, renderHistory, rerender, save, showAllActivity, showAllComments, type;\n      type = $attrs.type;\n      objectId = null;\n      showAllComments = false;\n      showAllActivity = false;\n      getPrettyDateFormat = function() {\n        return $translate.instant(\"ACTIVITY.DATETIME\");\n      };\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        type = $attrs.type;\n        objectId = model.id;\n        $ctrl.initialize(type, objectId);\n        return $ctrl.loadHistory(type, objectId);\n      });\n      getHumanizedFieldName = function(field) {\n        var humanizedFieldNames;\n        humanizedFieldNames = {\n          subject: $translate.instant(\"ACTIVITY.FIELDS.SUBJECT\"),\n          name: $translate.instant(\"ACTIVITY.FIELDS.NAME\"),\n          description: $translate.instant(\"ACTIVITY.FIELDS.DESCRIPTION\"),\n          content: $translate.instant(\"ACTIVITY.FIELDS.CONTENT\"),\n          status: $translate.instant(\"ACTIVITY.FIELDS.STATUS\"),\n          is_closed: $translate.instant(\"ACTIVITY.FIELDS.IS_CLOSED\"),\n          finish_date: $translate.instant(\"ACTIVITY.FIELDS.FINISH_DATE\"),\n          type: $translate.instant(\"ACTIVITY.FIELDS.TYPE\"),\n          priority: $translate.instant(\"ACTIVITY.FIELDS.PRIORITY\"),\n          severity: $translate.instant(\"ACTIVITY.FIELDS.SEVERITY\"),\n          assigned_to: $translate.instant(\"ACTIVITY.FIELDS.ASSIGNED_TO\"),\n          watchers: $translate.instant(\"ACTIVITY.FIELDS.WATCHERS\"),\n          milestone: $translate.instant(\"ACTIVITY.FIELDS.MILESTONE\"),\n          user_story: $translate.instant(\"ACTIVITY.FIELDS.USER_STORY\"),\n          project: $translate.instant(\"ACTIVITY.FIELDS.PROJECT\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          points: $translate.instant(\"ACTIVITY.FIELDS.POINTS\"),\n          client_requirement: $translate.instant(\"ACTIVITY.FIELDS.CLIENT_REQUIREMENT\"),\n          team_requirement: $translate.instant(\"ACTIVITY.FIELDS.TEAM_REQUIREMENT\"),\n          is_iocaine: $translate.instant(\"ACTIVITY.FIELDS.IS_IOCAINE\"),\n          tags: $translate.instant(\"ACTIVITY.FIELDS.TAGS\"),\n          attachments: $translate.instant(\"ACTIVITY.FIELDS.ATTACHMENTS\"),\n          is_deprecated: $translate.instant(\"ACTIVITY.FIELDS.IS_DEPRECATED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          order: $translate.instant(\"ACTIVITY.FIELDS.ORDER\"),\n          backlog_order: $translate.instant(\"ACTIVITY.FIELDS.BACKLOG_ORDER\"),\n          sprint_order: $translate.instant(\"ACTIVITY.FIELDS.SPRINT_ORDER\"),\n          kanban_order: $translate.instant(\"ACTIVITY.FIELDS.KANBAN_ORDER\"),\n          taskboard_order: $translate.instant(\"ACTIVITY.FIELDS.TASKBOARD_ORDER\"),\n          us_order: $translate.instant(\"ACTIVITY.FIELDS.US_ORDER\")\n        };\n        return humanizedFieldNames[field] || field;\n      };\n      countChanges = function(comment) {\n        return _.keys(comment.values_diff).length;\n      };\n      formatChange = function(change) {\n        if (_.isArray(change)) {\n          if (change.length === 0) {\n            return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n          }\n          return change.join(\", \");\n        }\n        if (change === \"\") {\n          return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n        }\n        if ((change == null) || change === false) {\n          return $translate.instant(\"ACTIVITY.VALUES.NO\");\n        }\n        if (change === true) {\n          return $translate.instant(\"ACTIVITY.VALUES.YES\");\n        }\n        return change;\n      };\n      renderAttachmentEntry = function(value) {\n        var attachments;\n        attachments = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.NEW_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var diff, name;\n              name = $translate.instant(\"ACTIVITY.UPDATED_ATTACHMENT\", {\n                filename: change.filename\n              });\n              diff = _.map(change.changes, function(values, name) {\n                return {\n                  name: getHumanizedFieldName(name),\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                };\n              });\n              return templateChangeAttachment({\n                name: name,\n                diff: diff\n              });\n            });\n          }\n        });\n        return _.flatten(attachments).join(\"\\n\");\n      };\n      renderCustomAttributesEntry = function(value) {\n        var customAttributes;\n        customAttributes = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              var html;\n              html = templateChangeGeneric({\n                name: change.name,\n                from: formatChange(\"\"),\n                to: formatChange(change.value)\n              });\n              html = $compile(html)($scope);\n              return html[0].outerHTML;\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_CUSTOM_ATTRIBUTE\"),\n                diff: change.name\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var customAttrsChanges;\n              customAttrsChanges = _.map(change.changes, function(values) {\n                return templateChangeGeneric({\n                  name: change.name,\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                });\n              });\n              return _.flatten(customAttrsChanges).join(\"\\n\");\n            });\n          }\n        });\n        return _.flatten(customAttributes).join(\"\\n\");\n      };\n      renderChangeEntry = function(field, value) {\n        var added, from, html, name, removed, to;\n        if (field === \"description\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"description\"),\n            diff: value[1]\n          });\n        } else if (field === \"blocked_note\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"blocked_note\"),\n            diff: value[1]\n          });\n        } else if (field === \"points\") {\n          html = templateChangePoints({\n            points: value\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"attachments\") {\n          return renderAttachmentEntry(value);\n        } else if (field === \"custom_attributes\") {\n          return renderCustomAttributesEntry(value);\n        } else if (field === \"tags\" || field === \"watchers\") {\n          name = getHumanizedFieldName(field);\n          removed = _.difference(value[0], value[1]);\n          added = _.difference(value[1], value[0]);\n          html = templateChangeList({\n            name: name,\n            removed: removed,\n            added: added\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"assigned_to\") {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          to = formatChange(value[1] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        } else {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0]);\n          to = formatChange(value[1]);\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        }\n      };\n      renderChangeEntries = function(change) {\n        return _.map(change.values_diff, function(value, field) {\n          return renderChangeEntry(field, value);\n        });\n      };\n      renderChangesHelperText = function(change) {\n        var size;\n        size = countChanges(change);\n        return $translate.instant(\"ACTIVITY.SIZE_CHANGE\", {\n          size: size\n        }, 'messageformat');\n      };\n      renderComment = function(comment) {\n        var html, ref, ref1, ref2;\n        if (comment.delete_comment_date || ((ref = comment.delete_comment_user) != null ? ref.name : void 0)) {\n          html = templateDeletedComment({\n            deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n            deleteCommentUser: comment.delete_comment_user.name,\n            deleteComment: comment.comment_html,\n            activityId: comment.id,\n            canRestoreComment: $scope.user && (comment.delete_comment_user.pk === $scope.user.id || $scope.project.my_permissions.indexOf(\"modify_project\") > -1)\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        }\n        html = templateActivity({\n          avatar: comment.user.photo,\n          userFullName: comment.user.name,\n          userProfileUrl: comment.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: comment.user.username\n          }) : \"\",\n          creationDate: moment(comment.created_at).format(getPrettyDateFormat()),\n          comment: comment.comment_html,\n          changesText: renderChangesHelperText(comment),\n          changes: renderChangeEntries(comment),\n          mode: \"comment\",\n          deleteCommentActionTitle: $translate.instant(\"COMMENTS.DELETE\"),\n          deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref1 = comment.delete_comment_user) != null ? ref1.name : void 0) ? comment.delete_comment_user.name : void 0,\n          activityId: comment.id,\n          canDeleteComment: comment.user.pk === ((ref2 = $scope.user) != null ? ref2.id : void 0) || $scope.project.my_permissions.indexOf(\"modify_project\") > -1\n        });\n        html = $compile(html)($scope);\n        return html[0].outerHTML;\n      };\n      renderChange = function(change) {\n        var ref;\n        return templateActivity({\n          avatar: change.user.photo,\n          userFullName: change.user.name,\n          userProfileUrl: change.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: change.user.username\n          }) : \"\",\n          creationDate: moment(change.created_at).format(getPrettyDateFormat()),\n          comment: change.comment_html,\n          changes: renderChangeEntries(change),\n          changesText: \"\",\n          mode: \"activity\",\n          deleteCommentDate: change.delete_comment_date ? moment(change.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref = change.delete_comment_user) != null ? ref.name : void 0) ? change.delete_comment_user.name : void 0,\n          activityId: change.id\n        });\n      };\n      renderHistory = function(entries, totalEntries) {\n        var html, showMore;\n        if (entries.length === totalEntries) {\n          showMore = 0;\n        } else {\n          showMore = totalEntries - entries.length;\n        }\n        html = templateBaseEntries({\n          entries: entries,\n          showMore: showMore\n        });\n        html = $compile(html)($scope);\n        return html;\n      };\n      renderBase = function() {\n        var changes, comments, commentsVisible, historyVisible, html;\n        comments = $scope.comments || [];\n        changes = $scope.history || [];\n        historyVisible = !!changes.length;\n        commentsVisible = (!!comments.length) || checkPermissionsService.check('modify_' + $attrs.type);\n        html = templateBase({\n          ngmodel: $attrs.ngModel,\n          type: $attrs.type,\n          mode: $attrs.mode,\n          historyVisible: historyVisible,\n          commentsVisible: commentsVisible\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      rerender = function() {\n        renderBase();\n        renderComments();\n        return renderActivity();\n      };\n      renderComments = function() {\n        var comments, html, totalComments;\n        comments = $scope.comments || [];\n        totalComments = comments.length;\n        if (!showAllComments) {\n          comments = _.takeRight(comments, 4);\n        }\n        comments = _.map(comments, function(x) {\n          return renderComment(x);\n        });\n        html = renderHistory(comments, totalComments);\n        return $el.find(\".comments-list\").html(html);\n      };\n      renderActivity = function() {\n        var changes, html, totalChanges;\n        changes = $scope.history || [];\n        totalChanges = changes.length;\n        if (!showAllActivity) {\n          changes = _.takeRight(changes, 4);\n        }\n        changes = _.map(changes, function(x) {\n          return renderChange(x);\n        });\n        html = renderHistory(changes, totalChanges);\n        return $el.find(\".changes-list\").html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(target) {\n          var currentLoading, model, onError, onSuccess;\n          $scope.$broadcast(\"markdown-editor:submit\");\n          $el.find(\".comment-list\").addClass(\"activeanimation\");\n          currentLoading = $loading().target(target).start();\n          onSuccess = function() {\n            $rootScope.$broadcast(\"comment:new\");\n            return $ctrl.loadHistory(type, objectId)[\"finally\"](function() {\n              return currentLoading.finish();\n            });\n          };\n          onError = function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          };\n          model = $scope.$eval($attrs.ngModel);\n          return $ctrl.repo.save(model).then(onSuccess, onError);\n        };\n      })(this));\n      $scope.$watch(\"comments\", rerender);\n      $scope.$watch(\"history\", rerender);\n      $scope.$on(\"object:updated\", function() {\n        return $ctrl.loadHistory(type, objectId);\n      });\n      $el.on(\"click\", \".add-comment .button-green\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      }));\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href && href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".show-more\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.parent().is(\".changes-list\")) {\n          showAllActivity = !showAllActivity;\n          return renderActivity();\n        } else {\n          showAllComments = !showAllComments;\n          return renderComments();\n        }\n      });\n      $el.on(\"click\", \".show-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').show();\n        target.parents('.activity-single').find('.show-deleted-comment').hide();\n        return target.parents('.activity-single').find('.comment-body').show();\n      });\n      $el.on(\"click\", \".hide-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').hide();\n        target.parents('.activity-single').find('.show-deleted-comment').show();\n        return target.parents('.activity-single').find('.comment-body').hide();\n      });\n      $el.on(\"click\", \".changes-title\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return target.parent().find(\".change-entry\").toggleClass(\"active\");\n      });\n      $el.on(\"focus\", \".add-comment textarea\", function(event) {\n        return $(this).addClass('active');\n      });\n      $el.on(\"click\", \".history-tabs a\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        $el.find(\".history-tabs li\").removeClass(\"active\");\n        target.parent().addClass(\"active\");\n        $el.find(\".history section\").addClass(\"hidden\");\n        return $el.find(\".history section.\" + (target.data('section-class'))).removeClass(\"hidden\");\n      });\n      $el.on(\"click\", \".comment-delete\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.deleteComment(type, objectId, activityId);\n      }));\n      $el.on(\"click\", \".comment-restore\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.undeleteComment(type, objectId, activityId);\n      }));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return renderBase();\n    };\n    return {\n      controller: HistoryController,\n      restrict: \"AE\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", [\"$log\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$tgConfirm\", \"$translate\", \"$compile\", \"$tgNavUrls\", \"$rootScope\", \"tgCheckPermissionsService\", HistoryDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/importer.coffee\n */\n\n(function() {\n  var ImportProjectButtonDirective, LbImportErrorDirective, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  ImportProjectButtonDirective = function($rs, $confirm, $location, $navUrls, $translate, $lightboxFactory, currentUserService, $tgAuth) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getRestrictionError;\n      getRestrictionError = function(result) {\n        var errorKey, maxMemberships, membersError, privateError, publicError, user;\n        if (result.headers) {\n          errorKey = '';\n          user = currentUserService.getUser();\n          maxMemberships = 0;\n          if (result.headers.isPrivate) {\n            privateError = !currentUserService.canCreatePrivateProjects().valid;\n            maxMemberships = null;\n            if (user.get('max_memberships_private_projects') !== null && result.headers.memberships >= user.get('max_memberships_private_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (privateError && membersError) {\n              errorKey = 'private-space-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            } else if (privateError) {\n              errorKey = 'private-space';\n            } else if (membersError) {\n              errorKey = 'private-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            }\n          } else {\n            publicError = !currentUserService.canCreatePublicProjects().valid;\n            if (user.get('max_memberships_public_projects') !== null && result.headers.memberships >= user.get('max_memberships_public_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (publicError && membersError) {\n              errorKey = 'public-space-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            } else if (publicError) {\n              errorKey = 'public-space';\n            } else if (membersError) {\n              errorKey = 'public-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            }\n          }\n          return {\n            key: errorKey,\n            values: {\n              max_memberships: maxMemberships,\n              members: result.headers.memberships\n            }\n          };\n        } else {\n          return false;\n        }\n      };\n      $el.on(\"click\", \".import-project-button\", function(event) {\n        event.preventDefault();\n        $el.find(\"input.import-file\").val(\"\");\n        return $el.find(\"input.import-file\").trigger(\"click\");\n      });\n      return $el.on(\"change\", \"input.import-file\", function(event) {\n        var file, loader, onError, onSuccess;\n        event.preventDefault();\n        file = event.target.files[0];\n        if (!file) {\n          return;\n        }\n        loader = $confirm.loader($translate.instant(\"PROJECT.IMPORT.UPLOADING_FILE\"));\n        onSuccess = function(result) {\n          return currentUserService.loadProjects().then(function() {\n            var ctx, message, msg, title;\n            loader.stop();\n            if (result.status === 202) {\n              title = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE\");\n              message = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE\");\n              return $confirm.success(title, message);\n            } else {\n              ctx = {\n                project: result.data.slug\n              };\n              $location.path($navUrls.resolve(\"project-admin-project-profile-details\", ctx));\n              msg = $translate.instant(\"PROJECT.IMPORT.SYNC_SUCCESS\");\n              return $confirm.notify(\"success\", msg);\n            }\n          });\n        };\n        onError = function(result) {\n          return $tgAuth.refresh().then(function() {\n            var errorMsg, ref, restrictionError;\n            restrictionError = getRestrictionError(result);\n            loader.stop();\n            if (restrictionError) {\n              return $lightboxFactory.create('tg-lb-import-error', {\n                \"class\": 'lightbox lightbox-import-error'\n              }, restrictionError);\n            } else {\n              errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR\");\n              if (result.status === 429) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n              } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n                  error_message: result.data._error_message\n                });\n              }\n              return $confirm.notify(\"error\", errorMsg);\n            }\n          });\n        };\n        loader.start();\n        return $rs.projects[\"import\"](file, loader.update).then(onSuccess, onError);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgImportProjectButton\", [\"$tgResources\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", \"$tgAuth\", ImportProjectButtonDirective]);\n\n  LbImportErrorDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      lightboxService.open(el);\n      return scope.close = function() {\n        lightboxService.close(el);\n      };\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-import-error.html\",\n      link: link\n    };\n  };\n\n  LbImportErrorDirective.$inject = [\"lightboxService\"];\n\n  module.directive(\"tgLbImportError\", LbImportErrorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, AttachmentPreviewLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxLeaveProjectWarningDirective, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, sizeFormat, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n    }\n\n    LightboxService.prototype.open = function($el) {\n      var defered, docEl, lightboxContent;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            var firstField;\n            firstField = $el.find('input,textarea').first();\n            if (firstField.length) {\n              return $el.find('input,textarea').first().focus();\n            } else if (document.activeElement) {\n              return $(document.activeElement).blur();\n            }\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            return _this.close($el);\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      var docEl, scope;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      docEl = angular.element(document);\n      docEl.off(\".lightbox\");\n      docEl.off(\".keyboard-navigation\");\n      this.animationFrame.add(function() {\n        $el.addClass('close');\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            $el.removeAttr('style');\n            return $el.removeClass(\"open\").removeClass('close');\n          };\n        })(this));\n      });\n      if ($el.hasClass(\"remove-on-close\")) {\n        scope = $el.data(\"scope\");\n        if (scope) {\n          scope.$destroy();\n        }\n        return $el.remove();\n      }\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $modelTransform, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = (function(_this) {\n        return function(finishCallback) {\n          var transform;\n          transform = $modelTransform.save(function(item) {\n            item.is_blocked = false;\n            item.blocked_note = \"\";\n            return item;\n          });\n          transform.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            return finishCallback();\n          });\n          transform.then(null, function() {\n            $confirm.notify(\"error\");\n            return item.revert();\n          });\n          transform[\"finally\"](function() {\n            return finishCallback();\n          });\n          return transform;\n        };\n      })(this);\n      block = function() {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\".button-green\")).start();\n        transform = $modelTransform.save(function(item) {\n          item.is_blocked = true;\n          item.blocked_note = $el.find(\".reason\").val();\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          currentLoading.finish();\n          return lightboxService.close($el);\n        });\n      };\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          return unblock(finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return block();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate, $confirm, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, form, resetAttachments, submit, submitButton;\n      form = null;\n      $scope.createEditUs = {};\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        if (form) {\n          form.reset();\n        }\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us, attachments) {\n        if (form) {\n          form.reset();\n        }\n        $scope.us = us;\n        $scope.attachments = Immutable.fromJS(attachments);\n        $scope.isNew = false;\n        resetAttachments();\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        return lightboxService.open($el);\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.us.project, 'us');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"us\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this));\n            return data;\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootScope.$broadcast(broadcastEvent, data);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", \"$tgConfirm\", \"$q\", \"tgAttachmentsService\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n        normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n        normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n        normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n        normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.includes(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        ctx = {\n          selected: selected,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.includes(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html;\n        ctx = {\n          selected: false,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(200, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", WatchersLightboxDirective]);\n\n  AttachmentPreviewLightboxDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-attachment-preview.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLbAttachmentPreview\", [\"lightboxService\", \"$tgTemplate\", \"$compile\", AttachmentPreviewLightboxDirective]);\n\n  LightboxLeaveProjectWarningDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-leave-project-warning.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLightboxLeaveProjectWarning\", [\"lightboxService\", LightboxLeaveProjectWarningDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          if (!target.hasClass('loading') && !service.settings.template) {\n            service.settings.template = target.html();\n          }\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(100).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      $scope.$watch($attrs.tgRelatedTaskStatus, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskStatus);\n        return updateTaskStatus($el, task, $scope.taskStatusById);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsDirective, LbTagLineDirective, TagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsDirective = function() {\n    var link, templates;\n    templates = {\n      backlog: _.template(\"<% _.each(tags, function(tag) { %>\\n    <span class=\\\"tag\\\" style=\\\"border-left: 5px solid <%- tag.color %>\\\"><%- tag.name %></span>\\n<% }) %>\"),\n      kanban: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"kanban-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\"),\n      taskboard: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"taskboard-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\")\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(srcTags) {\n        var html, tags, template;\n        template = templates[$attrs.tgColorizeTagsType];\n        srcTags.sort();\n        tags = _.map(srcTags, function(tag) {\n          var color;\n          color = $scope.project.tags_colors[tag];\n          return {\n            name: tag,\n            color: color\n          };\n        });\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeTags\", ColorizeTagsDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, autocomplete, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    autocomplete = null;\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, renderTags, resetInput, saveInputTag, showSaveButton;\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          })\n        };\n        _.map(ctx.tags, (function(_this) {\n          return function(tag) {\n            if (tag.color) {\n              return tag.style = \"border-left: 5px solid \" + tag.color;\n            }\n          };\n        })(this));\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\".tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          event.preventDefault();\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var input;\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(project.tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n  TagLineDirective = function($rootScope, $repo, $rs, $confirm, $modelTransform, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, ESC_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    ESC_KEY = 27;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/tags-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, autocomplete, deleteValue, hideAddTagButton, hideAddTagButtonText, hideInput, hideSaveButton, isEditable, renderInReadModeOnly, renderTags, resetInput, saveInputTag, showAddTagButton, showAddTagButtonText, showInput, showSaveButton;\n      autocomplete = null;\n      isEditable = function() {\n        if ($attrs.requiredPerm != null) {\n          return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n        }\n        return true;\n      };\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          }),\n          isEditable: isEditable()\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      renderInReadModeOnly = function() {\n        $el.find(\".add-tag\").remove();\n        $el.find(\"input\").remove();\n        return $el.find(\".save\").remove();\n      };\n      showAddTagButton = function() {\n        return $el.find(\".add-tag\").removeClass(\"hidden\");\n      };\n      hideAddTagButton = function() {\n        return $el.find(\".add-tag\").addClass(\"hidden\");\n      };\n      showAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").removeClass(\"hidden\");\n      };\n      hideAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").addClass(\"hidden\");\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      showInput = function() {\n        return $el.find(\"input\").removeClass(\"hidden\").focus();\n      };\n      hideInput = function() {\n        return $el.find(\"input\").addClass(\"hidden\").blur();\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = function(value) {\n        var onError, onSuccess, transform;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        transform = $modelTransform.save(function(item) {\n          var tags;\n          if (!item.tags) {\n            item.tags = [];\n          }\n          tags = _.clone(item.tags);\n          if (indexOf.call(tags, value) < 0) {\n            tags.push(value);\n          }\n          item.tags = tags;\n          return item;\n        });\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        hideSaveButton();\n        return transform.then(onSuccess, onError);\n      };\n      deleteValue = function(value) {\n        var onError, onSuccess, transform;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        transform = $modelTransform.save(function(item) {\n          var tags;\n          tags = _.clone(item.tags, false);\n          item.tags = _.pull(tags, value);\n          return item;\n        });\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        return transform.then(onSuccess, onError);\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === ESC_KEY) {\n          resetInput();\n          hideInput();\n          hideSaveButton();\n          return showAddTagButton();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".add-tag\", function(event) {\n        event.preventDefault();\n        hideAddTagButton();\n        return showInput();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project.tags_colors\", function(tags_colors) {\n        var input;\n        if (!isEditable()) {\n          renderInReadModeOnly();\n          return;\n        }\n        showAddTagButton();\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watchCollection(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.tags : void 0;\n      }, function() {\n        var model, ref, ref1, tagsColors;\n        model = $model.$modelValue;\n        if (!model) {\n          return;\n        }\n        if ((ref = model.tags) != null ? ref.length : void 0) {\n          hideAddTagButtonText();\n        } else {\n          showAddTagButtonText();\n        }\n        tagsColors = ((ref1 = $scope.project) != null ? ref1.tags_colors : void 0) || [];\n        return renderTags(model.tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgTagLine\", [\"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", TagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/wisiwyg.coffee\n */\n\n(function() {\n  var MarkitupDirective, bindOnce, module, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  MarkitupDirective = function($rootscope, $rs, $selectedText, $template, $compile, $translate) {\n    var link, previewTemplate;\n    previewTemplate = $template.get(\"common/wysiwyg/wysiwyg-markitup-preview.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addLine, cancelablePromise, closePreviewMode, element, markdownTitle, prepareUrlFormatting, preview, previewDomNode, previewInProgress, renderMarkItUp, setCaretPosition, unbind, urlFormatting;\n      element = angular.element($el);\n      previewDomNode = $(\"<div/>\", {\n        \"class\": \"preview\"\n      });\n      closePreviewMode = function() {\n        element.parents(\".markdown\").find(\".preview\").remove();\n        return element.parents(\".markItUp\").show();\n      };\n      $scope.$on(\"markdown-editor:submit\", function() {\n        return closePreviewMode();\n      });\n      cancelablePromise = null;\n      previewInProgress = false;\n      preview = function() {\n        var markItUpDomNode, markdownDomNode;\n        if (previewInProgress) {\n          return;\n        }\n        previewInProgress = true;\n        markdownDomNode = element.parents(\".markdown\");\n        markItUpDomNode = element.parents(\".markItUp\");\n        return $rs.mdrender.render($scope.projectId, $model.$modelValue).then(function(data) {\n          var html, markdown;\n          html = previewTemplate({\n            data: data.data\n          });\n          html = $compile(html)($scope);\n          markdownDomNode.append(html);\n          markItUpDomNode.hide();\n          previewInProgress = false;\n          markdown = element.closest(\".markdown\");\n          return markdown.on(\"mouseup.preview\", \".preview\", function(event) {\n            var target;\n            event.preventDefault();\n            target = angular.element(event.target);\n            if (!target.is('a') && $selectedText.get().length) {\n              return;\n            }\n            markdown.off(\".preview\");\n            return closePreviewMode();\n          });\n        });\n      };\n      setCaretPosition = function(textarea, caretPosition) {\n        var line, range, scrollRelation, totalLines;\n        if (textarea.createTextRange) {\n          range = textarea.createTextRange();\n          range.move(\"character\", caretPosition);\n          range.select();\n        } else if (textarea.selectionStart) {\n          textarea.focus();\n          textarea.setSelectionRange(caretPosition, caretPosition);\n        }\n        totalLines = textarea.value.split(\"\\n\").length;\n        line = textarea.value.slice(0, +(caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n        scrollRelation = line / totalLines;\n        return $el.scrollTop((scrollRelation * $el[0].scrollHeight) - ($el.height() / 2));\n      };\n      addLine = function(textarea, nline, replace) {\n        var cursorPosition, j, key, len, line, lines;\n        lines = textarea.value.split(\"\\n\");\n        if (replace) {\n          lines[nline] = replace + lines[nline];\n        } else {\n          lines[nline] = \"\";\n        }\n        cursorPosition = 0;\n        for (key = j = 0, len = lines.length; j < len; key = ++j) {\n          line = lines[key];\n          cursorPosition += line.length + 1 || 1;\n          if (key === nline) {\n            break;\n          }\n        }\n        textarea.value = lines.join(\"\\n\");\n        if (replace) {\n          return cursorPosition - lines[nline].length + replace.length - 1;\n        } else {\n          return cursorPosition;\n        }\n      };\n      prepareUrlFormatting = function(markItUp) {\n        var indices, regex, result;\n        regex = /(<<<|>>>)/gi;\n        result = 0;\n        indices = [];\n        while ((result = regex.exec(markItUp.textarea.value))) {\n          indices.push(result.index);\n        }\n        return markItUp.donotparse = indices;\n      };\n      urlFormatting = function(markItUp) {\n        var endIndex, ref, ref1, regex, result, startIndex, url, value;\n        regex = /<<</gi;\n        result = 0;\n        startIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref = result.index, indexOf.call(markItUp.donotparse, ref) < 0) {\n            startIndex = result.index;\n            break;\n          }\n        }\n        if (!result) {\n          return;\n        }\n        regex = />>>/gi;\n        endIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref1 = result.index, indexOf.call(markItUp.donotparse, ref1) < 0) {\n            endIndex = result.index;\n            break;\n          }\n        }\n        value = markItUp.textarea.value;\n        url = value.substring(startIndex, endIndex).replace('<<<', '').replace('>>>', '');\n        url = url.replace('(', '%28').replace(')', '%29');\n        url = url.replace('[', '%5B').replace(']', '%5D');\n        value = value.substring(0, startIndex) + url + value.substring(endIndex + 3, value.length);\n        markItUp.textarea.value = value;\n        return markItUp.donotparse = void 0;\n      };\n      markdownTitle = function(markItUp, char) {\n        var heading, i, j, n, ref;\n        heading = \"\";\n        n = $.trim(markItUp.selection || markItUp.placeHolder).length;\n        for (i = j = 0, ref = n - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n          heading += char;\n        }\n        return \"\\n\" + heading + \"\\n\";\n      };\n      renderMarkItUp = function() {\n        var markdownSettings;\n        markdownSettings = {\n          nameSpace: \"markdown\",\n          onShiftEnter: {\n            keepDefault: false,\n            openWith: \"\\n\\n\"\n          },\n          onEnter: {\n            keepDefault: false,\n            replaceWith: function() {\n              if (!$('.textcomplete-dropdown').is(':visible')) {\n                return \"\\n\";\n              }\n            },\n            afterInsert: function(data) {\n              var cursorLine, emptyListItem, lastLine, lines, markdownCaretPositon, match, newLineContent, nline, replace;\n              lines = data.textarea.value.split(\"\\n\");\n              if (data.caretPosition > 0) {\n                cursorLine = data.textarea.value.slice(0, +(data.caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n              } else {\n                cursorLine = 1;\n              }\n              newLineContent = data.textarea.value.slice(data.caretPosition).split(\"\\n\")[0];\n              lastLine = lines[cursorLine - 1];\n              match = lastLine.match(/^(\\s*- ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)\\-\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*\\* ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*\\* )$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*)(\\d+)\\.\\s/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)(\\d+)\\.\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = (match[1] + (parseInt(match[2], 10) + 1)) + \". \";\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              if (markdownCaretPositon) {\n                return setCaretPosition(data.textarea, markdownCaretPositon);\n              }\n            }\n          },\n          markupSet: [\n            {\n              name: $translate.instant(\"COMMON.WYSIWYG.H1_BUTTON\"),\n              key: \"1\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H1_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"=\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H2_BUTTON\"),\n              key: \"2\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H2_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"-\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H3_BUTTON\"),\n              key: \"3\",\n              openWith: \"### \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H3_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON\"),\n              key: \"B\",\n              openWith: \"**\",\n              closeWith: \"**\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\"),\n              key: \"I\",\n              openWith: \"_\",\n              closeWith: \"_\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.STRIKE_BUTTON\"),\n              key: \"S\",\n              openWith: \"~~\",\n              closeWith: \"~~\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_BUTTON\"),\n              openWith: \"- \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_BUTTON\"),\n              openWith: function(markItUp) {\n                return markItUp.line + \". \";\n              },\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PICTURE_BUTTON\"),\n              key: \"P\",\n              openWith: \"![\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.LINK_BUTTON\"),\n              key: \"L\",\n              openWith: \"[\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.LINK_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON\"),\n              openWith: \"> \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_BUTTON\"),\n              openWith: \"```\\n\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT\"),\n              closeWith: \"\\n```\"\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PREVIEW_BUTTON\"),\n              call: preview,\n              className: \"preview-icon\"\n            }\n          ],\n          afterInsert: function(event) {\n            var target;\n            target = angular.element(event.textarea);\n            return $model.$setViewValue(target.val());\n          }\n        };\n        return element.markItUpRemove().markItUp(markdownSettings).textcomplete([\n          {\n            cache: true,\n            match: /(^|\\s)#([a-z0-9]+)$/i,\n            search: function(term, callback) {\n              var filter, searchProps, searchTypes;\n              term = taiga.slugify(term);\n              searchTypes = ['issues', 'tasks', 'userstories'];\n              searchProps = ['ref', 'subject'];\n              filter = (function(_this) {\n                return function(item) {\n                  var j, len, prop;\n                  for (j = 0, len = searchProps.length; j < len; j++) {\n                    prop = searchProps[j];\n                    if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                      return true;\n                    }\n                  }\n                  return false;\n                };\n              })(this);\n              if (cancelablePromise) {\n                cancelablePromise.abort();\n              }\n              cancelablePromise = $rs.search[\"do\"]($scope.projectId, term);\n              cancelablePromise.then((function(_this) {\n                return function(res) {\n                  var j, len, results, type;\n                  if (res.count < 1 || res.count === res.wikipages.length) {\n                    return callback([]);\n                  } else {\n                    results = [];\n                    for (j = 0, len = searchTypes.length; j < len; j++) {\n                      type = searchTypes[j];\n                      if (res[type] && res[type].length > 0) {\n                        results.push(callback(res[type].filter(filter), true));\n                      } else {\n                        results.push(void 0);\n                      }\n                    }\n                    return results;\n                  }\n                };\n              })(this));\n              return callback([]);\n            },\n            replace: function(res) {\n              return \"$1\\#\" + res.ref + \" \";\n            },\n            template: function(res, term) {\n              return \"\\#\" + res.ref + \" - \" + res.subject;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)@([a-z0-9\\-\\._]{2,})$/i,\n            search: function(term, callback) {\n              var searchProps, username;\n              username = taiga.slugify(term);\n              searchProps = ['username', 'full_name', 'full_name_display'];\n              if ($scope.project.members.length < 1) {\n                return callback([]);\n              } else {\n                return callback($scope.project.members.filter((function(_this) {\n                  return function(user) {\n                    var j, len, prop;\n                    for (j = 0, len = searchProps.length; j < len; j++) {\n                      prop = searchProps[j];\n                      if (taiga.slugify(user[prop]).indexOf(username) >= 0) {\n                        return true;\n                      }\n                    }\n                    return false;\n                  };\n                })(this)));\n              }\n            },\n            replace: function(user) {\n              return \"$1@\" + user.username + \" \";\n            },\n            template: function(user) {\n              return user.username + \" - \" + user.full_name_display;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)\\[\\[([a-z0-9\\-]+)$/i,\n            search: function(term, callback) {\n              term = taiga.slugify(term);\n              return $rs.search[\"do\"]($scope.projectId, term).then((function(_this) {\n                return function(res) {\n                  if (res.count < 1) {\n                    callback([]);\n                  }\n                  if (res.count < 1 || !res.wikipages || res.wikipages.length <= 0) {\n                    callback([]);\n                  } else {\n                    callback(res.wikipages.filter(function(page) {\n                      return taiga.slugify(page['slug']).indexOf(term) >= 0;\n                    }), true);\n                  }\n                  return callback([]);\n                };\n              })(this));\n            },\n            replace: function(res) {\n              return \"$1[[\" + res.slug + \"]]\";\n            },\n            template: function(res, term) {\n              return res.slug;\n            }\n          }\n        ], {\n          debounce: 200\n        });\n      };\n      renderMarkItUp();\n      unbind = $rootscope.$on(\"$translateChangeEnd\", renderMarkItUp);\n      element.on(\"keypress\", function(event) {\n        return $scope.$apply();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgMarkitup\", [\"$rootScope\", \"$tgResources\", \"$selectedText\", \"$tgTemplate\", \"$compile\", \"$translate\", MarkitupDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogFiltersDirective, bindOnce, debounceLeading, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogFiltersDirective = function($q, $log, $location, $template, $compile) {\n    var link, template, templateSelected;\n    template = $template.get(\"backlog/filters.html\", true);\n    templateSelected = $template.get(\"backlog/filter-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, currentFiltersType, getFiltersType, initializeSelectedFilters, reloadUserstories, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection;\n      currentFiltersType = '';\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n        return currentFiltersType = getFiltersType();\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function() {\n        var i, len, name, ref, val, values;\n        showCategories();\n        selectedFilters = [];\n        ref = $scope.filters;\n        for (name in ref) {\n          values = ref[name];\n          for (i = 0, len = values.length; i < len; i++) {\n            val = values[i];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters();\n      };\n      renderSelectedFilters = function() {\n        var html;\n        _.map(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filters-applied\").html(html);\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.map(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadUserstories = function() {\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadUserstories(true), $ctrl.generateFilters()]).then(function() {\n          var currentFilters;\n          currentFilters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(currentFilters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var filter, filters;\n        currentFiltersType = getFiltersType();\n        filters = $scope.filters[type];\n        filter = _.find(filters, {\n          id: id\n        });\n        filter.selected = !filter.selected;\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $scope.$apply(function() {\n            return $ctrl.selectFilter(type, id);\n          });\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(selected) {\n            return filter.type === selected.type && filter.id === selected.id;\n          });\n          $ctrl.unselectFilter(type, id);\n        }\n        renderSelectedFilters(selectedFilters);\n        if (type === currentFiltersType) {\n          renderFilters(_.reject(filters, \"selected\"));\n        }\n        return reloadUserstories();\n      };\n      selectQFilter = debounceLeading(100, function(value) {\n        if (value === void 0) {\n          return;\n        }\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n        }\n        return reloadUserstories();\n      });\n      $scope.$watch(\"filtersQ\", selectQFilter);\n      $scope.$on(\"backlog:loaded\", function(ctx) {\n        return initializeSelectedFilters();\n      });\n      $scope.$on(\"filters:update\", function(ctx) {\n        return $ctrl.generateFilters().then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          if (currentFiltersType) {\n            return renderFilters(_.reject(filters, \"selected\"));\n          }\n        });\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data('type'));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories();\n      });\n      $el.on(\"click\", \".remove-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget).parent();\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      return $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.hasClass(\"active\")) {\n          target.removeClass(\"active\");\n        } else {\n          target.addClass(\"active\");\n        }\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", BacklogFiltersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, form, getLastSprint, hasErrors, remove, resetSprint, submit;\n      hasErrors = false;\n      createSprint = true;\n      form = null;\n      resetSprint = function() {\n        if (form) {\n          form.reset();\n        }\n        return $scope.sprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          newSprint = angular.copy($scope.sprint);\n          broadcastEvent = null;\n          if (createSprint) {\n            newSprint.estimated_start = moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint.setAttr(\"estimated_start\", moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\"));\n            newSprint.setAttr(\"estimated_finish\", moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\"));\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $rootscope.$broadcast(broadcastEvent, data);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.sprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.sprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.sprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId) {\n        var estimatedFinish, estimatedStart, lastSprint, lastSprintNameDom, prettyDate, text;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.sprint.project = projectId;\n        $scope.sprint.name = null;\n        $scope.sprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.sprint.estimated_start) {\n          estimatedStart = moment($scope.sprint.estimated_start);\n        }\n        $scope.sprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.sprint.estimated_finish) {\n          estimatedFinish = moment($scope.sprint.estimated_finish);\n        }\n        $scope.sprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.sprint = sprint;\n          $scope.sprint.estimated_start = moment($scope.sprint.estimated_start).format(prettyDate);\n          return $scope.sprint.estimated_finish = moment($scope.sprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\", \"tgResources\", \"$tgQueueModelTransformation\"];\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading, rs2, modelTransform) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      this.rs2 = rs2;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.page = 1;\n      this.disablePagination = false;\n      this.firstLoadComplete = false;\n      this.scope.userstories = [];\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          _this.firstLoadComplete = true;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories(true);\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function(event, data) {\n          var index;\n          index = _.findIndex(_this.scope.userstories, function(us) {\n            return us.id === data.id;\n          });\n          _this.scope.userstories[index] = data;\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadAllPaginatedUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          _this.scope.openSprints = _.filter(sprints, function(sprint) {\n            return !sprint.closed;\n          }).reverse();\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          _this.scope.currentSprint = _this.findCurrentSprint();\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.restoreFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = this.scope.oldSelectedTags;\n      selectedStatuses = this.scope.oldSelectedStatuses;\n      if (!selectedStatuses && !selectedStatuses) {\n        return;\n      }\n      this.scope.filtersQ = this.scope.filtersQOld;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = true;\n            return _this.selectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.resetFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = _.filter(this.scope.filters.tags, \"selected\");\n      selectedStatuses = _.filter(this.scope.filters.status, \"selected\");\n      this.scope.oldSelectedTags = selectedTags;\n      this.scope.oldSelectedStatuses = selectedStatuses;\n      this.scope.filtersQOld = this.scope.filtersQ;\n      this.scope.filtersQ = void 0;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = false;\n            return _this.unselectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.loadAllPaginatedUserstories = function() {\n      var page;\n      page = this.page;\n      return this.loadUserstories(true, this.scope.userstories.length).then((function(_this) {\n        return function() {\n          return _this.page = page;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadUserstories = function(resetPagination, pageSize) {\n      var promise;\n      if (resetPagination == null) {\n        resetPagination = false;\n      }\n      if (!this.scope.projectId) {\n        return null;\n      }\n      this.loadingUserstories = true;\n      this.disablePagination = true;\n      this.scope.httpParams = this.getUrlFilters();\n      this.rs.userstories.storeQueryParams(this.scope.projectId, this.scope.httpParams);\n      if (resetPagination) {\n        this.page = 1;\n      }\n      this.scope.httpParams.page = this.page;\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, this.scope.httpParams, pageSize);\n      return promise.then((function(_this) {\n        return function(result) {\n          var header, userstories;\n          userstories = result[0];\n          header = result[1];\n          if (resetPagination) {\n            _this.scope.userstories = [];\n          }\n          _this.scope.userstories = _this.scope.userstories.concat(_.sortBy(userstories, \"backlog_order\"));\n          _this.setSearchDataFilters();\n          _this.loadingUserstories = false;\n          if (header('x-pagination-next')) {\n            _this.disablePagination = false;\n            _this.page++;\n          }\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]);\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.closedMilestones = !!project.total_closed_milestones;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n          return project;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.initializeSubscription();\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadBacklog();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.generateFilters();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.resortUserStories = function(uses, field) {\n      var index, item, items, j, len;\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      items = [];\n      for (index = j = 0, len = uses.length; j < len; index = ++j) {\n        item = uses[index];\n        item[field] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var args, data, items, j, key, l, len, len1, len2, len3, m, movedFromClosedSprint, movedToClosedSprint, n, newSprint, oldSprintId, project, promise, promises, r, sprint, us, userstories;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      movedFromClosedSprint = false;\n      movedToClosedSprint = false;\n      sprint = this.scope.sprintsById[oldSprintId];\n      if (!sprint && this.scope.closedSprintsById) {\n        sprint = this.scope.closedSprintsById[oldSprintId];\n        if (sprint) {\n          movedFromClosedSprint = true;\n        }\n      }\n      newSprint = this.scope.sprintsById[newSprintId];\n      if (!newSprint && newSprintId) {\n        newSprint = this.scope.closedSprintsById[newSprintId];\n        if (newSprint) {\n          movedToClosedSprint = true;\n        }\n      }\n      if (newSprintId === oldSprintId) {\n        items = null;\n        userstories = null;\n        if (newSprintId === null) {\n          userstories = this.scope.userstories;\n        } else {\n          userstories = newSprint.user_stories;\n        }\n        this.scope.$apply(function() {\n          var args, j, key, len, r, us;\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            r = userstories.indexOf(us);\n            userstories.splice(r, 1);\n          }\n          args = [newUsIndex, 0].concat(usList);\n          return Array.prototype.splice.apply(userstories, args);\n        });\n        if (newSprintId === null) {\n          items = this.resortUserStories(userstories, \"backlog_order\");\n          data = this.prepareBulkUpdateData(items, \"backlog_order\");\n          this.rs.userstories.bulkUpdateBacklogOrder(project, data).then((function(_this) {\n            return function() {\n              return _this.rootscope.$broadcast(\"sprint:us:moved\");\n            };\n          })(this));\n        } else {\n          items = this.resortUserStories(userstories, \"sprint_order\");\n          data = this.prepareBulkUpdateData(items, \"sprint_order\");\n          this.rs.userstories.bulkUpdateSprintOrder(project, data).then((function(_this) {\n            return function() {\n              return _this.rootscope.$broadcast(\"sprint:us:moved\");\n            };\n          })(this));\n        }\n        return promise;\n      }\n      if (newSprintId === null) {\n        for (j = 0, len = usList.length; j < len; j++) {\n          us = usList[j];\n          us.milestone = null;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, l, len1, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(_this.scope.userstories, args);\n            results = [];\n            for (key = l = 0, len1 = usList.length; l < len1; key = ++l) {\n              us = usList[key];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n        promise = this.repo.save(us);\n        promise = promise.then((function(_this) {\n          return function() {\n            items = _this.resortUserStories(_this.scope.userstories, \"backlog_order\");\n            data = _this.prepareBulkUpdateData(items, \"backlog_order\");\n            return _this.rs.userstories.bulkUpdateBacklogOrder(us.project, data).then(function() {\n              _this.rootscope.$broadcast(\"sprint:us:moved\");\n              if (movedFromClosedSprint) {\n                return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n              }\n            });\n          };\n        })(this));\n        promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n        return promise;\n      }\n      if (oldSprintId === null) {\n        for (l = 0, len1 = usList.length; l < len1; l++) {\n          us = usList[l];\n          us.milestone = newSprintId;\n        }\n        args = [newUsIndex, 0].concat(usList);\n        Array.prototype.splice.apply(newSprint.user_stories, args);\n        for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n          us = usList[key];\n          r = this.scope.userstories.indexOf(us);\n          this.scope.userstories.splice(r, 1);\n        }\n      } else {\n        for (n = 0, len3 = usList.length; n < len3; n++) {\n          us = usList[n];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var len4, o, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (o = 0, len4 = usList.length; o < len4; o++) {\n              us = usList[o];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      }\n      promises = _.map(usList, (function(_this) {\n        return function(us) {\n          return _this.repo.save(us);\n        };\n      })(this));\n      promise = this.q.all(promises).then((function(_this) {\n        return function() {\n          items = _this.resortUserStories(newSprint.user_stories, \"sprint_order\");\n          data = _this.prepareBulkUpdateData(items, \"sprint_order\");\n          _this.rs.userstories.bulkUpdateSprintOrder(project, data).then(function(result) {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\");\n          });\n          _this.rs.userstories.bulkUpdateBacklogOrder(project, data).then(function() {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\");\n          });\n          if (movedToClosedSprint || movedFromClosedSprint) {\n            return _this.scope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n      return promise;\n    };\n\n    BacklogController.prototype.isFilterSelected = function(type, id) {\n      if ((this.searchdata[type] != null) && this.searchdata[type][id]) {\n        return true;\n      }\n      return false;\n    };\n\n    BacklogController.prototype.setSearchDataFilters = function() {\n      var name, results, urlfilters, val, value;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = this.scope.filtersQ || urlfilters.q;\n      }\n      this.searchdata = {};\n      results = [];\n      for (name in urlfilters) {\n        value = urlfilters[name];\n        if (this.searchdata[name] == null) {\n          this.searchdata[name] = {};\n        }\n        results.push((function() {\n          var j, len, ref1, results1;\n          ref1 = taiga.toString(value).split(\",\");\n          results1 = [];\n          for (j = 0, len = ref1.length; j < len; j++) {\n            val = ref1[j];\n            results1.push(this.searchdata[name][val] = true);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.getUrlFilters = function() {\n      return _.pick(this.location.search(), \"status\", \"tags\", \"q\");\n    };\n\n    BacklogController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      urlfilters = this.getUrlFilters();\n      this.scope.filters = {};\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.milestone = 'null';\n      return this.rs.userstories.filtersData(loadFilters).then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, selectedStatuses, selectedTags, tagsFilterFormat;\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.usStatusById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          selectedTags = _.filter(_this.scope.filters.tags, \"selected\");\n          selectedTags = _.map(selectedTags, \"id\");\n          selectedStatuses = _.filter(_this.scope.filters.status, \"selected\");\n          selectedStatuses = _.map(selectedStatuses, \"id\");\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rs.userstories.storeQueryParams(_this.scope.projectId, {\n            \"status\": selectedStatuses,\n            \"tags\": selectedTags,\n            \"project\": _this.scope.projectId,\n            \"milestone\": null\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref1, ref2, results, searchdata, val, value;\n      searchdata = {};\n      ref1 = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref1) {\n        value = ref1[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref2 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref2.length; j < len; j++) {\n          val = ref2[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var l, len1, results1;\n          results1 = [];\n          for (l = 0, len1 = value.length; l < len1; l++) {\n            obj = value[l];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      this.setSearchDataFilters();\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"edit-story\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          return _this.rs2.attachments.list(\"us\", us.id, projectId).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", us, attachments.toJS());\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.q.all([_this.loadProjectStats(), _this.loadSprints()]);\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    BacklogController.prototype.findCurrentSprint = function() {\n      var currentDate;\n      currentDate = new Date().getTime();\n      return _.find(this.scope.sprints, function(sprint) {\n        var end, start;\n        start = moment(sprint.estimated_start, 'YYYY-MM-DD').format('x');\n        end = moment(sprint.estimated_finish, 'YYYY-MM-DD').format('x');\n        return currentDate >= start && currentDate <= end;\n      });\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, getUsToMove, lastChecked, moveToCurrentSprint, moveToLatestSprint, moveUssToSprint, shiftPressed;\n      getUsToMove = function() {\n        var ussDom;\n        ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        return _.map(ussDom, function(item) {\n          var itemScope;\n          item = $(item).closest('.tg-scope');\n          itemScope = item.scope();\n          itemScope.us.milestone = $scope.sprints[0].id;\n          return itemScope.us;\n        });\n      };\n      moveUssToSprint = function(selectedUss, sprint) {\n        var extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        sprint.user_stories = _.union(sprint.user_stories, selectedUss);\n        sprint.total_points += totalExtraPoints;\n        $repo.saveAll(selectedUss).then(function() {\n          $ctrl.loadSprints();\n          return $ctrl.loadProjectStats();\n        });\n        return $el.find(\".move-to-sprint\").hide();\n      };\n      moveToCurrentSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.currentSprint);\n      };\n      moveToLatestSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.sprints[0]);\n      };\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n        moveToSprintDom = $el.find(\".move-to-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          return moveToSprintDom.show();\n        } else {\n          return moveToSprintDom.hide();\n        }\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-latest-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToLatestSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      return $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.filters-bar\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      if (!sidebar.hasClass(\"active\")) {\n        $ctrl.resetFilters();\n      } else {\n        $ctrl.restoreFilters();\n      }\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      filters = $ctrl.getUrlFilters();\n      if (filters.status || filters.tags || filters.q) {\n        showHideFilter($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-down\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", \"$translate\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogSortableDirective, bindOnce, deleteElement, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    $(el).scope().$destroy();\n    $(el).off();\n    return $(el).remove();\n  };\n\n  BacklogSortableDirective = function($repo, $rs, $rootscope, $tgConfirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var drake, filterError, initIsBacklog, scroll;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        initIsBacklog = false;\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        drake = dragula([$el[0], $('.empty-backlog')[0]], {\n          copySortSource: false,\n          copy: false,\n          isContainer: function(el) {\n            return el.classList.contains('sprint-table');\n          },\n          moves: function(item) {\n            var parent;\n            if (!$(item).hasClass('row')) {\n              return false;\n            }\n            parent = $(item).parent();\n            initIsBacklog = parent.hasClass('backlog-table-body');\n            if (initIsBacklog && $el.hasClass(\"active-filters\")) {\n              filterError();\n              return false;\n            }\n            return true;\n          }\n        });\n        drake.on('drag', function(item, container) {\n          var isChecked, parent;\n          parent = $(item).parent();\n          initIsBacklog = parent.hasClass('backlog-table-body');\n          $(document.body).addClass(\"drag-active\");\n          isChecked = $(item).find(\"input[type='checkbox']\").is(\":checked\");\n          return window.dragMultiple.start(item, container);\n        });\n        drake.on('cloned', function(item) {\n          return $(item).addClass('backlog-us-mirror');\n        });\n        drake.on('dragend', function(item) {\n          var dragMultipleItems, firstElement, index, isBacklog, items, parent, sameContainer, sprint, usList;\n          $('.doom-line').remove();\n          parent = $(item).parent();\n          isBacklog = parent.hasClass('backlog-table-body') || parent.hasClass('empty-backlog');\n          if (initIsBacklog || isBacklog) {\n            sameContainer = initIsBacklog === isBacklog;\n          } else {\n            sameContainer = $(item).scope().sprint.id === parent.scope().sprint.id;\n          }\n          dragMultipleItems = window.dragMultiple.stop();\n          $(document.body).removeClass(\"drag-active\");\n          items = $(item).parent().find('.row');\n          sprint = null;\n          firstElement = dragMultipleItems.length ? dragMultipleItems[0] : item;\n          if (isBacklog) {\n            index = $(firstElement).index(\".backlog-table-body .row\");\n          } else {\n            index = $(firstElement).index();\n            sprint = parent.scope().sprint.id;\n          }\n          if (!sameContainer) {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = [$(item).scope().us];\n            }\n            if (dragMultipleItems.length) {\n              _.each(dragMultipleItems, function(item) {\n                return deleteElement(item);\n              });\n            } else {\n              deleteElement(item);\n            }\n          } else {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = _.map(items, function(item) {\n                var itemUs;\n                item = $(item);\n                itemUs = item.scope().us;\n                return itemUs;\n              });\n            }\n          }\n          return $scope.$emit(\"sprint:us:move\", usList, index, sprint);\n        });\n        scroll = autoScroll([window], {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$translate\", BacklogSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".compact-sprint\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .compact-sprint\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".edit-sprint\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch($attrs.ngModel, function(sprint) {\n        return render(sprint);\n      });\n      $scope.$on(\"sprintform:edit:success\", function() {\n        return render($model.$modelValue);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(x.day);\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton;\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.task.project, 'task');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"task\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task, attachments) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        $scope.attachments = Immutable.fromJS(attachments);\n        resetAttachments();\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          promise.then(function(data) {\n            createAttachments(data);\n            deleteAttachments(data);\n            return data;\n          });\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootscope.$broadcast(broadcastEvent, data);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", \"$q\", \"tgAttachmentsService\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, TaskboardTaskDirective, TaskboardUserDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, params1, q, appMetaService, location, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, task) {\n          var promise;\n          task.assigned_to = userId;\n          promise = _this.repo.save(task);\n          return promise.then(null, function() {\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(tasks) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, task, us, usId;\n          _this.scope.tasks = _.sortBy(tasks, 'taskboard_order');\n          _this.scope.usTasks = {};\n          ref = _.union(_this.scope.userstories, [\n            {\n              id: null\n            }\n          ]);\n          for (i = 0, len = ref.length; i < len; i++) {\n            us = ref[i];\n            _this.scope.usTasks[us.id] = {};\n            ref1 = _this.scope.taskStatusList;\n            for (j = 0, len1 = ref1.length; j < len1; j++) {\n              status = ref1[j];\n              _this.scope.usTasks[us.id][status.id] = [];\n            }\n          }\n          ref2 = _this.scope.tasks;\n          for (k = 0, len2 = ref2.length; k < len2; k++) {\n            task = ref2[k];\n            if ((_this.scope.usTasks[task.user_story] != null) && (_this.scope.usTasks[task.user_story][task.status] != null)) {\n              _this.scope.usTasks[task.user_story][task.status].push(task);\n            }\n          }\n          if (tasks.length === 0) {\n            if (_this.scope.userstories.length > 0) {\n              usId = _this.scope.userstories[0].id;\n            } else {\n              usId = null;\n            }\n            _this.scope.usTasks[usId][_this.scope.taskStatusList[0].id].push({\n              isPlaceholder: true\n            });\n          }\n          return tasks;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTasksOrder = function(tasks) {\n      var data, items;\n      items = this.resortTasks(tasks);\n      data = this.prepareBulkUpdateData(items);\n      return this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id, data);\n    };\n\n    TaskboardController.prototype.resortTasks = function(tasks) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = tasks.length; i < len; index = ++i) {\n        item = tasks[index];\n        item[\"taskboard_order\"] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    TaskboardController.prototype.prepareBulkUpdateData = function(uses) {\n      return _.map(uses, function(x) {\n        return {\n          \"task_id\": x.id,\n          \"order\": x[\"taskboard_order\"]\n        };\n      });\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, usId, statusId, order) {\n      var promise, r, tasks;\n      r = this.scope.usTasks[task.user_story][task.status].indexOf(task);\n      this.scope.usTasks[task.user_story][task.status].splice(r, 1);\n      tasks = this.scope.usTasks[usId][statusId];\n      tasks.splice(order, 0, task);\n      task.user_story = usId;\n      task.status = statusId;\n      task.taskboard_order = order;\n      promise = this.repo.save(task);\n      this.rootscope.$broadcast(\"sprint:task:moved\", task);\n      promise.then((function(_this) {\n        return function() {\n          _this.refreshTasksOrder(tasks);\n          return _this.loadSprintStats();\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function() {\n          return console.log(\"FAIL TASK SAVE\");\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.editTaskAssignedTo = function(task) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardTaskDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch(\"task\", function(task) {\n        if (task.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!task.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      return $el.find(\".edit-task\").on(\"click\", function(event) {\n        if ($el.find('.edit-task').hasClass('noclick')) {\n          return;\n        }\n        return $scope.$apply(function() {\n          var currentLoading, target, task;\n          target = $(event.target);\n          currentLoading = $loading().target(target).timeout(200).start();\n          task = $scope.task;\n          return $rs.tasks.getByRef(task.project, task.ref).then((function(_this) {\n            return function(editingTask) {\n              return $rs2.attachments.list(\"task\", editingTask.id, editingTask.project).then(function(attachments) {\n                $rootscope.$broadcast(\"taskform:edit\", editingTask, attachments.toJS());\n                return currentLoading.finish();\n              });\n            };\n          })(this));\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardTask\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", TaskboardTaskDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      bindOnce($scope, \"usTasks\", function(project) {\n        $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n        $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n        return recalculateTaskboardWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          tasks = $scope.usTasks[usId][statusId].length;\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            return column.css(\"max-width\", maxColumnWidth);\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n  TaskboardUserDirective = function($log, $translate) {\n    var clickable, link;\n    clickable = false;\n    link = function($scope, $el, $attrs) {\n      var username_label;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      $scope.$watch('task.assigned_to', function(assigned_to) {\n        var user;\n        user = $scope.usersById[assigned_to];\n        if (user === void 0) {\n          _.assign($scope, {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          });\n        } else {\n          _.assign($scope, {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          });\n        }\n        return username_label.text($scope.name);\n      });\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") > -1) {\n          clickable = true;\n          $el.find(\".avatar-assigned-to\").on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl;\n              if ($el.find('a').hasClass('noclick')) {\n                return;\n              }\n              $ctrl = $el.controller();\n              return $ctrl.editTaskAssignedTo($scope.task);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl;\n            if ($el.find('a').hasClass('noclick')) {\n              return;\n            }\n            $ctrl = $el.controller();\n            return $ctrl.editTaskAssignedTo($scope.task);\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"taskboard/taskboard-user.html\",\n      scope: {\n        \"usersById\": \"=users\",\n        \"project\": \"=\",\n        \"task\": \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTaskboardUserAvatar\", [\"$log\", \"$translate\", TaskboardUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"tasks\", function(xx) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!($scope.project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: $el[0],\n          moves: function(item) {\n            return $(item).hasClass('taskboard-task');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, newUsId, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll([$('.taskboard-table-body')[0]], {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanUserDirective, KanbanUserstoryDirective, KanbanWipLimitDirective, bindMethods, bindOnce, defaultViewMode, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText, viewModes,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  defaultViewMode = \"maximized\";\n\n  viewModes = [\"maximized\", \"minimized\"];\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, params1, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.scope.statusViewModes = {};\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.refreshTagsColors();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.refreshTagsColors();\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(us) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, us) {\n      var promise;\n      us.assigned_to = userid;\n      promise = this.repo.save(us);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false\n      };\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, us, usByStatus, us_archived;\n          _this.scope.userstories = userstories;\n          usByStatus = _.groupBy(userstories, \"status\");\n          us_archived = [];\n          ref = _this.scope.usStatusList;\n          for (i = 0, len = ref.length; i < len; i++) {\n            status = ref[i];\n            if (usByStatus[status.id] == null) {\n              usByStatus[status.id] = [];\n            }\n            if (_this.scope.usByStatus != null) {\n              ref1 = _this.scope.usByStatus[status.id];\n              for (j = 0, len1 = ref1.length; j < len1; j++) {\n                us = ref1[j];\n                if (us.status !== status.id) {\n                  us_archived.push(us);\n                }\n              }\n            }\n            if (status.is_archived && (_this.scope.usByStatus != null) && _this.scope.usByStatus[status.id].length !== 0) {\n              ref2 = _this.scope.usByStatus[status.id].concat(us_archived);\n              for (k = 0, len2 = ref2.length; k < len2; k++) {\n                us = ref2[k];\n                if (us.status === status.id) {\n                  usByStatus[status.id].push(us);\n                }\n              }\n            }\n            usByStatus[status.id] = _.sortBy(usByStatus[status.id], \"kanban_order\");\n          }\n          if (userstories.length === 0) {\n            status = _this.scope.usStatusList[0];\n            usByStatus[status.id].push({\n              isPlaceholder: true\n            });\n          }\n          _this.scope.usByStatus = usByStatus;\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var params;\n      params = {\n        status: statusId\n      };\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.usByStatus[statusId] = _.sortBy(userstories, \"kanban_order\");\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      this.scope.usByStatus[statusId] = [];\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_kanban_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.projectId = project.id;\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.generateStatusViewModes();\n          _this.scope.$emit(\"project:loaded\", project);\n          return project;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          return _this.loadKanban();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.generateStatusViewModes = function() {\n      var i, len, mode, ref, status, storedStatusViewModes;\n      storedStatusViewModes = this.rs.kanban.getStatusViewModes(this.scope.projectId);\n      this.scope.statusViewModes = {};\n      ref = this.scope.usStatusList;\n      for (i = 0, len = ref.length; i < len; i++) {\n        status = ref[i];\n        mode = storedStatusViewModes[status.id] || defaultViewMode;\n        this.scope.statusViewModes[status.id] = mode;\n      }\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.storeStatusViewModes = function() {\n      return this.rs.kanban.storeStatusViewModes(this.scope.projectId, this.scope.statusViewModes);\n    };\n\n    KanbanController.prototype.updateStatusViewMode = function(statusId, newViewMode) {\n      this.scope.statusViewModes[statusId] = newViewMode;\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.isMaximized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'maximized';\n    };\n\n    KanbanController.prototype.isMinimized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'minimized';\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.resortUserStories = function(uses) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = uses.length; i < len; index = ++i) {\n        item = uses[index];\n        item.kanban_order = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var itemsToSave, promise, r;\n      if (oldStatusId !== newStatusId) {\n        r = this.scope.usByStatus[oldStatusId].indexOf(us);\n        this.scope.usByStatus[oldStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n        us.status = newStatusId;\n      } else {\n        r = this.scope.usByStatus[newStatusId].indexOf(us);\n        this.scope.usByStatus[newStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n      }\n      itemsToSave = this.resortUserStories(this.scope.usByStatus[newStatusId]);\n      this.scope.usByStatus[newStatusId] = _.sortBy(this.scope.usByStatus[newStatusId], \"kanban_order\");\n      promise = this.repo.save(us);\n      promise = promise.then((function(_this) {\n        return function() {\n          var data;\n          itemsToSave = _.reject(itemsToSave, {\n            \"id\": us.id\n          });\n          data = _this.prepareBulkUpdateData(itemsToSave);\n          return _this.rs.userstories.bulkUpdateKanbanOrder(us.project, data).then(function() {\n            return itemsToSave;\n          });\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      $scope[\"class\"] = \"icon-watch\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-watch\";\n            $scope.title = showArchivedText;\n            return $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n          } else {\n            $scope[\"class\"] = \"icon-unwatch\";\n            $scope.title = hideArchivedText;\n            return $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function() {\n        if (userStories.length > 0) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var r;\n        if (status.id === newStatusId) {\n          if (status.id === oldStatusId) {\n            r = userStories.indexOf(itemUs);\n            userStories.splice(r, 1);\n            userStories.splice(itemIndex, 0, itemUs);\n          } else {\n            itemUs.isArchived = true;\n            userStories.splice(itemIndex, 0, itemUs);\n          }\n        } else if (status.id === oldStatusId) {\n          itemUs.isArchived = false;\n          r = userStories.indexOf(itemUs);\n          userStories.splice(r, 1);\n        }\n        return updateIntroText();\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        if (statusId === status.id) {\n          userStories = _.filter(userStoriesLoaded, function(us) {\n            return us.status === status.id;\n          });\n          return updateIntroText();\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          userStories = [];\n          return updateIntroText();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanUserstoryDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch(\"us\", function(us) {\n        if (us.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!us.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      $el.on('click', '.edit-us', function(event) {\n        var currentLoading, target, us;\n        if ($el.find(\".icon-edit\").hasClass(\"noclick\")) {\n          return;\n        }\n        target = $(event.target);\n        currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n        us = $model.$modelValue;\n        return $rs.userstories.getByRef(us.project, us.ref).then((function(_this) {\n          return function(editingUserStory) {\n            return $rs2.attachments.list(\"us\", us.id, us.project).then(function(attachments) {\n              $rootscope.$broadcast(\"usform:edit\", editingUserStory, attachments.toJS());\n              return currentLoading.finish();\n            });\n          };\n        })(this));\n      });\n      $scope.getTemplateUrl = function() {\n        if ($scope.us.isPlaceholder) {\n          return \"common/components/kanban-placeholder.html\";\n        } else {\n          return \"kanban/kanban-task.html\";\n        }\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      template: '<ng-include src=\"getTemplateUrl()\"/>',\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserstory\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", KanbanUserstoryDirective]);\n\n  KanbanSquishColumnDirective = function(rs) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var updateTableWidth;\n      $scope.$on(\"project:loaded\", function(event, project) {\n        $scope.folds = rs.kanban.getStatusColumnModes(project.id);\n        return updateTableWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      return updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return timeout(200, function() {\n            var element;\n            element = $el.find(\".kanban-task\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", KanbanWipLimitDirective);\n\n  KanbanUserDirective = function($log, $compile, $translate) {\n    var clickable, link, template;\n    template = _.template(\"<figure class=\\\"avatar\\\">\\n    <a href=\\\"#\\\" title=\\\"{{'US.ASSIGN' | translate}}\\\" <% if (!clickable) {%>class=\\\"not-clickable\\\"<% } %>>\\n        <img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\" class=\\\"avatar\\\">\\n    </a>\\n</figure>\");\n    clickable = false;\n    link = function($scope, $el, $attrs, $model) {\n      var render, username_label, wtid;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      if (!$attrs.tgKanbanUserAvatar) {\n        return $log.error(\"KanbanUserDirective: no attr is defined\");\n      }\n      wtid = $scope.$watch($attrs.tgKanbanUserAvatar, function(v) {\n        var user;\n        if ($scope.usersById == null) {\n          $log.error(\"KanbanUserDirective requires userById set in scope.\");\n          return wtid();\n        } else {\n          user = $scope.usersById[v];\n          return render(user);\n        }\n      });\n      render = function(user) {\n        var ctx, html;\n        if (user === void 0) {\n          ctx = {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          };\n        } else {\n          ctx = {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          };\n        }\n        html = $compile(template(ctx))($scope);\n        $el.html(html);\n        return username_label.text(ctx.name);\n      };\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          clickable = true;\n          $el.on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl, us;\n              if ($el.find(\"a\").hasClass(\"noclick\")) {\n                return;\n              }\n              us = $model.$modelValue;\n              $ctrl = $el.controller();\n              return $ctrl.changeUsAssignedTo(us);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl, us;\n            if ($el.find(\"a\").hasClass(\"noclick\")) {\n              return;\n            }\n            us = $model.$modelValue;\n            $ctrl = $el.controller();\n            return $ctrl.changeUsAssignedTo(us);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserAvatar\", [\"$log\", \"$compile\", \"$translate\", KanbanUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: tdom[0],\n          moves: function(item) {\n            return $(item).hasClass('kanban-task');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.status, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll(containers, {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\", \"$tgQueueModelTransformation\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate, modelTransform) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issuePriority: ((ref3 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref3.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.issue_statuses;\n          _this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.typeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          _this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.severityList = project.severities;\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = project.priorities;\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          _this.modelTransform.setObject(_this.scope, 'issue');\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadIssue();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(statusId) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.status = statusId;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(type) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.type = type;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.type : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(severity) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.severity = severity;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.severity : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(priority) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.priority = priority;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.priority : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = (function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var attachmentsToAdd, createAttachments, form, resetAttachments, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.attachments = Immutable.List();\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        form.reset();\n        resetAttachments();\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el);\n        return $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          tags: []\n        };\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.issue.project, 'issue');\n        });\n        return $q.all(promises);\n      };\n      attachmentsToAdd = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return $scope.attachments = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            return createAttachments(data);\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$q\", \"tgAttachmentsService\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssuesController, IssuesDirective, IssuesFiltersDirective, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var filters, promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loadIssues = bind(this.loadIssues, this);\n      this.scope.sectionName = \"Issues\";\n      this.scope.filters = {};\n      if (_.isEmpty(this.location.search())) {\n        filters = this.rs.issues.getFilters(this.params.pslug);\n        filters.page = 1;\n        this.location.search(filters);\n        this.location.replace();\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.storeFilters = function() {\n      return this.rs.issues.storeFilters(this.params.pslug, this.location.search());\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_issues_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.severityList = _.sortBy(project.severities, \"order\");\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n          _this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\", \"tags\", \"status\", \"types\", \"q\", \"severities\", \"priorities\", \"assignedTo\", \"createdBy\", \"orderBy\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    IssuesController.prototype.getUrlFilter = function(name) {\n      var filters;\n      filters = _.pick(this.location.search(), name);\n      return filters[name];\n    };\n\n    IssuesController.prototype.loadMyFilters = function() {\n      return this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          return _.map(filters, function(value, key) {\n            return {\n              id: key,\n              name: key,\n              type: \"myFilters\",\n              selected: false\n            };\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.removeNotExistingFiltersFromUrl = function() {\n      var currentSearch, existingValues, filterName, filterValue, splittedValues, urlfilters;\n      currentSearch = this.location.search();\n      urlfilters = this.getUrlFilters();\n      for (filterName in urlfilters) {\n        filterValue = urlfilters[filterName];\n        if (filterName === \"page\" || filterName === \"orderBy\" || filterName === \"q\") {\n          continue;\n        }\n        if (filterName === \"tags\") {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"));\n        } else {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"), function(x) {\n            if (x === \"null\") {\n              return null;\n            } else {\n              return parseInt(x);\n            }\n          });\n        }\n        existingValues = _.intersection(splittedValues, _.map(this.scope.filters[filterName], \"id\"));\n        if (splittedValues.length !== existingValues.length) {\n          this.location.search(filterName, existingValues.join());\n        }\n      }\n      if (currentSearch !== this.location.search()) {\n        return this.location.replace();\n      }\n    };\n\n    IssuesController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref, ref1, results, searchdata, val, value;\n      searchdata = {};\n      ref = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref) {\n        value = ref[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref1 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref1.length; j < len; j++) {\n          val = ref1[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var k, len1, results1;\n          results1 = [];\n          for (k = 0, len1 = value.length; k < len1; k++) {\n            obj = value[k];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    IssuesController.prototype.loadFilters = function() {\n      var loadFilters, promise, urlfilters;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = urlfilters.q;\n      }\n      promise = this.loadMyFilters().then((function(_this) {\n        return function(myFilters) {\n          _this.scope.filters.myFilters = myFilters;\n          return myFilters;\n        };\n      })(this));\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.types = urlfilters.types;\n      loadFilters.severities = urlfilters.severities;\n      loadFilters.priorities = urlfilters.priorities;\n      loadFilters.assigned_to = urlfilters.assignedTo;\n      loadFilters.owner = urlfilters.createdBy;\n      promise = promise.then((function(_this) {\n        return function() {\n          return _this.rs.issues.filtersData(loadFilters);\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, tagsFilterFormat, usersFiltersFormat;\n          usersFiltersFormat = function(users, type, unknownOption) {\n            var reformatedUsers, unknownItem;\n            reformatedUsers = _.map(users, function(t) {\n              t.type = type;\n              t.name = t.full_name ? t.full_name : unknownOption;\n              return t;\n            });\n            unknownItem = _.remove(reformatedUsers, function(u) {\n              return !u.id;\n            });\n            reformatedUsers = _.sortBy(reformatedUsers, function(u) {\n              return u.name.toUpperCase();\n            });\n            if (unknownItem.length > 0) {\n              reformatedUsers.unshift(unknownItem[0]);\n            }\n            return reformatedUsers;\n          };\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.issueStatusById);\n          _this.scope.filters.severities = choicesFiltersFormat(data.severities, \"severities\", _this.scope.severityById);\n          _this.scope.filters.priorities = choicesFiltersFormat(data.priorities, \"priorities\", _this.scope.priorityById);\n          _this.scope.filters.assignedTo = usersFiltersFormat(data.assigned_to, \"assignedTo\", \"Unassigned\");\n          _this.scope.filters.createdBy = usersFiltersFormat(data.owners, \"createdBy\", \"Unknown\");\n          _this.scope.filters.types = choicesFiltersFormat(data.types, \"types\", _this.scope.issueTypeById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          _this.removeNotExistingFiltersFromUrl();\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rootscope.$broadcast(\"filters:loaded\", _this.scope.filters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var name, promise, ref, values;\n      this.scope.urlFilters = this.getUrlFilters();\n      this.scope.httpParams = {};\n      ref = this.scope.urlFilters;\n      for (name in ref) {\n        values = ref[name];\n        if (name === \"severities\") {\n          name = \"severity\";\n        } else if (name === \"orderBy\") {\n          name = \"order_by\";\n        } else if (name === \"priorities\") {\n          name = \"priority\";\n        } else if (name === \"assignedTo\") {\n          name = \"assigned_to\";\n        } else if (name === \"createdBy\") {\n          name = \"owner\";\n        } else if (name === \"status\") {\n          name = \"status\";\n        } else if (name === \"types\") {\n          name = \"type\";\n        }\n        this.scope.httpParams[name] = values;\n      }\n      promise = this.rs.issues.list(this.scope.projectId, this.scope.httpParams);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.loadFilters();\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCurrentFiltersTo = function(newFilter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          filters[newFilter] = _this.location.search();\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.deleteMyFilter = function(filter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          delete filters[filter];\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon;\n      currentOrder = $ctrl.getUrlFilter(\"orderBy\") || \"created_date\";\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        colHeadElement.html((colHeadElement.html()) + \"<span class='icon \" + icon + \"'></span>\");\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getUrlFilter(\"orderBy\");\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"orderBy\", finalOrder);\n          $ctrl.storeFilters();\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > span.icon\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n            return target.html((target.html()) + \"<span class='icon \" + icon + \"'></span>\");\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssuesFiltersDirective = function($q, $log, $location, $rs, $confirm, $loading, $template, $translate, $compile, $auth) {\n    var link, template, templateSelected;\n    template = $template.get(\"issue/issues-filters.html\", true);\n    templateSelected = $template.get(\"issue/issues-filters-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, getFiltersType, initializeSelectedFilters, reloadIssues, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection, unwatchIssues;\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\".breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 .subfilter .title\").html(title);\n        return $el.find(\"h2 .subfilter .title\").prop(\"data-type\", type);\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\".breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function(filters) {\n        var j, len, name, val, values;\n        selectedFilters = [];\n        for (name in filters) {\n          values = filters[name];\n          for (j = 0, len = values.length; j < len; j++) {\n            val = values[j];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters(selectedFilters);\n      };\n      renderSelectedFilters = function(selectedFilters) {\n        var html;\n        _.filter(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        $el.find(\".filters-applied\").html(html);\n        if ($auth.isAuthenticated() && selectedFilters.length > 0) {\n          return $el.find(\".save-filters\").show();\n        } else {\n          return $el.find(\".save-filters\").hide();\n        }\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.filter(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\".subfilter .title\").prop('data-type');\n      };\n      reloadIssues = function() {\n        var currentFiltersType;\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadIssues(), $ctrl.loadFilters()]).then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(filters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var currentFiltersType, filter, filterId, filters;\n        if (type === \"myFilters\") {\n          $rs.issues.getMyFilters($scope.projectId).then(function(data) {\n            var filters, myFilters;\n            myFilters = data;\n            filters = myFilters[id];\n            filters.page = 1;\n            $ctrl.replaceAllFilters(filters);\n            $ctrl.storeFilters();\n            $ctrl.loadIssues();\n            $ctrl.markSelectedFilters($scope.filters, filters);\n            return initializeSelectedFilters($scope.filters);\n          });\n          return null;\n        }\n        filters = $scope.filters[type];\n        filterId = type === 'tags' ? taiga.toString(id) : id;\n        filter = _.find(filters, {\n          id: filterId\n        });\n        filter.selected = !filter.selected;\n        if (id === null) {\n          id = \"null\";\n        }\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $ctrl.selectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(f) {\n            return f.id === filter.id && f.type === filter.type;\n          });\n          $ctrl.unselectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        }\n        reloadIssues();\n        renderSelectedFilters(selectedFilters);\n        currentFiltersType = getFiltersType();\n        if (type === currentFiltersType) {\n          return renderFilters(_.reject(filters, \"selected\"));\n        }\n      };\n      $scope.$on(\"filters:loaded\", function(ctx, filters) {\n        return initializeSelectedFilters(filters);\n      });\n      $scope.$on(\"filters:issueupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.status\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      selectQFilter = debounceLeading(100, function(value, oldValue) {\n        if (value === void 0 || value === oldValue) {\n          return;\n        }\n        $ctrl.replaceFilter(\"page\", null, true);\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n          $ctrl.storeFilters();\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n          $ctrl.storeFilters();\n        }\n        return reloadIssues();\n      });\n      unwatchIssues = $scope.$watch(\"issues\", function(newValue) {\n        if (!_.isUndefined(newValue)) {\n          $scope.$watch(\"filtersQ\", selectQFilter);\n          return unwatchIssues();\n        }\n      });\n      $el.on(\"click\", \".filters-cat-single\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data(\"type\"));\n      });\n      $el.on(\"click\", \".back\", function(event) {\n        event.preventDefault();\n        return showCategories($el);\n      });\n      $el.on(\"click\", \".filters-applied .remove-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget).parent();\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"active\");\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        if (type === \"myFilters\") {\n          target.removeClass(\"active\");\n        }\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .remove-filter\", function(event) {\n        var customFilterName, message, target, title;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        customFilterName = target.parent().data('id');\n        title = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.TITLE\");\n        message = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE\", {\n          customFilterName: customFilterName\n        });\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var promise;\n          promise = $ctrl.deleteMyFilter(customFilterName);\n          promise.then(function() {\n            promise = $ctrl.loadMyFilters();\n            promise.then(function(filters) {\n              askResponse.finish();\n              $scope.filters.myFilters = filters;\n              return renderFilters($scope.filters.myFilters);\n            });\n            return promise.then(null, function() {\n              return askResponse.finish();\n            });\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return $confirm.notify(\"error\");\n          });\n        });\n      });\n      $el.on(\"click\", \".save-filters\", function(event) {\n        event.preventDefault();\n        renderFilters($scope.filters[\"myFilters\"]);\n        showFilters(\"My filters\", \"myFilters\");\n        $el.find('.save-filters').hide();\n        $el.find('.my-filter-name').removeClass(\"hidden\");\n        $el.find('.my-filter-name').focus();\n        return $scope.$apply();\n      });\n      return $el.on(\"keyup\", \".my-filter-name\", function(event) {\n        var currentLoading, newFilter, promise, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newFilter = target.val();\n          currentLoading = $loading().target($el.find(\".new\")).start();\n          promise = $ctrl.saveCurrentFiltersTo(newFilter);\n          promise.then(function() {\n            var loadPromise;\n            loadPromise = $ctrl.loadMyFilters();\n            loadPromise.then(function(filters) {\n              var currentfilterstype;\n              currentLoading.finish();\n              $scope.filters.myFilters = filters;\n              currentfilterstype = $el.find(\"h2 .subfilter .title\").prop('data-type');\n              if (currentfilterstype === \"myFilters\") {\n                renderFilters($scope.filters.myFilters);\n              }\n              $el.find('.my-filter-name').addClass(\"hidden\");\n              return $el.find('.save-filters').show();\n            });\n            return loadPromise.then(null, function() {\n              currentLoading.finish();\n              return $confirm.notify(\"error\", \"Error loading custom filters\");\n            });\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            $el.find(\".my-filter-name\").val(newFilter).focus().select();\n            return $confirm.notify(\"error\", \"Filter not saved\");\n          });\n        } else if (event.keyCode === 27) {\n          $el.find('.my-filter-name').val('');\n          $el.find('.my-filter-name').addClass(\"hidden\");\n          return $el.find('.save-filters').show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssuesFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", \"$compile\", \"$tgAuth\", IssuesFiltersDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.status;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.status) {\n            filter.count--;\n          }\n        }\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.status;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.status) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:issueupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        if (member) {\n          ctx.name = member.full_name_display;\n          ctx.imgurl = member.photo;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgConfig\", \"$tgQueueModelTransformation\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, configService, modelTransform) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.configService = configService;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.scope.tribeEnabled = this.configService.config.tribeHost;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.scope.us.description_html || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          var allClosed;\n          _this.scope.tasks = _.clone(_this.scope.tasks, false);\n          allClosed = _.every(_this.scope.tasks, function(task) {\n            return task.is_closed;\n          });\n          if (_this.scope.us.is_closed !== allClosed) {\n            return _this.loadUs();\n          }\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.us_statuses;\n          _this.scope.statusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(_this.scope.pointsList, function(e) {\n            return e.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          var ctx, ref, ref1;\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          _this.modelTransform.setObject(_this.scope, 'us');\n          if (((ref = _this.scope.us.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.us.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadUs().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onTribeInfo = function() {\n      var image, publishDesc, publishTitle, text;\n      publishTitle = this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TITLE\");\n      image = $('<img />').attr({\n        'src': \"/\" + window._version + \"/images/monster-fight.png\",\n        'alt': this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TITLE\")\n      });\n      text = this.translate.instant(\"US.TRIBE.PUBLISH_MORE_INFO_TEXT\");\n      publishDesc = $('<div></div>').append(image).append(text);\n      return this.confirm.success(publishTitle, publishDesc);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          $el.html(html);\n          return $compile($el.contents())($scope);\n        };\n      })(this);\n      save = (function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, transform;\n          $el.find(\".pop-status\").popover().close();\n          currentLoading = $loading().target($el.find('.js-edit-status')).start();\n          transform = $modelTransform.save(function(us) {\n            us.status = status;\n            return us;\n          });\n          onSuccess = function() {\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return transform.then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = function(team_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.team_requirement = team_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.team_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(client_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.client_requirement = client_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.client_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgQueueModelTransformation\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, modelTransform) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.task_statuses;\n          _this.scope.statusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          _this.modelTransform.setObject(_this.scope, 'task');\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadTask().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(status) {\n        var currentLoading, onError, onSuccess, transform;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(task) {\n          task.status = status;\n          return task;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $compile, $template) {\n    var link, template;\n    template = $template.get(\"issue/iocaine-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(is_iocaine) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('label')).start();\n        transform = $modelTransform.save(function(task) {\n          task.is_iocaine = is_iocaine;\n          return task;\n        });\n        transform.then(function() {\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      };\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.is_iocaine : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$tgTemplate\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issuesEnabled = project.is_issues_activated;\n          _this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n          _this.scope.wikiEnabled = project.is_wiki_activated;\n          _this.scope.owner = project.owner.id;\n          return project;\n        };\n      })(this));\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var key, max, min, singleStat, value;\n      max = _.max(_.toArray(stat));\n      min = _.min(_.toArray(stat));\n      singleStat = Object();\n      for (key in stat) {\n        if (!hasProp.call(stat, key)) continue;\n        value = stat[key];\n        if (value === min) {\n          singleStat[key] = 0.1;\n        } else if (value === max) {\n          singleStat[key] = 1;\n        } else {\n          singleStat[key] = (value * 0.5) / max;\n        }\n      }\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          var userRoles;\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.loadMembers();\n          userRoles = _.map(_this.scope.users, function(user) {\n            return user.role;\n          });\n          _this.scope.roles = _.filter(_this.scope.roles, function(role) {\n            return userRoles.indexOf(role.id) !== -1;\n          });\n          return _this.loadMemberStats();\n        };\n      })(this));\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        project: \"=project\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate, lightboxFactory, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var leaveConfirm;\n      leaveConfirm = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($scope.project.id);\n            promise.then(function() {\n              return currentUserService.loadProjects().then(function() {\n                response.finish();\n                $confirm.notify(\"success\");\n                return $location.path($navurls.resolve(\"home\"));\n              });\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n      return $scope.leave = function() {\n        if ($scope.project.owner.id === $scope.user.id) {\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: true,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      };\n    };\n    return {\n      scope: {\n        user: \"=\",\n        project: \"=\"\n      },\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var EditableWikiContentDirective, WikiDetailController, WikiSummaryDirective, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiTitle,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(((ref = this.scope.wiki) != null ? ref.html : void 0) || \"\").text(),\n        totalEditions: ((ref1 = this.scope.wiki) != null ? ref1.editions : void 0) || 0,\n        lastModifiedDate: moment((ref2 = this.scope.wiki) != null ? ref2.modified_date : void 0).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var i, len, link, ref, selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          ref = _this.scope.wikiLinks;\n          for (i = 0, len = ref.length; i < len; i++) {\n            link = ref[i];\n            link.url = _this.navUrls.resolve(\"project-wiki-page\", {\n              project: _this.scope.projectSlug,\n              slug: link.href\n            });\n          }\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWiki()]).then(_this.checkLinksPerms.bind(_this));\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"add_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiTitle;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            return _this.confirm.notify(\"success\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            imgUrl: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            imgUrl: user.photo\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiSummaryDirective]);\n\n  EditableWikiContentDirective = function($window, $document, $repo, $confirm, $loading, $analytics, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, disableEdition, getSelectedText, isEditable, save, switchToEditMode, switchToReadMode;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      };\n      switchToEditMode = function() {\n        $el.find('.edit-wiki-content').show();\n        $el.find('.view-wiki-content').hide();\n        return $el.find('textarea').focus();\n      };\n      switchToReadMode = function() {\n        $el.find('.edit-wiki-content').hide();\n        return $el.find('.view-wiki-content').show();\n      };\n      disableEdition = function() {\n        $el.find(\".view-wiki-content .edit\").remove();\n        return $el.find(\".edit-wiki-content\").remove();\n      };\n      cancelEdition = function() {\n        if (!$model.$modelValue.id) {\n          return;\n        }\n        $model.$modelValue.revert();\n        return switchToReadMode();\n      };\n      getSelectedText = function() {\n        if ($window.getSelection) {\n          return $window.getSelection().toString();\n        } else if ($document.selection) {\n          return $document.selection.createRange().text;\n        }\n        return null;\n      };\n      save = $qqueue.bindAdd(function(wiki) {\n        var currentLoading, onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if (wiki.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n          }\n          $model.$setViewValue(wikiPage.clone());\n          $confirm.notify(\"success\");\n          return switchToReadMode();\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        currentLoading = $loading().removeClasses(\"icon-floppy\").target($el.find('.icon-floppy')).start();\n        if (wiki.id != null) {\n          promise = $repo.save(wiki).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", wiki).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.currentTarget);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"mousedown\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (event.button === 2) {\n\n        }\n      });\n      $el.on(\"mouseup\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (getSelectedText()) {\n          return;\n        }\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if (target.is('pre')) {\n          return;\n        }\n        return switchToEditMode();\n      });\n      $el.on(\"click\", \".save\", debounce(2000, function() {\n        return save($scope.wiki);\n      }));\n      $el.on(\"click\", \".cancel\", function() {\n        return $scope.$apply(cancelEdition);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode !== 27) {\n          return;\n        }\n        return $scope.$applyAsync(function() {\n          var message, title;\n          title = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE\");\n          message = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE\");\n          return $confirm.ask(title, null, message).then(function(askResponse) {\n            cancelEdition();\n            return askResponse.finish();\n          });\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        if (isEditable()) {\n          $el.addClass('editable');\n          if ((wikiPage.id == null) || $.trim(wikiPage.content).length === 0) {\n            return switchToEditMode();\n          }\n        } else {\n          return disableEdition();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      templateUrl: \"wiki/editable-wiki-content.html\"\n    };\n  };\n\n  module.directive(\"tgEditableWikiContent\", [\"$window\", \"$document\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", \"$tgQqueue\", \"$translate\", EditableWikiContentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $analytics, $loading, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      render = function(wikiLinks) {\n        var addWikiLinkPermission, deleteWikiLinkPermission, html;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        $el.html(html);\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".js-delete-link\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var ChangeOwnerLightboxController, ChangeOwnerLightboxDirective, LbRequestOwnershipDirective, LightboxAddMembersController, LightboxAddMembersDirective, LightboxAddMembersWarningMessageDirective, TransferProjectStartSuccessDirective, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  LightboxAddMembersController = (function() {\n    LightboxAddMembersController.$inject = [\"$scope\", \"lightboxService\", \"tgLoader\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\"];\n\n    function LightboxAddMembersController(scope1, lightboxService1, tgLoader, confirm, rs1, rootScope) {\n      var pendingMembersCount;\n      this.scope = scope1;\n      this.lightboxService = lightboxService1;\n      this.tgLoader = tgLoader;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rootScope = rootScope;\n      this._defaultMaxInvites = 4;\n      this._defaultRole = this.project.roles[0].id;\n      this.form = null;\n      this.submitInvites = false;\n      this.canAddUsers = true;\n      this.memberInvites = [];\n      if (this.project.max_memberships === null) {\n        this.membersLimit = this._defaultMaxInvites;\n      } else {\n        pendingMembersCount = Math.max(this.project.max_memberships - this.project.total_memberships, 0);\n        this.membersLimit = Math.min(pendingMembersCount, this._defaultMaxInvites);\n      }\n      this.addSingleMember();\n    }\n\n    LightboxAddMembersController.prototype.addSingleMember = function() {\n      this.memberInvites.push({\n        email: '',\n        role_id: this._defaultRole\n      });\n      if (this.memberInvites.length >= this.membersLimit) {\n        this.canAddUsers = false;\n      }\n      return this.showWarningMessage = !this.canAddUsers && this.project.total_memberships + this.memberInvites.length === this.project.max_memberships;\n    };\n\n    LightboxAddMembersController.prototype.removeSingleMember = function(index) {\n      this.memberInvites.splice(index, 1);\n      this.canAddUsers = true;\n      return this.showWarningMessage = this.membersLimit === 1;\n    };\n\n    LightboxAddMembersController.prototype.submit = function() {\n      var promise;\n      this.form.initializeFields();\n      this.form.reset();\n      if (!this.form.validate()) {\n        return;\n      }\n      this.memberInvites = _.filter(this.memberInvites, function(invites) {\n        return invites.email !== \"\";\n      });\n      this.submitInvites = true;\n      promise = this.rs.memberships.bulkCreateMemberships(this.project.id, this.memberInvites, this.invitationText);\n      return promise.then(this._onSuccessInvite.bind(this), this._onErrorInvite.bind(this));\n    };\n\n    LightboxAddMembersController.prototype._onSuccessInvite = function() {\n      this.submitInvites = false;\n      this.rootScope.$broadcast(\"membersform:new:success\");\n      this.lightboxService.closeAll();\n      return this.confirm.notify(\"success\");\n    };\n\n    LightboxAddMembersController.prototype._onErrorInvite = function(response) {\n      this.submitInvites = false;\n      this.form.setErrors(response.data);\n      if (response.data._error_message) {\n        return this.confirm.notify(\"error\", response.data._error_message);\n      }\n    };\n\n    return LightboxAddMembersController;\n\n  })();\n\n  module.controller(\"LbAddMembersController\", LightboxAddMembersController);\n\n  LightboxAddMembersDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      lightboxService.open(el);\n      return ctrl.form = el.find(\"form\").checksley();\n    };\n    return {\n      scope: {},\n      bindToController: {\n        project: '='\n      },\n      controller: 'LbAddMembersController',\n      controllerAs: 'vm',\n      templateUrl: 'admin/lightbox-add-members.html',\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAddMembers\", [\"lightboxService\", LightboxAddMembersDirective]);\n\n  LightboxAddMembersWarningMessageDirective = function() {\n    return {\n      templateUrl: \"admin/memberships-warning-message.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgLightboxAddMembersWarningMessage\", [LightboxAddMembersWarningMessageDirective]);\n\n  LbRequestOwnershipDirective = function(lightboxService, rs, confirmService, $translate) {\n    return {\n      link: function(scope, el) {\n        lightboxService.open(el);\n        return scope.request = function() {\n          scope.loading = true;\n          return rs.projects.transferRequest(scope.projectId).then(function() {\n            scope.loading = false;\n            lightboxService.close(el);\n            return confirmService.notify(\"success\", $translate.instant(\"ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS\"));\n          });\n        };\n      },\n      templateUrl: \"common/lightbox/lightbox-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgLbRequestOwnership', [\"lightboxService\", \"tgResources\", \"$tgConfirm\", \"$translate\", LbRequestOwnershipDirective]);\n\n  ChangeOwnerLightboxController = (function() {\n    function ChangeOwnerLightboxController(rs1, lightboxService1, confirm, translate) {\n      this.rs = rs1;\n      this.lightboxService = lightboxService1;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.users = [];\n      this.q = \"\";\n      this.commentOpen = false;\n    }\n\n    ChangeOwnerLightboxController.prototype.limit = 3;\n\n    ChangeOwnerLightboxController.prototype.normalizeString = function(normalizedString) {\n      normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n      normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n      normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n      normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n      normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n      return normalizedString;\n    };\n\n    ChangeOwnerLightboxController.prototype.filterUsers = function(user) {\n      var text, username;\n      username = user.full_name_display.toUpperCase();\n      username = this.normalizeString(username);\n      text = this.q.toUpperCase();\n      text = this.normalizeString(text);\n      return _.includes(username, text);\n    };\n\n    ChangeOwnerLightboxController.prototype.getUsers = function() {\n      var users;\n      if (!this.users.length && !this.q.length) {\n        users = this.activeUsers;\n      } else {\n        users = this.users;\n      }\n      users = users.slice(0, this.limit);\n      users = _.reject(users, {\n        \"selected\": true\n      });\n      return _.reject(users, {\n        \"id\": this.currentOwnerId\n      });\n    };\n\n    ChangeOwnerLightboxController.prototype.userSearch = function() {\n      this.users = this.activeUsers;\n      this.selected = _.find(this.users, {\n        \"selected\": true\n      });\n      if (this.q) {\n        return this.users = _.filter(this.users, this.filterUsers.bind(this));\n      }\n    };\n\n    ChangeOwnerLightboxController.prototype.selectUser = function(user) {\n      this.activeUsers = _.map(this.activeUsers, function(user) {\n        user.selected = false;\n        return user;\n      });\n      user.selected = true;\n      return this.userSearch();\n    };\n\n    ChangeOwnerLightboxController.prototype.submit = function() {\n      this.loading = true;\n      return this.rs.projects.transferStart(this.projectId, this.selected.id, this.comment).then((function(_this) {\n        return function() {\n          var desc, title;\n          _this.loading = false;\n          _this.lightboxService.closeAll();\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE\");\n          desc = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC\");\n          return _this.confirm.success(title, desc, {\n            type: \"svg\",\n            name: \"icon-speak-up\"\n          });\n        };\n      })(this));\n    };\n\n    return ChangeOwnerLightboxController;\n\n  })();\n\n  ChangeOwnerLightboxController.$inject = [\"tgResources\", \"lightboxService\", \"$tgConfirm\", \"$translate\"];\n\n  module.controller('ChangeOwnerLightbox', ChangeOwnerLightboxController);\n\n  ChangeOwnerLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function(scope, el) {\n      return lightboxService.open(el);\n    };\n    return {\n      scope: true,\n      controller: \"ChangeOwnerLightbox\",\n      controllerAs: \"vm\",\n      bindToController: {\n        currentOwnerId: \"=\",\n        projectId: \"=\",\n        activeUsers: \"=\"\n      },\n      templateUrl: \"common/lightbox/lightbox-change-owner.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbChangeOwner\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", ChangeOwnerLightboxDirective]);\n\n  TransferProjectStartSuccessDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el) {\n      scope.close = function() {\n        return lightboxService.close(el);\n      };\n      return lightboxService.open(el);\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-transfer-project-start-success.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbTransferProjectStartSuccess\", [\"lightboxService\", TransferProjectStartSuccessDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, NoMoreMembershipsExplanationDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgLightboxFactory\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate, auth, lightboxFactory1) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.auth = auth;\n      this.lightboxFactory = lightboxFactory1;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadInitialData();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.canAddUsers = project.max_memberships === null || project.max_memberships > project.total_memberships;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function() {\n          return _this.q.all([_this.loadMembers(), _this.auth.refresh()]);\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.lightboxFactory.create('tg-lb-add-members', {\n        \"class\": \"lightbox lightbox-add-member\",\n        \"project\": \"project\"\n      }, {\n        \"project\": this.scope.project\n      });\n    };\n\n    MembershipsController.prototype.showLimitUsersWarningMessage = function() {\n      var icon, message, title;\n      title = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING\");\n      message = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE\", {\n        members: this.scope.project.max_memberships\n      });\n      icon = \"/\" + window._version + \"/svg/icons/team-question.svg\";\n      return this.confirm.success(title, message, {\n        name: icon,\n        type: \"img\"\n      });\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate, $compile) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: member.photo ? member.photo : \"/\" + window._version + \"/images/unnamed.png\",\n          pending: !member.is_user_active ? pending : \"\",\n          isOwner: member.is_owner\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', \"$compile\", MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      if (member.is_owner) {\n        $el.find(\".js-check\").remove();\n        return;\n      }\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_admin);\n            return $confirm.notify(\"error\", data.is_admin[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_admin = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      html = render(member);\n      if (member.is_admin) {\n        return $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate, $location, $navUrls, lightboxFactory) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, leaveConfirm, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      leaveConfirm = function() {\n        var defaultMsg, message, title;\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if (member.user !== $scope.user.id) {\n                if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                  $ctrl.selectFilter(\"page\", $scope.page - 1);\n                }\n                $ctrl.loadInitialData();\n              } else {\n                $location.path($navUrls.resolve(\"home\"));\n              }\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"success\", text, null, 5000);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      };\n      $el.on(\"click\", \".delete\", function(event) {\n        var isCurrentUser;\n        event.preventDefault();\n        if ($scope.project.owner.id === member.user) {\n          isCurrentUser = $scope.user.id === member.user;\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: isCurrentUser,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgLightboxFactory\", MembershipsRowActionsDirective]);\n\n  NoMoreMembershipsExplanationDirective = function() {\n    return {\n      templateUrl: \"admin/no-more-memberships-explanation.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgNoMoreMembershipsExplanation\", [NoMoreMembershipsExplanationDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var AdminProjectChangeOwnerDirective, AdminProjectRequestOwnershipDirective, AdminProjectRestrictionsDirective, CsvExporterController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectLogoDirective, ProjectLogoModelDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgCurrentUserService\"];\n\n    function ProjectProfileController(scope1, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, tgAuth, currentUserService1) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.tgAuth = tgAuth;\n      this.currentUserService = currentUserService1;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          _this.appMetaService.setAll(title, description);\n          return _this.fillUsersAndRoles(_this.scope.project.members, _this.scope.project.roles);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n          _this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n          _this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      return this.q.all([this.loadProject(), this.tgAuth.refresh()]);\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            $ctrl.loadInitialData();\n            projectService.fetchProject();\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var form, promise;\n          form = $el.find(\"form\").checksley();\n          form.initializeFields();\n          form.reset();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            $scope.$emit(\"project:loaded\", $scope.project);\n            $confirm.notify(\"success\");\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this);\n      $el.on(\"change\", \".module-activation.module-direct-active input\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"keydown\", \".videoconference-attributes input\", function(e) {\n        return e.which !== 32;\n      });\n      $scope.$watch(\"project.videoconferences\", function(newVal, oldVal) {\n        if ((newVal != null) && (oldVal != null) && newVal !== oldVal) {\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(newValue, oldValue) {\n        if (newValue === false) {\n          $scope.project.videoconferences = null;\n          $scope.project.videoconferences_extra_data = \"\";\n          if (oldValue === true) {\n            return submit();\n          }\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope1, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n  ProjectLogoDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").addClass(\"active\");\n      };\n      onSuccess = function(response) {\n        var project;\n        project = $model.make_model(\"projects\", response.data);\n        $scope.project = project;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-logo\", function() {\n        return $el.find(\"#logo-field\").click();\n      });\n      $el.on(\"change\", \"#logo-field\", function(event) {\n        if ($scope.logoAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.projects.changeLogo($scope.project.id, $scope.logoAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-default-logo\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.projects.removeLogo($scope.project.id).then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectLogo\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", ProjectLogoDirective]);\n\n  ProjectLogoModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgProjectLogoModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgProjectLogoModel', ['$parse', ProjectLogoModelDirective]);\n\n  AdminProjectRestrictionsDirective = function() {\n    return {\n      scope: {\n        \"project\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-restrictions.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRestrictions', [AdminProjectRestrictionsDirective]);\n\n  AdminProjectRequestOwnershipDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.requestOwnership = function() {\n          return lightboxFactory.create(\"tg-lb-request-ownership\", {\n            \"class\": \"lightbox lightbox-request-ownership\"\n          }, {\n            projectId: scope.projectId\n          });\n        };\n      },\n      scope: {\n        \"projectId\": \"=\",\n        \"owner\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRequestOwnership', [\"tgLightboxFactory\", AdminProjectRequestOwnershipDirective]);\n\n  AdminProjectChangeOwnerDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.changeOwner = function() {\n          return lightboxFactory.create(\"tg-lb-change-owner\", {\n            \"class\": \"lightbox lightbox-select-user\",\n            \"project-id\": \"projectId\",\n            \"active-users\": \"activeUsers\",\n            \"current-owner-id\": \"currentOwnerId\"\n          }, {\n            projectId: scope.projectId,\n            activeUsers: scope.activeUsers,\n            currentOwnerId: scope.owner.id,\n            members: scope.members\n          });\n        };\n      },\n      scope: {\n        \"activeUsers\": \"=\",\n        \"projectId\": \"=\",\n        \"owner\": \"=\",\n        \"members\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-change-owner.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectChangeOwner', [\"tgLightboxFactory\", AdminProjectChangeOwnerDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      this.rootscope.$on(\"project:loaded\", this.loadValues);\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.maxBy(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      drake = dragula([tdom[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: tdom[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemIndex, itemValue;\n        itemEl = $(item);\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return drake.destroy();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            return row.siblings(\".visualization\").removeClass('hidden');\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".edition input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $el.find(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = {};\n      this.rootscope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          _this.loadCustomAttributes();\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          var ref;\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = (ref = _.maxBy(customAttributes, \"order\")) != null ? ref.order : void 0;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, drake, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      drake = dragula([sortableEl[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: sortableEl[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = $(item);\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n            return point.computable;\n          }));\n          return project;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadRoles();\n        };\n      })(this));\n      return promise;\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.loadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.loadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.loadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      return this.confirm.ask(title, subtitle, \"\").then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \".edit-value\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.maxBy($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<tg-svg svg-icon=\\\"icon-arrow-right\\\"></tg-svg>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          target.toggleClass(\"open-drawer\");\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadWebhooks();\n        };\n      })(this));\n      return promise;\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.toPairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\");\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\");\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          initializeNewValue();\n          if ($scope.webhooks.length >= 1) {\n            return formDOMNode.addClass(\"hidden\");\n          }\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n}).call(this);\n\n(function() {\n  var createProjectRestrictionDirective, module;\n\n  module = angular.module(\"taigaProject\");\n\n  createProjectRestrictionDirective = function() {\n    return {\n      templateUrl: \"project/wizard-restrictions.html\"\n    };\n  };\n\n  module.directive('tgCreateProjectRestriction', [createProjectRestrictionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var CreateProject, DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  CreateProject = function($rootscope, $repo, $confirm, $location, $navurls, $rs, $projectUrl, $loading, lightboxService, $cacheFactory, $translate, currentUserService, $auth) {\n    var directive, link;\n    link = function($scope, $el, attrs) {\n      var currentLoading, form, onErrorSubmit, onSuccessSubmit, openLightbox, submit, submitButton;\n      $scope.data = {};\n      $scope.templates = [];\n      currentLoading = null;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      onSuccessSubmit = function(response) {\n        $cacheFactory.get('$http').removeAll();\n        currentLoading.finish();\n        $rootscope.$broadcast(\"projects:reload\");\n        $confirm.notify(\"success\", $translate.instant(\"COMMON.SAVE\"));\n        $location.url($projectUrl.get(response));\n        lightboxService.close($el);\n        return currentUserService.loadProjects();\n      };\n      onErrorSubmit = function(response) {\n        var error_field, i, len, ref, results, selectors;\n        currentLoading.finish();\n        form.setErrors(response);\n        selectors = [];\n        ref = _.keys(response);\n        results = [];\n        for (i = 0, len = ref.length; i < len; i++) {\n          error_field = ref[i];\n          results.push(selectors.push(\"[name=\" + error_field + \"]\"));\n        }\n        return results;\n      };\n      submit = (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"projects\", $scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this);\n      openLightbox = function() {\n        $scope.data = {\n          is_private: false\n        };\n        if (!$scope.templates.length) {\n          $rs.projects.templates().then((function(_this) {\n            return function(result) {\n              $scope.templates = result;\n              return $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n                return x.slug === \"scrum\";\n              })).id;\n            };\n          })(this));\n        } else {\n          $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n            return x.slug === \"scrum\";\n          })).id;\n        }\n        $scope.canCreatePrivateProjects = currentUserService.canCreatePrivateProjects();\n        $scope.canCreatePublicProjects = currentUserService.canCreatePublicProjects();\n        return lightboxService.open($el);\n      };\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $auth.refresh().then(function() {\n        return openLightbox();\n      });\n    };\n    directive = {\n      link: link,\n      templateUrl: \"project/wizard-create-project.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbCreateProject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$tgResources\", \"$projectUrl\", \"$tgLoading\", \"lightboxService\", \"$cacheFactory\", \"$translate\", \"tgCurrentUserService\", \"$tgAuth\", CreateProject]);\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, ContribUserSettingsController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm) {\n      var promise;\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      promise = this.loadInitialData();\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    }\n\n    ContribController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.$broadcast('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n  ContribUserSettingsController = (function(superClass) {\n    extend(ContribUserSettingsController, superClass);\n\n    ContribUserSettingsController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\"];\n\n    function ContribUserSettingsController(rootScope, scope, params) {\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.userSettingsPlugins, {\n        \"slug\": this.params.plugin\n      }));\n    }\n\n    return ContribUserSettingsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribUserSettingsController\", ContribUserSettingsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.assign({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.assign({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.assign({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.assign({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location, lightboxService) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\") || $attrs.tgNavGetParams !== target.data(\"params\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n              target.data(\"params\", $attrs.tgNavGetParams);\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  $scope.$apply();\n                  break;\n                case 2:\n                  window.open(fullUrl);\n              }\n              return lightboxService.closeAll();\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", \"lightboxService\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data));\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.trimEnd(this.mainUrl, \"/\"), _.trimStart(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var filtersHashSuffix, hashSuffix, myFiltersHashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    filtersHashSuffix = \"issues-filters\";\n    myFiltersHashSuffix = \"issues-my-filters\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeFilters = function(projectSlug, params) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getFilters = function(projectSlug) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeMyFilters = function(projectId, myFilters) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = $http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = $http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, function(data) {\n          var innerPromise;\n          innerPromise = $http.post(\"\" + url, {\n            key: hash,\n            value: myFilters\n          });\n          innerPromise.then(function() {\n            return deferred.resolve();\n          });\n          return innerPromise.then(null, function() {\n            return deferred.reject();\n          });\n        });\n      }\n      return deferred.promise;\n    };\n    service.getMyFilters = function(projectId) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = $http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusViewModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusViewModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var error, ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if (evt.target.getResponseHeader('Taiga-Info-Project-Is-Private')) {\n            response.headers = {\n              isPrivate: evt.target.getResponseHeader('Taiga-Info-Project-Is-Private') === 'True',\n              memberships: parseInt(evt.target.getResponseHeader('Taiga-Info-Project-Memberships'))\n            };\n          }\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    service.changeLogo = function(projectId, file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('logo', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/change_logo\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeLogo = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/remove_logo\";\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.list = function(projectId, sprintId, userStoryId) {\n      var params;\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = {\n        project: projectId\n      };\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        sprint_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters, pageSize) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", _.extend(params, {\n        page_size: pageSize\n      }), {\n        enablePagination: true\n      }, true);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateSprintOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-sprint-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var form, submit, submitButton;\n      form = new checksley.Form($el.find(\"form\"));\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, submitButton;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var currentLoading, promise;\n        currentLoading = $loading().target(submitButton).start();\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          currentLoading.finish();\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          currentLoading.finish();\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $el.on(\"click\", \".button-red\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n      return submitButton = $el.find(\".button-red\");\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", \"$tgLoading\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.location.path(this.navUrls.resolve(\"permission-denied\"));\n        this.location.replace();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-gravatar\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaDiscover\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-link.directive.coffee\n */\n\n(function() {\n  var AttachmentLinkDirective;\n\n  AttachmentLinkDirective = function($parse, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attachment;\n      attachment = $parse(attrs.tgAttachmentLink)(scope);\n      el.on(\"click\", function(event) {\n        if (taiga.isImage(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return scope.$apply(function() {\n            return lightboxFactory.create('tg-lb-attachment-preview', {\n              \"class\": 'lightbox lightbox-block'\n            }, {\n              file: attachment.get('file')\n            });\n          });\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentLinkDirective.$inject = [\"$parse\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentLink\", AttachmentLinkDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-gallery.directive.coffee\n */\n\n(function() {\n  var AttachmentGalleryDirective;\n\n  AttachmentGalleryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment-gallery.html\",\n      link: link\n    };\n  };\n\n  AttachmentGalleryDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentGallery\", AttachmentGalleryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchment.controller.coffee\n */\n\n(function() {\n  var AttachmentController;\n\n  AttachmentController = (function() {\n    AttachmentController.$inject = ['tgAttachmentsService', '$translate'];\n\n    function AttachmentController(attachmentsService, translate) {\n      this.attachmentsService = attachmentsService;\n      this.translate = translate;\n      this.form = {};\n      this.form.description = this.attachment.getIn(['file', 'description']);\n      this.form.is_deprecated = this.attachment.get(['file', 'is_deprecated']);\n      this.title = this.translate.instant(\"ATTACHMENT.TITLE\", {\n        fileName: this.attachment.get('name'),\n        date: moment(this.attachment.get('created_date')).format(this.translate.instant(\"ATTACHMENT.DATE\"))\n      });\n    }\n\n    AttachmentController.prototype.editMode = function(mode) {\n      var attachment;\n      attachment = this.attachment.set('editable', mode);\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    AttachmentController.prototype[\"delete\"] = function() {\n      return this.onDelete({\n        attachment: this.attachment\n      });\n    };\n\n    AttachmentController.prototype.save = function() {\n      var attachment;\n      attachment = this.attachment.set('loading', true);\n      this.onUpdate({\n        attachment: attachment\n      });\n      attachment = this.attachment.merge({\n        editable: false,\n        loading: false\n      });\n      attachment = attachment.mergeIn(['file'], {\n        description: this.form.description,\n        is_deprecated: !!this.form.is_deprecated\n      });\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    return AttachmentController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Attachment', AttachmentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment.directive.coffee\n */\n\n(function() {\n  var AttachmentDirective;\n\n  AttachmentDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment.html\",\n      link: link\n    };\n  };\n\n  AttachmentDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachment\", AttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-drop.directive.coffee\n */\n\n(function() {\n  var AttachmentsDropDirective;\n\n  AttachmentsDropDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgAttachmentsDrop);\n      el.on('dragover', function(e) {\n        e.preventDefault();\n        return false;\n      });\n      el.on('drop', function(e) {\n        var dataTransfer;\n        e.stopPropagation();\n        e.preventDefault();\n        dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: dataTransfer.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentsDropDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsDrop\", AttachmentsDropDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.controller.coffee\n */\n\n(function() {\n  var AttachmentsFullController, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsFullController = (function() {\n    AttachmentsFullController.$inject = [\"$translate\", \"$tgConfirm\", \"$tgConfig\", \"$tgStorage\", \"tgAttachmentsFullService\", \"tgProjectService\"];\n\n    function AttachmentsFullController(translate, confirm, config, storage, attachmentsFullService, projectService) {\n      this.translate = translate;\n      this.confirm = confirm;\n      this.config = config;\n      this.storage = storage;\n      this.attachmentsFullService = attachmentsFullService;\n      this.projectService = projectService;\n      this.mode = this.storage.get('attachment-mode', 'list');\n      this.maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (this.maxFileSize) {\n        this.maxFileSize = sizeFormat(this.maxFileSize);\n      }\n      this.maxFileSizeMsg = this.maxFileSize ? this.translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: this.maxFileSize\n      }) : \"\";\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullController.prototype.uploadingAttachments = function() {\n      return this.attachmentsFullService.uploadingAttachments;\n    };\n\n    AttachmentsFullController.prototype.addAttachment = function(file) {\n      var editable;\n      editable = this.mode === 'list';\n      return this.attachmentsFullService.addAttachment(this.projectId, this.objId, this.type, file, editable);\n    };\n\n    AttachmentsFullController.prototype.setMode = function(mode) {\n      this.mode = mode;\n      return this.storage.set('attachment-mode', mode);\n    };\n\n    AttachmentsFullController.prototype.toggleDeprecatedsVisible = function() {\n      return this.attachmentsFullService.toggleDeprecatedsVisible();\n    };\n\n    AttachmentsFullController.prototype.addAttachments = function(files) {\n      return _.forEach(files, (function(_this) {\n        return function(file) {\n          return _this.addAttachment(file);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.loadAttachments = function() {\n      return this.attachmentsFullService.loadAttachments(this.type, this.objId, this.projectId);\n    };\n\n    AttachmentsFullController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      var message, title;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: toDeleteAttachment.getIn(['file', 'name'])\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onError = function() {\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            return askResponse.finish();\n          };\n          return _this.attachmentsFullService.deleteAttachment(toDeleteAttachment, _this.type).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.reorderAttachment = function(attachment, newIndex) {\n      return this.attachmentsFullService.reorderAttachment(this.type, attachment, newIndex);\n    };\n\n    AttachmentsFullController.prototype.updateAttachment = function(toUpdateAttachment) {\n      return this.attachmentsFullService.updateAttachment(toUpdateAttachment, this.type);\n    };\n\n    AttachmentsFullController.prototype._isEditable = function() {\n      if (this.projectService.project) {\n        return this.projectService.hasPermission(this.editPermission);\n      }\n      return false;\n    };\n\n    AttachmentsFullController.prototype.showAttachments = function() {\n      return this._isEditable() || this.attachmentsFullService.attachments.size;\n    };\n\n    return AttachmentsFullController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsFull\", AttachmentsFullController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.directive.coffee\n */\n\n(function() {\n  var AttachmentsFullDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  AttachmentsFullDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.objId', function(value) {\n        return ctrl.loadAttachments();\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        type: \"@\",\n        objId: \"=\",\n        projectId: \"=\",\n        editPermission: \"@\"\n      },\n      controller: \"AttachmentsFull\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-full/attachments-full.html\",\n      link: link\n    };\n  };\n\n  AttachmentsFullDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsFull\", AttachmentsFullDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-full.service.coffee\n */\n\n(function() {\n  var AttachmentsFullService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsFullService = (function(superClass) {\n    extend(AttachmentsFullService, superClass);\n\n    AttachmentsFullService.$inject = [\"tgAttachmentsService\", \"$rootScope\"];\n\n    function AttachmentsFullService(attachmentsService, rootScope) {\n      this.attachmentsService = attachmentsService;\n      this.rootScope = rootScope;\n      this._attachments = Immutable.List();\n      this._deprecatedsCount = 0;\n      this._attachmentsVisible = Immutable.List();\n      this._deprecatedsVisible = false;\n      this.uploadingAttachments = [];\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this._attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this._deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this._attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this._deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullService.prototype.toggleDeprecatedsVisible = function() {\n      this._deprecatedsVisible = !this._deprecatedsVisible;\n      return this.regenerate();\n    };\n\n    AttachmentsFullService.prototype.regenerate = function() {\n      this._deprecatedsCount = this._attachments.count(function(it) {\n        return it.getIn(['file', 'is_deprecated']);\n      });\n      if (this._deprecatedsVisible) {\n        return this._attachmentsVisible = this._attachments;\n      } else {\n        return this._attachmentsVisible = this._attachments.filter(function(it) {\n          return !it.getIn(['file', 'is_deprecated']);\n        });\n      }\n    };\n\n    AttachmentsFullService.prototype.addAttachment = function(projectId, objId, type, file, editable) {\n      if (editable == null) {\n        editable = true;\n      }\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var promise;\n          if (_this.attachmentsService.validate(file)) {\n            _this.uploadingAttachments.push(file);\n            promise = _this.attachmentsService.upload(file, objId, projectId, type);\n            return promise.then(function(file) {\n              var attachment;\n              _this.uploadingAttachments = _this.uploadingAttachments.filter(function(uploading) {\n                return uploading.name !== file.get('name');\n              });\n              attachment = Immutable.Map();\n              attachment = attachment.merge({\n                file: file,\n                editable: editable,\n                loading: false\n              });\n              _this._attachments = _this._attachments.push(attachment);\n              _this.regenerate();\n              _this.rootScope.$broadcast(\"attachment:create\");\n              return resolve(attachment);\n            });\n          } else {\n            return reject(file);\n          }\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.loadAttachments = function(type, objId, projectId) {\n      return this.attachmentsService.list(type, objId, projectId).then((function(_this) {\n        return function(files) {\n          _this._attachments = files.map(function(file) {\n            var attachment;\n            attachment = Immutable.Map();\n            return attachment.merge({\n              loading: false,\n              editable: false,\n              file: file\n            });\n          });\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.deleteAttachment = function(toDeleteAttachment, type) {\n      var onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this._attachments = _this._attachments.filter(function(attachment) {\n            return attachment !== toDeleteAttachment;\n          });\n          return _this.regenerate();\n        };\n      })(this);\n      return this.attachmentsService[\"delete\"](type, toDeleteAttachment.getIn(['file', 'id'])).then(onSuccess);\n    };\n\n    AttachmentsFullService.prototype.reorderAttachment = function(type, attachment, newIndex) {\n      var attachments, oldIndex, promises;\n      oldIndex = this.attachments.findIndex(function(it) {\n        return it === attachment;\n      });\n      if (oldIndex === newIndex) {\n        return;\n      }\n      attachments = this.attachments.remove(oldIndex);\n      attachments = attachments.splice(newIndex, 0, attachment);\n      attachments = attachments.map(function(x, i) {\n        return x.setIn(['file', 'order'], i + 1);\n      });\n      promises = [];\n      attachments.forEach((function(_this) {\n        return function(attachment) {\n          var patch;\n          patch = {\n            order: attachment.getIn(['file', 'order'])\n          };\n          return promises.push(_this.attachmentsService.patch(attachment.getIn(['file', 'id']), type, patch));\n        };\n      })(this));\n      return Promise.all(promises).then((function(_this) {\n        return function() {\n          _this._attachments = attachments;\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.updateAttachment = function(toUpdateAttachment, type) {\n      var index, oldAttachment, patch;\n      index = this._attachments.findIndex(function(attachment) {\n        return attachment.getIn(['file', 'id']) === toUpdateAttachment.getIn(['file', 'id']);\n      });\n      oldAttachment = this._attachments.get(index);\n      patch = taiga.patch(oldAttachment.get('file'), toUpdateAttachment.get('file'));\n      if (toUpdateAttachment.get('loading')) {\n        this._attachments = this._attachments.set(index, toUpdateAttachment);\n        return this.regenerate();\n      } else {\n        return this.attachmentsService.patch(toUpdateAttachment.getIn(['file', 'id']), type, patch).then((function(_this) {\n          return function() {\n            _this._attachments = _this._attachments.set(index, toUpdateAttachment);\n            return _this.regenerate();\n          };\n        })(this));\n      }\n    };\n\n    return AttachmentsFullService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsFullService\", AttachmentsFullService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.controller.coffee\n */\n\n(function() {\n  var AttachmentsSimpleController;\n\n  AttachmentsSimpleController = (function() {\n    AttachmentsSimpleController.$inject = [\"tgAttachmentsService\"];\n\n    function AttachmentsSimpleController(attachmentsService) {\n      this.attachmentsService = attachmentsService;\n    }\n\n    AttachmentsSimpleController.prototype.addAttachment = function(file) {\n      var attachment;\n      attachment = Immutable.fromJS({\n        file: file,\n        name: file.name,\n        size: file.size\n      });\n      if (this.attachmentsService.validate(file)) {\n        this.attachments = this.attachments.push(attachment);\n        if (this.onAdd) {\n          return this.onAdd({\n            attachment: attachment\n          });\n        }\n      }\n    };\n\n    AttachmentsSimpleController.prototype.addAttachments = function(files) {\n      return _.forEach(files, this.addAttachment.bind(this));\n    };\n\n    AttachmentsSimpleController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      this.attachments = this.attachments.filter(function(attachment) {\n        return attachment !== toDeleteAttachment;\n      });\n      if (this.onDelete) {\n        return this.onDelete({\n          attachment: toDeleteAttachment\n        });\n      }\n    };\n\n    return AttachmentsSimpleController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsSimple\", AttachmentsSimpleController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.directive.coffee\n */\n\n(function() {\n  var AttachmentsSimpleDirective;\n\n  AttachmentsSimpleDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachments: \"=\",\n        onAdd: \"&\",\n        onDelete: \"&\"\n      },\n      controller: \"AttachmentsSimple\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-simple/attachments-simple.html\",\n      link: link\n    };\n  };\n\n  AttachmentsSimpleDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSimple\", AttachmentsSimpleDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-sortable.directive.coffee\n */\n\n(function() {\n  var AttachmentSortableDirective;\n\n  AttachmentSortableDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      callback = $parse(attrs.tgAttachmentsSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var attachment, newIndex;\n        item = $(item);\n        attachment = item.scope().attachment;\n        newIndex = item.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            attachment: attachment,\n            index: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentSortableDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSortable\", AttachmentSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: auto-select.directive.coffee\n */\n\n(function() {\n  var AutoSelectDirective;\n\n  AutoSelectDirective = function($timeout) {\n    return {\n      link: function(scope, elm) {\n        return $timeout(function() {\n          return elm[0].select();\n        });\n      }\n    };\n  };\n\n  AutoSelectDirective.$inject = ['$timeout'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAutoSelect\", AutoSelectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: file-change.directive.coffee\n */\n\n(function() {\n  var FileChangeDirective;\n\n  FileChangeDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgFileChange);\n      el.on('change', function(event) {\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: event.currentTarget.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      restrict: \"A\",\n      link: link\n    };\n  };\n\n  FileChangeDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgFileChange\", FileChangeDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.icon-plus',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2015 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-big-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoBigSrcDirective;\n\n  ProjectLogoBigSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_big_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoBigSrc\"\n      }\n    };\n  };\n\n  ProjectLogoBigSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoBigSrc\", ProjectLogoBigSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-small-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoSmallSrcDirective;\n\n  ProjectLogoSmallSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_small_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoSmallSrc\"\n      }\n    };\n  };\n\n  ProjectLogoSmallSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoSmallSrc\", ProjectLogoSmallSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog > indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        url = url.replace(/-/g, \"\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n      scope.vm.fixed = false;\n      return $(window).on(\"scroll\", function() {\n        var position;\n        position = $(window).scrollTop();\n        if (position > 100 && scope.vm.fixed === false) {\n          scope.vm.fixed = true;\n          return scope.$digest();\n        } else if (position < 100 && scope.vm.fixed === true) {\n          scope.vm.fixed = false;\n          return scope.$digest();\n        }\n      });\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tribe-button.directive.coffee\n */\n\n(function() {\n  var TribeButtonDirective;\n\n  TribeButtonDirective = function(configService) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.vm = {};\n      return scope.vm.tribeHost = configService.config.tribeHost;\n    };\n    return {\n      scope: {\n        usId: \"=\",\n        projectSlug: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/tribe-button/tribe-button.html\",\n      link: link\n    };\n  };\n\n  TribeButtonDirective.$inject = [\"$tgConfig\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgTribeButton\", TribeButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tribe-linked.directive.coffee\n */\n\n(function() {\n  var TribeLinkedDirective;\n\n  TribeLinkedDirective = function(configService) {\n    var directive, link;\n    link = function(scope, el, attrs) {\n      scope.vm = {};\n      scope.vm.tribeHost = configService.config.tribeHost;\n      scope.vm.show = function() {\n        return scope.vm.open = true;\n      };\n      return scope.vm.hide = function(event) {\n        return scope.vm.open = false;\n      };\n    };\n    directive = {\n      templateUrl: \"components/tribe-button/tribe-linked.html\",\n      scope: {\n        gigTitle: \"=\",\n        gigId: \"=\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  TribeLinkedDirective.$inject = [\"$tgConfig\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgTribeLinked\", TribeLinkedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\", \"$rootScope\"];\n\n    function WatchButtonController(currentUserService, rootScope) {\n      this.currentUserService = currentUserService;\n      this.rootScope = rootScope;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.openWatchers = function() {\n      return this.rootScope.$broadcast(\"watcher:add\", this.item);\n    };\n\n    WatchButtonController.prototype.getPerms = function() {\n      var name, perms;\n      if (!this.item) {\n        return \"\";\n      }\n      name = this.item._name;\n      perms = {\n        userstories: 'modify_us',\n        issues: 'modify_issue',\n        tasks: 'modify_task'\n      };\n      return perms[name];\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: function(item, attributes) {\n        return \"components/watch-button/watch-button-\" + attributes.environment + \".html\";\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByController;\n\n  DiscoverHomeOrderByController = (function() {\n    DiscoverHomeOrderByController.$inject = ['$translate'];\n\n    function DiscoverHomeOrderByController(translate) {\n      this.translate = translate;\n      this.is_open = false;\n      this.texts = {\n        week: this.translate.instant('DISCOVER.FILTERS.WEEK'),\n        month: this.translate.instant('DISCOVER.FILTERS.MONTH'),\n        year: this.translate.instant('DISCOVER.FILTERS.YEAR'),\n        all: this.translate.instant('DISCOVER.FILTERS.ALL_TIME')\n      };\n    }\n\n    DiscoverHomeOrderByController.prototype.currentText = function() {\n      return this.texts[this.currentOrderBy];\n    };\n\n    DiscoverHomeOrderByController.prototype.open = function() {\n      return this.is_open = true;\n    };\n\n    DiscoverHomeOrderByController.prototype.close = function() {\n      return this.is_open = false;\n    };\n\n    DiscoverHomeOrderByController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      this.is_open = false;\n      return this.onChange({\n        orderBy: this.currentOrderBy\n      });\n    };\n\n    return DiscoverHomeOrderByController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHomeOrderBy\", DiscoverHomeOrderByController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.directive.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByDirective;\n\n  DiscoverHomeOrderByDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverHomeOrderBy\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-home-order-by/discover-home-order-by.html\",\n      scope: {\n        currentOrderBy: \"=orderBy\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverHomeOrderByDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverHomeOrderBy\", DiscoverHomeOrderByDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-bar.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchBarController;\n\n  DiscoverSearchBarController = (function() {\n    DiscoverSearchBarController.$inject = ['tgDiscoverProjectsService'];\n\n    function DiscoverSearchBarController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.projectsCount;\n        };\n      })(this));\n      this.discoverProjectsService.fetchStats();\n    }\n\n    DiscoverSearchBarController.prototype.selectFilter = function(filter) {\n      return this.onChange({\n        filter: filter,\n        q: this.q\n      });\n    };\n\n    DiscoverSearchBarController.prototype.submitFilter = function() {\n      return this.onChange({\n        filter: this.filter,\n        q: this.q\n      });\n    };\n\n    return DiscoverSearchBarController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchBar\", DiscoverSearchBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchBarDirective;\n\n  DiscoverSearchBarDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"DiscoverSearchBar\",\n      controllerAs: \"vm\",\n      templateUrl: 'discover/components/discover-search-bar/discover-search-bar.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchBarDirective.$inject = [];\n\n  angular.module('taigaDiscover').directive('tgDiscoverSearchBar', DiscoverSearchBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderController;\n\n  DiscoverSearchListHeaderController = (function() {\n    DiscoverSearchListHeaderController.$inject = [];\n\n    function DiscoverSearchListHeaderController() {\n      this.like_is_open = this.orderBy.indexOf('-total_fans') === 0;\n      this.activity_is_open = this.orderBy.indexOf('-total_activity') === 0;\n    }\n\n    DiscoverSearchListHeaderController.prototype.openLike = function() {\n      this.like_is_open = true;\n      this.activity_is_open = false;\n      return this.setOrderBy('-total_fans_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.openActivity = function() {\n      this.activity_is_open = true;\n      this.like_is_open = false;\n      return this.setOrderBy('-total_activity_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.setOrderBy = function(type) {\n      if (type == null) {\n        type = '';\n      }\n      if (!type) {\n        this.like_is_open = false;\n        this.activity_is_open = false;\n      }\n      return this.onChange({\n        orderBy: type\n      });\n    };\n\n    return DiscoverSearchListHeaderController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchListHeader\", DiscoverSearchListHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderDirective;\n\n  DiscoverSearchListHeaderDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverSearchListHeader\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-search-list-header/discover-search-list-header.html\",\n      scope: {\n        onChange: \"&\",\n        orderBy: \"=\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchListHeaderDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearchListHeader\", DiscoverSearchListHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.controller.coffee\n */\n\n(function() {\n  var FeaturedProjectsController;\n\n  FeaturedProjectsController = (function() {\n    FeaturedProjectsController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function FeaturedProjectsController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.featured;\n        };\n      })(this));\n      this.discoverProjectsService.fetchFeatured();\n    }\n\n    return FeaturedProjectsController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"FeaturedProjects\", FeaturedProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.directive.coffee\n */\n\n(function() {\n  var FeaturedProjectsDirective;\n\n  FeaturedProjectsDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"FeaturedProjects\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/featured-projects/featured-projects.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  FeaturedProjectsDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgFeaturedProjects\", FeaturedProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: highlighted.directive.coffee\n */\n\n(function() {\n  var HighlightedDirective;\n\n  HighlightedDirective = function() {\n    return {\n      templateUrl: \"discover/components/highlighted/highlighted.html\",\n      scope: {\n        loading: \"=\",\n        highlighted: \"=\",\n        orderBy: \"=\"\n      }\n    };\n  };\n\n  HighlightedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgHighlighted\", HighlightedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.controller.coffee\n */\n\n(function() {\n  var MostActiveController;\n\n  MostActiveController = (function() {\n    MostActiveController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostActiveController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostActive;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostActiveController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostActive({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostActiveController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostActiveController.prototype.getOrderBy = function(type) {\n      if (this.currentOrderBy === 'all') {\n        return '-total_activity';\n      } else {\n        return '-total_activity_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostActiveController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostActive\", MostActiveController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.directive.coffee\n */\n\n(function() {\n  var MostActiveDirective;\n\n  MostActiveDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostActive\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-active/most-active.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostActiveDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostActive\", MostActiveDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: msot-liked.controller.coffee\n */\n\n(function() {\n  var MostLikedController;\n\n  MostLikedController = (function() {\n    MostLikedController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostLikedController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostLiked;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostLikedController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostLiked({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostLikedController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostLikedController.prototype.getOrderBy = function() {\n      if (this.currentOrderBy === 'all') {\n        return '-total_fans';\n      } else {\n        return '-total_fans_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostLikedController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostLiked\", MostLikedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-liked.directive.coffee\n */\n\n(function() {\n  var MostLikedDirective;\n\n  MostLikedDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostLiked\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-liked/most-liked.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostLikedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostLiked\", MostLikedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeController;\n\n  DiscoverHomeController = (function() {\n    DiscoverHomeController.$inject = ['$tgLocation', '$tgNavUrls', 'tgAppMetaService', '$translate'];\n\n    function DiscoverHomeController(location, navUrls, appMetaService, translate) {\n      var description, title;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = this.translate.instant(\"DISCOVER.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverHomeController.prototype.onSubmit = function(q) {\n      var url;\n      url = this.navUrls.resolve('discover-search');\n      return this.location.search('text', q).path(url);\n    };\n\n    return DiscoverHomeController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHome\", DiscoverHomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchController;\n\n  DiscoverSearchController = (function() {\n    DiscoverSearchController.$inject = ['$routeParams', 'tgDiscoverProjectsService', '$route', 'tgAppMetaService', '$translate'];\n\n    function DiscoverSearchController(routeParams, discoverProjectsService, route, appMetaService, translate) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.discoverProjectsService = discoverProjectsService;\n      this.route = route;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.page = 1;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.nextSearchPage;\n        };\n      })(this));\n      this.q = this.routeParams.text;\n      this.filter = this.routeParams.filter || 'all';\n      this.orderBy = this.routeParams['order_by'] || '';\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverSearchController.prototype.fetch = function() {\n      this.page = 1;\n      this.discoverProjectsService.resetSearchList();\n      return this.search();\n    };\n\n    DiscoverSearchController.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.fetchByOrderBy = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.search = function() {\n      var filter, params;\n      filter = this.getFilter();\n      params = {\n        page: this.page,\n        q: this.q,\n        order_by: this.orderBy\n      };\n      _.assign(params, filter);\n      return this.discoverProjectsService.fetchSearch(params);\n    };\n\n    DiscoverSearchController.prototype.getFilter = function() {\n      if (this.filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (this.filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (this.filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    DiscoverSearchController.prototype.onChangeFilter = function(filter, q) {\n      this.filter = filter;\n      this.q = q;\n      this.route.updateParams({\n        filter: this.filter,\n        text: this.q\n      });\n      return this.fetchByGlobalSearch();\n    };\n\n    DiscoverSearchController.prototype.onChangeOrder = function(orderBy) {\n      this.orderBy = orderBy;\n      this.route.updateParams({\n        order_by: orderBy\n      });\n      return this.fetchByOrderBy();\n    };\n\n    return DiscoverSearchController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearch\", DiscoverSearchController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchDirective;\n\n  DiscoverSearchDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  DiscoverSearchDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearch\", DiscoverSearchDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-projects.service.coffee\n */\n\n(function() {\n  var DiscoverProjectsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  DiscoverProjectsService = (function(superClass) {\n    var _discoverParams;\n\n    extend(DiscoverProjectsService, superClass);\n\n    DiscoverProjectsService.$inject = [\"tgResources\", \"tgProjectsService\"];\n\n    _discoverParams = {\n      discover_mode: true\n    };\n\n    function DiscoverProjectsService(rs, projectsService) {\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this._mostLiked = Immutable.List();\n      this._mostActive = Immutable.List();\n      this._featured = Immutable.List();\n      this._searchResult = Immutable.List();\n      this._projectsCount = 0;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n      taiga.defineImmutableProperty(this, \"mostLiked\", (function(_this) {\n        return function() {\n          return _this._mostLiked;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"mostActive\", (function(_this) {\n        return function() {\n          return _this._mostActive;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this._featured;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this._nextSearchPage;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._projectsCount;\n        };\n      })(this));\n    }\n\n    DiscoverProjectsService.prototype.fetchMostLiked = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostLiked = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchMostActive = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostActive = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchFeatured = function() {\n      var _params;\n      _params = _.extend({}, _discoverParams);\n      _params.is_featured = true;\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 4);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._featured = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.resetSearchList = function() {\n      return this._searchResult = Immutable.List();\n    };\n\n    DiscoverProjectsService.prototype.fetchStats = function() {\n      return this.rs.stats.discover().then((function(_this) {\n        return function(discover) {\n          return _this._projectsCount = discover.getIn(['projects', 'total']);\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchSearch = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params).then((function(_this) {\n        return function(result) {\n          var projects;\n          _this._nextSearchPage = !!result.headers('X-Pagination-Next');\n          projects = Immutable.fromJS(result.data);\n          projects = projects.map(_this.decorate);\n          return _this._searchResult = _this._searchResult.concat(projects);\n        };\n      })(this));\n    };\n\n    return DiscoverProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaDiscover\").service(\"tgDiscoverProjectsService\", DiscoverProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.controller.coffee\n */\n\n(function() {\n  var HomeController;\n\n  HomeController = (function() {\n    HomeController.$inject = [\"tgCurrentUserService\", \"$location\", \"$tgNavUrls\"];\n\n    function HomeController(currentUserService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      if (!this.currentUserService.getUser()) {\n        this.location.path(this.navUrls.resolve(\"discover\"));\n      }\n    }\n\n    return HomeController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"Home\", HomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, _getValidDutiesAndAttachProjectInfo, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('projectName', project.get('name'));\n          duty = duty.set('blockedProject', project.get('blocked_code'));\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      _getValidDutiesAndAttachProjectInfo = function(duties, dutyType) {\n        duties = duties.filter(function(duty) {\n          return projectsById.get(String(duty.get('project')));\n        });\n        duties = duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, dutyType);\n        });\n        return duties;\n      };\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"userStories\"), \"userstories\");\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"tasks\"), \"tasks\");\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"issues\"), \"issues\");\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"userStories\"), \"userstories\");\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"tasks\"), \"tasks\");\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"issues\"), \"issues\");\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params, params_us, projectsById, projectsPromise, watching, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_us = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_us = {\n        is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedUserStoriesPromise, assignedTasksPromise, assignedIssuesPromise, watchingUserStoriesPromise, watchingTasksPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService, $rootScope) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        locationService.url(navUrlsService.resolve(\"discover\"));\n        return locationService.search({});\n      };\n      scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n      return scope.vm.userSettingsPlugins = _.filter($rootScope.userSettingsPlugins, {\n        userMenu: true\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\", \"$rootScope\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, locationService, navUrlsService, config) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n      scope.vm.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      scope.vm.login = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"login\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      scope.vm.register = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"register\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      return scope.$on(\"$routeChangeSuccess\", function() {\n        if (locationService.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileLikedController, ProfileVotedController, ProfileWatchedController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileLikedDirective, ProfileVotedDirective, ProfileWatchedDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://tree.taiga.io/support/admin/import-export-projects/\"\n      }, {\n        url: \"https://tree.taiga.io/support/admin/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: blocked-project-explanation.directive.coffee\n */\n\n(function() {\n  var BlockedProjectExplanationDirective;\n\n  BlockedProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/project/blocked-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgBlockedProjectExplanation\", BlockedProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var drake, itemEl, scroll;\n      itemEl = null;\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).hasClass('list-itemtype-project');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = $(item);\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n    function ProjectsListingController(currentUserService, projectsService) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    ProjectsListingController.prototype.newProject = function() {\n      return this.projectsService.newProject();\n    };\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      var projectSlug;\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      projectSlug = this.routeParams.pslug;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function(project) {\n      var ctx, metas;\n      if (!this.project) {\n        return null;\n      }\n      metas = {};\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      metas.title = this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx);\n      metas.description = this.project.get(\"description\");\n      return metas;\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\", \"tgLightboxFactory\"];\n\n    function ProjectsService(rs, projectUrl, lightboxFactory) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var colorized_tags, tags, url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      colorized_tags = [];\n      if (project.get(\"tags\")) {\n        tags = project.get(\"tags\").sort();\n        colorized_tags = tags.map(function(tag) {\n          var color;\n          color = project.get(\"tags_colors\").get(tag);\n          return Immutable.fromJS({\n            name: tag,\n            color: color\n          });\n        });\n        project = project.set(\"colorized_tags\", colorized_tags);\n      }\n      return project;\n    };\n\n    ProjectsService.prototype.newProject = function() {\n      return this.lightboxFactory.create(\"tg-lb-create-project\", {\n        \"class\": \"wizard-create-project lightbox\"\n      });\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    ProjectsService.prototype.transferValidateToken = function(projectId, token) {\n      return this.rs.projects.transferValidateToken(projectId, token);\n    };\n\n    ProjectsService.prototype.transferAccept = function(projectId, token, reason) {\n      return this.rs.projects.transferAccept(projectId, token, reason);\n    };\n\n    ProjectsService.prototype.transferReject = function(projectId, token, reason) {\n      return this.rs.projects.transferReject(projectId, token, reason);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: cant-own-project-explanation.directive.coffee\n */\n\n(function() {\n  var CantOwnProjectExplanationDirective;\n\n  CantOwnProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/transfer/cant-own-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgCantOwnProjectExplanation\", CantOwnProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProject, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProject = (function() {\n    TransferProject.$inject = [\"$routeParams\", \"tgProjectsService\", \"$location\", \"$tgAuth\", \"tgCurrentUserService\", \"$tgNavUrls\", \"$translate\", \"$tgConfirm\"];\n\n    function TransferProject(routeParams, projectService, location, authService, currentUserService, navUrls, translate, confirmService) {\n      this.routeParams = routeParams;\n      this.projectService = projectService;\n      this.location = location;\n      this.authService = authService;\n      this.currentUserService = currentUserService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.confirmService = confirmService;\n    }\n\n    TransferProject.prototype.initialize = function() {\n      this.projectId = this.project.get(\"id\");\n      this.token = this.routeParams.token;\n      this.showAddComment = false;\n      return this._refreshUserData();\n    };\n\n    TransferProject.prototype._validateToken = function() {\n      return this.projectService.transferValidateToken(this.projectId, this.token).then(null, (function(_this) {\n        return function(data, status) {\n          return _this.location.path(_this.navUrls.resolve(\"not-found\"));\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._refreshUserData = function() {\n      return this.authService.refresh().then((function(_this) {\n        return function() {\n          _this._validateToken();\n          _this._setProjectData();\n          return _this._checkOwnerData();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._setProjectData = function() {\n      return this.canBeOwnedByUser = this.currentUserService.canOwnProject(this.project);\n    };\n\n    TransferProject.prototype._checkOwnerData = function() {\n      var currentUser, maxMemberships;\n      currentUser = this.currentUserService.getUser();\n      if (this.project.get('is_private')) {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE';\n        this.maxProjects = currentUser.get('max_private_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_private_projects');\n        maxMemberships = currentUser.get('max_memberships_private_projects');\n      } else {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC';\n        this.maxProjects = currentUser.get('max_public_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_public_projects');\n        maxMemberships = currentUser.get('max_memberships_public_projects');\n      }\n      return this.validNumberOfMemberships = maxMemberships === null || this.project.get('total_memberships') <= maxMemberships;\n    };\n\n    TransferProject.prototype.transferAccept = function(token, reason) {\n      this.loadingAccept = true;\n      return this.projectService.transferAccept(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"project-admin-project-profile-details\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingAccept = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.transferReject = function(token, reason) {\n      this.loadingReject = true;\n      return this.projectService.transferReject(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"home\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingReject = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.addComment = function() {\n      return this.showAddComment = true;\n    };\n\n    TransferProject.prototype.hideComment = function() {\n      this.showAddComment = false;\n      return this.reason = '';\n    };\n\n    return TransferProject;\n\n  })();\n\n  module.controller(\"TransferProjectController\", TransferProject);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProjectDirective, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProjectDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initialize();\n    };\n    return {\n      link: link,\n      scope: {},\n      bindToController: {\n        project: \"=\"\n      },\n      templateUrl: \"projects/transfer/transfer-project.html\",\n      controller: 'TransferProjectController',\n      controllerAs: 'vm'\n    };\n  };\n\n  module.directive('tgTransferProject', TransferProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  Resource = function(urlsService, http, config, $rootScope, $q, storage) {\n    var service;\n    service = {};\n    service.list = function(type, objectId, projectId) {\n      var httpOptions, params, url, urlname;\n      urlname = \"attachments/\" + type;\n      params = {\n        object_id: objectId,\n        project: projectId\n      };\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      url = urlsService.resolve(urlname);\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service[\"delete\"] = function(type, id) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http[\"delete\"](url);\n    };\n    service.patch = function(type, id, patch) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http.patch(url, patch);\n    };\n    service.create = function(type, projectId, objectId, file) {\n      var data, defered, maxFileSize, response, token, uploadComplete, uploadFailed, uploadProgress, url, urlname, xhr;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname);\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var attachment, error, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              attachment = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              attachment = {};\n            }\n            if (status >= 200 && status < 400) {\n              attachment = Immutable.fromJS(attachment);\n              return defered.resolve(attachment);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      token = storage.get('token');\n      xhr.open(\"POST\", url);\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function() {\n      return {\n        \"attachments\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"$tgConfig\", \"$rootScope\", \"$q\", \"$tgStorage\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgAttachmentsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      if (pagination == null) {\n        pagination = true;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-lazy-pagination\": true\n          }\n        };\n      }\n      return http.get(url, params, httpOptions);\n    };\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    service.transferValidateToken = function(projectId, token) {\n      var data, url;\n      data = {\n        token: token\n      };\n      url = urlsService.resolve(\"project-transfer-validate-token\", projectId);\n      return http.post(url, data);\n    };\n    service.transferAccept = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-accept\", projectId);\n      return http.post(url, data);\n    };\n    service.transferReject = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-reject\", projectId);\n      return http.post(url, data);\n    };\n    service.transferRequest = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-transfer-request\", projectId);\n      return http.post(url);\n    };\n    service.transferStart = function(projectId, userId, reason) {\n      var data, url;\n      data = {\n        user: userId,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-start\", projectId);\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\", \"tgAttachmentsResource\", \"tgStatsResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warm(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: stats-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.discover = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"stats-discover\");\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"stats\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgStatsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"head title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"head meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"head meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"head meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments.service.coffee\n */\n\n(function() {\n  var AttachmentsService, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsService = (function() {\n    AttachmentsService.$inject = [\"$tgConfirm\", \"$tgConfig\", \"$translate\", \"tgResources\"];\n\n    function AttachmentsService(confirm, config, translate, rs) {\n      this.confirm = confirm;\n      this.config = config;\n      this.translate = translate;\n      this.rs = rs;\n      this.maxFileSize = this.getMaxFileSize();\n      if (this.maxFileSize) {\n        this.maxFileSizeFormated = sizeFormat(this.maxFileSize);\n      }\n    }\n\n    AttachmentsService.prototype.sizeError = function(file) {\n      var message;\n      message = this.translate.instant(\"ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED\", {\n        fileName: file.name,\n        fileSize: sizeFormat(file.size),\n        maxFileSize: this.maxFileSizeFormated\n      });\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.validate = function(file) {\n      if (this.maxFileSize && file.size > this.maxFileSize) {\n        this.sizeError(file);\n        return false;\n      }\n      return true;\n    };\n\n    AttachmentsService.prototype.getMaxFileSize = function() {\n      return this.config.get(\"maxUploadFileSize\", null);\n    };\n\n    AttachmentsService.prototype.list = function(type, objId, projectId) {\n      return this.rs.attachments.list(type, objId, projectId).then((function(_this) {\n        return function(attachments) {\n          return attachments.sortBy(function(attachment) {\n            return attachment.get('order');\n          });\n        };\n      })(this));\n    };\n\n    AttachmentsService.prototype[\"delete\"] = function(type, id) {\n      return this.rs.attachments[\"delete\"](type, id);\n    };\n\n    AttachmentsService.prototype.saveError = function(file, data) {\n      var message;\n      message = \"\";\n      if (file) {\n        message = this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n          fileName: file.name,\n          errorMessage: data.data._error_message\n        });\n      }\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.upload = function(file, objId, projectId, type) {\n      var promise;\n      promise = this.rs.attachments.create(type, projectId, objId, file);\n      promise.then(null, this.saveError.bind(this, file));\n      return promise;\n    };\n\n    AttachmentsService.prototype.patch = function(id, type, patch) {\n      var promise;\n      promise = this.rs.attachments.patch(type, id, patch);\n      promise.then(null, this.saveError.bind(this, null));\n      return promise;\n    };\n\n    return AttachmentsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAttachmentsService\", AttachmentsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var ChekcPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  ChekcPermissionsService = (function() {\n    ChekcPermissionsService.$inject = [\"tgProjectService\"];\n\n    function ChekcPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    ChekcPermissionsService.prototype.check = function(permission) {\n      if (!this.projectService.project) {\n        return false;\n      }\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return ChekcPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", ChekcPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    CurrentUserService.prototype.canCreatePrivateProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_private_projects') !== null && user.get('total_private_projects') >= user.get('max_private_projects')) {\n        return {\n          valid: false,\n          reason: 'max_private_projects',\n          type: 'private_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canCreatePublicProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_public_projects') !== null && user.get('total_public_projects') >= user.get('max_public_projects')) {\n        return {\n          valid: false,\n          reason: 'max_public_projects',\n          type: 'public_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canOwnProject = function(project) {\n      var result, user;\n      user = this.getUser();\n      if (project.get('is_private')) {\n        result = this.canCreatePrivateProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_private_projects') !== null && project.get('total_memberships') > user.get('max_memberships_private_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_private_projects',\n            type: 'private_project'\n          };\n        }\n      } else {\n        result = this.canCreatePublicProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_public_projects') !== null && project.get('total_memberships') > user.get('max_memberships_public_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_public_projects',\n            type: 'public_project'\n          };\n        }\n      }\n      return {\n        valid: true\n      };\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs, scopeAttrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      scope = _.merge(scope, scopeAttrs);\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo.service.coffee\n */\n\n(function() {\n  var ProjectLogoService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  ProjectLogoService = (function() {\n    function ProjectLogoService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/project-logos/project-logo-01.png\", \"/\" + window._version + \"/images/project-logos/project-logo-02.png\", \"/\" + window._version + \"/images/project-logos/project-logo-03.png\", \"/\" + window._version + \"/images/project-logos/project-logo-04.png\", \"/\" + window._version + \"/images/project-logos/project-logo-05.png\"];\n      COLORS = [\"rgba( 153,  214, 220, 1 )\", \"rgba( 213,  156,  156, 1 )\", \"rgba( 214, 161, 212,  1 )\", \"rgba( 164, 162, 219, 1 )\", \"rgba( 152, 224, 168,  1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    ProjectLogoService.prototype.getDefaultProjectLogo = function(slug, id) {\n      var idx, key, logo;\n      key = slug + \"-\" + id;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    return ProjectLogoService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectLogoService\", ProjectLogoService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\"];\n\n    function ProjectService(projectsService, xhrError) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n    }\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.hasPermission = function(permission) {\n      return this._project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId) {\n      return this.rs.users.getContacts(userId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"$location\", \"$tgNavUrls\"];\n\n    function xhrError(q, location, navUrls) {\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n    }\n\n    xhrError.prototype.notFound = function() {\n      this.location.path(this.navUrls.resolve(\"not-found\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      this.location.path(this.navUrls.resolve(\"permission-denied\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      var span;\n      title = title || text;\n      span = $('<span>').attr('ng-non-bindable', true).text(text);\n      return $('<a>').attr('tg-nav', url).attr('title', title).append(span).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            text = timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1);\n            return $($.parseHTML(text)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              if (event.obj === 'userstory') {\n                values_diff = Immutable.Map({\n                  'moveInBacklog': values_diff\n                });\n              } else {\n                values_diff = values_diff.deleteIn(['values_diff', 'milestone']);\n              }\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"]}