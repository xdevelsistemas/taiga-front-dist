{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","blockingIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","call","templateUrl","controller","controllerAs","loader","title","description","joyride","reloadOnSearch","access","requiresLogin","section","redirectTo","params","pslug","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","httpResponseError","response","nextUrl","status","config","cancelable","closeAll","replace","url","indexOf","encodeURIComponent","search","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","$routeParams","redirectToBlockedPage","responseOk","blockedUrl","currentUrl","project","blocked_code","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","ljs","load","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","linewidth","pikaday","checksley","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","projectService","navigationBarService","un","user","validators","debug","$on","refresh","val","width","lines","valid","nl2br","split","every","line","length","prettyDate","isValid","updateValidators","contribPlugins","adminPlugins","filter","userSettingsPlugins","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","next","start","setSection","setProjectBySlug","cleanProject","setAll","addMobileViewport","removeMobileViewport","enableHeader","plugin","value","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","location","navUrls","q","Base","Service","Controller","addClass","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","groupBy","isImage","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","el","className","classList","add","str","breakTag","object","dependencies","methods","keys","forIn","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","ref","char","toLowerCase","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isFunction","isObject","removeKeys","chain","flatten","reduce","cartesianProduct","reduceRight","a","b","y","match","oldImmutable","newImmutable","pathObj","forEach","newValue","toJS","FiltersMixin","PageMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","members","uniq","includes","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","existing","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","LoginPage","PublicRegisterMessageDirective","RegisterDirective","currentUserService","$inject","rootscope","storage","model","http","urls","translate","currentUserService1","themeService","userModel","_currentTheme","_getUserTheme","setUserdata","userData","Immutable","fromJS","getAttrs","setUser","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","set","clear","remove","setToken","token","getToken","removeToken","auth_token","login","clone","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","acceptInvitiationWithExistingUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","templates","template","templateFn","publicRegisterEnabled","restrict","directive","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","find","decodeURIComponent","onKeyUp","target","currentTarget","iscapsLockActivated","loginFormType","preventDefault","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","trackEvent","_error_message","error","setErrors","message","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","$window","onresize","$broadcast","home","not-found","permission-denied","discover","discover-search","forgot-password","change-password","change-email","cancel-account","create-project","profile","user-profile","blocked-project","project-backlog","project-taskboard","project-kanban","project-issues","project-search","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","user-settings-contrib","$navurls","update","AnimationFrame","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","LightboxClose","ProjectUrl","Qqueue","QueueModelTransformation","SelectedText","Svg","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","removeClass","unObserve","unwatch","tgCheckPermission","$observe","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","negation","my_permissions","classes","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","lastPromise","qqueue","bindAdd","args","qqueue1","repo","model1","setObject","prop","attrs","cloneDeep","_attrs","_name","getObj","save","transformation","defered","comment","$templateCache","lodash","tmp","svgIcon","svgTitle","svgTitleTranslate","svgTitleTranslateValues","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","trimStart","host","ws","addEventListener","onOpen","onMessage","onClose","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","show","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","setInterval","error1","Error","sendMessage","cmd","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","create","feedback","finish","open","focus","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","task","subject","html","keyCode","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","assigned_to","createTask","reset","default_task_status","openNewRelatedTask","us","$rs","_isEditable","_isVisible","loadTasks","tasks","list","usId","showRelatedTasks","$ctrl","autoSave","notAutoSave","updateRelatedTask","member","imgurl","photo","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-contacts","user-me","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","project-transfer-validate-token","project-transfer-accept","project-transfer-reject","project-transfer-request","project-transfer-start","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","milestones","userstories","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-sprint-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/us","history/issue","history/task","history/wiki","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/userstory","custom-attributes/issue","custom-attributes/task","custom-attributes-values/userstory","custom-attributes-values/issue","custom-attributes-values/task","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","stats-discover","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","scope1","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadFilters","loadProject","getBySlug","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","$route","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","$destroy","$new","parseHTML","activeSection","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","trackPage","s","o","g","r","m","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","page","category","action","label","BindScope","jQuery","CompileHtmlDirective","tgCompileHtml","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableDescriptionDirective","EditableSubjectDirective","EditableWysiwyg","ListItemAssignedtoDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","WatchersDirective","renderRange","first","second","endDate","initDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","onSelect","picker","setDate","Pikaday","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner","owner_extra_info","created_date","$modelTransform","deleteWatcher","isEditable","renderWatchers","ref1","requiredPerm","watchers","transform","watcherId","watcherIds","revert","pull","$currentUserService","renderAssignedTo","assignedObject","fullName","isIocaine","isUnassigned","assigned_to_extra_info","is_iocaine","fullNameVisible","ask","instance","is_blocked","onDeleteGoToUrl","onDeleteTitle","subtitle","hide","click","$selectedText","noDescriptionMegEditMode","noDescriptionMegReadMode","cancelEdition","is","href","$","scrollTop","offset","top","$applyAsync","noDescriptionMsg","attachmentsService","attachmentsFullService","isInEditMode","uploadFile","file","addAttachment","getIn","textarea","dataTransfer","promises","stopPropagation","originalEvent","files","markItUp","replaceWith","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","issue","tgListitemIssueStatus","issueTypeById","domNode","color","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgProgressBar","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxService","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","append","selected","icon","detailImage","svgContainer","useSVG","createElementNS","setAttributeNS","appendChild","prepend","stop","percent","body","selector","tsem","one","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","TEXT_TYPE","TYPE_CHOICES","URL_TYPE","confirm","objectId","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$templates","$storage","collapsedHash","$ctrls","collapsed","hash","requiredEditionPerm","setFocusAndSelectOnInputField","edit","editable","tgCustomAttributeValue","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","$setViewValue","mainTemplate","calculateTotalPoints","calculateRoles","$watchCollection","$qqueue","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","height","clientHeight","defaultFilter","momentFormat","momentFromNow","yesNoFilter","defaultValue","without_suffix","fromNow","HistoryController","HistoryDirective","IGNORED_FIELDS","userstories.userstory","tasks.task","issues.issue","loadHistory","history","changeModel","historyEntry","historyResult","j","len1","values_diff","description_diff","description_html","blocked_note_diff","blocked_note","blocked_note_html","comments","deleteComment","activityId","undeleteComment","checkPermissionsService","templateActivity","templateBase","templateBaseEntries","templateChangeAttachment","templateChangeDiff","templateChangeGeneric","templateChangeList","templateChangePoints","templateDeletedComment","countChanges","formatChange","getHumanizedFieldName","getPrettyDateFormat","renderActivity","renderAttachmentEntry","renderBase","renderChange","renderChangeEntries","renderChangeEntry","renderChangesHelperText","renderComment","renderComments","renderCustomAttributesEntry","renderHistory","rerender","showAllActivity","showAllComments","humanizedFieldNames","content","is_closed","finish_date","milestone","user_story","client_requirement","team_requirement","attachments","is_deprecated","order","backlog_order","sprint_order","kanban_order","taskboard_order","us_order","change","isArray","changes","diff","filename","from","to","outerHTML","customAttrsChanges","added","removed","difference","ref2","delete_comment_date","delete_comment_user","deleteCommentDate","deleteCommentUser","comment_html","canRestoreComment","pk","avatar","userFullName","userProfileUrl","creationDate","created_at","changesText","mode","deleteCommentActionTitle","canDeleteComment","entries","totalEntries","showMore","commentsVisible","historyVisible","check","ngmodel","totalComments","takeRight","totalChanges","parents","toggleClass","ImportProjectButtonDirective","LbImportErrorDirective","$lightboxFactory","$tgAuth","getRestrictionError","errorKey","maxMemberships","membersError","privateError","publicError","isPrivate","canCreatePrivateProjects","canCreatePublicProjects","max_memberships","trigger","loadProjects","errorMsg","restrictionError","class","error_message","AssignedToLightboxDirective","AttachmentPreviewLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxLeaveProjectWarningDirective","LightboxService","WatchersLightboxDirective","docEl","lightboxContent","not","firstField","activeElement","blur","code","which","removeAttr","lightboxEl","dispatch","prev","$tgrepo","block","unblock","finishCallback","watch","attachmentsToAdd","attachmentsToDelete","createAttachments","deleteAttachments","resetAttachments","createEditUs","isNew","List","attachment","deleteAttachment","statusList","usStatusList","is_archived","upload","broadcastEvent","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","string","normalizedString","toUpperCase","partial","assignedToId","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","spinner","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","statuses","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","left","fadeOut","fadeIn","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsDirective","LbTagLineDirective","TagLineDirective","TagsDirective","formatter","parser","$formatters","$parsers","backlog","kanban","taskboard","srcTags","tgColorizeTagsType","sort","tag","tags_colors","tgColorizeTags","COMMA_KEY","ENTER_KEY","autocomplete","templateTags","addValue","deleteValue","hideSaveButton","renderTags","resetInput","saveInputTag","showSaveButton","tagsColors","style","fromCharCode","Awesomplete","ESC_KEY","hideAddTagButton","hideAddTagButtonText","hideInput","renderInReadModeOnly","showAddTagButton","showAddTagButtonText","showInput","MarkitupDirective","previewTemplate","addLine","cancelablePromise","closePreviewMode","markdownTitle","prepareUrlFormatting","preview","previewDomNode","previewInProgress","renderMarkItUp","setCaretPosition","urlFormatting","markItUpDomNode","markdownDomNode","mdrender","markdown","caretPosition","scrollRelation","totalLines","createTextRange","move","selectionStart","setSelectionRange","scrollHeight","nline","cursorPosition","indices","regex","exec","index","donotparse","endIndex","startIndex","heading","n","placeHolder","markdownSettings","nameSpace","onShiftEnter","keepDefault","openWith","onEnter","afterInsert","cursorLine","emptyListItem","lastLine","markdownCaretPositon","newLineContent","markupSet","closeWith","separator","beforeInsert","markItUpRemove","textcomplete","cache","searchProps","searchTypes","res","count","BacklogFiltersDirective","templateSelected","currentFiltersType","getFiltersType","initializeSelectedFilters","reloadUserstories","renderFilters","renderSelectedFilters","selectQFilter","selectedFilters","showCategories","showFilters","toggleFilterSelection","f","loadUserstories","generateFilters","currentFilters","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","estimated_start","estimated_finish","newSprint","copy","setAttr","sprintsCounter","__all__","milestonesCounter","openSprints","sortedSprints","sprints","closed","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","analytics","rs2","modelTransform","disablePagination","firstLoadComplete","showTags","activeFilters","showGraphPlaceholder","initializeEventHandlers","getShowTags","loadProjectStats","loadSprints","loadClosedSprints","findIndex","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","loadAllPaginatedUserstories","toggleShowTags","storeShowTags","toggleActiveFilters","stats","defined_points","completedPercentage","total_milestones","closedSprints","totalClosedMilestones","user_stories","closedSprintsById","totalMilestones","totalOpenMilestones","reverse","sprintsById","currentSprint","findCurrentSprint","restoreFilters","selectedStatuses","selectedTags","oldSelectedTags","oldSelectedStatuses","filtersQ","filtersQOld","filterGrp","resetFilters","resetPagination","pageSize","loadingUserstories","httpParams","getUrlFilters","storeQueryParams","listUnassigned","header","setSearchDataFilters","loadBacklog","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","resortUserStories","items","isModified","usList","newUsIndex","newSprintId","len2","len3","movedFromClosedSprint","movedToClosedSprint","oldSprintId","splice","Array","bulkUpdateBacklogOrder","bulkUpdateSprintOrder","console","len4","isFilterSelected","searchdata","urlfilters","results1","pick","filtersData","choicesFiltersFormat","tagsFilterFormat","byIdObject","markSelectedFilters","isSelected","omit","updateUserStoryStatus","editUserStory","$event","getByRef","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","currentDate","end","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","current_sum","domElement","assigned_points","before","rowElements","checkSelected","getUsToMove","lastChecked","moveToCurrentSprint","moveToLatestSprint","moveUssToSprint","shiftPressed","ussDom","itemScope","selectedUss","extraPoints","totalExtraPoints","ussCurrent","union","saveAll","moveToSprintDom","selectedUsDom","shiftKey","current","elements","nextAll","prevAll","nextUntil","prevUntil","elm","ussToMove","hideText","showText","sidebar","filtersSearch","numberOfRoles","roleName","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","options","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogSortableDirective","deleteElement","$tgConfirm","drake","filterError","initIsBacklog","scroll","dragula","copySortSource","isContainer","contains","moves","container","isChecked","dragMultiple","dragMultipleItems","firstElement","isBacklog","sameContainer","itemUs","autoScroll","margin","pixels","scrollWhenOutside","down","dragging","destroy","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","assign","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","last","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","sprintId","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","TaskboardTaskDirective","TaskboardUserDirective","rs1","_setMeta","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","loadTaskboard","taskMove","refreshTagsColors","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","completed_points","completed_tasks","usTasks","isPlaceholder","sslug","refreshTasksOrder","resortTasks","bulkUpdateTaskTaskboardOrder","task_id","addNewTask","editTaskAssignedTo","tableBodyDom","tableHeaderDom","scrollLeft","$rs2","editingTask","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","clickable","username_label","TaskboardSortableDirective","xx","containers","itemEl","newParentScope","oldParentScope","tdom","mirrorContainer","itemIndex","itemTask","newStatusId","newUsId","oldStatusId","oldUsId","parentEl","st","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanUserDirective","KanbanUserstoryDirective","KanbanWipLimitDirective","defaultViewMode","viewModes","statusViewModes","onAssignedToChanged","loadUserStoriesForStatus","hideUserStoriesForStatus","changeUsAssignedTo","userid","status__is_archived","listAll","usByStatus","us_archived","loadKanban","generateStatusViewModes","storedStatusViewModes","getStatusViewModes","storeStatusViewModes","updateStatusViewMode","newViewMode","isMaximized","isMinimized","itemsToSave","bulkUpdateKanbanOrder","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","isArchived","userStoriesLoaded","editingUserStory","getTemplateUrl","updateTableWidth","folds","redrawWipLimit","tgKanbanWipLimit","wip_limit","wtid","tgKanbanUserAvatar","KanbanSortableDirective","IssueDetailController","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","initializeOnDeleteGoToUrl","ref3","issueSubject","issueStatus","statusById","issueType","typeById","issueSeverity","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","priorityList","issueId","commentModel","neighbors","previous","previousUrl","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","typees","severityes","priorityes","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","default_issue_status","default_issue_type","default_priority","default_severity","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssuesController","IssuesDirective","IssuesFiltersDirective","loadIssues","getFilters","storeFilters","issueStatusList","issueTypes","getUrlFilter","loadMyFilters","getMyFilters","removeNotExistingFiltersFromUrl","currentSearch","existingValues","filterName","filterValue","splittedValues","intersection","myFilters","types","assignedTo","createdBy","usersFiltersFormat","unknownOption","reformatedUsers","unknownItem","full_name","u","owners","loadIssuesRequests","urlFilters","models","paginatedBy","saveCurrentFiltersTo","newFilter","storeMyFilters","deleteMyFilter","addNewIssue","addIssuesInBulk","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","finalOrder","newOrder","reloadIssues","unwatchIssues","filterId","customFilterName","loadPromise","currentfilterstype","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","usRef","usref","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","allClosed","loadUs","kanbanStaus","noMilestone","order_by","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","taskId","loadUserStory","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","userRoles","lightboxFactory","leaveConfirm","confirm_leave_project_text","leave_project_text","leave","isCurrentUser","EditableWikiContentDirective","WikiDetailController","WikiSummaryDirective","projectSlug","wikiSlug","wikiTitle","linksVisible","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","loadWiki","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","checkLinksPerms","last_modifier","imgUrl","wikiPage","disableEdition","getSelectedText","switchToEditMode","switchToReadMode","button","WikiNavDirective","addWikiLinkPermission","deleteWikiLinkPermission","linkId","newLink","ChangeOwnerLightboxController","ChangeOwnerLightboxDirective","LbRequestOwnershipDirective","LightboxAddMembersController","LightboxAddMembersDirective","LightboxAddMembersWarningMessageDirective","TransferProjectStartSuccessDirective","lightboxService1","pendingMembersCount","_defaultMaxInvites","_defaultRole","submitInvites","canAddUsers","memberInvites","membersLimit","total_memberships","addSingleMember","role_id","showWarningMessage","removeSingleMember","initializeFields","invites","bulkCreateMemberships","invitationText","_onSuccessInvite","_onErrorInvite","ctrl","bindToController","confirmService","transferRequest","commentOpen","limit","getUsers","currentOwnerId","userSearch","selectUser","transferStart","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","NoMoreMembershipsExplanationDirective","lightboxFactory1","i_am_admin","httpFilters","membership","is_user_active","addNewMembers","showLimitUsersWarningMessage","pending","user_email","isOwner","is_owner","tgMembershipsRowAvatar","tgMembershipsRowAdminCheckbox","inputId","is_admin","roleList","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","AdminNavigationDirective","tgAdminNavigation","AdminProjectChangeOwnerDirective","AdminProjectRequestOwnershipDirective","AdminProjectRestrictionsDirective","CsvExporterController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectLogoDirective","ProjectLogoModelDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","tgAuth","prioritiesList","severitiesList","issueTypesList","openDeleteLightbox","newUrl","fetchProject","newVal","oldVal","videoconferences_extra_data","videoconferences","isVideoconferenceActivated","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","uuid","regenerateUuid","sectionTitle","showSizeInfo","logoAttachment","changeLogo","removeLogo","$parse","modelSetter","tgProjectLogoModel","requestOwnership","changeOwner","project-id","active-users","current-owner-id","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","maxBy","itemValue","linkDragAndDrop","linkValue","direction","cancel","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","newIndex","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","is_private","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","toPairs","request_headers","arg","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","createProjectRestrictionDirective","CreateProject","DeleteProjectDirective","$projectUrl","$cacheFactory","removeAll","error_field","selectors","creation_template","head","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","has","ContribController","ContribUserSettingsController","currentPlugin","FiltersStorageService","HttpService","cacheFactory","locationFactory","lastRoute","Model","ModelService","dataTypes","_dataTypes","setAttrs","_modifiedAttrs","_isModified","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","getter","self","setter","substr","enumerable","configurable","isAttributeModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNavGetParams","tgNav","fullUrl","getURLParams","getURLParamsStr","metaKey","ctrlKey","RepositoryService","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","wikipage","StorageService","_default","serializedValue","getItem","setItem","removeItem","UrlsService","fmt","mainUrl","trimEnd","resourceProvider","_get","userstory","_list","filtersHashSuffix","hashSuffix","myFiltersHashSuffix","getQueryParams","listInAllProjects","project_id","bulk_issues","ns","innerPromise","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","listByUser","invitation_extra_text","bulk_memberships","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_userstories_csv_uuid","regenerate_issues_csv_uuid","regenerate_tasks_csv_uuid","statusUpdater","complete","failed","maxFileSize","uploadComplete","uploadFailed","uploadProgress","fileName","fileSize","evt","loaded","uploadedSize","totalSize","responseText","getResponseHeader","FormData","XMLHttpRequest","setRequestHeader","transformRequest","identity","deferredAbort","get_all","noop","hashSuffixUsRowModes","userStoryId","sprint_id","bulk_tasks","changeAvatar","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","page_size","status_id","bulk_stories","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","maxFileSizeMsg","availableThemes","avatarAttachment","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","AttachmentLinkDirective","tgAttachmentLink","AttachmentGalleryDirective","onDelete","AttachmentController","editMode","mergeIn","AttachmentDirective","AttachmentsDropDirective","eventAttr","tgAttachmentsDrop","AttachmentsFullController","deprecatedsCount","attachmentsVisible","deprecatedsVisible","uploadingAttachments","objId","setMode","toggleDeprecatedsVisible","addAttachments","loadAttachments","toDeleteAttachment","errorMessage","reorderAttachment","updateAttachment","toUpdateAttachment","hasPermission","editPermission","showAttachments","AttachmentsFullDirective","AttachmentsFullService","_attachments","_deprecatedsCount","_attachmentsVisible","_deprecatedsVisible","regenerate","it","uploading","Map","oldIndex","setIn","oldAttachment","AttachmentsSimpleController","onAdd","AttachmentsSimpleDirective","AttachmentSortableDirective","tgAttachmentsSortable","AutoSelectDirective","$timeout","FileChangeDirective","tgFileChange","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","getConfig","dashboard","steps","position","joyRide","joyRides","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectLogoBigSrcDirective","projectLogoService","logo","projectLogo","getDefaultProjectLogo","ProjectLogoSmallSrcDirective","ProjectMenuController","menu","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","vm","fixed","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","WatchButtonController","openWatchers","getPerms","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","attributes","environment","DiscoverHomeOrderByController","is_open","week","month","year","currentText","currentOrderBy","orderBy","onChange","DiscoverHomeOrderByDirective","DiscoverSearchBarController","discoverProjectsService","projectsCount","fetchStats","submitFilter","DiscoverSearchBarDirective","DiscoverSearchListHeaderController","like_is_open","activity_is_open","openLike","setOrderBy","openActivity","DiscoverSearchListHeaderDirective","FeaturedProjectsController","featured","fetchFeatured","FeaturedProjectsDirective","HighlightedDirective","highlighted","MostActiveController","mostActive","getOrderBy","fetch","fetchMostActive","MostActiveDirective","MostLikedController","mostLiked","fetchMostLiked","MostLikedDirective","DiscoverHomeController","onSubmit","DiscoverSearchController","routeParams","searchResult","nextSearchPage","loadingGlobal","loadingList","loadingPagination","resetSearchList","fetchByGlobalSearch","fetchByOrderBy","getFilter","fetchSearch","is_looking_for_people","onChangeFilter","updateParams","onChangeOrder","DiscoverSearchDirective","DiscoverProjectsService","projectsService","_mostLiked","_mostActive","_featured","_searchResult","_projectsCount","decorate","_decorate","_nextSearchPage","_discoverParams","discover_mode","_params","getProjects","is_featured","ExternalAppController","externalAppsService","xhrError","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","DutyDirective","navurls","duty","getDutyType","HomeController","HomeService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","_getValidDutiesAndAttachProjectInfo","watching","objType","duties","dutyType","getWorkInProgress","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_us","projectsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","p","status__is_closed","HomeProjectListDirective","newProject","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","DropdownProjectListDirective","DropdownUserDirective","authService","configService","locationService","navUrlsService","isFeedbackEnabled","userMenu","NavigationBarDirective","isEnabledHeader","NavigationBarService","enabledHeader","ProfileBarController","userService","loadStats","getStats","ProfileBarDirective","ProfileContactsController","loadContacts","getContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileLikedController","ProfileVotedController","ProfileWatchedController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","scrollDisabled","_page","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","getLiked","getVoted","getWatched","ProfileLikedDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","transclude","tab","tabIcon","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","notFound","userUsername","BlockedProjectExplanationDirective","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","ProjectsListingController","ProjectController","activeMembers","setfn","metas","ProjectsService","projectUrl","getProjectBySlug","getProjectStats","paginate","colorized_tags","transferValidateToken","transferAccept","reason","transferReject","CantOwnProjectExplanationDirective","TransferProject","showAddComment","_refreshUserData","_validateToken","_setProjectData","_checkOwnerData","canBeOwnedByUser","canOwnProject","ownerMessage","maxProjects","currentProjects","validNumberOfMemberships","loadingAccept","loadingReject","addComment","hideComment","TransferProjectDirective","Resource","urlsService","urlname","object_id","x-disable-pagination","progressMessage","progressPercent","pagination","paginateResponseService","x-lazy-pagination","getTimeline","only_relevant","Resources","services","serviceFn","serviceName","serviceProperty","warm","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","getProfileTimeline","getUserTimeline","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","AttachmentsService","getMaxFileSize","maxFileSizeFormated","sizeError","saveError","ChekcPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","LightboxFactory","compile","scopeAttrs","PaginateResponse","paginateResponse","ProjectLogoService","modulo","COLORS","IMAGES","logos","murmurhash3_32_gc","ProjectService","_project","_section","_sectionsBreadcrumb","_activeMembers","ThemeService","themeName","stylesheetEl","UserService","pageNumber","objectType","textQuery","contactsFiltered","contact","contactId","permissionDenied","UserTimelineAttachmentDirective","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","timeline","title_attr","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","getType","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","invalid","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","blocked","moveInBacklog","deleteIn","_addEntyAttributes","filterNot"],"mappings":"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","file":"app.js","sourcesContent":["\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, blockingIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      controller: \"Home\",\n      controllerAs: \"vm\",\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/discover\", {\n      templateUrl: \"discover/discover-home/discover-home.html\",\n      controller: \"DiscoverHome\",\n      controllerAs: \"vm\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true\n    });\n    $routeProvider.when(\"/discover/search\", {\n      templateUrl: \"discover/discover-search/discover-search.html\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true,\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/blocked-project/:pslug/\", {\n      templateUrl: \"projects/project/blocked-project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/project/:pslug/transfer/:token\", {\n      templateUrl: \"projects/transfer/transfer-page.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/user-settings/contrib/:plugin\", {\n      templateUrl: \"contrib/user-settings.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true,\n      controller: \"LoginPage\"\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      redirectTo: \"/not-found\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          $location.path($navUrls.resolve(\"error\"));\n          $location.replace();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = encodeURIComponent($location.url());\n          $location.url($navUrls.resolve(\"login\")).search(\"next=\" + nextUrl);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    blockingIntercept = function($q, $routeParams, $location, $navUrls) {\n      var redirectToBlockedPage, responseError, responseOk;\n      redirectToBlockedPage = function() {\n        var blockedUrl, currentUrl, pslug;\n        pslug = $routeParams.pslug;\n        blockedUrl = $navUrls.resolve(\"blocked-project\", {\n          project: pslug\n        });\n        currentUrl = $location.url();\n        if (currentUrl.indexOf(blockedUrl) === -1) {\n          return $location.replace().path(blockedUrl);\n        }\n      };\n      responseOk = function(response) {\n        if (response.data.blocked_code) {\n          redirectToBlockedPage();\n        }\n        return response;\n      };\n      responseError = function(response) {\n        if (response.status === 451) {\n          redirectToBlockedPage();\n        }\n        return $q.reject(response);\n      };\n      return {\n        response: responseOk,\n        responseError: responseError\n      };\n    };\n    $provide.factory(\"blockingIntercept\", [\"$q\", \"$routeParams\", \"$location\", \"$tgNavUrls\", blockingIntercept]);\n    $httpProvider.interceptors.push(\"blockingIntercept\");\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    if (lang !== 'en') {\n      ljs.load((\"/\" + window._version + \"/locales/moment-locales/\") + lang + \".js\");\n    }\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\"),\n      linewidth: $translate.instant(\"COMMON.FORM_ERRORS.LINEWIDTH\"),\n      pikaday: $translate.instant(\"COMMON.FORM_ERRORS.PIKADAY\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, projectService, loaderService, navigationBarService) {\n    var un, user, validators;\n    $log.debug(\"Initialize application\");\n    $rootscope.$on('$translatePartialLoaderStructureChanged', function() {\n      return $translate.refresh();\n    });\n    validators = {\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      },\n      pikaday: function(val) {\n        var prettyDate;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        return moment(val, prettyDate).isValid();\n      }\n    };\n    checksley.updateValidators(validators);\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.userSettingsPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"userSettings\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      projectService.setSection(next.section);\n      if (next.params.pslug) {\n        projectService.setProjectBySlug(next.params.pslug);\n      } else {\n        projectService.cleanProject();\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"taigaDiscover\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\"].concat(_.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  }));\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgProjectService\", \"tgLoader\", \"tgNavigationBarService\", \"$route\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.location.path(this.navUrls.resolve(\"not-found\"));\n          this.location.replace();\n        } else if (xhr.status === 403) {\n          this.location.path(this.navUrls.resolve(\"permission-denied\"));\n          this.location.replace();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var addClass, bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, groupBy, isImage, joinStr, mixOf, nl2br, patch, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  addClass = function(el, className) {\n    if (el.classList) {\n      return el.classList.add(className);\n    } else {\n      return el.className += ' ' + className;\n    }\n  };\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return data.toString().toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, '-and-').replace(/[^\\w\\-]+/g, '').replace(/\\-\\-+/g, '-');\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return coll.join(str);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    },\n    cartesianProduct: function() {\n      return _.reduceRight(arguments, function(a, b) {\n        return _.flatten(_.map(a, function(x) {\n          return _.map(b, function(y) {\n            return [y].concat(x);\n          });\n        }), true);\n      }, [[]]);\n    }\n  });\n\n  isImage = function(name) {\n    return name.match(/\\.(jpe?g|png|gif|gifv|webm)/i) !== null;\n  };\n\n  patch = function(oldImmutable, newImmutable) {\n    var pathObj;\n    pathObj = {};\n    newImmutable.forEach(function(newValue, key) {\n      if (newValue !== oldImmutable.get(key)) {\n        if (newValue.toJS) {\n          return pathObj[key] = newValue.toJS();\n        } else {\n          return pathObj[key] = newValue;\n        }\n      }\n    });\n    return pathObj;\n  };\n\n  taiga = this.taiga;\n\n  taiga.addClass = addClass;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n  taiga.isImage = isImage;\n\n  taiga.patch = patch;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.includes(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, LoginPage, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  LoginPage = (function() {\n    LoginPage.$inject = ['tgCurrentUserService', '$location', '$tgNavUrls', '$routeParams'];\n\n    function LoginPage(currentUserService, $location, $navUrls, $routeParams) {\n      var url;\n      if (currentUserService.isAuthenticated()) {\n        url = $navUrls.resolve(\"home\");\n        if ($routeParams['next']) {\n          url = $routeParams['next'];\n          $location.search('next', null);\n        }\n        $location.path(url);\n      }\n    }\n\n    return LoginPage;\n\n  })();\n\n  module.controller('LoginPage', LoginPage);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config, translate, currentUserService1, themeService) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config;\n      this.translate = translate;\n      this.currentUserService = currentUserService1;\n      this.themeService = themeService;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        return this.currentUserService.setUser(this.userData);\n      } else {\n        return this.userData = null;\n      }\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.refresh = function() {\n      var url;\n      url = this.urls.resolve(\"user-me\");\n      return this.http.get(url).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = data.data;\n          user.token = _this.getUser().auth_token;\n          user = _this.model.make_model(\"users\", user);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      return this._setLocales();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.acceptInvitiationWithExistingUser = function(data) {\n      return this.register(data, \"private\", true);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, $routeParams, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var nextUrl, publicRegisterEnabled, url;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      url = $navUrls.resolve(\"register\");\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"register\")) {\n        nextUrl = encodeURIComponent($routeParams['next']);\n        url += \"?next=\" + nextUrl;\n      }\n      return template({\n        url: url\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$routeParams\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccess = function(response) {\n        $events.setupConnection();\n        return $location.url($scope.nextUrl);\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      $scope.onKeyUp = function(event) {\n        var target, value;\n        target = angular.element(event.currentTarget);\n        value = target.val();\n        $scope.iscapsLockActivated = false;\n        if (value !== value.toLowerCase()) {\n          return $scope.iscapsLockActivated = true;\n        }\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $routeParams, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      $scope.nextUrl = $navUrls.resolve(\"home\");\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        return $location.url($scope.nextUrl);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$routeParams\", \"$tgAnalytics\", \"$translate\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var message, title;\n        $location.path($navUrls.resolve(\"login\"));\n        title = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TITLE\");\n        message = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TEXT\");\n        return $confirm.success(title, message);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $params, $navUrls, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        return $scope.invitation = invitation;\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        return $confirm.notify(\"light-error\", response.data._error_message);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithExistingUser($scope.dataLogin);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              return $location.path($navUrls.resolve(\"home\"));\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"discover\": \"/discover\",\n    \"discover-search\": \"/discover/search\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/create-project\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"blocked-project\": \"/blocked-project/:project\",\n    \"project\": \"/project/:project\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\",\n    \"user-settings-contrib\": \"/user-settings/contrib/:plugin\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, LightboxClose, ProjectUrl, Qqueue, QueueModelTransformation, SelectedText, Svg, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function(projectService) {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project && permission) {\n        if (project.get('my_permissions').indexOf(permission) > -1) {\n          return $el.removeClass('hidden');\n        }\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission, unObserve, unwatch;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      unwatch = $scope.$watch(function() {\n        return projectService.project;\n      }, function() {\n        if (!projectService.project) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unwatch();\n      });\n      unObserve = $attrs.$observe(\"tgCheckPermission\", function(permission) {\n        if (!permission) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unObserve();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CheckPermissionDirective.$inject = [\"tgProjectService\"];\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  QueueModelTransformation = (function(superClass) {\n    extend(QueueModelTransformation, superClass);\n\n    QueueModelTransformation.$inject = [\"$tgQqueue\", \"$tgRepo\", \"$q\", \"$tgModel\"];\n\n    function QueueModelTransformation(qqueue1, repo, q, model1) {\n      this.qqueue = qqueue1;\n      this.repo = repo;\n      this.q = q;\n      this.model = model1;\n    }\n\n    QueueModelTransformation.prototype.setObject = function(scope, prop) {\n      this.scope = scope;\n      this.prop = prop;\n    };\n\n    QueueModelTransformation.prototype.clone = function() {\n      var attrs, model;\n      attrs = _.cloneDeep(this.scope[this.prop]._attrs);\n      model = this.model.make_model(this.scope[this.prop]._name, attrs);\n      return model;\n    };\n\n    QueueModelTransformation.prototype.getObj = function() {\n      return this.scope[this.prop];\n    };\n\n    QueueModelTransformation.prototype.save = function(transformation) {\n      var defered;\n      defered = this.q.defer();\n      this.qqueue.add((function(_this) {\n        return function() {\n          var clone, comment, obj, success;\n          obj = _this.getObj();\n          comment = obj.comment;\n          obj.comment = '';\n          clone = _this.clone();\n          transformation(clone);\n          if (comment.length) {\n            clone.comment = comment;\n          }\n          success = function() {\n            _this.scope[_this.prop] = clone;\n            return defered.resolve.apply(null, arguments);\n          };\n          return _this.repo.save(clone).then(success, defered.reject);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    return QueueModelTransformation;\n\n  })(taiga.Service);\n\n  module.service(\"$tgQueueModelTransformation\", QueueModelTransformation);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function() {\n    var template;\n    template = \"<tg-svg class=\\\"capslock\\\" ng-if=\\\"capslockIcon && iscapsLockActivated\\\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgCapslock\", [Capslock]);\n\n  LightboxClose = function() {\n    var template;\n    template = \"<a class=\\\"close\\\" href=\\\"\\\" title=\\\"{{'COMMON.CLOSE' | translate}}\\\">\\n    <tg-svg svg-icon=\\\"icon-close\\\"></tg-svg>\\n</a>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgLightboxClose\", [LightboxClose]);\n\n  Svg = function() {\n    var template;\n    template = \"<svg class=\\\"{{ 'icon ' + svgIcon }}\\\">\\n    <use xlink:href=\\\"\\\" ng-attr-xlink:href=\\\"{{ '#' + svgIcon }}\\\">\\n        <title ng-if=\\\"svgTitle\\\">{{svgTitle}}</title>\\n        <title\\n            ng-if=\\\"svgTitleTranslate\\\"\\n            translate=\\\"{{svgTitleTranslate}}\\\"\\n            translate-values=\\\"{{svgTitleTranslateValues}}\\\"\\n            ></title>\\n    </use>\\n</svg>\";\n    return {\n      scope: {\n        svgIcon: \"@\",\n        svgTitle: \"@\",\n        svgTitleTranslate: \"@\",\n        svgTitleTranslateValues: \"=\"\n      },\n      template: template\n    };\n  };\n\n  module.directive(\"tgSvg\", [Svg]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.trimStart(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e, error1;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.stopHeartBeatMessages();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.startHeartBeatMessages();\n      this.notifications();\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      return this.error = true;\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      return this.stopHeartBeatMessages();\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        $el.html($compile(templateEdit({\n          task: task\n        }))($scope));\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".save-task\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        $el.off();\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".edit-task\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $analytics) {\n    var link, newTask;\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render, reset;\n      createTask = function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          return $scope.$emit(\"related-tasks:add\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      };\n      close = function() {\n        $el.off();\n        return $scope.openNewRelatedTask = false;\n      };\n      reset = function() {\n        newTask = {\n          subject: \"\",\n          assigned_to: null\n        };\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        return $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n      };\n      render = function() {\n        $scope.openNewRelatedTask = true;\n        return $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              reset();\n              return $el.find('input').focus();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n      };\n      $scope.save = function() {\n        return createTask(newTask).then(function() {\n          return close();\n        });\n      };\n      taiga.bindOnce($scope, \"us\", reset);\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return $scope.$apply(render);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      templateUrl: 'task/related-task-create-form.html'\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$tgAnalytics\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel, $template) {\n    var link, template;\n    template = $template.get(\"common/components/add-button.html\", true);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".add-button\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgTemplate\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var _isEditable, _isVisible, loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, 'ref');\n            return tasks;\n          };\n        })(this));\n      };\n      _isVisible = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"view_tasks\") !== -1;\n        }\n        return false;\n      };\n      _isEditable = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n        }\n        return false;\n      };\n      $scope.showRelatedTasks = function() {\n        var ref;\n        return _isVisible() && (_isEditable() || ((ref = $scope.tasks) != null ? ref.length : void 0));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[task.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $scope.$watch($attrs.tgRelatedTaskAssignedToInlineEdition, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n        return updateRelatedTask(task);\n      });\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"user-me\": \"/users/me\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"project-transfer-validate-token\": \"/projects/%s/transfer_validate_token\",\n    \"project-transfer-accept\": \"/projects/%s/transfer_accept\",\n    \"project-transfer-reject\": \"/projects/%s/transfer_reject\",\n    \"project-transfer-request\": \"/projects/%s/transfer_request\",\n    \"project-transfer-start\": \"/projects/%s/transfer_start\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"milestones\": \"/milestones\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-sprint-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\",\n    \"stats-discover\": \"/stats/discover\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate) {\n      var loadSearchData, promise;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.scope.sectionName = \"Search\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          return _this.fillUsersAndRoles(project.members, project.roles);\n        };\n      })(this));\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\".search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          tabsDom.find(\"li.\" + name).show();\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          return $location.search(\"text\", searchTerm);\n        }\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      return this.initialized = true;\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableDescriptionDirective, EditableSubjectDirective, EditableWysiwyg, ListItemAssignedtoDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0],\n          onSelect: (function(_this) {\n            return function(date) {\n              return selectedDate = date;\n            };\n          })(this),\n          onOpen: (function(_this) {\n            return function() {\n              if (selectedDate != null) {\n                return $el.picker.setDate(selectedDate);\n              }\n            };\n          })(this)\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          return initialize();\n        };\n      })(this));\n      $scope.$watch($attrs.ngModel, function(val) {\n        if ((val != null) && !$el.picker) {\n          initialize();\n        }\n        if (val != null) {\n          return $el.picker.setDate(val);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var ref;\n        if (model != null) {\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\"),\n            photo: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", CreatedByDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $modelTransform, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/watchers.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(watchers) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watchers;\n          return item;\n        });\n        transform.then(function() {\n          watchers = _.map(watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      deleteWatcher = function(watcherIds) {\n        var transform;\n        transform = $modelTransform.save(function(item) {\n          item.watchers = watcherIds;\n          return item;\n        });\n        transform.then(function() {\n          var item, watchers;\n          item = $modelTransform.getObj();\n          watchers = _.map(item.watchers, function(watcherId) {\n            return $scope.usersById[watcherId];\n          });\n          renderWatchers(watchers);\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        return transform.then(null, function() {\n          item.revert();\n          return $confirm.notify(\"error\");\n        });\n      };\n      renderWatchers = function(watchers) {\n        var ctx, html;\n        ctx = {\n          watchers: watchers,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $modelTransform, $template, $translate, $compile, $currentUserService) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = function(userId) {\n        var currentLoading, item, transform;\n        item = $model.$modelValue.clone();\n        item.assigned_to = userId;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(item) {\n          item.assigned_to = userId;\n          return item;\n        });\n        transform.then(function() {\n          currentLoading.finish();\n          renderAssignedTo($modelTransform.getObj());\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        });\n        return transform;\n      };\n      renderAssignedTo = function(assignedObject) {\n        var ctx, fullName, html, isIocaine, isUnassigned, photo;\n        if ((assignedObject != null ? assignedObject.assigned_to : void 0) != null) {\n          fullName = assignedObject.assigned_to_extra_info.full_name_display;\n          photo = assignedObject.assigned_to_extra_info.photo;\n          isUnassigned = false;\n        } else {\n          fullName = $translate.instant(\"COMMON.ASSIGNED_TO.ASSIGN\");\n          photo = \"/\" + window._version + \"/images/unnamed.png\";\n          isUnassigned = true;\n        }\n        isIocaine = assignedObject != null ? assignedObject.is_iocaine : void 0;\n        ctx = {\n          fullName: fullName,\n          photo: photo,\n          isUnassigned: isUnassigned,\n          isEditable: isEditable(),\n          isIocaine: isIocaine,\n          fullNameVisible: !(isUnassigned && !$currentUserService.isAuthenticated())\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".assign-to-me\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        $model.$modelValue.assigned_to = $currentUserService.getUser().get('id');\n        return save($currentUserService.getUser().get('id'));\n      });\n      $el.on(\"click\", \".remove-user\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$translate\", \"$compile\", \"tgCurrentUserService\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').removeClass('is-active');\n          return $el.find('.item-unblock').addClass('is-active');\n        } else {\n          $el.find('.item-block').addClass('is-active');\n          return $el.find('.item-unblock').removeClass('is-active');\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableSubjectDirective = function($rootscope, $repo, $confirm, $loading, $modelTransform, $template) {\n    var link, template;\n    template = $template.get(\"common/components/editable-subject.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-subject').hide();\n        return $el.find('.view-subject').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = function(subject) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('.save-container')).start();\n        transform = $modelTransform.save(function(item) {\n          item.subject = subject;\n          return item;\n        });\n        transform.then((function(_this) {\n          return function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-subject').hide();\n            return $el.find('.view-subject').show();\n          };\n        })(this));\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n        return transform;\n      };\n      $el.click(function() {\n        if (!isEditable()) {\n          return;\n        }\n        $el.find('.edit-subject').show();\n        $el.find('.view-subject').hide();\n        return $el.find('input').focus();\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var subject;\n        e.preventDefault();\n        subject = $scope.item.subject;\n        return save(subject);\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var subject;\n        if (event.keyCode === 13) {\n          subject = $scope.item.subject;\n          return save(subject);\n        } else if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $model.$modelValue.revert();\n            };\n          })(this));\n          $el.find('.edit-subject').hide();\n          return $el.find('.view-subject').show();\n        }\n      });\n      $el.find('.edit-subject').hide();\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (!isEditable()) {\n          return $el.find('.view-subject .edit').remove();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableSubject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", EditableSubjectDirective]);\n\n  EditableDescriptionDirective = function($rootscope, $repo, $confirm, $compile, $loading, $selectedText, $modelTransform, $template, $translate) {\n    var link, noDescriptionMegEditMode, noDescriptionMegReadMode, template;\n    template = $template.get(\"common/components/editable-description.html\");\n    noDescriptionMegEditMode = $template.get(\"common/components/editable-description-msg-edit-mode.html\");\n    noDescriptionMegReadMode = $template.get(\"common/components/editable-description-msg-read-mode.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, isEditable, save;\n      $el.find('.edit-description').hide();\n      $el.find('.view-description .edit').hide();\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = function(description) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('.save-container')).start();\n        transform = $modelTransform.save(function(item) {\n          item.description = description;\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          $rootscope.$broadcast(\"object:updated\");\n          $el.find('.edit-description').hide();\n          return $el.find('.view-description').show();\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      };\n      cancelEdition = function() {\n        $scope.item.revert();\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      };\n      $el.on(\"mouseup\", \".view-description\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        $el.find('.edit-description').show();\n        $el.find('.view-description').hide();\n        return $el.find('textarea').focus();\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var description;\n        e.preventDefault();\n        description = $scope.item.description;\n        return save(description);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode !== 27) {\n          return;\n        }\n        return $scope.$applyAsync(function() {\n          var message, title;\n          title = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE\");\n          message = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE\");\n          return $confirm.ask(title, null, message).then(function(askResponse) {\n            cancelEdition();\n            return askResponse.finish();\n          });\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (isEditable()) {\n          $el.find('.view-description .edit').show();\n          $el.find('.view-description .us-content').addClass('editable');\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegEditMode)($scope);\n        } else {\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegReadMode)($scope);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableDescription\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", \"$tgLoading\", \"$selectedText\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$translate\", EditableDescriptionDirective]);\n\n  EditableWysiwyg = function(attachmentsService, attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var isInEditMode, uploadFile;\n      isInEditMode = function() {\n        return $el.find('textarea').is(':visible');\n      };\n      uploadFile = function(file, type) {\n        if (!attachmentsService.validate(file)) {\n          return;\n        }\n        return attachmentsFullService.addAttachment($model.$modelValue.project, $model.$modelValue.id, type, file).then(function(result) {\n          if (taiga.isImage(result.getIn(['file', 'name']))) {\n            return '![' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          } else {\n            return '[' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          }\n        });\n      };\n      $el.on('dragover', function(e) {\n        var textarea;\n        textarea = $el.find('textarea').focus();\n        return false;\n      });\n      return $el.on('drop', function(e) {\n        var dataTransfer, promises, textarea, type;\n        e.stopPropagation();\n        e.preventDefault();\n        if (isInEditMode()) {\n          dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n          textarea = $el.find('textarea');\n          textarea.addClass('in-progress');\n          type = $model.$modelValue['_name'];\n          if (type === \"userstories\") {\n            type = \"us\";\n          } else if (type === \"tasks\") {\n            type = \"task\";\n          } else if (type === \"issues\") {\n            type = \"issue\";\n          } else if (type === \"wiki\") {\n            type = \"wiki_page\";\n          }\n          promises = _.map(dataTransfer.files, function(file) {\n            return uploadFile(file, type);\n          });\n          return Promise.all(promises).then(function(result) {\n            textarea = $el.find('textarea');\n            $.markItUp({\n              replaceWith: result.join(' ')\n            });\n            return textarea.removeClass('in-progress');\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEditableWysiwyg\", [\"tgAttachmentsService\", \"tgAttachmentsFullService\", EditableWysiwyg]);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = usersById[item.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", \"$translate\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = i18nSectionName;\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      if (title) {\n        el.find(\".title\").text(title);\n      }\n      if (subtitle) {\n        el.find(\".subtitle\").text(subtitle);\n      }\n      if (message) {\n        el.find(\".message\").text(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").text(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").text(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        value = _.escape(value);\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\".title\").html(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message, icon) {\n      var defered, detailImage, el, svgContainer, useSVG;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      el.find(\"img\").remove();\n      el.find(\"svg\").remove();\n      if (icon) {\n        if (icon.type === \"img\") {\n          detailImage = $('<img>').addClass('lb-icon').attr('src', icon.name);\n        } else if (icon.type === \"svg\") {\n          detailImage = document.createElement(\"div\");\n          taiga.addClass(detailImage, \"icon\");\n          taiga.addClass(detailImage, icon.name);\n          taiga.addClass(detailImage, \"lb-icon\");\n          svgContainer = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n          useSVG = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n          useSVG.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + icon.name);\n          detailImage.appendChild(svgContainer).appendChild(useSVG);\n        }\n        if (detailImage) {\n          el.find('section').prepend(detailImage);\n        }\n      }\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message) {\n      var el;\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\".title\").html(title);\n            }\n            if (message) {\n              el.find(\".message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive').one('animationend', function() {\n            return $(this).removeClass('inactive');\n          });\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-close, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope, rootscope, repo, rs, confirm, q) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $el.on(\"click\", \".custom-fields-header .collapse\", function() {\n        var collapsed, hash;\n        hash = collapsedHash($attrs.type);\n        collapsed = !($storage.get(hash) || false);\n        $storage.set(hash, collapsed);\n        if (collapsed) {\n          $el.find(\".custom-fields-header .icon\").removeClass(\"open\");\n          return $el.find(\".custom-fields-body\").removeClass(\"open\");\n        } else {\n          $el.find(\".custom-fields-header .icon\").addClass(\"open\");\n          return $el.find(\".custom-fields-body\").addClass(\"open\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var collapsed;\n      collapsed = $storage.get(collapsedHash($attrs.type)) || false;\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm,\n        collapsed: collapsed\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)($scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)($scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, input;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          input = $el.find(\"input[name=value], textarea[name='value']\");\n          attributeValue.value = input.val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode span a\", function(event) {\n        return event.stopPropagation();\n      });\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \".js-edit-description\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".js-save-description\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile, $modelTransform, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = function(points) {\n        var onError, transform;\n        transform = $modelTransform.save((function(_this) {\n          return function(us) {\n            us.points = points;\n            return us;\n          };\n        })(this));\n        onError = (function(_this) {\n          return function() {\n            return $confirm.notify(\"error\");\n          };\n        })(this);\n        return transform.then(null, onError);\n      };\n      $scope.$watchCollection(function() {\n        return $model.$modelValue && $model.$modelValue.points;\n      }, function() {\n        var estimationProcess, us;\n        us = $model.$modelValue;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            return save(points).then(function() {\n              return $rootScope.$broadcast(\"object:updated\");\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", \"$tgQueueModelTransformation\", \"$tgConfirm\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $repo, $confirm, $q, $qqueue) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              return deferred.resolve();\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"?\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            return _this.onSelectedPointForRole(roleId, pointId, points);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgRepo\", \"$tgConfirm\", \"$q\", \"$tgQqueue\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var defaultFilter, module, momentFormat, momentFromNow, sizeFormat, taiga, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n  sizeFormat = (function(_this) {\n    return function() {\n      return _this.taiga.sizeFormat;\n    };\n  })(this);\n\n  module.filter(\"sizeFormat\", sizeFormat);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/history.coffee\n */\n\n(function() {\n  var HistoryController, HistoryDirective, IGNORED_FIELDS, bindOnce, debounce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  IGNORED_FIELDS = {\n    \"userstories.userstory\": [\"watchers\", \"kanban_order\", \"backlog_order\", \"sprint_order\", \"finish_date\", \"tribe_gig\"],\n    \"tasks.task\": [\"watchers\", \"us_order\", \"taskboard_order\"],\n    \"issues.issue\": [\"watchers\"]\n  };\n\n  HistoryController = (function(superClass) {\n    extend(HistoryController, superClass);\n\n    HistoryController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\"];\n\n    function HistoryController(scope, repo, rs) {\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n    }\n\n    HistoryController.prototype.initialize = function(type, objectId) {\n      this.type = type;\n      return this.objectId = objectId;\n    };\n\n    HistoryController.prototype.loadHistory = function(type, objectId) {\n      return this.rs.history.get(type, objectId).then((function(_this) {\n        return function(history) {\n          var changeModel, historyEntry, historyResult, i, j, len, len1;\n          for (i = 0, len = history.length; i < len; i++) {\n            historyResult = history[i];\n            if (historyResult.values_diff.description_diff != null) {\n              historyResult.values_diff.description = historyResult.values_diff.description_diff;\n            }\n            delete historyResult.values_diff.description_html;\n            delete historyResult.values_diff.description_diff;\n            if (historyResult.values_diff.blocked_note_diff != null) {\n              historyResult.values_diff.blocked_note = historyResult.values_diff.blocked_note_diff;\n            }\n            delete historyResult.values_diff.blocked_note_html;\n            delete historyResult.values_diff.blocked_note_diff;\n          }\n          for (j = 0, len1 = history.length; j < len1; j++) {\n            historyEntry = history[j];\n            changeModel = historyEntry.key.split(\":\")[0];\n            if (IGNORED_FIELDS[changeModel] != null) {\n              historyEntry.values_diff = _.removeKeys(historyEntry.values_diff, IGNORED_FIELDS[changeModel]);\n            }\n          }\n          _this.scope.history = _.filter(history, function(item) {\n            return Object.keys(item.values_diff).length > 0;\n          });\n          return _this.scope.comments = _.filter(history, function(item) {\n            return item.comment !== \"\";\n          });\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.deleteComment = function(type, objectId, activityId) {\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.undeleteComment = function(type, objectId, activityId) {\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    return HistoryController;\n\n  })(taiga.Controller);\n\n  HistoryDirective = function($log, $loading, $qqueue, $template, $confirm, $translate, $compile, $navUrls, $rootScope, checkPermissionsService) {\n    var link, templateActivity, templateBase, templateBaseEntries, templateChangeAttachment, templateChangeDiff, templateChangeGeneric, templateChangeList, templateChangePoints, templateDeletedComment;\n    templateChangeDiff = $template.get(\"common/history/history-change-diff.html\", true);\n    templateChangePoints = $template.get(\"common/history/history-change-points.html\", true);\n    templateChangeGeneric = $template.get(\"common/history/history-change-generic.html\", true);\n    templateChangeAttachment = $template.get(\"common/history/history-change-attachment.html\", true);\n    templateChangeList = $template.get(\"common/history/history-change-list.html\", true);\n    templateDeletedComment = $template.get(\"common/history/history-deleted-comment.html\", true);\n    templateActivity = $template.get(\"common/history/history-activity.html\", true);\n    templateBaseEntries = $template.get(\"common/history/history-base-entries.html\", true);\n    templateBase = $template.get(\"common/history/history-base.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var countChanges, formatChange, getHumanizedFieldName, getPrettyDateFormat, objectId, renderActivity, renderAttachmentEntry, renderBase, renderChange, renderChangeEntries, renderChangeEntry, renderChangesHelperText, renderComment, renderComments, renderCustomAttributesEntry, renderHistory, rerender, save, showAllActivity, showAllComments, type;\n      type = $attrs.type;\n      objectId = null;\n      showAllComments = false;\n      showAllActivity = false;\n      getPrettyDateFormat = function() {\n        return $translate.instant(\"ACTIVITY.DATETIME\");\n      };\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        type = $attrs.type;\n        objectId = model.id;\n        $ctrl.initialize(type, objectId);\n        return $ctrl.loadHistory(type, objectId);\n      });\n      getHumanizedFieldName = function(field) {\n        var humanizedFieldNames;\n        humanizedFieldNames = {\n          subject: $translate.instant(\"ACTIVITY.FIELDS.SUBJECT\"),\n          name: $translate.instant(\"ACTIVITY.FIELDS.NAME\"),\n          description: $translate.instant(\"ACTIVITY.FIELDS.DESCRIPTION\"),\n          content: $translate.instant(\"ACTIVITY.FIELDS.CONTENT\"),\n          status: $translate.instant(\"ACTIVITY.FIELDS.STATUS\"),\n          is_closed: $translate.instant(\"ACTIVITY.FIELDS.IS_CLOSED\"),\n          finish_date: $translate.instant(\"ACTIVITY.FIELDS.FINISH_DATE\"),\n          type: $translate.instant(\"ACTIVITY.FIELDS.TYPE\"),\n          priority: $translate.instant(\"ACTIVITY.FIELDS.PRIORITY\"),\n          severity: $translate.instant(\"ACTIVITY.FIELDS.SEVERITY\"),\n          assigned_to: $translate.instant(\"ACTIVITY.FIELDS.ASSIGNED_TO\"),\n          watchers: $translate.instant(\"ACTIVITY.FIELDS.WATCHERS\"),\n          milestone: $translate.instant(\"ACTIVITY.FIELDS.MILESTONE\"),\n          user_story: $translate.instant(\"ACTIVITY.FIELDS.USER_STORY\"),\n          project: $translate.instant(\"ACTIVITY.FIELDS.PROJECT\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          points: $translate.instant(\"ACTIVITY.FIELDS.POINTS\"),\n          client_requirement: $translate.instant(\"ACTIVITY.FIELDS.CLIENT_REQUIREMENT\"),\n          team_requirement: $translate.instant(\"ACTIVITY.FIELDS.TEAM_REQUIREMENT\"),\n          is_iocaine: $translate.instant(\"ACTIVITY.FIELDS.IS_IOCAINE\"),\n          tags: $translate.instant(\"ACTIVITY.FIELDS.TAGS\"),\n          attachments: $translate.instant(\"ACTIVITY.FIELDS.ATTACHMENTS\"),\n          is_deprecated: $translate.instant(\"ACTIVITY.FIELDS.IS_DEPRECATED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          order: $translate.instant(\"ACTIVITY.FIELDS.ORDER\"),\n          backlog_order: $translate.instant(\"ACTIVITY.FIELDS.BACKLOG_ORDER\"),\n          sprint_order: $translate.instant(\"ACTIVITY.FIELDS.SPRINT_ORDER\"),\n          kanban_order: $translate.instant(\"ACTIVITY.FIELDS.KANBAN_ORDER\"),\n          taskboard_order: $translate.instant(\"ACTIVITY.FIELDS.TASKBOARD_ORDER\"),\n          us_order: $translate.instant(\"ACTIVITY.FIELDS.US_ORDER\")\n        };\n        return humanizedFieldNames[field] || field;\n      };\n      countChanges = function(comment) {\n        return _.keys(comment.values_diff).length;\n      };\n      formatChange = function(change) {\n        if (_.isArray(change)) {\n          if (change.length === 0) {\n            return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n          }\n          return change.join(\", \");\n        }\n        if (change === \"\") {\n          return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n        }\n        if ((change == null) || change === false) {\n          return $translate.instant(\"ACTIVITY.VALUES.NO\");\n        }\n        if (change === true) {\n          return $translate.instant(\"ACTIVITY.VALUES.YES\");\n        }\n        return change;\n      };\n      renderAttachmentEntry = function(value) {\n        var attachments;\n        attachments = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.NEW_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var diff, name;\n              name = $translate.instant(\"ACTIVITY.UPDATED_ATTACHMENT\", {\n                filename: change.filename\n              });\n              diff = _.map(change.changes, function(values, name) {\n                return {\n                  name: getHumanizedFieldName(name),\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                };\n              });\n              return templateChangeAttachment({\n                name: name,\n                diff: diff\n              });\n            });\n          }\n        });\n        return _.flatten(attachments).join(\"\\n\");\n      };\n      renderCustomAttributesEntry = function(value) {\n        var customAttributes;\n        customAttributes = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              var html;\n              html = templateChangeGeneric({\n                name: change.name,\n                from: formatChange(\"\"),\n                to: formatChange(change.value)\n              });\n              html = $compile(html)($scope);\n              return html[0].outerHTML;\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_CUSTOM_ATTRIBUTE\"),\n                diff: change.name\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var customAttrsChanges;\n              customAttrsChanges = _.map(change.changes, function(values) {\n                return templateChangeGeneric({\n                  name: change.name,\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                });\n              });\n              return _.flatten(customAttrsChanges).join(\"\\n\");\n            });\n          }\n        });\n        return _.flatten(customAttributes).join(\"\\n\");\n      };\n      renderChangeEntry = function(field, value) {\n        var added, from, html, name, removed, to;\n        if (field === \"description\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"description\"),\n            diff: value[1]\n          });\n        } else if (field === \"blocked_note\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"blocked_note\"),\n            diff: value[1]\n          });\n        } else if (field === \"points\") {\n          html = templateChangePoints({\n            points: value\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"attachments\") {\n          return renderAttachmentEntry(value);\n        } else if (field === \"custom_attributes\") {\n          return renderCustomAttributesEntry(value);\n        } else if (field === \"tags\" || field === \"watchers\") {\n          name = getHumanizedFieldName(field);\n          removed = _.difference(value[0], value[1]);\n          added = _.difference(value[1], value[0]);\n          html = templateChangeList({\n            name: name,\n            removed: removed,\n            added: added\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"assigned_to\") {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          to = formatChange(value[1] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        } else {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0]);\n          to = formatChange(value[1]);\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        }\n      };\n      renderChangeEntries = function(change) {\n        return _.map(change.values_diff, function(value, field) {\n          return renderChangeEntry(field, value);\n        });\n      };\n      renderChangesHelperText = function(change) {\n        var size;\n        size = countChanges(change);\n        return $translate.instant(\"ACTIVITY.SIZE_CHANGE\", {\n          size: size\n        }, 'messageformat');\n      };\n      renderComment = function(comment) {\n        var html, ref, ref1, ref2;\n        if (comment.delete_comment_date || ((ref = comment.delete_comment_user) != null ? ref.name : void 0)) {\n          html = templateDeletedComment({\n            deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n            deleteCommentUser: comment.delete_comment_user.name,\n            deleteComment: comment.comment_html,\n            activityId: comment.id,\n            canRestoreComment: $scope.user && (comment.delete_comment_user.pk === $scope.user.id || $scope.project.my_permissions.indexOf(\"modify_project\") > -1)\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        }\n        html = templateActivity({\n          avatar: comment.user.photo,\n          userFullName: comment.user.name,\n          userProfileUrl: comment.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: comment.user.username\n          }) : \"\",\n          creationDate: moment(comment.created_at).format(getPrettyDateFormat()),\n          comment: comment.comment_html,\n          changesText: renderChangesHelperText(comment),\n          changes: renderChangeEntries(comment),\n          mode: \"comment\",\n          deleteCommentActionTitle: $translate.instant(\"COMMENTS.DELETE\"),\n          deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref1 = comment.delete_comment_user) != null ? ref1.name : void 0) ? comment.delete_comment_user.name : void 0,\n          activityId: comment.id,\n          canDeleteComment: comment.user.pk === ((ref2 = $scope.user) != null ? ref2.id : void 0) || $scope.project.my_permissions.indexOf(\"modify_project\") > -1\n        });\n        html = $compile(html)($scope);\n        return html[0].outerHTML;\n      };\n      renderChange = function(change) {\n        var ref;\n        return templateActivity({\n          avatar: change.user.photo,\n          userFullName: change.user.name,\n          userProfileUrl: change.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: change.user.username\n          }) : \"\",\n          creationDate: moment(change.created_at).format(getPrettyDateFormat()),\n          comment: change.comment_html,\n          changes: renderChangeEntries(change),\n          changesText: \"\",\n          mode: \"activity\",\n          deleteCommentDate: change.delete_comment_date ? moment(change.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref = change.delete_comment_user) != null ? ref.name : void 0) ? change.delete_comment_user.name : void 0,\n          activityId: change.id\n        });\n      };\n      renderHistory = function(entries, totalEntries) {\n        var html, showMore;\n        if (entries.length === totalEntries) {\n          showMore = 0;\n        } else {\n          showMore = totalEntries - entries.length;\n        }\n        html = templateBaseEntries({\n          entries: entries,\n          showMore: showMore\n        });\n        html = $compile(html)($scope);\n        return html;\n      };\n      renderBase = function() {\n        var changes, comments, commentsVisible, historyVisible, html;\n        comments = $scope.comments || [];\n        changes = $scope.history || [];\n        historyVisible = !!changes.length;\n        commentsVisible = (!!comments.length) || checkPermissionsService.check('modify_' + $attrs.type);\n        html = templateBase({\n          ngmodel: $attrs.ngModel,\n          type: $attrs.type,\n          mode: $attrs.mode,\n          historyVisible: historyVisible,\n          commentsVisible: commentsVisible\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      rerender = function() {\n        renderBase();\n        renderComments();\n        return renderActivity();\n      };\n      renderComments = function() {\n        var comments, html, totalComments;\n        comments = $scope.comments || [];\n        totalComments = comments.length;\n        if (!showAllComments) {\n          comments = _.takeRight(comments, 4);\n        }\n        comments = _.map(comments, function(x) {\n          return renderComment(x);\n        });\n        html = renderHistory(comments, totalComments);\n        return $el.find(\".comments-list\").html(html);\n      };\n      renderActivity = function() {\n        var changes, html, totalChanges;\n        changes = $scope.history || [];\n        totalChanges = changes.length;\n        if (!showAllActivity) {\n          changes = _.takeRight(changes, 4);\n        }\n        changes = _.map(changes, function(x) {\n          return renderChange(x);\n        });\n        html = renderHistory(changes, totalChanges);\n        return $el.find(\".changes-list\").html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(target) {\n          var currentLoading, model, onError, onSuccess;\n          $scope.$broadcast(\"markdown-editor:submit\");\n          $el.find(\".comment-list\").addClass(\"activeanimation\");\n          currentLoading = $loading().target(target).start();\n          onSuccess = function() {\n            $rootScope.$broadcast(\"comment:new\");\n            return $ctrl.loadHistory(type, objectId)[\"finally\"](function() {\n              return currentLoading.finish();\n            });\n          };\n          onError = function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          };\n          model = $scope.$eval($attrs.ngModel);\n          return $ctrl.repo.save(model).then(onSuccess, onError);\n        };\n      })(this));\n      $scope.$watch(\"comments\", rerender);\n      $scope.$watch(\"history\", rerender);\n      $scope.$on(\"object:updated\", function() {\n        return $ctrl.loadHistory(type, objectId);\n      });\n      $el.on(\"click\", \".add-comment .button-green\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      }));\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href && href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".show-more\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.parent().is(\".changes-list\")) {\n          showAllActivity = !showAllActivity;\n          return renderActivity();\n        } else {\n          showAllComments = !showAllComments;\n          return renderComments();\n        }\n      });\n      $el.on(\"click\", \".show-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').show();\n        target.parents('.activity-single').find('.show-deleted-comment').hide();\n        return target.parents('.activity-single').find('.comment-body').show();\n      });\n      $el.on(\"click\", \".hide-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').hide();\n        target.parents('.activity-single').find('.show-deleted-comment').show();\n        return target.parents('.activity-single').find('.comment-body').hide();\n      });\n      $el.on(\"click\", \".changes-title\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return target.parent().find(\".change-entry\").toggleClass(\"active\");\n      });\n      $el.on(\"focus\", \".add-comment textarea\", function(event) {\n        return $(this).addClass('active');\n      });\n      $el.on(\"click\", \".history-tabs a\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        $el.find(\".history-tabs li\").removeClass(\"active\");\n        target.parent().addClass(\"active\");\n        $el.find(\".history section\").addClass(\"hidden\");\n        return $el.find(\".history section.\" + (target.data('section-class'))).removeClass(\"hidden\");\n      });\n      $el.on(\"click\", \".comment-delete\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.deleteComment(type, objectId, activityId);\n      }));\n      $el.on(\"click\", \".comment-restore\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.undeleteComment(type, objectId, activityId);\n      }));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return renderBase();\n    };\n    return {\n      controller: HistoryController,\n      restrict: \"AE\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", [\"$log\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$tgConfirm\", \"$translate\", \"$compile\", \"$tgNavUrls\", \"$rootScope\", \"tgCheckPermissionsService\", HistoryDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/importer.coffee\n */\n\n(function() {\n  var ImportProjectButtonDirective, LbImportErrorDirective, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  ImportProjectButtonDirective = function($rs, $confirm, $location, $navUrls, $translate, $lightboxFactory, currentUserService, $tgAuth) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getRestrictionError;\n      getRestrictionError = function(result) {\n        var errorKey, maxMemberships, membersError, privateError, publicError, user;\n        if (result.headers) {\n          errorKey = '';\n          user = currentUserService.getUser();\n          maxMemberships = 0;\n          if (result.headers.isPrivate) {\n            privateError = !currentUserService.canCreatePrivateProjects().valid;\n            maxMemberships = null;\n            if (user.get('max_memberships_private_projects') !== null && result.headers.memberships >= user.get('max_memberships_private_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (privateError && membersError) {\n              errorKey = 'private-space-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            } else if (privateError) {\n              errorKey = 'private-space';\n            } else if (membersError) {\n              errorKey = 'private-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            }\n          } else {\n            publicError = !currentUserService.canCreatePublicProjects().valid;\n            if (user.get('max_memberships_public_projects') !== null && result.headers.memberships >= user.get('max_memberships_public_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (publicError && membersError) {\n              errorKey = 'public-space-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            } else if (publicError) {\n              errorKey = 'public-space';\n            } else if (membersError) {\n              errorKey = 'public-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            }\n          }\n          return {\n            key: errorKey,\n            values: {\n              max_memberships: maxMemberships,\n              members: result.headers.memberships\n            }\n          };\n        } else {\n          return false;\n        }\n      };\n      $el.on(\"click\", \".import-project-button\", function(event) {\n        event.preventDefault();\n        $el.find(\"input.import-file\").val(\"\");\n        return $el.find(\"input.import-file\").trigger(\"click\");\n      });\n      return $el.on(\"change\", \"input.import-file\", function(event) {\n        var file, loader, onError, onSuccess;\n        event.preventDefault();\n        file = event.target.files[0];\n        if (!file) {\n          return;\n        }\n        loader = $confirm.loader($translate.instant(\"PROJECT.IMPORT.UPLOADING_FILE\"));\n        onSuccess = function(result) {\n          return currentUserService.loadProjects().then(function() {\n            var ctx, message, msg, title;\n            loader.stop();\n            if (result.status === 202) {\n              title = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE\");\n              message = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE\");\n              return $confirm.success(title, message);\n            } else {\n              ctx = {\n                project: result.data.slug\n              };\n              $location.path($navUrls.resolve(\"project-admin-project-profile-details\", ctx));\n              msg = $translate.instant(\"PROJECT.IMPORT.SYNC_SUCCESS\");\n              return $confirm.notify(\"success\", msg);\n            }\n          });\n        };\n        onError = function(result) {\n          return $tgAuth.refresh().then(function() {\n            var errorMsg, ref, restrictionError;\n            restrictionError = getRestrictionError(result);\n            loader.stop();\n            if (restrictionError) {\n              return $lightboxFactory.create('tg-lb-import-error', {\n                \"class\": 'lightbox lightbox-import-error'\n              }, restrictionError);\n            } else {\n              errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR\");\n              if (result.status === 429) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n              } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n                  error_message: result.data._error_message\n                });\n              }\n              return $confirm.notify(\"error\", errorMsg);\n            }\n          });\n        };\n        loader.start();\n        return $rs.projects[\"import\"](file, loader.update).then(onSuccess, onError);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgImportProjectButton\", [\"$tgResources\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", \"$tgAuth\", ImportProjectButtonDirective]);\n\n  LbImportErrorDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      lightboxService.open(el);\n      return scope.close = function() {\n        lightboxService.close(el);\n      };\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-import-error.html\",\n      link: link\n    };\n  };\n\n  LbImportErrorDirective.$inject = [\"lightboxService\"];\n\n  module.directive(\"tgLbImportError\", LbImportErrorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, AttachmentPreviewLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxLeaveProjectWarningDirective, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, sizeFormat, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n    }\n\n    LightboxService.prototype.open = function($el) {\n      var defered, docEl, lightboxContent;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            var firstField;\n            firstField = $el.find('input,textarea').first();\n            if (firstField.length) {\n              return $el.find('input,textarea').first().focus();\n            } else if (document.activeElement) {\n              return $(document.activeElement).blur();\n            }\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            return _this.close($el);\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      var docEl, scope;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      docEl = angular.element(document);\n      docEl.off(\".lightbox\");\n      docEl.off(\".keyboard-navigation\");\n      this.animationFrame.add(function() {\n        $el.addClass('close');\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            $el.removeAttr('style');\n            return $el.removeClass(\"open\").removeClass('close');\n          };\n        })(this));\n      });\n      if ($el.hasClass(\"remove-on-close\")) {\n        scope = $el.data(\"scope\");\n        if (scope) {\n          scope.$destroy();\n        }\n        return $el.remove();\n      }\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $modelTransform, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = (function(_this) {\n        return function(finishCallback) {\n          var transform;\n          transform = $modelTransform.save(function(item) {\n            item.is_blocked = false;\n            item.blocked_note = \"\";\n            return item;\n          });\n          transform.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            return finishCallback();\n          });\n          transform.then(null, function() {\n            $confirm.notify(\"error\");\n            return item.revert();\n          });\n          transform[\"finally\"](function() {\n            return finishCallback();\n          });\n          return transform;\n        };\n      })(this);\n      block = function() {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\".button-green\")).start();\n        transform = $modelTransform.save(function(item) {\n          item.is_blocked = true;\n          item.blocked_note = $el.find(\".reason\").val();\n          return item;\n        });\n        transform.then(function() {\n          $confirm.notify(\"success\");\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          currentLoading.finish();\n          return lightboxService.close($el);\n        });\n      };\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          return unblock(finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return block();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate, $confirm, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, form, resetAttachments, submit, submitButton;\n      form = null;\n      $scope.createEditUs = {};\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        if (form) {\n          form.reset();\n        }\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us, attachments) {\n        if (form) {\n          form.reset();\n        }\n        $scope.us = us;\n        $scope.attachments = Immutable.fromJS(attachments);\n        $scope.isNew = false;\n        resetAttachments();\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        return lightboxService.open($el);\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.us.project, 'us');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"us\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this));\n            return data;\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootScope.$broadcast(broadcastEvent, data);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", \"$tgConfirm\", \"$q\", \"tgAttachmentsService\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n        normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n        normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n        normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n        normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.includes(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        ctx = {\n          selected: selected,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.includes(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html;\n        ctx = {\n          selected: false,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(200, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", WatchersLightboxDirective]);\n\n  AttachmentPreviewLightboxDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-attachment-preview.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLbAttachmentPreview\", [\"lightboxService\", \"$tgTemplate\", \"$compile\", AttachmentPreviewLightboxDirective]);\n\n  LightboxLeaveProjectWarningDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-leave-project-warning.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLightboxLeaveProjectWarning\", [\"lightboxService\", LightboxLeaveProjectWarningDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          if (!target.hasClass('loading') && !service.settings.template) {\n            service.settings.template = target.html();\n          }\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(100).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      $scope.$watch($attrs.tgRelatedTaskStatus, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskStatus);\n        return updateTaskStatus($el, task, $scope.taskStatusById);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsDirective, LbTagLineDirective, TagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsDirective = function() {\n    var link, templates;\n    templates = {\n      backlog: _.template(\"<% _.each(tags, function(tag) { %>\\n    <span class=\\\"tag\\\" style=\\\"border-left: 5px solid <%- tag.color %>\\\"><%- tag.name %></span>\\n<% }) %>\"),\n      kanban: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"kanban-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\"),\n      taskboard: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"taskboard-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\")\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(srcTags) {\n        var html, tags, template;\n        template = templates[$attrs.tgColorizeTagsType];\n        srcTags.sort();\n        tags = _.map(srcTags, function(tag) {\n          var color;\n          color = $scope.project.tags_colors[tag];\n          return {\n            name: tag,\n            color: color\n          };\n        });\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeTags\", ColorizeTagsDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, autocomplete, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    autocomplete = null;\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, renderTags, resetInput, saveInputTag, showSaveButton;\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          })\n        };\n        _.map(ctx.tags, (function(_this) {\n          return function(tag) {\n            if (tag.color) {\n              return tag.style = \"border-left: 5px solid \" + tag.color;\n            }\n          };\n        })(this));\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\".tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          event.preventDefault();\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var input;\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(project.tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n  TagLineDirective = function($rootScope, $repo, $rs, $confirm, $modelTransform, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, ESC_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    ESC_KEY = 27;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/tags-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, autocomplete, deleteValue, hideAddTagButton, hideAddTagButtonText, hideInput, hideSaveButton, isEditable, renderInReadModeOnly, renderTags, resetInput, saveInputTag, showAddTagButton, showAddTagButtonText, showInput, showSaveButton;\n      autocomplete = null;\n      isEditable = function() {\n        if ($attrs.requiredPerm != null) {\n          return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n        }\n        return true;\n      };\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          }),\n          isEditable: isEditable()\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      renderInReadModeOnly = function() {\n        $el.find(\".add-tag\").remove();\n        $el.find(\"input\").remove();\n        return $el.find(\".save\").remove();\n      };\n      showAddTagButton = function() {\n        return $el.find(\".add-tag\").removeClass(\"hidden\");\n      };\n      hideAddTagButton = function() {\n        return $el.find(\".add-tag\").addClass(\"hidden\");\n      };\n      showAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").removeClass(\"hidden\");\n      };\n      hideAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").addClass(\"hidden\");\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      showInput = function() {\n        return $el.find(\"input\").removeClass(\"hidden\").focus();\n      };\n      hideInput = function() {\n        return $el.find(\"input\").addClass(\"hidden\").blur();\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = function(value) {\n        var onError, onSuccess, transform;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        transform = $modelTransform.save(function(item) {\n          var tags;\n          if (!item.tags) {\n            item.tags = [];\n          }\n          tags = _.clone(item.tags);\n          if (indexOf.call(tags, value) < 0) {\n            tags.push(value);\n          }\n          item.tags = tags;\n          return item;\n        });\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        hideSaveButton();\n        return transform.then(onSuccess, onError);\n      };\n      deleteValue = function(value) {\n        var onError, onSuccess, transform;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        transform = $modelTransform.save(function(item) {\n          var tags;\n          tags = _.clone(item.tags, false);\n          item.tags = _.pull(tags, value);\n          return item;\n        });\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        return transform.then(onSuccess, onError);\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === ESC_KEY) {\n          resetInput();\n          hideInput();\n          hideSaveButton();\n          return showAddTagButton();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".add-tag\", function(event) {\n        event.preventDefault();\n        hideAddTagButton();\n        return showInput();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project.tags_colors\", function(tags_colors) {\n        var input;\n        if (!isEditable()) {\n          renderInReadModeOnly();\n          return;\n        }\n        showAddTagButton();\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watchCollection(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.tags : void 0;\n      }, function() {\n        var model, ref, ref1, tagsColors;\n        model = $model.$modelValue;\n        if (!model) {\n          return;\n        }\n        if ((ref = model.tags) != null ? ref.length : void 0) {\n          hideAddTagButtonText();\n        } else {\n          showAddTagButtonText();\n        }\n        tagsColors = ((ref1 = $scope.project) != null ? ref1.tags_colors : void 0) || [];\n        return renderTags(model.tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgTagLine\", [\"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", TagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/wisiwyg.coffee\n */\n\n(function() {\n  var MarkitupDirective, bindOnce, module, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  MarkitupDirective = function($rootscope, $rs, $selectedText, $template, $compile, $translate) {\n    var link, previewTemplate;\n    previewTemplate = $template.get(\"common/wysiwyg/wysiwyg-markitup-preview.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addLine, cancelablePromise, closePreviewMode, element, markdownTitle, prepareUrlFormatting, preview, previewDomNode, previewInProgress, renderMarkItUp, setCaretPosition, unbind, urlFormatting;\n      element = angular.element($el);\n      previewDomNode = $(\"<div/>\", {\n        \"class\": \"preview\"\n      });\n      closePreviewMode = function() {\n        element.parents(\".markdown\").find(\".preview\").remove();\n        return element.parents(\".markItUp\").show();\n      };\n      $scope.$on(\"markdown-editor:submit\", function() {\n        return closePreviewMode();\n      });\n      cancelablePromise = null;\n      previewInProgress = false;\n      preview = function() {\n        var markItUpDomNode, markdownDomNode;\n        if (previewInProgress) {\n          return;\n        }\n        previewInProgress = true;\n        markdownDomNode = element.parents(\".markdown\");\n        markItUpDomNode = element.parents(\".markItUp\");\n        return $rs.mdrender.render($scope.projectId, $model.$modelValue).then(function(data) {\n          var html, markdown;\n          html = previewTemplate({\n            data: data.data\n          });\n          html = $compile(html)($scope);\n          markdownDomNode.append(html);\n          markItUpDomNode.hide();\n          previewInProgress = false;\n          markdown = element.closest(\".markdown\");\n          return markdown.on(\"mouseup.preview\", \".preview\", function(event) {\n            var target;\n            event.preventDefault();\n            target = angular.element(event.target);\n            if (!target.is('a') && $selectedText.get().length) {\n              return;\n            }\n            markdown.off(\".preview\");\n            return closePreviewMode();\n          });\n        });\n      };\n      setCaretPosition = function(textarea, caretPosition) {\n        var line, range, scrollRelation, totalLines;\n        if (textarea.createTextRange) {\n          range = textarea.createTextRange();\n          range.move(\"character\", caretPosition);\n          range.select();\n        } else if (textarea.selectionStart) {\n          textarea.focus();\n          textarea.setSelectionRange(caretPosition, caretPosition);\n        }\n        totalLines = textarea.value.split(\"\\n\").length;\n        line = textarea.value.slice(0, +(caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n        scrollRelation = line / totalLines;\n        return $el.scrollTop((scrollRelation * $el[0].scrollHeight) - ($el.height() / 2));\n      };\n      addLine = function(textarea, nline, replace) {\n        var cursorPosition, j, key, len, line, lines;\n        lines = textarea.value.split(\"\\n\");\n        if (replace) {\n          lines[nline] = replace + lines[nline];\n        } else {\n          lines[nline] = \"\";\n        }\n        cursorPosition = 0;\n        for (key = j = 0, len = lines.length; j < len; key = ++j) {\n          line = lines[key];\n          cursorPosition += line.length + 1 || 1;\n          if (key === nline) {\n            break;\n          }\n        }\n        textarea.value = lines.join(\"\\n\");\n        if (replace) {\n          return cursorPosition - lines[nline].length + replace.length - 1;\n        } else {\n          return cursorPosition;\n        }\n      };\n      prepareUrlFormatting = function(markItUp) {\n        var indices, regex, result;\n        regex = /(<<<|>>>)/gi;\n        result = 0;\n        indices = [];\n        while ((result = regex.exec(markItUp.textarea.value))) {\n          indices.push(result.index);\n        }\n        return markItUp.donotparse = indices;\n      };\n      urlFormatting = function(markItUp) {\n        var endIndex, ref, ref1, regex, result, startIndex, url, value;\n        regex = /<<</gi;\n        result = 0;\n        startIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref = result.index, indexOf.call(markItUp.donotparse, ref) < 0) {\n            startIndex = result.index;\n            break;\n          }\n        }\n        if (!result) {\n          return;\n        }\n        regex = />>>/gi;\n        endIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref1 = result.index, indexOf.call(markItUp.donotparse, ref1) < 0) {\n            endIndex = result.index;\n            break;\n          }\n        }\n        value = markItUp.textarea.value;\n        url = value.substring(startIndex, endIndex).replace('<<<', '').replace('>>>', '');\n        url = url.replace('(', '%28').replace(')', '%29');\n        url = url.replace('[', '%5B').replace(']', '%5D');\n        value = value.substring(0, startIndex) + url + value.substring(endIndex + 3, value.length);\n        markItUp.textarea.value = value;\n        return markItUp.donotparse = void 0;\n      };\n      markdownTitle = function(markItUp, char) {\n        var heading, i, j, n, ref;\n        heading = \"\";\n        n = $.trim(markItUp.selection || markItUp.placeHolder).length;\n        for (i = j = 0, ref = n - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n          heading += char;\n        }\n        return \"\\n\" + heading + \"\\n\";\n      };\n      renderMarkItUp = function() {\n        var markdownSettings;\n        markdownSettings = {\n          nameSpace: \"markdown\",\n          onShiftEnter: {\n            keepDefault: false,\n            openWith: \"\\n\\n\"\n          },\n          onEnter: {\n            keepDefault: false,\n            replaceWith: function() {\n              if (!$('.textcomplete-dropdown').is(':visible')) {\n                return \"\\n\";\n              }\n            },\n            afterInsert: function(data) {\n              var cursorLine, emptyListItem, lastLine, lines, markdownCaretPositon, match, newLineContent, nline, replace;\n              lines = data.textarea.value.split(\"\\n\");\n              if (data.caretPosition > 0) {\n                cursorLine = data.textarea.value.slice(0, +(data.caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n              } else {\n                cursorLine = 1;\n              }\n              newLineContent = data.textarea.value.slice(data.caretPosition).split(\"\\n\")[0];\n              lastLine = lines[cursorLine - 1];\n              match = lastLine.match(/^(\\s*- ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)\\-\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*\\* ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*\\* )$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*)(\\d+)\\.\\s/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)(\\d+)\\.\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = (match[1] + (parseInt(match[2], 10) + 1)) + \". \";\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              if (markdownCaretPositon) {\n                return setCaretPosition(data.textarea, markdownCaretPositon);\n              }\n            }\n          },\n          markupSet: [\n            {\n              name: $translate.instant(\"COMMON.WYSIWYG.H1_BUTTON\"),\n              key: \"1\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H1_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"=\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H2_BUTTON\"),\n              key: \"2\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H2_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"-\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H3_BUTTON\"),\n              key: \"3\",\n              openWith: \"### \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H3_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON\"),\n              key: \"B\",\n              openWith: \"**\",\n              closeWith: \"**\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\"),\n              key: \"I\",\n              openWith: \"_\",\n              closeWith: \"_\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.STRIKE_BUTTON\"),\n              key: \"S\",\n              openWith: \"~~\",\n              closeWith: \"~~\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_BUTTON\"),\n              openWith: \"- \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_BUTTON\"),\n              openWith: function(markItUp) {\n                return markItUp.line + \". \";\n              },\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PICTURE_BUTTON\"),\n              key: \"P\",\n              openWith: \"![\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.LINK_BUTTON\"),\n              key: \"L\",\n              openWith: \"[\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.LINK_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON\"),\n              openWith: \"> \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_BUTTON\"),\n              openWith: \"```\\n\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT\"),\n              closeWith: \"\\n```\"\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PREVIEW_BUTTON\"),\n              call: preview,\n              className: \"preview-icon\"\n            }\n          ],\n          afterInsert: function(event) {\n            var target;\n            target = angular.element(event.textarea);\n            return $model.$setViewValue(target.val());\n          }\n        };\n        return element.markItUpRemove().markItUp(markdownSettings).textcomplete([\n          {\n            cache: true,\n            match: /(^|\\s)#([a-z0-9]+)$/i,\n            search: function(term, callback) {\n              var filter, searchProps, searchTypes;\n              term = taiga.slugify(term);\n              searchTypes = ['issues', 'tasks', 'userstories'];\n              searchProps = ['ref', 'subject'];\n              filter = (function(_this) {\n                return function(item) {\n                  var j, len, prop;\n                  for (j = 0, len = searchProps.length; j < len; j++) {\n                    prop = searchProps[j];\n                    if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                      return true;\n                    }\n                  }\n                  return false;\n                };\n              })(this);\n              if (cancelablePromise) {\n                cancelablePromise.abort();\n              }\n              cancelablePromise = $rs.search[\"do\"]($scope.projectId, term);\n              cancelablePromise.then((function(_this) {\n                return function(res) {\n                  var j, len, results, type;\n                  if (res.count < 1 || res.count === res.wikipages.length) {\n                    return callback([]);\n                  } else {\n                    results = [];\n                    for (j = 0, len = searchTypes.length; j < len; j++) {\n                      type = searchTypes[j];\n                      if (res[type] && res[type].length > 0) {\n                        results.push(callback(res[type].filter(filter), true));\n                      } else {\n                        results.push(void 0);\n                      }\n                    }\n                    return results;\n                  }\n                };\n              })(this));\n              return callback([]);\n            },\n            replace: function(res) {\n              return \"$1\\#\" + res.ref + \" \";\n            },\n            template: function(res, term) {\n              return \"\\#\" + res.ref + \" - \" + res.subject;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)@([a-z0-9\\-\\._]{2,})$/i,\n            search: function(term, callback) {\n              var searchProps, username;\n              username = taiga.slugify(term);\n              searchProps = ['username', 'full_name', 'full_name_display'];\n              if ($scope.project.members.length < 1) {\n                return callback([]);\n              } else {\n                return callback($scope.project.members.filter((function(_this) {\n                  return function(user) {\n                    var j, len, prop;\n                    for (j = 0, len = searchProps.length; j < len; j++) {\n                      prop = searchProps[j];\n                      if (taiga.slugify(user[prop]).indexOf(username) >= 0) {\n                        return true;\n                      }\n                    }\n                    return false;\n                  };\n                })(this)));\n              }\n            },\n            replace: function(user) {\n              return \"$1@\" + user.username + \" \";\n            },\n            template: function(user) {\n              return user.username + \" - \" + user.full_name_display;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)\\[\\[([a-z0-9\\-]+)$/i,\n            search: function(term, callback) {\n              term = taiga.slugify(term);\n              return $rs.search[\"do\"]($scope.projectId, term).then((function(_this) {\n                return function(res) {\n                  if (res.count < 1) {\n                    callback([]);\n                  }\n                  if (res.count < 1 || !res.wikipages || res.wikipages.length <= 0) {\n                    callback([]);\n                  } else {\n                    callback(res.wikipages.filter(function(page) {\n                      return taiga.slugify(page['slug']).indexOf(term) >= 0;\n                    }), true);\n                  }\n                  return callback([]);\n                };\n              })(this));\n            },\n            replace: function(res) {\n              return \"$1[[\" + res.slug + \"]]\";\n            },\n            template: function(res, term) {\n              return res.slug;\n            }\n          }\n        ], {\n          debounce: 200\n        });\n      };\n      renderMarkItUp();\n      unbind = $rootscope.$on(\"$translateChangeEnd\", renderMarkItUp);\n      element.on(\"keypress\", function(event) {\n        return $scope.$apply();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgMarkitup\", [\"$rootScope\", \"$tgResources\", \"$selectedText\", \"$tgTemplate\", \"$compile\", \"$translate\", MarkitupDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogFiltersDirective, bindOnce, debounceLeading, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogFiltersDirective = function($q, $log, $location, $template, $compile) {\n    var link, template, templateSelected;\n    template = $template.get(\"backlog/filters.html\", true);\n    templateSelected = $template.get(\"backlog/filter-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, currentFiltersType, getFiltersType, initializeSelectedFilters, reloadUserstories, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection;\n      currentFiltersType = '';\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n        return currentFiltersType = getFiltersType();\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function() {\n        var i, len, name, ref, val, values;\n        showCategories();\n        selectedFilters = [];\n        ref = $scope.filters;\n        for (name in ref) {\n          values = ref[name];\n          for (i = 0, len = values.length; i < len; i++) {\n            val = values[i];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters();\n      };\n      renderSelectedFilters = function() {\n        var html;\n        _.map(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filters-applied\").html(html);\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.map(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadUserstories = function() {\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadUserstories(true), $ctrl.generateFilters()]).then(function() {\n          var currentFilters;\n          currentFilters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(currentFilters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var filter, filters;\n        currentFiltersType = getFiltersType();\n        filters = $scope.filters[type];\n        filter = _.find(filters, {\n          id: id\n        });\n        filter.selected = !filter.selected;\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $scope.$apply(function() {\n            return $ctrl.selectFilter(type, id);\n          });\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(selected) {\n            return filter.type === selected.type && filter.id === selected.id;\n          });\n          $ctrl.unselectFilter(type, id);\n        }\n        renderSelectedFilters(selectedFilters);\n        if (type === currentFiltersType) {\n          renderFilters(_.reject(filters, \"selected\"));\n        }\n        return reloadUserstories();\n      };\n      selectQFilter = debounceLeading(100, function(value) {\n        if (value === void 0) {\n          return;\n        }\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n        }\n        return reloadUserstories();\n      });\n      $scope.$watch(\"filtersQ\", selectQFilter);\n      $scope.$on(\"backlog:loaded\", function(ctx) {\n        return initializeSelectedFilters();\n      });\n      $scope.$on(\"filters:update\", function(ctx) {\n        return $ctrl.generateFilters().then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          if (currentFiltersType) {\n            return renderFilters(_.reject(filters, \"selected\"));\n          }\n        });\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data('type'));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories();\n      });\n      $el.on(\"click\", \".remove-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget).parent();\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      return $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.hasClass(\"active\")) {\n          target.removeClass(\"active\");\n        } else {\n          target.addClass(\"active\");\n        }\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", BacklogFiltersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, form, getLastSprint, hasErrors, remove, resetSprint, submit;\n      hasErrors = false;\n      createSprint = true;\n      form = null;\n      resetSprint = function() {\n        if (form) {\n          form.reset();\n        }\n        return $scope.sprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          newSprint = angular.copy($scope.sprint);\n          broadcastEvent = null;\n          if (createSprint) {\n            newSprint.estimated_start = moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint.setAttr(\"estimated_start\", moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\"));\n            newSprint.setAttr(\"estimated_finish\", moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\"));\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $rootscope.$broadcast(broadcastEvent, data);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.sprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.sprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.sprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId) {\n        var estimatedFinish, estimatedStart, lastSprint, lastSprintNameDom, prettyDate, text;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.sprint.project = projectId;\n        $scope.sprint.name = null;\n        $scope.sprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.sprint.estimated_start) {\n          estimatedStart = moment($scope.sprint.estimated_start);\n        }\n        $scope.sprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.sprint.estimated_finish) {\n          estimatedFinish = moment($scope.sprint.estimated_finish);\n        }\n        $scope.sprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.sprint = sprint;\n          $scope.sprint.estimated_start = moment($scope.sprint.estimated_start).format(prettyDate);\n          return $scope.sprint.estimated_finish = moment($scope.sprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\", \"tgResources\", \"$tgQueueModelTransformation\"];\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading, rs2, modelTransform) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      this.rs2 = rs2;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.page = 1;\n      this.disablePagination = false;\n      this.firstLoadComplete = false;\n      this.scope.userstories = [];\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          _this.firstLoadComplete = true;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories(true);\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function(event, data) {\n          var index;\n          index = _.findIndex(_this.scope.userstories, function(us) {\n            return us.id === data.id;\n          });\n          _this.scope.userstories[index] = data;\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadAllPaginatedUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          _this.scope.openSprints = _.filter(sprints, function(sprint) {\n            return !sprint.closed;\n          }).reverse();\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          _this.scope.currentSprint = _this.findCurrentSprint();\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.restoreFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = this.scope.oldSelectedTags;\n      selectedStatuses = this.scope.oldSelectedStatuses;\n      if (!selectedStatuses && !selectedStatuses) {\n        return;\n      }\n      this.scope.filtersQ = this.scope.filtersQOld;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = true;\n            return _this.selectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.resetFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = _.filter(this.scope.filters.tags, \"selected\");\n      selectedStatuses = _.filter(this.scope.filters.status, \"selected\");\n      this.scope.oldSelectedTags = selectedTags;\n      this.scope.oldSelectedStatuses = selectedStatuses;\n      this.scope.filtersQOld = this.scope.filtersQ;\n      this.scope.filtersQ = void 0;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = false;\n            return _this.unselectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.loadAllPaginatedUserstories = function() {\n      var page;\n      page = this.page;\n      return this.loadUserstories(true, this.scope.userstories.length).then((function(_this) {\n        return function() {\n          return _this.page = page;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadUserstories = function(resetPagination, pageSize) {\n      var promise;\n      if (resetPagination == null) {\n        resetPagination = false;\n      }\n      if (!this.scope.projectId) {\n        return null;\n      }\n      this.loadingUserstories = true;\n      this.disablePagination = true;\n      this.scope.httpParams = this.getUrlFilters();\n      this.rs.userstories.storeQueryParams(this.scope.projectId, this.scope.httpParams);\n      if (resetPagination) {\n        this.page = 1;\n      }\n      this.scope.httpParams.page = this.page;\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, this.scope.httpParams, pageSize);\n      return promise.then((function(_this) {\n        return function(result) {\n          var header, userstories;\n          userstories = result[0];\n          header = result[1];\n          if (resetPagination) {\n            _this.scope.userstories = [];\n          }\n          _this.scope.userstories = _this.scope.userstories.concat(_.sortBy(userstories, \"backlog_order\"));\n          _this.setSearchDataFilters();\n          _this.loadingUserstories = false;\n          if (header('x-pagination-next')) {\n            _this.disablePagination = false;\n            _this.page++;\n          }\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]);\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.closedMilestones = !!project.total_closed_milestones;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n          return project;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.initializeSubscription();\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadBacklog();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.generateFilters();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.resortUserStories = function(uses, field) {\n      var index, item, items, j, len;\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      items = [];\n      for (index = j = 0, len = uses.length; j < len; index = ++j) {\n        item = uses[index];\n        item[field] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var args, data, items, j, key, l, len, len1, len2, len3, m, movedFromClosedSprint, movedToClosedSprint, n, newSprint, oldSprintId, project, promise, promises, r, sprint, us, userstories;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      movedFromClosedSprint = false;\n      movedToClosedSprint = false;\n      sprint = this.scope.sprintsById[oldSprintId];\n      if (!sprint && this.scope.closedSprintsById) {\n        sprint = this.scope.closedSprintsById[oldSprintId];\n        if (sprint) {\n          movedFromClosedSprint = true;\n        }\n      }\n      newSprint = this.scope.sprintsById[newSprintId];\n      if (!newSprint && newSprintId) {\n        newSprint = this.scope.closedSprintsById[newSprintId];\n        if (newSprint) {\n          movedToClosedSprint = true;\n        }\n      }\n      if (newSprintId === oldSprintId) {\n        items = null;\n        userstories = null;\n        if (newSprintId === null) {\n          userstories = this.scope.userstories;\n        } else {\n          userstories = newSprint.user_stories;\n        }\n        this.scope.$apply(function() {\n          var args, j, key, len, r, us;\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            r = userstories.indexOf(us);\n            userstories.splice(r, 1);\n          }\n          args = [newUsIndex, 0].concat(usList);\n          return Array.prototype.splice.apply(userstories, args);\n        });\n        if (newSprintId === null) {\n          items = this.resortUserStories(userstories, \"backlog_order\");\n          data = this.prepareBulkUpdateData(items, \"backlog_order\");\n          this.rs.userstories.bulkUpdateBacklogOrder(project, data).then((function(_this) {\n            return function() {\n              return _this.rootscope.$broadcast(\"sprint:us:moved\");\n            };\n          })(this));\n        } else {\n          items = this.resortUserStories(userstories, \"sprint_order\");\n          data = this.prepareBulkUpdateData(items, \"sprint_order\");\n          this.rs.userstories.bulkUpdateSprintOrder(project, data).then((function(_this) {\n            return function() {\n              return _this.rootscope.$broadcast(\"sprint:us:moved\");\n            };\n          })(this));\n        }\n        return promise;\n      }\n      if (newSprintId === null) {\n        for (j = 0, len = usList.length; j < len; j++) {\n          us = usList[j];\n          us.milestone = null;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, l, len1, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(_this.scope.userstories, args);\n            results = [];\n            for (key = l = 0, len1 = usList.length; l < len1; key = ++l) {\n              us = usList[key];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n        promise = this.repo.save(us);\n        promise = promise.then((function(_this) {\n          return function() {\n            items = _this.resortUserStories(_this.scope.userstories, \"backlog_order\");\n            data = _this.prepareBulkUpdateData(items, \"backlog_order\");\n            return _this.rs.userstories.bulkUpdateBacklogOrder(us.project, data).then(function() {\n              _this.rootscope.$broadcast(\"sprint:us:moved\");\n              if (movedFromClosedSprint) {\n                return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n              }\n            });\n          };\n        })(this));\n        promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n        return promise;\n      }\n      if (oldSprintId === null) {\n        for (l = 0, len1 = usList.length; l < len1; l++) {\n          us = usList[l];\n          us.milestone = newSprintId;\n        }\n        args = [newUsIndex, 0].concat(usList);\n        Array.prototype.splice.apply(newSprint.user_stories, args);\n        for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n          us = usList[key];\n          r = this.scope.userstories.indexOf(us);\n          this.scope.userstories.splice(r, 1);\n        }\n      } else {\n        for (n = 0, len3 = usList.length; n < len3; n++) {\n          us = usList[n];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var len4, o, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (o = 0, len4 = usList.length; o < len4; o++) {\n              us = usList[o];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      }\n      promises = _.map(usList, (function(_this) {\n        return function(us) {\n          return _this.repo.save(us);\n        };\n      })(this));\n      promise = this.q.all(promises).then((function(_this) {\n        return function() {\n          items = _this.resortUserStories(newSprint.user_stories, \"sprint_order\");\n          data = _this.prepareBulkUpdateData(items, \"sprint_order\");\n          _this.rs.userstories.bulkUpdateSprintOrder(project, data).then(function(result) {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\");\n          });\n          _this.rs.userstories.bulkUpdateBacklogOrder(project, data).then(function() {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\");\n          });\n          if (movedToClosedSprint || movedFromClosedSprint) {\n            return _this.scope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n      return promise;\n    };\n\n    BacklogController.prototype.isFilterSelected = function(type, id) {\n      if ((this.searchdata[type] != null) && this.searchdata[type][id]) {\n        return true;\n      }\n      return false;\n    };\n\n    BacklogController.prototype.setSearchDataFilters = function() {\n      var name, results, urlfilters, val, value;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = this.scope.filtersQ || urlfilters.q;\n      }\n      this.searchdata = {};\n      results = [];\n      for (name in urlfilters) {\n        value = urlfilters[name];\n        if (this.searchdata[name] == null) {\n          this.searchdata[name] = {};\n        }\n        results.push((function() {\n          var j, len, ref1, results1;\n          ref1 = taiga.toString(value).split(\",\");\n          results1 = [];\n          for (j = 0, len = ref1.length; j < len; j++) {\n            val = ref1[j];\n            results1.push(this.searchdata[name][val] = true);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.getUrlFilters = function() {\n      return _.pick(this.location.search(), \"status\", \"tags\", \"q\");\n    };\n\n    BacklogController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      urlfilters = this.getUrlFilters();\n      this.scope.filters = {};\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.milestone = 'null';\n      return this.rs.userstories.filtersData(loadFilters).then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, selectedStatuses, selectedTags, tagsFilterFormat;\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.usStatusById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          selectedTags = _.filter(_this.scope.filters.tags, \"selected\");\n          selectedTags = _.map(selectedTags, \"id\");\n          selectedStatuses = _.filter(_this.scope.filters.status, \"selected\");\n          selectedStatuses = _.map(selectedStatuses, \"id\");\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rs.userstories.storeQueryParams(_this.scope.projectId, {\n            \"status\": selectedStatuses,\n            \"tags\": selectedTags,\n            \"project\": _this.scope.projectId,\n            \"milestone\": null\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref1, ref2, results, searchdata, val, value;\n      searchdata = {};\n      ref1 = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref1) {\n        value = ref1[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref2 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref2.length; j < len; j++) {\n          val = ref2[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var l, len1, results1;\n          results1 = [];\n          for (l = 0, len1 = value.length; l < len1; l++) {\n            obj = value[l];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      this.setSearchDataFilters();\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"edit-story\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          return _this.rs2.attachments.list(\"us\", us.id, projectId).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", us, attachments.toJS());\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.q.all([_this.loadProjectStats(), _this.loadSprints()]);\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    BacklogController.prototype.findCurrentSprint = function() {\n      var currentDate;\n      currentDate = new Date().getTime();\n      return _.find(this.scope.sprints, function(sprint) {\n        var end, start;\n        start = moment(sprint.estimated_start, 'YYYY-MM-DD').format('x');\n        end = moment(sprint.estimated_finish, 'YYYY-MM-DD').format('x');\n        return currentDate >= start && currentDate <= end;\n      });\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, getUsToMove, lastChecked, moveToCurrentSprint, moveToLatestSprint, moveUssToSprint, shiftPressed;\n      getUsToMove = function() {\n        var ussDom;\n        ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        return _.map(ussDom, function(item) {\n          var itemScope;\n          item = $(item).closest('.tg-scope');\n          itemScope = item.scope();\n          itemScope.us.milestone = $scope.sprints[0].id;\n          return itemScope.us;\n        });\n      };\n      moveUssToSprint = function(selectedUss, sprint) {\n        var extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        sprint.user_stories = _.union(sprint.user_stories, selectedUss);\n        sprint.total_points += totalExtraPoints;\n        $repo.saveAll(selectedUss).then(function() {\n          $ctrl.loadSprints();\n          return $ctrl.loadProjectStats();\n        });\n        return $el.find(\".move-to-sprint\").hide();\n      };\n      moveToCurrentSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.currentSprint);\n      };\n      moveToLatestSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.sprints[0]);\n      };\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n        moveToSprintDom = $el.find(\".move-to-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          return moveToSprintDom.show();\n        } else {\n          return moveToSprintDom.hide();\n        }\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-latest-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToLatestSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      return $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.filters-bar\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      if (!sidebar.hasClass(\"active\")) {\n        $ctrl.resetFilters();\n      } else {\n        $ctrl.restoreFilters();\n      }\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      filters = $ctrl.getUrlFilters();\n      if (filters.status || filters.tags || filters.q) {\n        showHideFilter($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-down\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", \"$translate\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId, points) {\n            us.points = points;\n            estimationProcess.render();\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogSortableDirective, bindOnce, deleteElement, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    $(el).scope().$destroy();\n    $(el).off();\n    return $(el).remove();\n  };\n\n  BacklogSortableDirective = function($repo, $rs, $rootscope, $tgConfirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var drake, filterError, initIsBacklog, scroll;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        initIsBacklog = false;\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        drake = dragula([$el[0], $('.empty-backlog')[0]], {\n          copySortSource: false,\n          copy: false,\n          isContainer: function(el) {\n            return el.classList.contains('sprint-table');\n          },\n          moves: function(item) {\n            var parent;\n            if (!$(item).hasClass('row')) {\n              return false;\n            }\n            parent = $(item).parent();\n            initIsBacklog = parent.hasClass('backlog-table-body');\n            if (initIsBacklog && $el.hasClass(\"active-filters\")) {\n              filterError();\n              return false;\n            }\n            return true;\n          }\n        });\n        drake.on('drag', function(item, container) {\n          var isChecked, parent;\n          parent = $(item).parent();\n          initIsBacklog = parent.hasClass('backlog-table-body');\n          $(document.body).addClass(\"drag-active\");\n          isChecked = $(item).find(\"input[type='checkbox']\").is(\":checked\");\n          return window.dragMultiple.start(item, container);\n        });\n        drake.on('cloned', function(item) {\n          return $(item).addClass('backlog-us-mirror');\n        });\n        drake.on('dragend', function(item) {\n          var dragMultipleItems, firstElement, index, isBacklog, items, parent, sameContainer, sprint, usList;\n          $('.doom-line').remove();\n          parent = $(item).parent();\n          isBacklog = parent.hasClass('backlog-table-body') || parent.hasClass('empty-backlog');\n          if (initIsBacklog || isBacklog) {\n            sameContainer = initIsBacklog === isBacklog;\n          } else {\n            sameContainer = $(item).scope().sprint.id === parent.scope().sprint.id;\n          }\n          dragMultipleItems = window.dragMultiple.stop();\n          $(document.body).removeClass(\"drag-active\");\n          items = $(item).parent().find('.row');\n          sprint = null;\n          firstElement = dragMultipleItems.length ? dragMultipleItems[0] : item;\n          if (isBacklog) {\n            index = $(firstElement).index(\".backlog-table-body .row\");\n          } else {\n            index = $(firstElement).index();\n            sprint = parent.scope().sprint.id;\n          }\n          if (!sameContainer) {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = [$(item).scope().us];\n            }\n            if (dragMultipleItems.length) {\n              _.each(dragMultipleItems, function(item) {\n                return deleteElement(item);\n              });\n            } else {\n              deleteElement(item);\n            }\n          } else {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = _.map(items, function(item) {\n                var itemUs;\n                item = $(item);\n                itemUs = item.scope().us;\n                return itemUs;\n              });\n            }\n          }\n          return $scope.$emit(\"sprint:us:move\", usList, index, sprint);\n        });\n        scroll = autoScroll([window], {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$translate\", BacklogSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".compact-sprint\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .compact-sprint\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".edit-sprint\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch($attrs.ngModel, function(sprint) {\n        return render(sprint);\n      });\n      $scope.$on(\"sprintform:edit:success\", function() {\n        return render($model.$modelValue);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(x.day);\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton;\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.task.project, 'task');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"task\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task, attachments) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        $scope.attachments = Immutable.fromJS(attachments);\n        resetAttachments();\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          promise.then(function(data) {\n            createAttachments(data);\n            deleteAttachments(data);\n            return data;\n          });\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootscope.$broadcast(broadcastEvent, data);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", \"$q\", \"tgAttachmentsService\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, TaskboardTaskDirective, TaskboardUserDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, params1, q, appMetaService, location, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, task) {\n          var promise;\n          task.assigned_to = userId;\n          promise = _this.repo.save(task);\n          return promise.then(null, function() {\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(tasks) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, task, us, usId;\n          _this.scope.tasks = _.sortBy(tasks, 'taskboard_order');\n          _this.scope.usTasks = {};\n          ref = _.union(_this.scope.userstories, [\n            {\n              id: null\n            }\n          ]);\n          for (i = 0, len = ref.length; i < len; i++) {\n            us = ref[i];\n            _this.scope.usTasks[us.id] = {};\n            ref1 = _this.scope.taskStatusList;\n            for (j = 0, len1 = ref1.length; j < len1; j++) {\n              status = ref1[j];\n              _this.scope.usTasks[us.id][status.id] = [];\n            }\n          }\n          ref2 = _this.scope.tasks;\n          for (k = 0, len2 = ref2.length; k < len2; k++) {\n            task = ref2[k];\n            if ((_this.scope.usTasks[task.user_story] != null) && (_this.scope.usTasks[task.user_story][task.status] != null)) {\n              _this.scope.usTasks[task.user_story][task.status].push(task);\n            }\n          }\n          if (tasks.length === 0) {\n            if (_this.scope.userstories.length > 0) {\n              usId = _this.scope.userstories[0].id;\n            } else {\n              usId = null;\n            }\n            _this.scope.usTasks[usId][_this.scope.taskStatusList[0].id].push({\n              isPlaceholder: true\n            });\n          }\n          return tasks;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTasksOrder = function(tasks) {\n      var data, items;\n      items = this.resortTasks(tasks);\n      data = this.prepareBulkUpdateData(items);\n      return this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id, data);\n    };\n\n    TaskboardController.prototype.resortTasks = function(tasks) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = tasks.length; i < len; index = ++i) {\n        item = tasks[index];\n        item[\"taskboard_order\"] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    TaskboardController.prototype.prepareBulkUpdateData = function(uses) {\n      return _.map(uses, function(x) {\n        return {\n          \"task_id\": x.id,\n          \"order\": x[\"taskboard_order\"]\n        };\n      });\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, usId, statusId, order) {\n      var promise, r, tasks;\n      r = this.scope.usTasks[task.user_story][task.status].indexOf(task);\n      this.scope.usTasks[task.user_story][task.status].splice(r, 1);\n      tasks = this.scope.usTasks[usId][statusId];\n      tasks.splice(order, 0, task);\n      task.user_story = usId;\n      task.status = statusId;\n      task.taskboard_order = order;\n      promise = this.repo.save(task);\n      this.rootscope.$broadcast(\"sprint:task:moved\", task);\n      promise.then((function(_this) {\n        return function() {\n          _this.refreshTasksOrder(tasks);\n          return _this.loadSprintStats();\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function() {\n          return console.log(\"FAIL TASK SAVE\");\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.editTaskAssignedTo = function(task) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardTaskDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch(\"task\", function(task) {\n        if (task.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!task.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      return $el.find(\".edit-task\").on(\"click\", function(event) {\n        if ($el.find('.edit-task').hasClass('noclick')) {\n          return;\n        }\n        return $scope.$apply(function() {\n          var currentLoading, target, task;\n          target = $(event.target);\n          currentLoading = $loading().target(target).timeout(200).start();\n          task = $scope.task;\n          return $rs.tasks.getByRef(task.project, task.ref).then((function(_this) {\n            return function(editingTask) {\n              return $rs2.attachments.list(\"task\", editingTask.id, editingTask.project).then(function(attachments) {\n                $rootscope.$broadcast(\"taskform:edit\", editingTask, attachments.toJS());\n                return currentLoading.finish();\n              });\n            };\n          })(this));\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardTask\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", TaskboardTaskDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      bindOnce($scope, \"usTasks\", function(project) {\n        $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n        $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n        return recalculateTaskboardWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          tasks = $scope.usTasks[usId][statusId].length;\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            return column.css(\"max-width\", maxColumnWidth);\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n  TaskboardUserDirective = function($log, $translate) {\n    var clickable, link;\n    clickable = false;\n    link = function($scope, $el, $attrs) {\n      var username_label;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      $scope.$watch('task.assigned_to', function(assigned_to) {\n        var user;\n        user = $scope.usersById[assigned_to];\n        if (user === void 0) {\n          _.assign($scope, {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          });\n        } else {\n          _.assign($scope, {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          });\n        }\n        return username_label.text($scope.name);\n      });\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") > -1) {\n          clickable = true;\n          $el.find(\".avatar-assigned-to\").on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl;\n              if ($el.find('a').hasClass('noclick')) {\n                return;\n              }\n              $ctrl = $el.controller();\n              return $ctrl.editTaskAssignedTo($scope.task);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl;\n            if ($el.find('a').hasClass('noclick')) {\n              return;\n            }\n            $ctrl = $el.controller();\n            return $ctrl.editTaskAssignedTo($scope.task);\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"taskboard/taskboard-user.html\",\n      scope: {\n        \"usersById\": \"=users\",\n        \"project\": \"=\",\n        \"task\": \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTaskboardUserAvatar\", [\"$log\", \"$translate\", TaskboardUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"tasks\", function(xx) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!($scope.project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: $el[0],\n          moves: function(item) {\n            return $(item).hasClass('taskboard-task');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, newUsId, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll(containers, {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanUserDirective, KanbanUserstoryDirective, KanbanWipLimitDirective, bindMethods, bindOnce, defaultViewMode, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText, viewModes,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  defaultViewMode = \"maximized\";\n\n  viewModes = [\"maximized\", \"minimized\"];\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, params1, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.scope.statusViewModes = {};\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.refreshTagsColors();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.refreshTagsColors();\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(us) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, us) {\n      var promise;\n      us.assigned_to = userid;\n      promise = this.repo.save(us);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false\n      };\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, us, usByStatus, us_archived;\n          _this.scope.userstories = userstories;\n          usByStatus = _.groupBy(userstories, \"status\");\n          us_archived = [];\n          ref = _this.scope.usStatusList;\n          for (i = 0, len = ref.length; i < len; i++) {\n            status = ref[i];\n            if (usByStatus[status.id] == null) {\n              usByStatus[status.id] = [];\n            }\n            if (_this.scope.usByStatus != null) {\n              ref1 = _this.scope.usByStatus[status.id];\n              for (j = 0, len1 = ref1.length; j < len1; j++) {\n                us = ref1[j];\n                if (us.status !== status.id) {\n                  us_archived.push(us);\n                }\n              }\n            }\n            if (status.is_archived && (_this.scope.usByStatus != null) && _this.scope.usByStatus[status.id].length !== 0) {\n              ref2 = _this.scope.usByStatus[status.id].concat(us_archived);\n              for (k = 0, len2 = ref2.length; k < len2; k++) {\n                us = ref2[k];\n                if (us.status === status.id) {\n                  usByStatus[status.id].push(us);\n                }\n              }\n            }\n            usByStatus[status.id] = _.sortBy(usByStatus[status.id], \"kanban_order\");\n          }\n          if (userstories.length === 0) {\n            status = _this.scope.usStatusList[0];\n            usByStatus[status.id].push({\n              isPlaceholder: true\n            });\n          }\n          _this.scope.usByStatus = usByStatus;\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var params;\n      params = {\n        status: statusId\n      };\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.usByStatus[statusId] = _.sortBy(userstories, \"kanban_order\");\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      this.scope.usByStatus[statusId] = [];\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_kanban_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.projectId = project.id;\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.generateStatusViewModes();\n          _this.scope.$emit(\"project:loaded\", project);\n          return project;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          return _this.loadKanban();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.generateStatusViewModes = function() {\n      var i, len, mode, ref, status, storedStatusViewModes;\n      storedStatusViewModes = this.rs.kanban.getStatusViewModes(this.scope.projectId);\n      this.scope.statusViewModes = {};\n      ref = this.scope.usStatusList;\n      for (i = 0, len = ref.length; i < len; i++) {\n        status = ref[i];\n        mode = storedStatusViewModes[status.id] || defaultViewMode;\n        this.scope.statusViewModes[status.id] = mode;\n      }\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.storeStatusViewModes = function() {\n      return this.rs.kanban.storeStatusViewModes(this.scope.projectId, this.scope.statusViewModes);\n    };\n\n    KanbanController.prototype.updateStatusViewMode = function(statusId, newViewMode) {\n      this.scope.statusViewModes[statusId] = newViewMode;\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.isMaximized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'maximized';\n    };\n\n    KanbanController.prototype.isMinimized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'minimized';\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.resortUserStories = function(uses) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = uses.length; i < len; index = ++i) {\n        item = uses[index];\n        item.kanban_order = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var itemsToSave, promise, r;\n      if (oldStatusId !== newStatusId) {\n        r = this.scope.usByStatus[oldStatusId].indexOf(us);\n        this.scope.usByStatus[oldStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n        us.status = newStatusId;\n      } else {\n        r = this.scope.usByStatus[newStatusId].indexOf(us);\n        this.scope.usByStatus[newStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n      }\n      itemsToSave = this.resortUserStories(this.scope.usByStatus[newStatusId]);\n      this.scope.usByStatus[newStatusId] = _.sortBy(this.scope.usByStatus[newStatusId], \"kanban_order\");\n      promise = this.repo.save(us);\n      promise = promise.then((function(_this) {\n        return function() {\n          var data;\n          itemsToSave = _.reject(itemsToSave, {\n            \"id\": us.id\n          });\n          data = _this.prepareBulkUpdateData(itemsToSave);\n          return _this.rs.userstories.bulkUpdateKanbanOrder(us.project, data).then(function() {\n            return itemsToSave;\n          });\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      $scope[\"class\"] = \"icon-watch\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-watch\";\n            $scope.title = showArchivedText;\n            return $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n          } else {\n            $scope[\"class\"] = \"icon-unwatch\";\n            $scope.title = hideArchivedText;\n            return $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function() {\n        if (userStories.length > 0) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var r;\n        if (status.id === newStatusId) {\n          if (status.id === oldStatusId) {\n            r = userStories.indexOf(itemUs);\n            userStories.splice(r, 1);\n            userStories.splice(itemIndex, 0, itemUs);\n          } else {\n            itemUs.isArchived = true;\n            userStories.splice(itemIndex, 0, itemUs);\n          }\n        } else if (status.id === oldStatusId) {\n          itemUs.isArchived = false;\n          r = userStories.indexOf(itemUs);\n          userStories.splice(r, 1);\n        }\n        return updateIntroText();\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        if (statusId === status.id) {\n          userStories = _.filter(userStoriesLoaded, function(us) {\n            return us.status === status.id;\n          });\n          return updateIntroText();\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          userStories = [];\n          return updateIntroText();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanUserstoryDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch(\"us\", function(us) {\n        if (us.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!us.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      $el.on('click', '.edit-us', function(event) {\n        var currentLoading, target, us;\n        if ($el.find(\".icon-edit\").hasClass(\"noclick\")) {\n          return;\n        }\n        target = $(event.target);\n        currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n        us = $model.$modelValue;\n        return $rs.userstories.getByRef(us.project, us.ref).then((function(_this) {\n          return function(editingUserStory) {\n            return $rs2.attachments.list(\"us\", us.id, us.project).then(function(attachments) {\n              $rootscope.$broadcast(\"usform:edit\", editingUserStory, attachments.toJS());\n              return currentLoading.finish();\n            });\n          };\n        })(this));\n      });\n      $scope.getTemplateUrl = function() {\n        if ($scope.us.isPlaceholder) {\n          return \"common/components/kanban-placeholder.html\";\n        } else {\n          return \"kanban/kanban-task.html\";\n        }\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      template: '<ng-include src=\"getTemplateUrl()\"/>',\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserstory\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", KanbanUserstoryDirective]);\n\n  KanbanSquishColumnDirective = function(rs) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var updateTableWidth;\n      $scope.$on(\"project:loaded\", function(event, project) {\n        $scope.folds = rs.kanban.getStatusColumnModes(project.id);\n        return updateTableWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      return updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return timeout(200, function() {\n            var element;\n            element = $el.find(\".kanban-task\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", KanbanWipLimitDirective);\n\n  KanbanUserDirective = function($log, $compile, $translate) {\n    var clickable, link, template;\n    template = _.template(\"<figure class=\\\"avatar\\\">\\n    <a href=\\\"#\\\" title=\\\"{{'US.ASSIGN' | translate}}\\\" <% if (!clickable) {%>class=\\\"not-clickable\\\"<% } %>>\\n        <img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\" class=\\\"avatar\\\">\\n    </a>\\n</figure>\");\n    clickable = false;\n    link = function($scope, $el, $attrs, $model) {\n      var render, username_label, wtid;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      if (!$attrs.tgKanbanUserAvatar) {\n        return $log.error(\"KanbanUserDirective: no attr is defined\");\n      }\n      wtid = $scope.$watch($attrs.tgKanbanUserAvatar, function(v) {\n        var user;\n        if ($scope.usersById == null) {\n          $log.error(\"KanbanUserDirective requires userById set in scope.\");\n          return wtid();\n        } else {\n          user = $scope.usersById[v];\n          return render(user);\n        }\n      });\n      render = function(user) {\n        var ctx, html;\n        if (user === void 0) {\n          ctx = {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          };\n        } else {\n          ctx = {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          };\n        }\n        html = $compile(template(ctx))($scope);\n        $el.html(html);\n        return username_label.text(ctx.name);\n      };\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          clickable = true;\n          $el.on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl, us;\n              if ($el.find(\"a\").hasClass(\"noclick\")) {\n                return;\n              }\n              us = $model.$modelValue;\n              $ctrl = $el.controller();\n              return $ctrl.changeUsAssignedTo(us);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl, us;\n            if ($el.find(\"a\").hasClass(\"noclick\")) {\n              return;\n            }\n            us = $model.$modelValue;\n            $ctrl = $el.controller();\n            return $ctrl.changeUsAssignedTo(us);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserAvatar\", [\"$log\", \"$compile\", \"$translate\", KanbanUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: tdom[0],\n          moves: function(item) {\n            return $(item).hasClass('kanban-task');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.status, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll(containers, {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\", \"$tgQueueModelTransformation\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate, modelTransform) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issuePriority: ((ref3 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref3.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.issue_statuses;\n          _this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.typeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          _this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.severityList = project.severities;\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = project.priorities;\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          _this.modelTransform.setObject(_this.scope, 'issue');\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadIssue();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(statusId) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.status = statusId;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(type) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.type = type;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.type : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(severity) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.severity = severity;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.severity : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(priority) {\n        var currentLoading, onError, onSuccess, transform;\n        $.fn.popover().closeAll();\n        currentLoading = $loading().target($el.find(\".level-name\")).start();\n        transform = $modelTransform.save(function(issue) {\n          issue.priority = priority;\n          return issue;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.priority : void 0;\n      }, function() {\n        var issue;\n        issue = $model.$modelValue;\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = (function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var attachmentsToAdd, createAttachments, form, resetAttachments, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.attachments = Immutable.List();\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        form.reset();\n        resetAttachments();\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el);\n        return $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          tags: []\n        };\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.issue.project, 'issue');\n        });\n        return $q.all(promises);\n      };\n      attachmentsToAdd = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return $scope.attachments = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            return createAttachments(data);\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$q\", \"tgAttachmentsService\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssuesController, IssuesDirective, IssuesFiltersDirective, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var filters, promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loadIssues = bind(this.loadIssues, this);\n      this.scope.sectionName = \"Issues\";\n      this.scope.filters = {};\n      if (_.isEmpty(this.location.search())) {\n        filters = this.rs.issues.getFilters(this.params.pslug);\n        filters.page = 1;\n        this.location.search(filters);\n        this.location.replace();\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.storeFilters = function() {\n      return this.rs.issues.storeFilters(this.params.pslug, this.location.search());\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_issues_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.severityList = _.sortBy(project.severities, \"order\");\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n          _this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\", \"tags\", \"status\", \"types\", \"q\", \"severities\", \"priorities\", \"assignedTo\", \"createdBy\", \"orderBy\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    IssuesController.prototype.getUrlFilter = function(name) {\n      var filters;\n      filters = _.pick(this.location.search(), name);\n      return filters[name];\n    };\n\n    IssuesController.prototype.loadMyFilters = function() {\n      return this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          return _.map(filters, function(value, key) {\n            return {\n              id: key,\n              name: key,\n              type: \"myFilters\",\n              selected: false\n            };\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.removeNotExistingFiltersFromUrl = function() {\n      var currentSearch, existingValues, filterName, filterValue, splittedValues, urlfilters;\n      currentSearch = this.location.search();\n      urlfilters = this.getUrlFilters();\n      for (filterName in urlfilters) {\n        filterValue = urlfilters[filterName];\n        if (filterName === \"page\" || filterName === \"orderBy\" || filterName === \"q\") {\n          continue;\n        }\n        if (filterName === \"tags\") {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"));\n        } else {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"), function(x) {\n            if (x === \"null\") {\n              return null;\n            } else {\n              return parseInt(x);\n            }\n          });\n        }\n        existingValues = _.intersection(splittedValues, _.map(this.scope.filters[filterName], \"id\"));\n        if (splittedValues.length !== existingValues.length) {\n          this.location.search(filterName, existingValues.join());\n        }\n      }\n      if (currentSearch !== this.location.search()) {\n        return this.location.replace();\n      }\n    };\n\n    IssuesController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref, ref1, results, searchdata, val, value;\n      searchdata = {};\n      ref = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref) {\n        value = ref[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref1 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref1.length; j < len; j++) {\n          val = ref1[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var k, len1, results1;\n          results1 = [];\n          for (k = 0, len1 = value.length; k < len1; k++) {\n            obj = value[k];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    IssuesController.prototype.loadFilters = function() {\n      var loadFilters, promise, urlfilters;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = urlfilters.q;\n      }\n      promise = this.loadMyFilters().then((function(_this) {\n        return function(myFilters) {\n          _this.scope.filters.myFilters = myFilters;\n          return myFilters;\n        };\n      })(this));\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.types = urlfilters.types;\n      loadFilters.severities = urlfilters.severities;\n      loadFilters.priorities = urlfilters.priorities;\n      loadFilters.assigned_to = urlfilters.assignedTo;\n      loadFilters.owner = urlfilters.createdBy;\n      promise = promise.then((function(_this) {\n        return function() {\n          return _this.rs.issues.filtersData(loadFilters);\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, tagsFilterFormat, usersFiltersFormat;\n          usersFiltersFormat = function(users, type, unknownOption) {\n            var reformatedUsers, unknownItem;\n            reformatedUsers = _.map(users, function(t) {\n              t.type = type;\n              t.name = t.full_name ? t.full_name : unknownOption;\n              return t;\n            });\n            unknownItem = _.remove(reformatedUsers, function(u) {\n              return !u.id;\n            });\n            reformatedUsers = _.sortBy(reformatedUsers, function(u) {\n              return u.name.toUpperCase();\n            });\n            if (unknownItem.length > 0) {\n              reformatedUsers.unshift(unknownItem[0]);\n            }\n            return reformatedUsers;\n          };\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.issueStatusById);\n          _this.scope.filters.severities = choicesFiltersFormat(data.severities, \"severities\", _this.scope.severityById);\n          _this.scope.filters.priorities = choicesFiltersFormat(data.priorities, \"priorities\", _this.scope.priorityById);\n          _this.scope.filters.assignedTo = usersFiltersFormat(data.assigned_to, \"assignedTo\", \"Unassigned\");\n          _this.scope.filters.createdBy = usersFiltersFormat(data.owners, \"createdBy\", \"Unknown\");\n          _this.scope.filters.types = choicesFiltersFormat(data.types, \"types\", _this.scope.issueTypeById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          _this.removeNotExistingFiltersFromUrl();\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rootscope.$broadcast(\"filters:loaded\", _this.scope.filters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var name, promise, ref, values;\n      this.scope.urlFilters = this.getUrlFilters();\n      this.scope.httpParams = {};\n      ref = this.scope.urlFilters;\n      for (name in ref) {\n        values = ref[name];\n        if (name === \"severities\") {\n          name = \"severity\";\n        } else if (name === \"orderBy\") {\n          name = \"order_by\";\n        } else if (name === \"priorities\") {\n          name = \"priority\";\n        } else if (name === \"assignedTo\") {\n          name = \"assigned_to\";\n        } else if (name === \"createdBy\") {\n          name = \"owner\";\n        } else if (name === \"status\") {\n          name = \"status\";\n        } else if (name === \"types\") {\n          name = \"type\";\n        }\n        this.scope.httpParams[name] = values;\n      }\n      promise = this.rs.issues.list(this.scope.projectId, this.scope.httpParams);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.loadFilters();\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCurrentFiltersTo = function(newFilter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          filters[newFilter] = _this.location.search();\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.deleteMyFilter = function(filter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          delete filters[filter];\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon;\n      currentOrder = $ctrl.getUrlFilter(\"orderBy\") || \"created_date\";\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        colHeadElement.html((colHeadElement.html()) + \"<span class='icon \" + icon + \"'></span>\");\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getUrlFilter(\"orderBy\");\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"orderBy\", finalOrder);\n          $ctrl.storeFilters();\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > span.icon\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n            return target.html((target.html()) + \"<span class='icon \" + icon + \"'></span>\");\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssuesFiltersDirective = function($q, $log, $location, $rs, $confirm, $loading, $template, $translate, $compile, $auth) {\n    var link, template, templateSelected;\n    template = $template.get(\"issue/issues-filters.html\", true);\n    templateSelected = $template.get(\"issue/issues-filters-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, getFiltersType, initializeSelectedFilters, reloadIssues, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection, unwatchIssues;\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\".breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 .subfilter .title\").html(title);\n        return $el.find(\"h2 .subfilter .title\").prop(\"data-type\", type);\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\".breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function(filters) {\n        var j, len, name, val, values;\n        selectedFilters = [];\n        for (name in filters) {\n          values = filters[name];\n          for (j = 0, len = values.length; j < len; j++) {\n            val = values[j];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters(selectedFilters);\n      };\n      renderSelectedFilters = function(selectedFilters) {\n        var html;\n        _.filter(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        $el.find(\".filters-applied\").html(html);\n        if ($auth.isAuthenticated() && selectedFilters.length > 0) {\n          return $el.find(\".save-filters\").show();\n        } else {\n          return $el.find(\".save-filters\").hide();\n        }\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.filter(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\".subfilter .title\").prop('data-type');\n      };\n      reloadIssues = function() {\n        var currentFiltersType;\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadIssues(), $ctrl.loadFilters()]).then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(filters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var currentFiltersType, filter, filterId, filters;\n        if (type === \"myFilters\") {\n          $rs.issues.getMyFilters($scope.projectId).then(function(data) {\n            var filters, myFilters;\n            myFilters = data;\n            filters = myFilters[id];\n            filters.page = 1;\n            $ctrl.replaceAllFilters(filters);\n            $ctrl.storeFilters();\n            $ctrl.loadIssues();\n            $ctrl.markSelectedFilters($scope.filters, filters);\n            return initializeSelectedFilters($scope.filters);\n          });\n          return null;\n        }\n        filters = $scope.filters[type];\n        filterId = type === 'tags' ? taiga.toString(id) : id;\n        filter = _.find(filters, {\n          id: filterId\n        });\n        filter.selected = !filter.selected;\n        if (id === null) {\n          id = \"null\";\n        }\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $ctrl.selectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(f) {\n            return f.id === filter.id && f.type === filter.type;\n          });\n          $ctrl.unselectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        }\n        reloadIssues();\n        renderSelectedFilters(selectedFilters);\n        currentFiltersType = getFiltersType();\n        if (type === currentFiltersType) {\n          return renderFilters(_.reject(filters, \"selected\"));\n        }\n      };\n      $scope.$on(\"filters:loaded\", function(ctx, filters) {\n        return initializeSelectedFilters(filters);\n      });\n      $scope.$on(\"filters:issueupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.status\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      selectQFilter = debounceLeading(100, function(value, oldValue) {\n        if (value === void 0 || value === oldValue) {\n          return;\n        }\n        $ctrl.replaceFilter(\"page\", null, true);\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n          $ctrl.storeFilters();\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n          $ctrl.storeFilters();\n        }\n        return reloadIssues();\n      });\n      unwatchIssues = $scope.$watch(\"issues\", function(newValue) {\n        if (!_.isUndefined(newValue)) {\n          $scope.$watch(\"filtersQ\", selectQFilter);\n          return unwatchIssues();\n        }\n      });\n      $el.on(\"click\", \".filters-cat-single\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data(\"type\"));\n      });\n      $el.on(\"click\", \".back\", function(event) {\n        event.preventDefault();\n        return showCategories($el);\n      });\n      $el.on(\"click\", \".filters-applied .remove-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget).parent();\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"active\");\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        if (type === \"myFilters\") {\n          target.removeClass(\"active\");\n        }\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .remove-filter\", function(event) {\n        var customFilterName, message, target, title;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        customFilterName = target.parent().data('id');\n        title = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.TITLE\");\n        message = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE\", {\n          customFilterName: customFilterName\n        });\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var promise;\n          promise = $ctrl.deleteMyFilter(customFilterName);\n          promise.then(function() {\n            promise = $ctrl.loadMyFilters();\n            promise.then(function(filters) {\n              askResponse.finish();\n              $scope.filters.myFilters = filters;\n              return renderFilters($scope.filters.myFilters);\n            });\n            return promise.then(null, function() {\n              return askResponse.finish();\n            });\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return $confirm.notify(\"error\");\n          });\n        });\n      });\n      $el.on(\"click\", \".save-filters\", function(event) {\n        event.preventDefault();\n        renderFilters($scope.filters[\"myFilters\"]);\n        showFilters(\"My filters\", \"myFilters\");\n        $el.find('.save-filters').hide();\n        $el.find('.my-filter-name').removeClass(\"hidden\");\n        $el.find('.my-filter-name').focus();\n        return $scope.$apply();\n      });\n      return $el.on(\"keyup\", \".my-filter-name\", function(event) {\n        var currentLoading, newFilter, promise, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newFilter = target.val();\n          currentLoading = $loading().target($el.find(\".new\")).start();\n          promise = $ctrl.saveCurrentFiltersTo(newFilter);\n          promise.then(function() {\n            var loadPromise;\n            loadPromise = $ctrl.loadMyFilters();\n            loadPromise.then(function(filters) {\n              var currentfilterstype;\n              currentLoading.finish();\n              $scope.filters.myFilters = filters;\n              currentfilterstype = $el.find(\"h2 .subfilter .title\").prop('data-type');\n              if (currentfilterstype === \"myFilters\") {\n                renderFilters($scope.filters.myFilters);\n              }\n              $el.find('.my-filter-name').addClass(\"hidden\");\n              return $el.find('.save-filters').show();\n            });\n            return loadPromise.then(null, function() {\n              currentLoading.finish();\n              return $confirm.notify(\"error\", \"Error loading custom filters\");\n            });\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            $el.find(\".my-filter-name\").val(newFilter).focus().select();\n            return $confirm.notify(\"error\", \"Filter not saved\");\n          });\n        } else if (event.keyCode === 27) {\n          $el.find('.my-filter-name').val('');\n          $el.find('.my-filter-name').addClass(\"hidden\");\n          return $el.find('.save-filters').show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssuesFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", \"$compile\", \"$tgAuth\", IssuesFiltersDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.status;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.status) {\n            filter.count--;\n          }\n        }\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.status;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.status) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:issueupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        if (member) {\n          ctx.name = member.full_name_display;\n          ctx.imgurl = member.photo;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgQueueModelTransformation\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, modelTransform) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.scope.us.description_html || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          var allClosed;\n          _this.scope.tasks = _.clone(_this.scope.tasks, false);\n          allClosed = _.every(_this.scope.tasks, function(task) {\n            return task.is_closed;\n          });\n          if (_this.scope.us.is_closed !== allClosed) {\n            return _this.loadUs();\n          }\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.us_statuses;\n          _this.scope.statusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(_this.scope.pointsList, function(e) {\n            return e.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          var ctx, ref, ref1;\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          _this.modelTransform.setObject(_this.scope, 'us');\n          if (((ref = _this.scope.us.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.us.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadUs().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          $el.html(html);\n          return $compile($el.contents())($scope);\n        };\n      })(this);\n      save = (function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, transform;\n          $el.find(\".pop-status\").popover().close();\n          currentLoading = $loading().target($el.find('.js-edit-status')).start();\n          transform = $modelTransform.save(function(us) {\n            us.status = status;\n            return us;\n          });\n          onSuccess = function() {\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return transform.then(onSuccess, onError);\n        };\n      })(this);\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = function(team_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.team_requirement = team_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.team_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(client_requirement) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find(\"label\")).start();\n        transform = $modelTransform.save(function(us) {\n          us.client_requirement = client_requirement;\n          return us;\n        });\n        transform.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          };\n        })(this));\n        return transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n      };\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.client_requirement : void 0;\n      }, function() {\n        var us;\n        us = $model.$modelValue;\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", \"$tgQueueModelTransformation\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate, modelTransform) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.modelTransform = modelTransform;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.task_statuses;\n          _this.scope.statusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          _this.modelTransform.setObject(_this.scope, 'task');\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadTask().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $modelTransform, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"common/components/status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = function(status) {\n        var currentLoading, onError, onSuccess, transform;\n        currentLoading = $loading().target($el).start();\n        transform = $modelTransform.save(function(task) {\n          task.status = status;\n          return task;\n        });\n        onSuccess = function() {\n          $rootScope.$broadcast(\"object:updated\");\n          return currentLoading.finish();\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          return currentLoading.finish();\n        };\n        return transform.then(onSuccess, onError);\n      };\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.status : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $modelTransform, $compile, $template) {\n    var link, template;\n    template = $template.get(\"issue/iocaine-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = function(is_iocaine) {\n        var currentLoading, transform;\n        currentLoading = $loading().target($el.find('label')).start();\n        transform = $modelTransform.save(function(task) {\n          task.is_iocaine = is_iocaine;\n          return task;\n        });\n        transform.then(function() {\n          return $rootscope.$broadcast(\"object:updated\");\n        });\n        transform.then(null, function() {\n          return $confirm.notify(\"error\");\n        });\n        return transform[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      };\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch(function() {\n        var ref;\n        return (ref = $model.$modelValue) != null ? ref.is_iocaine : void 0;\n      }, function() {\n        var task;\n        task = $model.$modelValue;\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQueueModelTransformation\", \"$compile\", \"$tgTemplate\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issuesEnabled = project.is_issues_activated;\n          _this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n          _this.scope.wikiEnabled = project.is_wiki_activated;\n          _this.scope.owner = project.owner.id;\n          return project;\n        };\n      })(this));\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var key, max, min, singleStat, value;\n      max = _.max(_.toArray(stat));\n      min = _.min(_.toArray(stat));\n      singleStat = Object();\n      for (key in stat) {\n        if (!hasProp.call(stat, key)) continue;\n        value = stat[key];\n        if (value === min) {\n          singleStat[key] = 0.1;\n        } else if (value === max) {\n          singleStat[key] = 1;\n        } else {\n          singleStat[key] = (value * 0.5) / max;\n        }\n      }\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          var userRoles;\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.loadMembers();\n          userRoles = _.map(_this.scope.users, function(user) {\n            return user.role;\n          });\n          _this.scope.roles = _.filter(_this.scope.roles, function(role) {\n            return userRoles.indexOf(role.id) !== -1;\n          });\n          return _this.loadMemberStats();\n        };\n      })(this));\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        project: \"=project\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate, lightboxFactory, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var leaveConfirm;\n      leaveConfirm = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($scope.project.id);\n            promise.then(function() {\n              return currentUserService.loadProjects().then(function() {\n                response.finish();\n                $confirm.notify(\"success\");\n                return $location.path($navurls.resolve(\"home\"));\n              });\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n      return $scope.leave = function() {\n        if ($scope.project.owner.id === $scope.user.id) {\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: true,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      };\n    };\n    return {\n      scope: {\n        user: \"=\",\n        project: \"=\"\n      },\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var EditableWikiContentDirective, WikiDetailController, WikiSummaryDirective, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiTitle,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(((ref = this.scope.wiki) != null ? ref.html : void 0) || \"\").text(),\n        totalEditions: ((ref1 = this.scope.wiki) != null ? ref1.editions : void 0) || 0,\n        lastModifiedDate: moment((ref2 = this.scope.wiki) != null ? ref2.modified_date : void 0).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var i, len, link, ref, selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          ref = _this.scope.wikiLinks;\n          for (i = 0, len = ref.length; i < len; i++) {\n            link = ref[i];\n            link.url = _this.navUrls.resolve(\"project-wiki-page\", {\n              project: _this.scope.projectSlug,\n              slug: link.href\n            });\n          }\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWiki()]).then(_this.checkLinksPerms.bind(_this));\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"modify_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiTitle;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            return _this.confirm.notify(\"success\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            imgUrl: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            imgUrl: user.photo\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiSummaryDirective]);\n\n  EditableWikiContentDirective = function($window, $document, $repo, $confirm, $loading, $analytics, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, disableEdition, getSelectedText, isEditable, save, switchToEditMode, switchToReadMode;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      };\n      switchToEditMode = function() {\n        $el.find('.edit-wiki-content').show();\n        $el.find('.view-wiki-content').hide();\n        return $el.find('textarea').focus();\n      };\n      switchToReadMode = function() {\n        $el.find('.edit-wiki-content').hide();\n        return $el.find('.view-wiki-content').show();\n      };\n      disableEdition = function() {\n        $el.find(\".view-wiki-content .edit\").remove();\n        return $el.find(\".edit-wiki-content\").remove();\n      };\n      cancelEdition = function() {\n        if (!$model.$modelValue.id) {\n          return;\n        }\n        $model.$modelValue.revert();\n        return switchToReadMode();\n      };\n      getSelectedText = function() {\n        if ($window.getSelection) {\n          return $window.getSelection().toString();\n        } else if ($document.selection) {\n          return $document.selection.createRange().text;\n        }\n        return null;\n      };\n      save = $qqueue.bindAdd(function(wiki) {\n        var currentLoading, onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if (wiki.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n          }\n          $model.$setViewValue(wikiPage.clone());\n          $confirm.notify(\"success\");\n          return switchToReadMode();\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        currentLoading = $loading().removeClasses(\"icon-floppy\").target($el.find('.icon-floppy')).start();\n        if (wiki.id != null) {\n          promise = $repo.save(wiki).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", wiki).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.currentTarget);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"mousedown\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (event.button === 2) {\n\n        }\n      });\n      $el.on(\"mouseup\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (getSelectedText()) {\n          return;\n        }\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if (target.is('pre')) {\n          return;\n        }\n        return switchToEditMode();\n      });\n      $el.on(\"click\", \".save\", debounce(2000, function() {\n        return save($scope.wiki);\n      }));\n      $el.on(\"click\", \".cancel\", function() {\n        return $scope.$apply(cancelEdition);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode !== 27) {\n          return;\n        }\n        return $scope.$applyAsync(function() {\n          var message, title;\n          title = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE\");\n          message = $translate.instant(\"COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE\");\n          return $confirm.ask(title, null, message).then(function(askResponse) {\n            cancelEdition();\n            return askResponse.finish();\n          });\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        if (isEditable()) {\n          $el.addClass('editable');\n          if ((wikiPage.id == null) || $.trim(wikiPage.content).length === 0) {\n            return switchToEditMode();\n          }\n        } else {\n          return disableEdition();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      templateUrl: \"wiki/editable-wiki-content.html\"\n    };\n  };\n\n  module.directive(\"tgEditableWikiContent\", [\"$window\", \"$document\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", \"$tgQqueue\", \"$translate\", EditableWikiContentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $analytics, $loading, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      render = function(wikiLinks) {\n        var addWikiLinkPermission, deleteWikiLinkPermission, html;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        $el.html(html);\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".js-delete-link\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var ChangeOwnerLightboxController, ChangeOwnerLightboxDirective, LbRequestOwnershipDirective, LightboxAddMembersController, LightboxAddMembersDirective, LightboxAddMembersWarningMessageDirective, TransferProjectStartSuccessDirective, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  LightboxAddMembersController = (function() {\n    LightboxAddMembersController.$inject = [\"$scope\", \"lightboxService\", \"tgLoader\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\"];\n\n    function LightboxAddMembersController(scope1, lightboxService1, tgLoader, confirm, rs1, rootScope) {\n      var pendingMembersCount;\n      this.scope = scope1;\n      this.lightboxService = lightboxService1;\n      this.tgLoader = tgLoader;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rootScope = rootScope;\n      this._defaultMaxInvites = 4;\n      this._defaultRole = this.project.roles[0].id;\n      this.form = null;\n      this.submitInvites = false;\n      this.canAddUsers = true;\n      this.memberInvites = [];\n      if (this.project.max_memberships === null) {\n        this.membersLimit = this._defaultMaxInvites;\n      } else {\n        pendingMembersCount = Math.max(this.project.max_memberships - this.project.total_memberships, 0);\n        this.membersLimit = Math.min(pendingMembersCount, this._defaultMaxInvites);\n      }\n      this.addSingleMember();\n    }\n\n    LightboxAddMembersController.prototype.addSingleMember = function() {\n      this.memberInvites.push({\n        email: '',\n        role_id: this._defaultRole\n      });\n      if (this.memberInvites.length >= this.membersLimit) {\n        this.canAddUsers = false;\n      }\n      return this.showWarningMessage = !this.canAddUsers && this.project.total_memberships + this.memberInvites.length === this.project.max_memberships;\n    };\n\n    LightboxAddMembersController.prototype.removeSingleMember = function(index) {\n      this.memberInvites.splice(index, 1);\n      this.canAddUsers = true;\n      return this.showWarningMessage = this.membersLimit === 1;\n    };\n\n    LightboxAddMembersController.prototype.submit = function() {\n      var promise;\n      this.form.initializeFields();\n      this.form.reset();\n      if (!this.form.validate()) {\n        return;\n      }\n      this.memberInvites = _.filter(this.memberInvites, function(invites) {\n        return invites.email !== \"\";\n      });\n      this.submitInvites = true;\n      promise = this.rs.memberships.bulkCreateMemberships(this.project.id, this.memberInvites, this.invitationText);\n      return promise.then(this._onSuccessInvite.bind(this), this._onErrorInvite.bind(this));\n    };\n\n    LightboxAddMembersController.prototype._onSuccessInvite = function() {\n      this.submitInvites = false;\n      this.rootScope.$broadcast(\"membersform:new:success\");\n      this.lightboxService.closeAll();\n      return this.confirm.notify(\"success\");\n    };\n\n    LightboxAddMembersController.prototype._onErrorInvite = function(response) {\n      this.submitInvites = false;\n      this.form.setErrors(response.data);\n      if (response.data._error_message) {\n        return this.confirm.notify(\"error\", response.data._error_message);\n      }\n    };\n\n    return LightboxAddMembersController;\n\n  })();\n\n  module.controller(\"LbAddMembersController\", LightboxAddMembersController);\n\n  LightboxAddMembersDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      lightboxService.open(el);\n      return ctrl.form = el.find(\"form\").checksley();\n    };\n    return {\n      scope: {},\n      bindToController: {\n        project: '='\n      },\n      controller: 'LbAddMembersController',\n      controllerAs: 'vm',\n      templateUrl: 'admin/lightbox-add-members.html',\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAddMembers\", [\"lightboxService\", LightboxAddMembersDirective]);\n\n  LightboxAddMembersWarningMessageDirective = function() {\n    return {\n      templateUrl: \"admin/lightbox-add-members-no-more=memberships-warning-message.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgLightboxAddMembersWarningMessage\", [LightboxAddMembersWarningMessageDirective]);\n\n  LbRequestOwnershipDirective = function(lightboxService, rs, confirmService, $translate) {\n    return {\n      link: function(scope, el) {\n        lightboxService.open(el);\n        return scope.request = function() {\n          scope.loading = true;\n          return rs.projects.transferRequest(scope.projectId).then(function() {\n            scope.loading = false;\n            lightboxService.close(el);\n            return confirmService.notify(\"success\", $translate.instant(\"ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS\"));\n          });\n        };\n      },\n      templateUrl: \"common/lightbox/lightbox-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgLbRequestOwnership', [\"lightboxService\", \"tgResources\", \"$tgConfirm\", \"$translate\", LbRequestOwnershipDirective]);\n\n  ChangeOwnerLightboxController = (function() {\n    function ChangeOwnerLightboxController(rs1, lightboxService1, confirm, translate) {\n      this.rs = rs1;\n      this.lightboxService = lightboxService1;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.users = [];\n      this.q = \"\";\n      this.commentOpen = false;\n    }\n\n    ChangeOwnerLightboxController.prototype.limit = 3;\n\n    ChangeOwnerLightboxController.prototype.normalizeString = function(normalizedString) {\n      normalizedString = normalizedString.replace(\"Á\", \"A\").replace(\"Ä\", \"A\").replace(\"À\", \"A\");\n      normalizedString = normalizedString.replace(\"É\", \"E\").replace(\"Ë\", \"E\").replace(\"È\", \"E\");\n      normalizedString = normalizedString.replace(\"Í\", \"I\").replace(\"Ï\", \"I\").replace(\"Ì\", \"I\");\n      normalizedString = normalizedString.replace(\"Ó\", \"O\").replace(\"Ö\", \"O\").replace(\"Ò\", \"O\");\n      normalizedString = normalizedString.replace(\"Ú\", \"U\").replace(\"Ü\", \"U\").replace(\"Ù\", \"U\");\n      return normalizedString;\n    };\n\n    ChangeOwnerLightboxController.prototype.filterUsers = function(user) {\n      var text, username;\n      username = user.full_name_display.toUpperCase();\n      username = this.normalizeString(username);\n      text = this.q.toUpperCase();\n      text = this.normalizeString(text);\n      return _.includes(username, text);\n    };\n\n    ChangeOwnerLightboxController.prototype.getUsers = function() {\n      var users;\n      if (!this.users.length && !this.q.length) {\n        users = this.activeUsers;\n      } else {\n        users = this.users;\n      }\n      users = users.slice(0, this.limit);\n      users = _.reject(users, {\n        \"selected\": true\n      });\n      return _.reject(users, {\n        \"id\": this.currentOwnerId\n      });\n    };\n\n    ChangeOwnerLightboxController.prototype.userSearch = function() {\n      this.users = this.activeUsers;\n      this.selected = _.find(this.users, {\n        \"selected\": true\n      });\n      if (this.q) {\n        return this.users = _.filter(this.users, this.filterUsers.bind(this));\n      }\n    };\n\n    ChangeOwnerLightboxController.prototype.selectUser = function(user) {\n      this.activeUsers = _.map(this.activeUsers, function(user) {\n        user.selected = false;\n        return user;\n      });\n      user.selected = true;\n      return this.userSearch();\n    };\n\n    ChangeOwnerLightboxController.prototype.submit = function() {\n      this.loading = true;\n      return this.rs.projects.transferStart(this.projectId, this.selected.id, this.comment).then((function(_this) {\n        return function() {\n          var desc, title;\n          _this.loading = false;\n          _this.lightboxService.closeAll();\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE\");\n          desc = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC\");\n          return _this.confirm.success(title, desc, {\n            type: \"svg\",\n            name: \"icon-speak-up\"\n          });\n        };\n      })(this));\n    };\n\n    return ChangeOwnerLightboxController;\n\n  })();\n\n  ChangeOwnerLightboxController.$inject = [\"tgResources\", \"lightboxService\", \"$tgConfirm\", \"$translate\"];\n\n  module.controller('ChangeOwnerLightbox', ChangeOwnerLightboxController);\n\n  ChangeOwnerLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function(scope, el) {\n      return lightboxService.open(el);\n    };\n    return {\n      scope: true,\n      controller: \"ChangeOwnerLightbox\",\n      controllerAs: \"vm\",\n      bindToController: {\n        currentOwnerId: \"=\",\n        projectId: \"=\",\n        activeUsers: \"=\"\n      },\n      templateUrl: \"common/lightbox/lightbox-change-owner.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbChangeOwner\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", ChangeOwnerLightboxDirective]);\n\n  TransferProjectStartSuccessDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el) {\n      scope.close = function() {\n        return lightboxService.close(el);\n      };\n      return lightboxService.open(el);\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-transfer-project-start-success.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbTransferProjectStartSuccess\", [\"lightboxService\", TransferProjectStartSuccessDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, NoMoreMembershipsExplanationDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgLightboxFactory\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate, auth, lightboxFactory1) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.auth = auth;\n      this.lightboxFactory = lightboxFactory1;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadInitialData();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.canAddUsers = project.max_memberships === null || project.max_memberships > project.total_memberships;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function() {\n          return _this.q.all([_this.loadMembers(), _this.auth.refresh()]);\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.lightboxFactory.create('tg-lb-add-members', {\n        \"class\": \"lightbox lightbox-add-member\",\n        \"project\": \"project\"\n      }, {\n        \"project\": this.scope.project\n      });\n    };\n\n    MembershipsController.prototype.showLimitUsersWarningMessage = function() {\n      var icon, message, title;\n      title = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING\");\n      message = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE\", {\n        members: this.scope.project.max_memberships\n      });\n      icon = \"/\" + window._version + \"/svg/icons/team-question.svg\";\n      return this.confirm.success(title, message, {\n        name: icon,\n        type: \"img\"\n      });\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate, $compile) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: member.photo ? member.photo : \"/\" + window._version + \"/images/unnamed.png\",\n          pending: !member.is_user_active ? pending : \"\",\n          isOwner: member.is_owner\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', \"$compile\", MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      if (member.is_owner) {\n        $el.find(\".js-check\").remove();\n        return;\n      }\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_admin);\n            return $confirm.notify(\"error\", data.is_admin[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_admin = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      html = render(member);\n      if (member.is_admin) {\n        return $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate, $location, $navUrls, lightboxFactory) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, leaveConfirm, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      leaveConfirm = function() {\n        var defaultMsg, message, title;\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if (member.user !== $scope.user.id) {\n                if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                  $ctrl.selectFilter(\"page\", $scope.page - 1);\n                }\n                $ctrl.loadInitialData();\n              } else {\n                $location.path($navUrls.resolve(\"home\"));\n              }\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"success\", text, null, 5000);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      };\n      $el.on(\"click\", \".delete\", function(event) {\n        var isCurrentUser;\n        event.preventDefault();\n        if ($scope.project.owner.id === member.user) {\n          isCurrentUser = $scope.user.id === member.user;\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: isCurrentUser,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgLightboxFactory\", MembershipsRowActionsDirective]);\n\n  NoMoreMembershipsExplanationDirective = function() {\n    return {\n      templateUrl: \"admin/no-more-memberships-explanation.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgNoMoreMembershipsExplanation\", [NoMoreMembershipsExplanationDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var AdminProjectChangeOwnerDirective, AdminProjectRequestOwnershipDirective, AdminProjectRestrictionsDirective, CsvExporterController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectLogoDirective, ProjectLogoModelDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgCurrentUserService\"];\n\n    function ProjectProfileController(scope1, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, tgAuth, currentUserService1) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.tgAuth = tgAuth;\n      this.currentUserService = currentUserService1;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          _this.appMetaService.setAll(title, description);\n          return _this.fillUsersAndRoles(_this.scope.project.members, _this.scope.project.roles);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n          _this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n          _this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      return this.q.all([this.loadProject(), this.tgAuth.refresh()]);\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            $ctrl.loadInitialData();\n            projectService.fetchProject();\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var form, promise;\n          form = $el.find(\"form\").checksley();\n          form.initializeFields();\n          form.reset();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            $scope.$emit(\"project:loaded\", $scope.project);\n            $confirm.notify(\"success\");\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this);\n      $el.on(\"change\", \".module-activation.module-direct-active input\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"keydown\", \".videoconference-attributes input\", function(e) {\n        return e.which !== 32;\n      });\n      $scope.$watch(\"project.videoconferences\", function(newVal, oldVal) {\n        if ((newVal != null) && (oldVal != null) && newVal !== oldVal) {\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(newValue, oldValue) {\n        if (newValue === false) {\n          $scope.project.videoconferences = null;\n          $scope.project.videoconferences_extra_data = \"\";\n          if (oldValue === true) {\n            return submit();\n          }\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope1, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n  ProjectLogoDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").addClass(\"active\");\n      };\n      onSuccess = function(response) {\n        var project;\n        project = $model.make_model(\"projects\", response.data);\n        $scope.project = project;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-logo\", function() {\n        return $el.find(\"#logo-field\").click();\n      });\n      $el.on(\"change\", \"#logo-field\", function(event) {\n        if ($scope.logoAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.projects.changeLogo($scope.project.id, $scope.logoAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-default-logo\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.projects.removeLogo($scope.project.id).then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectLogo\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", ProjectLogoDirective]);\n\n  ProjectLogoModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgProjectLogoModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgProjectLogoModel', ['$parse', ProjectLogoModelDirective]);\n\n  AdminProjectRestrictionsDirective = function() {\n    return {\n      scope: {\n        \"project\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-restrictions.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRestrictions', [AdminProjectRestrictionsDirective]);\n\n  AdminProjectRequestOwnershipDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.requestOwnership = function() {\n          return lightboxFactory.create(\"tg-lb-request-ownership\", {\n            \"class\": \"lightbox lightbox-request-ownership\"\n          }, {\n            projectId: scope.projectId\n          });\n        };\n      },\n      scope: {\n        \"projectId\": \"=\",\n        \"owner\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRequestOwnership', [\"tgLightboxFactory\", AdminProjectRequestOwnershipDirective]);\n\n  AdminProjectChangeOwnerDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.changeOwner = function() {\n          return lightboxFactory.create(\"tg-lb-change-owner\", {\n            \"class\": \"lightbox lightbox-select-user\",\n            \"project-id\": \"projectId\",\n            \"active-users\": \"activeUsers\",\n            \"current-owner-id\": \"currentOwnerId\"\n          }, {\n            projectId: scope.projectId,\n            activeUsers: scope.activeUsers,\n            currentOwnerId: scope.owner.id,\n            members: scope.members\n          });\n        };\n      },\n      scope: {\n        \"activeUsers\": \"=\",\n        \"projectId\": \"=\",\n        \"owner\": \"=\",\n        \"members\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-change-owner.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectChangeOwner', [\"tgLightboxFactory\", AdminProjectChangeOwnerDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      this.rootscope.$on(\"project:loaded\", this.loadValues);\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.maxBy(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      drake = dragula([tdom[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: tdom[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemIndex, itemValue;\n        itemEl = $(item);\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return drake.destroy();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            return row.siblings(\".visualization\").removeClass('hidden');\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".edition input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $el.find(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = {};\n      this.rootscope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          _this.loadCustomAttributes();\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          var ref;\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = (ref = _.maxBy(customAttributes, \"order\")) != null ? ref.order : void 0;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, drake, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      drake = dragula([sortableEl[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: sortableEl[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = $(item);\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n            return point.computable;\n          }));\n          return project;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadRoles();\n        };\n      })(this));\n      return promise;\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.loadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.loadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.loadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      return this.confirm.ask(title, subtitle, \"\").then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \".edit-value\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.maxBy($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<tg-svg svg-icon=\\\"icon-arrow-right\\\"></tg-svg>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          target.toggleClass(\"open-drawer\");\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadWebhooks();\n        };\n      })(this));\n      return promise;\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.toPairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\");\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\");\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          initializeNewValue();\n          if ($scope.webhooks.length >= 1) {\n            return formDOMNode.addClass(\"hidden\");\n          }\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n}).call(this);\n\n(function() {\n  var createProjectRestrictionDirective, module;\n\n  module = angular.module(\"taigaProject\");\n\n  createProjectRestrictionDirective = function() {\n    return {\n      templateUrl: \"project/wizard-restrictions.html\"\n    };\n  };\n\n  module.directive('tgCreateProjectRestriction', [createProjectRestrictionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var CreateProject, DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  CreateProject = function($rootscope, $repo, $confirm, $location, $navurls, $rs, $projectUrl, $loading, lightboxService, $cacheFactory, $translate, currentUserService, $auth) {\n    var directive, link;\n    link = function($scope, $el, attrs) {\n      var currentLoading, form, onErrorSubmit, onSuccessSubmit, openLightbox, submit, submitButton;\n      $scope.data = {};\n      $scope.templates = [];\n      currentLoading = null;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      onSuccessSubmit = function(response) {\n        $cacheFactory.get('$http').removeAll();\n        currentLoading.finish();\n        $rootscope.$broadcast(\"projects:reload\");\n        $confirm.notify(\"success\", $translate.instant(\"COMMON.SAVE\"));\n        $location.url($projectUrl.get(response));\n        lightboxService.close($el);\n        return currentUserService.loadProjects();\n      };\n      onErrorSubmit = function(response) {\n        var error_field, i, len, ref, results, selectors;\n        currentLoading.finish();\n        form.setErrors(response);\n        selectors = [];\n        ref = _.keys(response);\n        results = [];\n        for (i = 0, len = ref.length; i < len; i++) {\n          error_field = ref[i];\n          results.push(selectors.push(\"[name=\" + error_field + \"]\"));\n        }\n        return results;\n      };\n      submit = (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"projects\", $scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this);\n      openLightbox = function() {\n        $scope.data = {\n          is_private: false\n        };\n        if (!$scope.templates.length) {\n          $rs.projects.templates().then((function(_this) {\n            return function(result) {\n              $scope.templates = result;\n              return $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n                return x.slug === \"scrum\";\n              })).id;\n            };\n          })(this));\n        } else {\n          $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n            return x.slug === \"scrum\";\n          })).id;\n        }\n        $scope.canCreatePrivateProjects = currentUserService.canCreatePrivateProjects();\n        $scope.canCreatePublicProjects = currentUserService.canCreatePublicProjects();\n        return lightboxService.open($el);\n      };\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $auth.refresh().then(function() {\n        return openLightbox();\n      });\n    };\n    directive = {\n      link: link,\n      templateUrl: \"project/wizard-create-project.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbCreateProject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$tgResources\", \"$projectUrl\", \"$tgLoading\", \"lightboxService\", \"$cacheFactory\", \"$translate\", \"tgCurrentUserService\", \"$tgAuth\", CreateProject]);\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, ContribUserSettingsController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm) {\n      var promise;\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      promise = this.loadInitialData();\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    }\n\n    ContribController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.$broadcast('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n  ContribUserSettingsController = (function(superClass) {\n    extend(ContribUserSettingsController, superClass);\n\n    ContribUserSettingsController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\"];\n\n    function ContribUserSettingsController(rootScope, scope, params) {\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.userSettingsPlugins, {\n        \"slug\": this.params.plugin\n      }));\n    }\n\n    return ContribUserSettingsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribUserSettingsController\", ContribUserSettingsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.assign({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.assign({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.assign({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.assign({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location, lightboxService) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\") || $attrs.tgNavGetParams !== target.data(\"params\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n              target.data(\"params\", $attrs.tgNavGetParams);\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  $scope.$apply();\n                  break;\n                case 2:\n                  window.open(fullUrl);\n              }\n              return lightboxService.closeAll();\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", \"lightboxService\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data));\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.trimEnd(this.mainUrl, \"/\"), _.trimStart(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var filtersHashSuffix, hashSuffix, myFiltersHashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    filtersHashSuffix = \"issues-filters\";\n    myFiltersHashSuffix = \"issues-my-filters\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeFilters = function(projectSlug, params) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getFilters = function(projectSlug) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeMyFilters = function(projectId, myFilters) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = $http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = $http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, function(data) {\n          var innerPromise;\n          innerPromise = $http.post(\"\" + url, {\n            key: hash,\n            value: myFilters\n          });\n          innerPromise.then(function() {\n            return deferred.resolve();\n          });\n          return innerPromise.then(null, function() {\n            return deferred.reject();\n          });\n        });\n      }\n      return deferred.promise;\n    };\n    service.getMyFilters = function(projectId) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = $http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusViewModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusViewModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var error, ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if (evt.target.getResponseHeader('Taiga-Info-Project-Is-Private')) {\n            response.headers = {\n              isPrivate: evt.target.getResponseHeader('Taiga-Info-Project-Is-Private') === 'True',\n              memberships: parseInt(evt.target.getResponseHeader('Taiga-Info-Project-Memberships'))\n            };\n          }\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    service.changeLogo = function(projectId, file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('logo', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/change_logo\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeLogo = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/remove_logo\";\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.list = function(projectId, sprintId, userStoryId) {\n      var params;\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = {\n        project: projectId\n      };\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        sprint_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters, pageSize) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", _.extend(params, {\n        page_size: pageSize\n      }), {\n        enablePagination: true\n      }, true);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateSprintOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-sprint-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var form, submit, submitButton;\n      form = new checksley.Form($el.find(\"form\"));\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, submitButton;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var currentLoading, promise;\n        currentLoading = $loading().target(submitButton).start();\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          currentLoading.finish();\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          currentLoading.finish();\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $el.on(\"click\", \".button-red\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n      return submitButton = $el.find(\".button-red\");\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", \"$tgLoading\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.location.path(this.navUrls.resolve(\"permission-denied\"));\n        this.location.replace();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-gravatar\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaDiscover\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-link.directive.coffee\n */\n\n(function() {\n  var AttachmentLinkDirective;\n\n  AttachmentLinkDirective = function($parse, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attachment;\n      attachment = $parse(attrs.tgAttachmentLink)(scope);\n      el.on(\"click\", function(event) {\n        if (taiga.isImage(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return scope.$apply(function() {\n            return lightboxFactory.create('tg-lb-attachment-preview', {\n              \"class\": 'lightbox lightbox-block'\n            }, {\n              file: attachment.get('file')\n            });\n          });\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentLinkDirective.$inject = [\"$parse\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentLink\", AttachmentLinkDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-gallery.directive.coffee\n */\n\n(function() {\n  var AttachmentGalleryDirective;\n\n  AttachmentGalleryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment-gallery.html\",\n      link: link\n    };\n  };\n\n  AttachmentGalleryDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentGallery\", AttachmentGalleryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchment.controller.coffee\n */\n\n(function() {\n  var AttachmentController;\n\n  AttachmentController = (function() {\n    AttachmentController.$inject = ['tgAttachmentsService', '$translate'];\n\n    function AttachmentController(attachmentsService, translate) {\n      this.attachmentsService = attachmentsService;\n      this.translate = translate;\n      this.form = {};\n      this.form.description = this.attachment.getIn(['file', 'description']);\n      this.form.is_deprecated = this.attachment.get(['file', 'is_deprecated']);\n      this.title = this.translate.instant(\"ATTACHMENT.TITLE\", {\n        fileName: this.attachment.get('name'),\n        date: moment(this.attachment.get('created_date')).format(this.translate.instant(\"ATTACHMENT.DATE\"))\n      });\n    }\n\n    AttachmentController.prototype.editMode = function(mode) {\n      var attachment;\n      attachment = this.attachment.set('editable', mode);\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    AttachmentController.prototype[\"delete\"] = function() {\n      return this.onDelete({\n        attachment: this.attachment\n      });\n    };\n\n    AttachmentController.prototype.save = function() {\n      var attachment;\n      attachment = this.attachment.set('loading', true);\n      this.onUpdate({\n        attachment: attachment\n      });\n      attachment = this.attachment.merge({\n        editable: false,\n        loading: false\n      });\n      attachment = attachment.mergeIn(['file'], {\n        description: this.form.description,\n        is_deprecated: !!this.form.is_deprecated\n      });\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    return AttachmentController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Attachment', AttachmentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment.directive.coffee\n */\n\n(function() {\n  var AttachmentDirective;\n\n  AttachmentDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment.html\",\n      link: link\n    };\n  };\n\n  AttachmentDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachment\", AttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-drop.directive.coffee\n */\n\n(function() {\n  var AttachmentsDropDirective;\n\n  AttachmentsDropDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgAttachmentsDrop);\n      el.on('dragover', function(e) {\n        e.preventDefault();\n        return false;\n      });\n      el.on('drop', function(e) {\n        var dataTransfer;\n        e.stopPropagation();\n        e.preventDefault();\n        dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: dataTransfer.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentsDropDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsDrop\", AttachmentsDropDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.controller.coffee\n */\n\n(function() {\n  var AttachmentsFullController, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsFullController = (function() {\n    AttachmentsFullController.$inject = [\"$translate\", \"$tgConfirm\", \"$tgConfig\", \"$tgStorage\", \"tgAttachmentsFullService\", \"tgProjectService\"];\n\n    function AttachmentsFullController(translate, confirm, config, storage, attachmentsFullService, projectService) {\n      this.translate = translate;\n      this.confirm = confirm;\n      this.config = config;\n      this.storage = storage;\n      this.attachmentsFullService = attachmentsFullService;\n      this.projectService = projectService;\n      this.mode = this.storage.get('attachment-mode', 'list');\n      this.maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (this.maxFileSize) {\n        this.maxFileSize = sizeFormat(this.maxFileSize);\n      }\n      this.maxFileSizeMsg = this.maxFileSize ? this.translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: this.maxFileSize\n      }) : \"\";\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullController.prototype.uploadingAttachments = function() {\n      return this.attachmentsFullService.uploadingAttachments;\n    };\n\n    AttachmentsFullController.prototype.addAttachment = function(file) {\n      var editable;\n      editable = this.mode === 'list';\n      return this.attachmentsFullService.addAttachment(this.projectId, this.objId, this.type, file, editable);\n    };\n\n    AttachmentsFullController.prototype.setMode = function(mode) {\n      this.mode = mode;\n      return this.storage.set('attachment-mode', mode);\n    };\n\n    AttachmentsFullController.prototype.toggleDeprecatedsVisible = function() {\n      return this.attachmentsFullService.toggleDeprecatedsVisible();\n    };\n\n    AttachmentsFullController.prototype.addAttachments = function(files) {\n      return _.forEach(files, (function(_this) {\n        return function(file) {\n          return _this.addAttachment(file);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.loadAttachments = function() {\n      return this.attachmentsFullService.loadAttachments(this.type, this.objId, this.projectId);\n    };\n\n    AttachmentsFullController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      var message, title;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: toDeleteAttachment.getIn(['file', 'name'])\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onError = function() {\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            return askResponse.finish();\n          };\n          return _this.attachmentsFullService.deleteAttachment(toDeleteAttachment, _this.type).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.reorderAttachment = function(attachment, newIndex) {\n      return this.attachmentsFullService.reorderAttachment(this.type, attachment, newIndex);\n    };\n\n    AttachmentsFullController.prototype.updateAttachment = function(toUpdateAttachment) {\n      return this.attachmentsFullService.updateAttachment(toUpdateAttachment, this.type);\n    };\n\n    AttachmentsFullController.prototype._isEditable = function() {\n      if (this.projectService.project) {\n        return this.projectService.hasPermission(this.editPermission);\n      }\n      return false;\n    };\n\n    AttachmentsFullController.prototype.showAttachments = function() {\n      return this._isEditable() || this.attachmentsFullService.attachments.size;\n    };\n\n    return AttachmentsFullController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsFull\", AttachmentsFullController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.directive.coffee\n */\n\n(function() {\n  var AttachmentsFullDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  AttachmentsFullDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.objId', function(value) {\n        return ctrl.loadAttachments();\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        type: \"@\",\n        objId: \"=\",\n        projectId: \"=\",\n        editPermission: \"@\"\n      },\n      controller: \"AttachmentsFull\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-full/attachments-full.html\",\n      link: link\n    };\n  };\n\n  AttachmentsFullDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsFull\", AttachmentsFullDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-full.service.coffee\n */\n\n(function() {\n  var AttachmentsFullService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsFullService = (function(superClass) {\n    extend(AttachmentsFullService, superClass);\n\n    AttachmentsFullService.$inject = [\"tgAttachmentsService\", \"$rootScope\"];\n\n    function AttachmentsFullService(attachmentsService, rootScope) {\n      this.attachmentsService = attachmentsService;\n      this.rootScope = rootScope;\n      this._attachments = Immutable.List();\n      this._deprecatedsCount = 0;\n      this._attachmentsVisible = Immutable.List();\n      this._deprecatedsVisible = false;\n      this.uploadingAttachments = [];\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this._attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this._deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this._attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this._deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullService.prototype.toggleDeprecatedsVisible = function() {\n      this._deprecatedsVisible = !this._deprecatedsVisible;\n      return this.regenerate();\n    };\n\n    AttachmentsFullService.prototype.regenerate = function() {\n      this._deprecatedsCount = this._attachments.count(function(it) {\n        return it.getIn(['file', 'is_deprecated']);\n      });\n      if (this._deprecatedsVisible) {\n        return this._attachmentsVisible = this._attachments;\n      } else {\n        return this._attachmentsVisible = this._attachments.filter(function(it) {\n          return !it.getIn(['file', 'is_deprecated']);\n        });\n      }\n    };\n\n    AttachmentsFullService.prototype.addAttachment = function(projectId, objId, type, file, editable) {\n      if (editable == null) {\n        editable = true;\n      }\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var promise;\n          if (_this.attachmentsService.validate(file)) {\n            _this.uploadingAttachments.push(file);\n            promise = _this.attachmentsService.upload(file, objId, projectId, type);\n            return promise.then(function(file) {\n              var attachment;\n              _this.uploadingAttachments = _this.uploadingAttachments.filter(function(uploading) {\n                return uploading.name !== file.get('name');\n              });\n              attachment = Immutable.Map();\n              attachment = attachment.merge({\n                file: file,\n                editable: editable,\n                loading: false\n              });\n              _this._attachments = _this._attachments.push(attachment);\n              _this.regenerate();\n              _this.rootScope.$broadcast(\"attachment:create\");\n              return resolve(attachment);\n            });\n          } else {\n            return reject(file);\n          }\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.loadAttachments = function(type, objId, projectId) {\n      return this.attachmentsService.list(type, objId, projectId).then((function(_this) {\n        return function(files) {\n          _this._attachments = files.map(function(file) {\n            var attachment;\n            attachment = Immutable.Map();\n            return attachment.merge({\n              loading: false,\n              editable: false,\n              file: file\n            });\n          });\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.deleteAttachment = function(toDeleteAttachment, type) {\n      var onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this._attachments = _this._attachments.filter(function(attachment) {\n            return attachment !== toDeleteAttachment;\n          });\n          return _this.regenerate();\n        };\n      })(this);\n      return this.attachmentsService[\"delete\"](type, toDeleteAttachment.getIn(['file', 'id'])).then(onSuccess);\n    };\n\n    AttachmentsFullService.prototype.reorderAttachment = function(type, attachment, newIndex) {\n      var attachments, oldIndex, promises;\n      oldIndex = this.attachments.findIndex(function(it) {\n        return it === attachment;\n      });\n      if (oldIndex === newIndex) {\n        return;\n      }\n      attachments = this.attachments.remove(oldIndex);\n      attachments = attachments.splice(newIndex, 0, attachment);\n      attachments = attachments.map(function(x, i) {\n        return x.setIn(['file', 'order'], i + 1);\n      });\n      promises = [];\n      attachments.forEach((function(_this) {\n        return function(attachment) {\n          var patch;\n          patch = {\n            order: attachment.getIn(['file', 'order'])\n          };\n          return promises.push(_this.attachmentsService.patch(attachment.getIn(['file', 'id']), type, patch));\n        };\n      })(this));\n      return Promise.all(promises).then((function(_this) {\n        return function() {\n          _this._attachments = attachments;\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.updateAttachment = function(toUpdateAttachment, type) {\n      var index, oldAttachment, patch;\n      index = this._attachments.findIndex(function(attachment) {\n        return attachment.getIn(['file', 'id']) === toUpdateAttachment.getIn(['file', 'id']);\n      });\n      oldAttachment = this._attachments.get(index);\n      patch = taiga.patch(oldAttachment.get('file'), toUpdateAttachment.get('file'));\n      if (toUpdateAttachment.get('loading')) {\n        this._attachments = this._attachments.set(index, toUpdateAttachment);\n        return this.regenerate();\n      } else {\n        return this.attachmentsService.patch(toUpdateAttachment.getIn(['file', 'id']), type, patch).then((function(_this) {\n          return function() {\n            _this._attachments = _this._attachments.set(index, toUpdateAttachment);\n            return _this.regenerate();\n          };\n        })(this));\n      }\n    };\n\n    return AttachmentsFullService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsFullService\", AttachmentsFullService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.controller.coffee\n */\n\n(function() {\n  var AttachmentsSimpleController;\n\n  AttachmentsSimpleController = (function() {\n    AttachmentsSimpleController.$inject = [\"tgAttachmentsService\"];\n\n    function AttachmentsSimpleController(attachmentsService) {\n      this.attachmentsService = attachmentsService;\n    }\n\n    AttachmentsSimpleController.prototype.addAttachment = function(file) {\n      var attachment;\n      attachment = Immutable.fromJS({\n        file: file,\n        name: file.name,\n        size: file.size\n      });\n      if (this.attachmentsService.validate(file)) {\n        this.attachments = this.attachments.push(attachment);\n        if (this.onAdd) {\n          return this.onAdd({\n            attachment: attachment\n          });\n        }\n      }\n    };\n\n    AttachmentsSimpleController.prototype.addAttachments = function(files) {\n      return _.forEach(files, this.addAttachment.bind(this));\n    };\n\n    AttachmentsSimpleController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      this.attachments = this.attachments.filter(function(attachment) {\n        return attachment !== toDeleteAttachment;\n      });\n      if (this.onDelete) {\n        return this.onDelete({\n          attachment: toDeleteAttachment\n        });\n      }\n    };\n\n    return AttachmentsSimpleController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsSimple\", AttachmentsSimpleController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.directive.coffee\n */\n\n(function() {\n  var AttachmentsSimpleDirective;\n\n  AttachmentsSimpleDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachments: \"=\",\n        onAdd: \"&\",\n        onDelete: \"&\"\n      },\n      controller: \"AttachmentsSimple\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-simple/attachments-simple.html\",\n      link: link\n    };\n  };\n\n  AttachmentsSimpleDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSimple\", AttachmentsSimpleDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-sortable.directive.coffee\n */\n\n(function() {\n  var AttachmentSortableDirective;\n\n  AttachmentSortableDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      callback = $parse(attrs.tgAttachmentsSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var attachment, newIndex;\n        item = $(item);\n        attachment = item.scope().attachment;\n        newIndex = item.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            attachment: attachment,\n            index: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentSortableDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSortable\", AttachmentSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: auto-select.directive.coffee\n */\n\n(function() {\n  var AutoSelectDirective;\n\n  AutoSelectDirective = function($timeout) {\n    return {\n      link: function(scope, elm) {\n        return $timeout(function() {\n          return elm[0].select();\n        });\n      }\n    };\n  };\n\n  AutoSelectDirective.$inject = ['$timeout'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAutoSelect\", AutoSelectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: file-change.directive.coffee\n */\n\n(function() {\n  var FileChangeDirective;\n\n  FileChangeDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgFileChange);\n      el.on('change', function(event) {\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: event.currentTarget.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      restrict: \"A\",\n      link: link\n    };\n  };\n\n  FileChangeDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgFileChange\", FileChangeDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.icon-plus',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2015 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-big-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoBigSrcDirective;\n\n  ProjectLogoBigSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_big_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoBigSrc\"\n      }\n    };\n  };\n\n  ProjectLogoBigSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoBigSrc\", ProjectLogoBigSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-small-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoSmallSrcDirective;\n\n  ProjectLogoSmallSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_small_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoSmallSrc\"\n      }\n    };\n  };\n\n  ProjectLogoSmallSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoSmallSrc\", ProjectLogoSmallSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog > indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        url = url.replace(/-/g, \"\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n      scope.vm.fixed = false;\n      return $(window).on(\"scroll\", function() {\n        var position;\n        position = $(window).scrollTop();\n        if (position > 100 && scope.vm.fixed === false) {\n          scope.vm.fixed = true;\n          return scope.$digest();\n        } else if (position < 100 && scope.vm.fixed === true) {\n          scope.vm.fixed = false;\n          return scope.$digest();\n        }\n      });\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\", \"$rootScope\"];\n\n    function WatchButtonController(currentUserService, rootScope) {\n      this.currentUserService = currentUserService;\n      this.rootScope = rootScope;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.openWatchers = function() {\n      return this.rootScope.$broadcast(\"watcher:add\", this.item);\n    };\n\n    WatchButtonController.prototype.getPerms = function() {\n      var name, perms;\n      if (!this.item) {\n        return \"\";\n      }\n      name = this.item._name;\n      perms = {\n        userstories: 'modify_us',\n        issues: 'modify_issue',\n        tasks: 'modify_task'\n      };\n      return perms[name];\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: function(item, attributes) {\n        return \"components/watch-button/watch-button-\" + attributes.environment + \".html\";\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByController;\n\n  DiscoverHomeOrderByController = (function() {\n    DiscoverHomeOrderByController.$inject = ['$translate'];\n\n    function DiscoverHomeOrderByController(translate) {\n      this.translate = translate;\n      this.is_open = false;\n      this.texts = {\n        week: this.translate.instant('DISCOVER.FILTERS.WEEK'),\n        month: this.translate.instant('DISCOVER.FILTERS.MONTH'),\n        year: this.translate.instant('DISCOVER.FILTERS.YEAR'),\n        all: this.translate.instant('DISCOVER.FILTERS.ALL_TIME')\n      };\n    }\n\n    DiscoverHomeOrderByController.prototype.currentText = function() {\n      return this.texts[this.currentOrderBy];\n    };\n\n    DiscoverHomeOrderByController.prototype.open = function() {\n      return this.is_open = true;\n    };\n\n    DiscoverHomeOrderByController.prototype.close = function() {\n      return this.is_open = false;\n    };\n\n    DiscoverHomeOrderByController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      this.is_open = false;\n      return this.onChange({\n        orderBy: this.currentOrderBy\n      });\n    };\n\n    return DiscoverHomeOrderByController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHomeOrderBy\", DiscoverHomeOrderByController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.directive.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByDirective;\n\n  DiscoverHomeOrderByDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverHomeOrderBy\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-home-order-by/discover-home-order-by.html\",\n      scope: {\n        currentOrderBy: \"=orderBy\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverHomeOrderByDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverHomeOrderBy\", DiscoverHomeOrderByDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-bar.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchBarController;\n\n  DiscoverSearchBarController = (function() {\n    DiscoverSearchBarController.$inject = ['tgDiscoverProjectsService'];\n\n    function DiscoverSearchBarController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.projectsCount;\n        };\n      })(this));\n      this.discoverProjectsService.fetchStats();\n    }\n\n    DiscoverSearchBarController.prototype.selectFilter = function(filter) {\n      return this.onChange({\n        filter: filter,\n        q: this.q\n      });\n    };\n\n    DiscoverSearchBarController.prototype.submitFilter = function() {\n      return this.onChange({\n        filter: this.filter,\n        q: this.q\n      });\n    };\n\n    return DiscoverSearchBarController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchBar\", DiscoverSearchBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchBarDirective;\n\n  DiscoverSearchBarDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"DiscoverSearchBar\",\n      controllerAs: \"vm\",\n      templateUrl: 'discover/components/discover-search-bar/discover-search-bar.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchBarDirective.$inject = [];\n\n  angular.module('taigaDiscover').directive('tgDiscoverSearchBar', DiscoverSearchBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderController;\n\n  DiscoverSearchListHeaderController = (function() {\n    DiscoverSearchListHeaderController.$inject = [];\n\n    function DiscoverSearchListHeaderController() {\n      this.like_is_open = this.orderBy.indexOf('-total_fans') === 0;\n      this.activity_is_open = this.orderBy.indexOf('-total_activity') === 0;\n    }\n\n    DiscoverSearchListHeaderController.prototype.openLike = function() {\n      this.like_is_open = true;\n      this.activity_is_open = false;\n      return this.setOrderBy('-total_fans_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.openActivity = function() {\n      this.activity_is_open = true;\n      this.like_is_open = false;\n      return this.setOrderBy('-total_activity_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.setOrderBy = function(type) {\n      if (type == null) {\n        type = '';\n      }\n      if (!type) {\n        this.like_is_open = false;\n        this.activity_is_open = false;\n      }\n      return this.onChange({\n        orderBy: type\n      });\n    };\n\n    return DiscoverSearchListHeaderController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchListHeader\", DiscoverSearchListHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderDirective;\n\n  DiscoverSearchListHeaderDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverSearchListHeader\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-search-list-header/discover-search-list-header.html\",\n      scope: {\n        onChange: \"&\",\n        orderBy: \"=\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchListHeaderDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearchListHeader\", DiscoverSearchListHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.controller.coffee\n */\n\n(function() {\n  var FeaturedProjectsController;\n\n  FeaturedProjectsController = (function() {\n    FeaturedProjectsController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function FeaturedProjectsController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.featured;\n        };\n      })(this));\n      this.discoverProjectsService.fetchFeatured();\n    }\n\n    return FeaturedProjectsController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"FeaturedProjects\", FeaturedProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.directive.coffee\n */\n\n(function() {\n  var FeaturedProjectsDirective;\n\n  FeaturedProjectsDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"FeaturedProjects\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/featured-projects/featured-projects.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  FeaturedProjectsDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgFeaturedProjects\", FeaturedProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: highlighted.directive.coffee\n */\n\n(function() {\n  var HighlightedDirective;\n\n  HighlightedDirective = function() {\n    return {\n      templateUrl: \"discover/components/highlighted/highlighted.html\",\n      scope: {\n        loading: \"=\",\n        highlighted: \"=\",\n        orderBy: \"=\"\n      }\n    };\n  };\n\n  HighlightedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgHighlighted\", HighlightedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.controller.coffee\n */\n\n(function() {\n  var MostActiveController;\n\n  MostActiveController = (function() {\n    MostActiveController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostActiveController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostActive;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostActiveController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostActive({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostActiveController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostActiveController.prototype.getOrderBy = function(type) {\n      if (this.currentOrderBy === 'all') {\n        return '-total_activity';\n      } else {\n        return '-total_activity_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostActiveController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostActive\", MostActiveController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.directive.coffee\n */\n\n(function() {\n  var MostActiveDirective;\n\n  MostActiveDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostActive\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-active/most-active.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostActiveDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostActive\", MostActiveDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: msot-liked.controller.coffee\n */\n\n(function() {\n  var MostLikedController;\n\n  MostLikedController = (function() {\n    MostLikedController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostLikedController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostLiked;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostLikedController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostLiked({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostLikedController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostLikedController.prototype.getOrderBy = function() {\n      if (this.currentOrderBy === 'all') {\n        return '-total_fans';\n      } else {\n        return '-total_fans_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostLikedController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostLiked\", MostLikedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-liked.directive.coffee\n */\n\n(function() {\n  var MostLikedDirective;\n\n  MostLikedDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostLiked\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-liked/most-liked.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostLikedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostLiked\", MostLikedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeController;\n\n  DiscoverHomeController = (function() {\n    DiscoverHomeController.$inject = ['$tgLocation', '$tgNavUrls', 'tgAppMetaService', '$translate'];\n\n    function DiscoverHomeController(location, navUrls, appMetaService, translate) {\n      var description, title;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = this.translate.instant(\"DISCOVER.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverHomeController.prototype.onSubmit = function(q) {\n      var url;\n      url = this.navUrls.resolve('discover-search');\n      return this.location.search('text', q).path(url);\n    };\n\n    return DiscoverHomeController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHome\", DiscoverHomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchController;\n\n  DiscoverSearchController = (function() {\n    DiscoverSearchController.$inject = ['$routeParams', 'tgDiscoverProjectsService', '$route', 'tgAppMetaService', '$translate'];\n\n    function DiscoverSearchController(routeParams, discoverProjectsService, route, appMetaService, translate) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.discoverProjectsService = discoverProjectsService;\n      this.route = route;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.page = 1;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.nextSearchPage;\n        };\n      })(this));\n      this.q = this.routeParams.text;\n      this.filter = this.routeParams.filter || 'all';\n      this.orderBy = this.routeParams['order_by'] || '';\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverSearchController.prototype.fetch = function() {\n      this.page = 1;\n      this.discoverProjectsService.resetSearchList();\n      return this.search();\n    };\n\n    DiscoverSearchController.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.fetchByOrderBy = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.search = function() {\n      var filter, params;\n      filter = this.getFilter();\n      params = {\n        page: this.page,\n        q: this.q,\n        order_by: this.orderBy\n      };\n      _.assign(params, filter);\n      return this.discoverProjectsService.fetchSearch(params);\n    };\n\n    DiscoverSearchController.prototype.getFilter = function() {\n      if (this.filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (this.filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (this.filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    DiscoverSearchController.prototype.onChangeFilter = function(filter, q) {\n      this.filter = filter;\n      this.q = q;\n      this.route.updateParams({\n        filter: this.filter,\n        text: this.q\n      });\n      return this.fetchByGlobalSearch();\n    };\n\n    DiscoverSearchController.prototype.onChangeOrder = function(orderBy) {\n      this.orderBy = orderBy;\n      this.route.updateParams({\n        order_by: orderBy\n      });\n      return this.fetchByOrderBy();\n    };\n\n    return DiscoverSearchController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearch\", DiscoverSearchController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchDirective;\n\n  DiscoverSearchDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  DiscoverSearchDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearch\", DiscoverSearchDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-projects.service.coffee\n */\n\n(function() {\n  var DiscoverProjectsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  DiscoverProjectsService = (function(superClass) {\n    var _discoverParams;\n\n    extend(DiscoverProjectsService, superClass);\n\n    DiscoverProjectsService.$inject = [\"tgResources\", \"tgProjectsService\"];\n\n    _discoverParams = {\n      discover_mode: true\n    };\n\n    function DiscoverProjectsService(rs, projectsService) {\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this._mostLiked = Immutable.List();\n      this._mostActive = Immutable.List();\n      this._featured = Immutable.List();\n      this._searchResult = Immutable.List();\n      this._projectsCount = 0;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n      taiga.defineImmutableProperty(this, \"mostLiked\", (function(_this) {\n        return function() {\n          return _this._mostLiked;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"mostActive\", (function(_this) {\n        return function() {\n          return _this._mostActive;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this._featured;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this._nextSearchPage;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._projectsCount;\n        };\n      })(this));\n    }\n\n    DiscoverProjectsService.prototype.fetchMostLiked = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostLiked = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchMostActive = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostActive = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchFeatured = function() {\n      var _params;\n      _params = _.extend({}, _discoverParams);\n      _params.is_featured = true;\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 4);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._featured = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.resetSearchList = function() {\n      return this._searchResult = Immutable.List();\n    };\n\n    DiscoverProjectsService.prototype.fetchStats = function() {\n      return this.rs.stats.discover().then((function(_this) {\n        return function(discover) {\n          return _this._projectsCount = discover.getIn(['projects', 'total']);\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchSearch = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params).then((function(_this) {\n        return function(result) {\n          var projects;\n          _this._nextSearchPage = !!result.headers('X-Pagination-Next');\n          projects = Immutable.fromJS(result.data);\n          projects = projects.map(_this.decorate);\n          return _this._searchResult = _this._searchResult.concat(projects);\n        };\n      })(this));\n    };\n\n    return DiscoverProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaDiscover\").service(\"tgDiscoverProjectsService\", DiscoverProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.controller.coffee\n */\n\n(function() {\n  var HomeController;\n\n  HomeController = (function() {\n    HomeController.$inject = [\"tgCurrentUserService\", \"$location\", \"$tgNavUrls\"];\n\n    function HomeController(currentUserService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      if (!this.currentUserService.getUser()) {\n        this.location.path(this.navUrls.resolve(\"discover\"));\n      }\n    }\n\n    return HomeController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"Home\", HomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, _getValidDutiesAndAttachProjectInfo, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('projectName', project.get('name'));\n          duty = duty.set('blockedProject', project.get('blocked_code'));\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      _getValidDutiesAndAttachProjectInfo = function(duties, dutyType) {\n        duties = duties.filter(function(duty) {\n          return projectsById.get(String(duty.get('project')));\n        });\n        duties = duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, dutyType);\n        });\n        return duties;\n      };\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"userStories\"), \"userstories\");\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"tasks\"), \"tasks\");\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(assignedTo.get(\"issues\"), \"issues\");\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"userStories\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"userStories\"), \"userstories\");\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"tasks\"), \"tasks\");\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = _getValidDutiesAndAttachProjectInfo(watching.get(\"issues\"), \"issues\");\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params, params_us, projectsById, projectsPromise, watching, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_us = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_us = {\n        is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedUserStoriesPromise, assignedTasksPromise, assignedIssuesPromise, watchingUserStoriesPromise, watchingTasksPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService, $rootScope) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        locationService.url(navUrlsService.resolve(\"discover\"));\n        return locationService.search({});\n      };\n      scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n      return scope.vm.userSettingsPlugins = _.filter($rootScope.userSettingsPlugins, {\n        userMenu: true\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\", \"$rootScope\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, locationService, navUrlsService, config) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n      scope.vm.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      scope.vm.login = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"login\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      scope.vm.register = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"register\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      return scope.$on(\"$routeChangeSuccess\", function() {\n        if (locationService.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileLikedController, ProfileVotedController, ProfileWatchedController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileLikedDirective, ProfileVotedDirective, ProfileWatchedDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://tree.taiga.io/support/admin/import-export-projects/\"\n      }, {\n        url: \"https://tree.taiga.io/support/admin/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: blocked-project-explanation.directive.coffee\n */\n\n(function() {\n  var BlockedProjectExplanationDirective;\n\n  BlockedProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/project/blocked-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgBlockedProjectExplanation\", BlockedProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var drake, itemEl, scroll;\n      itemEl = null;\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).hasClass('list-itemtype-project');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = $(item);\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n    function ProjectsListingController(currentUserService, projectsService) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    ProjectsListingController.prototype.newProject = function() {\n      return this.projectsService.newProject();\n    };\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      var projectSlug;\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      projectSlug = this.routeParams.pslug;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function(project) {\n      var ctx, metas;\n      if (!this.project) {\n        return null;\n      }\n      metas = {};\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      metas.title = this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx);\n      metas.description = this.project.get(\"description\");\n      return metas;\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\", \"tgLightboxFactory\"];\n\n    function ProjectsService(rs, projectUrl, lightboxFactory) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var colorized_tags, tags, url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      colorized_tags = [];\n      if (project.get(\"tags\")) {\n        tags = project.get(\"tags\").sort();\n        colorized_tags = tags.map(function(tag) {\n          var color;\n          color = project.get(\"tags_colors\").get(tag);\n          return Immutable.fromJS({\n            name: tag,\n            color: color\n          });\n        });\n        project = project.set(\"colorized_tags\", colorized_tags);\n      }\n      return project;\n    };\n\n    ProjectsService.prototype.newProject = function() {\n      return this.lightboxFactory.create(\"tg-lb-create-project\", {\n        \"class\": \"wizard-create-project lightbox\"\n      });\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    ProjectsService.prototype.transferValidateToken = function(projectId, token) {\n      return this.rs.projects.transferValidateToken(projectId, token);\n    };\n\n    ProjectsService.prototype.transferAccept = function(projectId, token, reason) {\n      return this.rs.projects.transferAccept(projectId, token, reason);\n    };\n\n    ProjectsService.prototype.transferReject = function(projectId, token, reason) {\n      return this.rs.projects.transferReject(projectId, token, reason);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: cant-own-project-explanation.directive.coffee\n */\n\n(function() {\n  var CantOwnProjectExplanationDirective;\n\n  CantOwnProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/transfer/cant-own-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgCantOwnProjectExplanation\", CantOwnProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProject, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProject = (function() {\n    TransferProject.$inject = [\"$routeParams\", \"tgProjectsService\", \"$location\", \"$tgAuth\", \"tgCurrentUserService\", \"$tgNavUrls\", \"$translate\", \"$tgConfirm\"];\n\n    function TransferProject(routeParams, projectService, location, authService, currentUserService, navUrls, translate, confirmService) {\n      this.routeParams = routeParams;\n      this.projectService = projectService;\n      this.location = location;\n      this.authService = authService;\n      this.currentUserService = currentUserService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.confirmService = confirmService;\n    }\n\n    TransferProject.prototype.initialize = function() {\n      this.projectId = this.project.get(\"id\");\n      this.token = this.routeParams.token;\n      this.showAddComment = false;\n      return this._refreshUserData();\n    };\n\n    TransferProject.prototype._validateToken = function() {\n      return this.projectService.transferValidateToken(this.projectId, this.token).then(null, (function(_this) {\n        return function(data, status) {\n          return _this.location.path(_this.navUrls.resolve(\"not-found\"));\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._refreshUserData = function() {\n      return this.authService.refresh().then((function(_this) {\n        return function() {\n          _this._validateToken();\n          _this._setProjectData();\n          return _this._checkOwnerData();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._setProjectData = function() {\n      return this.canBeOwnedByUser = this.currentUserService.canOwnProject(this.project);\n    };\n\n    TransferProject.prototype._checkOwnerData = function() {\n      var currentUser, maxMemberships;\n      currentUser = this.currentUserService.getUser();\n      if (this.project.get('is_private')) {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE';\n        this.maxProjects = currentUser.get('max_private_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_private_projects');\n        maxMemberships = currentUser.get('max_memberships_private_projects');\n      } else {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC';\n        this.maxProjects = currentUser.get('max_public_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_public_projects');\n        maxMemberships = currentUser.get('max_memberships_public_projects');\n      }\n      return this.validNumberOfMemberships = maxMemberships === null || this.project.get('total_memberships') <= maxMemberships;\n    };\n\n    TransferProject.prototype.transferAccept = function(token, reason) {\n      this.loadingAccept = true;\n      return this.projectService.transferAccept(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"project-admin-project-profile-details\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingAccept = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.transferReject = function(token, reason) {\n      this.loadingReject = true;\n      return this.projectService.transferReject(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"home\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingReject = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.addComment = function() {\n      return this.showAddComment = true;\n    };\n\n    TransferProject.prototype.hideComment = function() {\n      this.showAddComment = false;\n      return this.reason = '';\n    };\n\n    return TransferProject;\n\n  })();\n\n  module.controller(\"TransferProjectController\", TransferProject);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProjectDirective, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProjectDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initialize();\n    };\n    return {\n      link: link,\n      scope: {},\n      bindToController: {\n        project: \"=\"\n      },\n      templateUrl: \"projects/transfer/transfer-project.html\",\n      controller: 'TransferProjectController',\n      controllerAs: 'vm'\n    };\n  };\n\n  module.directive('tgTransferProject', TransferProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  Resource = function(urlsService, http, config, $rootScope, $q, storage) {\n    var service;\n    service = {};\n    service.list = function(type, objectId, projectId) {\n      var httpOptions, params, url, urlname;\n      urlname = \"attachments/\" + type;\n      params = {\n        object_id: objectId,\n        project: projectId\n      };\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      url = urlsService.resolve(urlname);\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service[\"delete\"] = function(type, id) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http[\"delete\"](url);\n    };\n    service.patch = function(type, id, patch) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http.patch(url, patch);\n    };\n    service.create = function(type, projectId, objectId, file) {\n      var data, defered, maxFileSize, response, token, uploadComplete, uploadFailed, uploadProgress, url, urlname, xhr;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname);\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var attachment, error, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              attachment = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              attachment = {};\n            }\n            if (status >= 200 && status < 400) {\n              attachment = Immutable.fromJS(attachment);\n              return defered.resolve(attachment);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      token = storage.get('token');\n      xhr.open(\"POST\", url);\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function() {\n      return {\n        \"attachments\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"$tgConfig\", \"$rootScope\", \"$q\", \"$tgStorage\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgAttachmentsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      if (pagination == null) {\n        pagination = true;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-lazy-pagination\": true\n          }\n        };\n      }\n      return http.get(url, params, httpOptions);\n    };\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    service.transferValidateToken = function(projectId, token) {\n      var data, url;\n      data = {\n        token: token\n      };\n      url = urlsService.resolve(\"project-transfer-validate-token\", projectId);\n      return http.post(url, data);\n    };\n    service.transferAccept = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-accept\", projectId);\n      return http.post(url, data);\n    };\n    service.transferReject = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-reject\", projectId);\n      return http.post(url, data);\n    };\n    service.transferRequest = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-transfer-request\", projectId);\n      return http.post(url);\n    };\n    service.transferStart = function(projectId, userId, reason) {\n      var data, url;\n      data = {\n        user: userId,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-start\", projectId);\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\", \"tgAttachmentsResource\", \"tgStatsResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warm(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: stats-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.discover = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"stats-discover\");\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"stats\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgStatsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"head title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"head meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"head meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"head meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments.service.coffee\n */\n\n(function() {\n  var AttachmentsService, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsService = (function() {\n    AttachmentsService.$inject = [\"$tgConfirm\", \"$tgConfig\", \"$translate\", \"tgResources\"];\n\n    function AttachmentsService(confirm, config, translate, rs) {\n      this.confirm = confirm;\n      this.config = config;\n      this.translate = translate;\n      this.rs = rs;\n      this.maxFileSize = this.getMaxFileSize();\n      if (this.maxFileSize) {\n        this.maxFileSizeFormated = sizeFormat(this.maxFileSize);\n      }\n    }\n\n    AttachmentsService.prototype.sizeError = function(file) {\n      var message;\n      message = this.translate.instant(\"ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED\", {\n        fileName: file.name,\n        fileSize: sizeFormat(file.size),\n        maxFileSize: this.maxFileSizeFormated\n      });\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.validate = function(file) {\n      if (this.maxFileSize && file.size > this.maxFileSize) {\n        this.sizeError(file);\n        return false;\n      }\n      return true;\n    };\n\n    AttachmentsService.prototype.getMaxFileSize = function() {\n      return this.config.get(\"maxUploadFileSize\", null);\n    };\n\n    AttachmentsService.prototype.list = function(type, objId, projectId) {\n      return this.rs.attachments.list(type, objId, projectId).then((function(_this) {\n        return function(attachments) {\n          return attachments.sortBy(function(attachment) {\n            return attachment.get('order');\n          });\n        };\n      })(this));\n    };\n\n    AttachmentsService.prototype[\"delete\"] = function(type, id) {\n      return this.rs.attachments[\"delete\"](type, id);\n    };\n\n    AttachmentsService.prototype.saveError = function(file, data) {\n      var message;\n      message = \"\";\n      if (file) {\n        message = this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n          fileName: file.name,\n          errorMessage: data.data._error_message\n        });\n      }\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.upload = function(file, objId, projectId, type) {\n      var promise;\n      promise = this.rs.attachments.create(type, projectId, objId, file);\n      promise.then(null, this.saveError.bind(this, file));\n      return promise;\n    };\n\n    AttachmentsService.prototype.patch = function(id, type, patch) {\n      var promise;\n      promise = this.rs.attachments.patch(type, id, patch);\n      promise.then(null, this.saveError.bind(this, null));\n      return promise;\n    };\n\n    return AttachmentsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAttachmentsService\", AttachmentsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var ChekcPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  ChekcPermissionsService = (function() {\n    ChekcPermissionsService.$inject = [\"tgProjectService\"];\n\n    function ChekcPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    ChekcPermissionsService.prototype.check = function(permission) {\n      if (!this.projectService.project) {\n        return false;\n      }\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return ChekcPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", ChekcPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    CurrentUserService.prototype.canCreatePrivateProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_private_projects') !== null && user.get('total_private_projects') >= user.get('max_private_projects')) {\n        return {\n          valid: false,\n          reason: 'max_private_projects',\n          type: 'private_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canCreatePublicProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_public_projects') !== null && user.get('total_public_projects') >= user.get('max_public_projects')) {\n        return {\n          valid: false,\n          reason: 'max_public_projects',\n          type: 'public_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canOwnProject = function(project) {\n      var result, user;\n      user = this.getUser();\n      if (project.get('is_private')) {\n        result = this.canCreatePrivateProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_private_projects') !== null && project.get('total_memberships') > user.get('max_memberships_private_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_private_projects',\n            type: 'private_project'\n          };\n        }\n      } else {\n        result = this.canCreatePublicProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_public_projects') !== null && project.get('total_memberships') > user.get('max_memberships_public_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_public_projects',\n            type: 'public_project'\n          };\n        }\n      }\n      return {\n        valid: true\n      };\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs, scopeAttrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      scope = _.merge(scope, scopeAttrs);\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo.service.coffee\n */\n\n(function() {\n  var ProjectLogoService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  ProjectLogoService = (function() {\n    function ProjectLogoService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/project-logos/project-logo-01.png\", \"/\" + window._version + \"/images/project-logos/project-logo-02.png\", \"/\" + window._version + \"/images/project-logos/project-logo-03.png\", \"/\" + window._version + \"/images/project-logos/project-logo-04.png\", \"/\" + window._version + \"/images/project-logos/project-logo-05.png\"];\n      COLORS = [\"rgba( 153,  214, 220, 1 )\", \"rgba( 213,  156,  156, 1 )\", \"rgba( 214, 161, 212,  1 )\", \"rgba( 164, 162, 219, 1 )\", \"rgba( 152, 224, 168,  1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    ProjectLogoService.prototype.getDefaultProjectLogo = function(slug, id) {\n      var idx, key, logo;\n      key = slug + \"-\" + id;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    return ProjectLogoService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectLogoService\", ProjectLogoService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\"];\n\n    function ProjectService(projectsService, xhrError) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n    }\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.hasPermission = function(permission) {\n      return this._project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId) {\n      return this.rs.users.getContacts(userId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"$location\", \"$tgNavUrls\"];\n\n    function xhrError(q, location, navUrls) {\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n    }\n\n    xhrError.prototype.notFound = function() {\n      this.location.path(this.navUrls.resolve(\"not-found\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      this.location.path(this.navUrls.resolve(\"permission-denied\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      title = title || text;\n      return $('<a>').attr('tg-nav', url).text(text).attr('title', title).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            text = timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1);\n            return $($.parseHTML(text)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jesús Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragán Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcántara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              if (event.obj === 'userstory') {\n                values_diff = Immutable.Map({\n                  'moveInBacklog': values_diff\n                });\n              } else {\n                values_diff = values_diff.deleteIn(['values_diff', 'milestone']);\n              }\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"],"sourceRoot":"/source/"}