(function(){var configure,i18nInit,init,module,modules,pluginsWithModule,taiga;this.taiga=taiga={},this.taigaContribPlugins=this.taigaContribPlugins||window.taigaContribPlugins||[],taiga.generateHash=function(components){return null==components&&(components=[]),components=_.map(components,function(x){return JSON.stringify(x)}),hex_sha1(components.join(":"))},taiga.generateUniqueSessionIdentifier=function(){var date,randomNumber;return date=(new Date).getTime(),randomNumber=Math.floor(150994944*Math.random()),taiga.generateHash([date,randomNumber])},taiga.sessionId=taiga.generateUniqueSessionIdentifier(),configure=function($routeProvider,$locationProvider,$httpProvider,$provide,$tgEventsProvider,$compileProvider,$translateProvider,$translatePartialLoaderProvider,$animateProvider){var authHttpIntercept,decorators,defaultHeaders,loaderIntercept,originalWhen,preferedLangCode,userInfo,versionCheckHttpIntercept;return $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/),originalWhen=$routeProvider.when,$routeProvider.when=function(path,route){return route.resolve||(route.resolve={}),angular.extend(route.resolve,{languageLoad:["$q","$translate",function($q,$translate){var deferred;return deferred=$q.defer(),$translate().then(function(){return deferred.resolve()}),deferred.promise}]}),originalWhen.call($routeProvider,path,route)},$routeProvider.when("/",{templateUrl:"home/home.html",controller:"Home",controllerAs:"vm",loader:!0,title:"HOME.PAGE_TITLE",loader:!0,description:"HOME.PAGE_DESCRIPTION",joyride:"dashboard"}),$routeProvider.when("/discover",{templateUrl:"discover/discover-home/discover-home.html",controller:"DiscoverHome",controllerAs:"vm",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0}),$routeProvider.when("/discover/search",{templateUrl:"discover/discover-search/discover-search.html",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0,controller:"DiscoverSearch",controllerAs:"vm",reloadOnSearch:!1}),$routeProvider.when("/projects/",{templateUrl:"projects/listing/projects-listing.html",access:{requiresLogin:!0},title:"PROJECTS.PAGE_TITLE",description:"PROJECTS.PAGE_DESCRIPTION",loader:!0,controller:"ProjectsListing",controllerAs:"vm"}),$routeProvider.when("/project/:pslug/",{templateUrl:"projects/project/project.html",loader:!0,controller:"Project",controllerAs:"vm",section:"project-timeline"}),$routeProvider.when("/project/:pslug/search",{templateUrl:"search/search.html",reloadOnSearch:!1,section:"search",loader:!0}),$routeProvider.when("/project/:pslug/backlog",{templateUrl:"backlog/backlog.html",loader:!0,section:"backlog",joyride:"backlog"}),$routeProvider.when("/project/:pslug/kanban",{templateUrl:"kanban/kanban.html",loader:!0,section:"kanban",joyride:"kanban"}),$routeProvider.when("/project/:pslug/taskboard/:sslug",{templateUrl:"taskboard/taskboard.html",loader:!0,section:"backlog"}),$routeProvider.when("/project/:pslug/us/:usref",{templateUrl:"us/us-detail.html",loader:!0,section:"backlog-kanban"}),$routeProvider.when("/project/:pslug/task/:taskref",{templateUrl:"task/task-detail.html",loader:!0,section:"backlog-kanban"}),$routeProvider.when("/project/:pslug/wiki",{redirectTo:function(params){return"/project/"+params.pslug+"/wiki/home"}}),$routeProvider.when("/project/:pslug/wiki/:slug",{templateUrl:"wiki/wiki.html",loader:!0,section:"wiki"}),$routeProvider.when("/project/:pslug/team",{templateUrl:"team/team.html",loader:!0,section:"team"}),$routeProvider.when("/project/:pslug/issues",{templateUrl:"issue/issues.html",loader:!0,section:"issues"}),$routeProvider.when("/project/:pslug/issue/:issueref",{templateUrl:"issue/issues-detail.html",loader:!0,section:"issues"}),$routeProvider.when("/project/:pslug/admin/project-profile/details",{templateUrl:"admin/admin-project-profile.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-profile/default-values",{templateUrl:"admin/admin-project-default-values.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-profile/modules",{templateUrl:"admin/admin-project-modules.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-profile/export",{templateUrl:"admin/admin-project-export.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-profile/reports",{templateUrl:"admin/admin-project-reports.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-values/status",{templateUrl:"admin/admin-project-values-status.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-values/points",{templateUrl:"admin/admin-project-values-points.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-values/priorities",{templateUrl:"admin/admin-project-values-priorities.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-values/severities",{templateUrl:"admin/admin-project-values-severities.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-values/types",{templateUrl:"admin/admin-project-values-types.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/project-values/custom-fields",{templateUrl:"admin/admin-project-values-custom-fields.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/memberships",{templateUrl:"admin/admin-memberships.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/roles",{templateUrl:"admin/admin-roles.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/third-parties/webhooks",{templateUrl:"admin/admin-third-parties-webhooks.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/third-parties/github",{templateUrl:"admin/admin-third-parties-github.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/third-parties/gitlab",{templateUrl:"admin/admin-third-parties-gitlab.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/third-parties/bitbucket",{templateUrl:"admin/admin-third-parties-bitbucket.html",section:"admin"}),$routeProvider.when("/project/:pslug/admin/contrib/:plugin",{templateUrl:"contrib/main.html"}),$routeProvider.when("/user-settings/user-profile",{templateUrl:"user/user-profile.html"}),$routeProvider.when("/user-settings/user-change-password",{templateUrl:"user/user-change-password.html"}),$routeProvider.when("/user-settings/mail-notifications",{templateUrl:"user/mail-notifications.html"}),$routeProvider.when("/change-email/:email_token",{templateUrl:"user/change-email.html"}),$routeProvider.when("/cancel-account/:cancel_token",{templateUrl:"user/cancel-account.html"}),$routeProvider.when("/profile",{templateUrl:"profile/profile.html",loader:!0,access:{requiresLogin:!0},controller:"Profile",controllerAs:"vm"}),$routeProvider.when("/profile/:slug",{templateUrl:"profile/profile.html",loader:!0,controller:"Profile",controllerAs:"vm"}),$routeProvider.when("/login",{templateUrl:"auth/login.html",title:"LOGIN.PAGE_TITLE",description:"LOGIN.PAGE_DESCRIPTION",disableHeader:!0}),$routeProvider.when("/register",{templateUrl:"auth/register.html",title:"REGISTER.PAGE_TITLE",description:"REGISTER.PAGE_DESCRIPTION",disableHeader:!0}),$routeProvider.when("/forgot-password",{templateUrl:"auth/forgot-password.html",title:"FORGOT_PASSWORD.PAGE_TITLE",description:"FORGOT_PASSWORD.PAGE_DESCRIPTION",disableHeader:!0}),$routeProvider.when("/change-password/:token",{templateUrl:"auth/change-password-from-recovery.html",title:"CHANGE_PASSWORD.PAGE_TITLE",description:"CHANGE_PASSWORD.PAGE_TITLE",disableHeader:!0}),$routeProvider.when("/invitation/:token",{templateUrl:"auth/invitation.html",title:"INVITATION.PAGE_TITLE",description:"INVITATION.PAGE_DESCRIPTION",disableHeader:!0}),$routeProvider.when("/external-apps",{templateUrl:"external-apps/external-app.html",title:"EXTERNAL_APP.PAGE_TITLE",description:"EXTERNAL_APP.PAGE_DESCRIPTION",controller:"ExternalApp",controllerAs:"vm",disableHeader:!0,mobileViewport:!0}),$routeProvider.when("/error",{templateUrl:"error/error.html"}),$routeProvider.when("/not-found",{templateUrl:"error/not-found.html"}),$routeProvider.when("/permission-denied",{templateUrl:"error/permission-denied.html"}),$routeProvider.otherwise({redirectTo:"/not-found"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1}),defaultHeaders={"Content-Type":"application/json","Accept-Language":window.taigaConfig.defaultLanguage||"en","X-Session-Id":taiga.sessionId},$httpProvider.defaults.headers["delete"]=defaultHeaders,$httpProvider.defaults.headers.patch=defaultHeaders,$httpProvider.defaults.headers.post=defaultHeaders,$httpProvider.defaults.headers.put=defaultHeaders,$httpProvider.defaults.headers.get={"X-Session-Id":taiga.sessionId},$httpProvider.useApplyAsync(!0),$tgEventsProvider.setSessionId(taiga.sessionId),authHttpIntercept=function($q,$location,$navUrls,$lightboxService){var httpResponseError;return httpResponseError=function(response){var nextUrl;return 0===response.status||-1===response.status&&!response.config.cancelable?($lightboxService.closeAll(),$location.path($navUrls.resolve("error")),$location.replace()):401===response.status&&-1===$location.url().indexOf("/login")&&(nextUrl=encodeURIComponent($location.url()),$location.url($navUrls.resolve("login")).search("next="+nextUrl)),$q.reject(response)},{responseError:httpResponseError}},$provide.factory("authHttpIntercept",["$q","$location","$tgNavUrls","lightboxService",authHttpIntercept]),$httpProvider.interceptors.push("authHttpIntercept"),loaderIntercept=function($q,loaderService){return{request:function(config){return loaderService.logRequest(),config},requestError:function(rejection){return loaderService.logResponse(),$q.reject(rejection)},responseError:function(rejection){return loaderService.logResponse(),$q.reject(rejection)},response:function(response){return loaderService.logResponse(),response}}},$provide.factory("loaderIntercept",["$q","tgLoader",loaderIntercept]),$httpProvider.interceptors.push("loaderIntercept"),versionCheckHttpIntercept=function($q){var httpResponseError;return httpResponseError=function(response){var $injector;return 400===response.status&&response.data.version&&($injector=angular.element("body").injector(),$injector.invoke(["$tgConfirm","$translate",function(_this){return function($confirm,$translate){var versionErrorMsg;return versionErrorMsg=$translate.instant("ERROR.VERSION_ERROR"),$confirm.notify("error",versionErrorMsg,null,1e4)}}(this)])),$q.reject(response)},{responseError:httpResponseError}},$provide.factory("versionCheckHttpIntercept",["$q",versionCheckHttpIntercept]),$httpProvider.interceptors.push("versionCheckHttpIntercept"),window.checksley.updateValidators({linewidth:function(val,width){var lines,valid;return lines=taiga.nl2br(val).split("<br />"),valid=_.every(lines,function(line){return line.length<width})}}),$compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo||!1),localStorage.userInfo&&(userInfo=JSON.parse(localStorage.userInfo)),preferedLangCode=(null!=userInfo?userInfo.lang:void 0)||window.taigaConfig.defaultLanguage||"en",$translatePartialLoaderProvider.addPart("taiga"),$translateProvider.useLoader("$translatePartialLoader",{urlTemplate:"/"+window._version+"/locales/{part}/locale-{lang}.json"}).useSanitizeValueStrategy("escapeParameters").addInterpolation("$translateMessageFormatInterpolation").preferredLanguage(preferedLangCode),$translateProvider.fallbackLanguage(preferedLangCode),decorators=window.getDecorators(),_.each(decorators,function(decorator){return $provide.decorator(decorator.provider,decorator.decorator)})},i18nInit=function(lang,$translate){var messages;return moment.locale(lang),messages={defaultMessage:$translate.instant("COMMON.FORM_ERRORS.DEFAULT_MESSAGE"),type:{email:$translate.instant("COMMON.FORM_ERRORS.TYPE_EMAIL"),url:$translate.instant("COMMON.FORM_ERRORS.TYPE_URL"),urlstrict:$translate.instant("COMMON.FORM_ERRORS.TYPE_URLSTRICT"),number:$translate.instant("COMMON.FORM_ERRORS.TYPE_NUMBER"),digits:$translate.instant("COMMON.FORM_ERRORS.TYPE_DIGITS"),dateIso:$translate.instant("COMMON.FORM_ERRORS.TYPE_DATEISO"),alphanum:$translate.instant("COMMON.FORM_ERRORS.TYPE_ALPHANUM"),phone:$translate.instant("COMMON.FORM_ERRORS.TYPE_PHONE")},notnull:$translate.instant("COMMON.FORM_ERRORS.NOTNULL"),notblank:$translate.instant("COMMON.FORM_ERRORS.NOT_BLANK"),required:$translate.instant("COMMON.FORM_ERRORS.REQUIRED"),regexp:$translate.instant("COMMON.FORM_ERRORS.REGEXP"),min:$translate.instant("COMMON.FORM_ERRORS.MIN"),max:$translate.instant("COMMON.FORM_ERRORS.MAX"),range:$translate.instant("COMMON.FORM_ERRORS.RANGE"),minlength:$translate.instant("COMMON.FORM_ERRORS.MIN_LENGTH"),maxlength:$translate.instant("COMMON.FORM_ERRORS.MAX_LENGTH"),rangelength:$translate.instant("COMMON.FORM_ERRORS.RANGE_LENGTH"),mincheck:$translate.instant("COMMON.FORM_ERRORS.MIN_CHECK"),maxcheck:$translate.instant("COMMON.FORM_ERRORS.MAX_CHECK"),rangecheck:$translate.instant("COMMON.FORM_ERRORS.RANGE_CHECK"),equalto:$translate.instant("COMMON.FORM_ERRORS.EQUAL_TO")},checksley.updateMessages("default",messages)},init=function($log,$rootscope,$auth,$events,$analytics,$translate,$location,$navUrls,appMetaService,projectService,loaderService,navigationBarService){var un,user;return $log.debug("Initialize application"),$rootscope.contribPlugins=this.taigaContribPlugins,$rootscope.adminPlugins=_.where(this.taigaContribPlugins,{type:"admin"}),$rootscope.$on("$translateChangeEnd",function(e,ctx){var lang;return lang=ctx.language,i18nInit(lang,$translate)}),Promise.setScheduler(function(cb){return $rootscope.$evalAsync(cb)}),$events.setupConnection(),$auth.isAuthenticated()&&(user=$auth.getUser()),$analytics.initialize(),un=$rootscope.$on("$routeChangeStart",function(event,next){return next.loader&&loaderService.start(!0),un()}),$rootscope.$on("$routeChangeSuccess",function(event,next){var description,title;return next.loader&&loaderService.start(!0),next.access&&next.access.requiresLogin&&($auth.isAuthenticated()||$location.path($navUrls.resolve("login"))),projectService.setSection(next.section),next.params.pslug?projectService.setProjectBySlug(next.params.pslug):projectService.cleanProject(),(next.title||next.description)&&(title=$translate.instant(next.title||""),description=$translate.instant(next.description||""),appMetaService.setAll(title,description)),next.mobileViewport?appMetaService.addMobileViewport():appMetaService.removeMobileViewport(),next.disableHeader?navigationBarService.disableHeader():navigationBarService.enableHeader()})},pluginsWithModule=_.filter(this.taigaContribPlugins,function(plugin){return plugin.module}),angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",500),modules=["taigaBase","taigaCommon","taigaResources","taigaResources2","taigaAuth","taigaEvents","taigaHome","taigaNavigationBar","taigaProjects","taigaRelatedTasks","taigaBacklog","taigaTaskboard","taigaKanban","taigaIssues","taigaUserStories","taigaTasks","taigaTeam","taigaWiki","taigaSearch","taigaAdmin","taigaProject","taigaUserSettings","taigaFeedback","taigaPlugins","taigaIntegrations","taigaComponents","taigaProfile","taigaHome","taigaUserTimeline","taigaExternalApps","taigaDiscover","templates","ngSanitize","ngRoute","ngAnimate","ngAria","pascalprecht.translate","infinite-scroll","tgRepeat"].concat(_.map(pluginsWithModule,function(plugin){return plugin.module})),module=angular.module("taiga",modules),module.config(["$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider",configure]),module.run(["$log","$rootScope","$tgAuth","$tgEvents","$tgAnalytics","$translate","$tgLocation","$tgNavUrls","tgAppMetaService","tgProjectService","tgLoader","tgNavigationBarService","$route",init])}).call(this),function(){var TaigaBase,TaigaController,TaigaService,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};TaigaBase=function(){function TaigaBase(){}return TaigaBase}(),TaigaService=function(superClass){function TaigaService(){return TaigaService.__super__.constructor.apply(this,arguments)}return extend(TaigaService,superClass),TaigaService}(TaigaBase),TaigaController=function(superClass){function TaigaController(){return this.onInitialDataError=bind(this.onInitialDataError,this),TaigaController.__super__.constructor.apply(this,arguments)}return extend(TaigaController,superClass),TaigaController.prototype.onInitialDataError=function(xhr){return xhr&&(404===xhr.status?(this.location.path(this.navUrls.resolve("not-found")),this.location.replace()):403===xhr.status&&(this.location.path(this.navUrls.resolve("permission-denied")),this.location.replace())),this.q.reject(xhr)},TaigaController}(TaigaBase),this.taiga.Base=TaigaBase,this.taiga.Service=TaigaService,this.taiga.Controller=TaigaController}.call(this),function(){var bindMethods,bindOnce,cancelTimeout,debounce,debounceLeading,defineImmutableProperty,groupBy,isImage,joinStr,mixOf,nl2br,patch,replaceTags,scopeDefer,sizeFormat,slugify,startswith,stripTags,taiga,timeout,toString,toggleText,trim,truncate,unslugify,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},slice=[].slice,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;nl2br=function(_this){return function(str){var breakTag;return breakTag="<br />",(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2")}}(this),bindMethods=function(_this){return function(object){var dependencies,methods;return dependencies=_.keys(object),methods=[],_.forIn(object,function(value,key){return indexOf.call(dependencies,key)<0?methods.push(key):void 0}),_.bindAll(object,methods)}}(this),bindOnce=function(_this){return function(scope,attr,continuation){var delBind,val;return val=scope.$eval(attr),void 0!==val?continuation(val):(delBind=null,delBind=scope.$watch(attr,function(val){return void 0!==val?(continuation(val),delBind?delBind():void 0):void 0}))}}(this),mixOf=function(){var Mixed,base,i,method,mixin,mixins,name,ref;for(base=arguments[0],mixins=2<=arguments.length?slice.call(arguments,1):[],Mixed=function(superClass){function Mixed(){return Mixed.__super__.constructor.apply(this,arguments)}return extend(Mixed,superClass),Mixed}(base),i=mixins.length-1;i>=0;i+=-1){mixin=mixins[i],ref=mixin.prototype;for(name in ref)method=ref[name],Mixed.prototype[name]=method}return Mixed},trim=function(data,char){return _.str.trim(data,char)},slugify=function(data){return _.str.slugify(data)},unslugify=function(data){return data?_.str.capitalize(data.replace(/-/g," ")):data},toggleText=function(element,texts){var nextTextPosition,text;return nextTextPosition=element.data("nextTextPosition"),(null==nextTextPosition||nextTextPosition>=texts.length)&&(nextTextPosition=0),text=texts[nextTextPosition],element.data("nextTextPosition",nextTextPosition+1),element.text(text)},groupBy=function(coll,pred){var i,item,len,result;for(result={},i=0,len=coll.length;len>i;i++)item=coll[i],result[pred(item)]=item;return result},timeout=function(wait,continuation){return window.setTimeout(continuation,wait)},cancelTimeout=function(timeoutVar){return window.clearTimeout(timeoutVar)},scopeDefer=function(scope,func){return _.defer(function(_this){return function(){return scope.$apply(func)}}(this))},toString=function(value){return _.isNumber(value)?value+"":_.isString(value)?value:_.isPlainObject(value)?JSON.stringify(value):_.isUndefined(value)?"":value.toString()},joinStr=function(str,coll){return _.str.join(str,coll)},debounce=function(wait,func){return _.debounce(func,wait,{leading:!0,trailing:!1})},debounceLeading=function(wait,func){return _.debounce(func,wait,{leading:!1,trailing:!0})},startswith=function(str1,str2){return _.str.startsWith(str1,str2)},truncate=function(str,maxLength,suffix){var out;return null==suffix&&(suffix="..."),"string"==typeof str||str instanceof String?(out=str.slice(0),out.length>maxLength&&(out=out.substring(0,maxLength+1),out=out.substring(0,Math.min(out.length,out.lastIndexOf(" "))),out+=suffix),out):str},sizeFormat=function(input,precision){var number,size,units;return null==precision&&(precision=1),isNaN(parseFloat(input))||!isFinite(input)?"-":0===input?"0 bytes":(units=["bytes","KB","MB","GB","TB","PB"],number=Math.floor(Math.log(input)/Math.log(1024)),number>5&&(number=5),size=(input/Math.pow(1024,number)).toFixed(precision),size+" "+units[number])},stripTags=function(str,exception){var pattern;return exception?(pattern=new RegExp("<(?!"+exception+"s*/?)[^>]+>","gi"),String(str).replace(pattern,"")):String(str).replace(/<\/?[^>]+>/g,"")},replaceTags=function(str,tags,replace){var pattern;return pattern=new RegExp("<("+tags+")>","gi"),str=str.replace(pattern,"<"+replace+">"),pattern=new RegExp("</("+tags+")>","gi"),str=str.replace(pattern,"</"+replace+">")},defineImmutableProperty=function(_this){return function(obj,name,fn){return Object.defineProperty(obj,name,{get:function(){var fn_result;if(!_.isFunction(fn))throw"defineImmutableProperty third param must be a function";if(fn_result=fn(),fn_result&&_.isObject(fn_result)&&void 0===fn_result.size)throw"defineImmutableProperty must return immutable data";return fn_result}})}}(this),_.mixin({removeKeys:function(obj,keys){return _.chain([keys]).flatten().reduce(function(obj,key){return delete obj[key],obj},obj).value()},cartesianProduct:function(){return _.reduceRight(arguments,function(a,b){return _.flatten(_.map(a,function(x){return _.map(b,function(y){return[y].concat(x)})}),!0)},[[]])}}),isImage=function(name){return null!==name.match(/\.(jpe?g|png|gif|gifv|webm)/i)},patch=function(oldImmutable,newImmutable){var pathObj;return pathObj={},newImmutable.forEach(function(newValue,key){return newValue!==oldImmutable.get(key)?newValue.toJS?pathObj[key]=newValue.toJS():pathObj[key]=newValue:void 0}),pathObj},taiga=this.taiga,taiga.nl2br=nl2br,taiga.bindMethods=bindMethods,taiga.bindOnce=bindOnce,taiga.mixOf=mixOf,taiga.trim=trim,taiga.slugify=slugify,taiga.unslugify=unslugify,taiga.toggleText=toggleText,taiga.groupBy=groupBy,taiga.timeout=timeout,taiga.cancelTimeout=cancelTimeout,taiga.scopeDefer=scopeDefer,taiga.toString=toString,taiga.joinStr=joinStr,taiga.truncate=truncate,taiga.debounce=debounce,taiga.debounceLeading=debounceLeading,taiga.startswith=startswith,taiga.sizeFormat=sizeFormat,taiga.stripTags=stripTags,taiga.replaceTags=replaceTags,taiga.defineImmutableProperty=defineImmutableProperty,taiga.isImage=isImage,taiga.patch=patch}.call(this),function(){var FiltersMixin,PageMixin,groupBy,joinStr,taiga,toString,trim;taiga=this.taiga,groupBy=this.taiga.groupBy,joinStr=this.taiga.joinStr,trim=this.taiga.trim,toString=this.taiga.toString,PageMixin=function(){function PageMixin(){}return PageMixin.prototype.fillUsersAndRoles=function(users,roles){var activeUsers,computableRoles;return activeUsers=_.filter(users,function(_this){return function(user){return user.is_active}}(this)),this.scope.activeUsers=_.sortBy(activeUsers,"full_name_display"),this.scope.activeUsersById=groupBy(this.scope.activeUsers,function(e){return e.id}),this.scope.users=_.sortBy(users,"full_name_display"),this.scope.usersById=groupBy(this.scope.users,function(e){return e.id}),this.scope.roles=_.sortBy(roles,"order"),computableRoles=_(this.scope.project.members).map("role").uniq().value(),this.scope.computableRoles=_(roles).filter("computable").filter(function(x){return _.contains(computableRoles,x.id)}).value()},PageMixin.prototype.loadUsersAndRoles=function(){var promise;return promise=this.q.all([this.rs.projects.usersList(this.scope.projectId),this.rs.projects.rolesList(this.scope.projectId)]),promise.then(function(_this){return function(results){var roles,users;return users=results[0],roles=results[1],_this.fillUsersAndRoles(users,roles),results}}(this))},PageMixin}(),taiga.PageMixin=PageMixin,FiltersMixin=function(){function FiltersMixin(){}return FiltersMixin.prototype.selectFilter=function(name,value,load){var existing,location,params;return null==load&&(load=!1),params=this.location.search(),void 0!==params[name]&&"page"!==name&&(existing=_.map(taiga.toString(params[name]).split(","),function(x){return trim(x)}),existing.push(taiga.toString(value)),existing=_.compact(existing),value=joinStr(",",_.uniq(existing))),this.location.isInCurrentRouteParams(name,value)?void 0:(location=load?this.location:this.location.noreload(this.scope),location.search(name,value))},FiltersMixin.prototype.replaceFilter=function(name,value,load){var location;return null==load&&(load=!1),this.location.isInCurrentRouteParams(name,value)?void 0:(location=load?this.location:this.location.noreload(this.scope),location.search(name,value))},FiltersMixin.prototype.replaceAllFilters=function(filters,load){var location;return null==load&&(load=!1),location=load?this.location:this.location.noreload(this.scope),location.search(filters)},FiltersMixin.prototype.unselectFilter=function(name,value,load){var location,newValues,params,parsedValues;return null==load&&(load=!1),params=this.location.search(),void 0!==params[name]?((void 0===value||null===value)&&delete params[name],parsedValues=_.map(taiga.toString(params[name]).split(","),function(x){return trim(x)}),newValues=_.reject(parsedValues,function(x){return x===taiga.toString(value)}),newValues=_.compact(newValues),value=_.isEmpty(newValues)?null:joinStr(",",_.uniq(newValues)),location=load?this.location:this.location.noreload(this.scope),location.search(name,value)):void 0},FiltersMixin}(),taiga.FiltersMixin=FiltersMixin}.call(this),function(){var module;module=angular.module("taigaAdmin",[])}.call(this),function(){var AuthService,CancelAccountDirective,ChangeEmailDirective,ChangePasswordFromRecoveryDirective,ForgotPasswordDirective,InvitationDirective,LoginDirective,PublicRegisterMessageDirective,RegisterDirective,debounce,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,debounce=this.taiga.debounce,module=angular.module("taigaAuth",["taigaResources"]),AuthService=function(superClass){function AuthService(rootscope,storage,model,rs,http,urls,config,translate,currentUserService,themeService){var userModel;this.rootscope=rootscope,this.storage=storage,this.model=model,this.rs=rs,this.http=http,this.urls=urls,this.config=config,this.translate=translate,this.currentUserService=currentUserService,this.themeService=themeService,AuthService.__super__.constructor.call(this),userModel=this.getUser(),this._currentTheme=this._getUserTheme(),this.setUserdata(userModel)}return extend(AuthService,superClass),AuthService.$inject=["$rootScope","$tgStorage","$tgModel","$tgResources","$tgHttp","$tgUrls","$tgConfig","$translate","tgCurrentUserService","tgThemeService"],AuthService.prototype.setUserdata=function(userModel){return userModel?(this.userData=Immutable.fromJS(userModel.getAttrs()),this.currentUserService.setUser(this.userData)):this.userData=null},AuthService.prototype._getUserTheme=function(){var ref;return(null!=(ref=this.rootscope.user)?ref.theme:void 0)||this.config.get("defaultTheme")||"taiga"},AuthService.prototype._setTheme=function(){var newTheme;return newTheme=this._getUserTheme(),this._currentTheme!==newTheme?(this._currentTheme=newTheme,this.themeService.use(this._currentTheme)):void 0},AuthService.prototype._setLocales=function(){var lang,ref;return lang=(null!=(ref=this.rootscope.user)?ref.lang:void 0)||this.config.get("defaultLanguage")||"en",this.translate.preferredLanguage(lang),this.translate.use(lang)},AuthService.prototype.getUser=function(){var user,userData;return this.rootscope.user?this.rootscope.user:(userData=this.storage.get("userInfo"))?(user=this.model.make_model("users",userData),this.rootscope.user=user,this._setLocales(),this._setTheme(),user):(this._setTheme(),null)},AuthService.prototype.setUser=function(user){return this.rootscope.auth=user,this.storage.set("userInfo",user.getAttrs()),this.rootscope.user=user,this.setUserdata(user),this._setLocales(),this._setTheme()},AuthService.prototype.clear=function(){return this.rootscope.auth=null,this.rootscope.user=null,this.storage.remove("userInfo")},AuthService.prototype.setToken=function(token){return this.storage.set("token",token)},AuthService.prototype.getToken=function(){return this.storage.get("token")},AuthService.prototype.removeToken=function(){return this.storage.remove("token")},AuthService.prototype.isAuthenticated=function(){return null!==this.getUser()?!0:!1},AuthService.prototype.login=function(data,type){var url;return url=this.urls.resolve("auth"),data=_.clone(data,!1),data.type=type?type:"normal",this.removeToken(),this.http.post(url,data).then(function(_this){return function(data,status){var user;return user=_this.model.make_model("users",data.data),_this.setToken(user.auth_token),_this.setUser(user),user}}(this))},AuthService.prototype.logout=function(){return this.removeToken(),this.clear(),this.currentUserService.removeUser(),this._setTheme(),this._setLocales()},AuthService.prototype.register=function(data,type,existing){var url;return url=this.urls.resolve("auth-register"),data=_.clone(data,!1),data.type=type?type:"public","private"===type&&(data.existing=existing?existing:!1),this.removeToken(),this.http.post(url,data).then(function(_this){return function(response){var user;return user=_this.model.make_model("users",response.data),_this.setToken(user.auth_token),_this.setUser(user),user}}(this))},AuthService.prototype.getInvitation=function(token){return this.rs.invitations.get(token)},AuthService.prototype.acceptInvitiationWithNewUser=function(data){return this.register(data,"private",!1)},AuthService.prototype.acceptInvitiationWithExistingUser=function(data){return this.register(data,"private",!0)},AuthService.prototype.forgotPassword=function(data){var url;return url=this.urls.resolve("users-password-recovery"),data=_.clone(data,!1),this.removeToken(),this.http.post(url,data)},AuthService.prototype.changePasswordFromRecovery=function(data){var url;return url=this.urls.resolve("users-change-password-from-recovery"),data=_.clone(data,!1),this.removeToken(),this.http.post(url,data)},AuthService.prototype.changeEmail=function(data){var url;return url=this.urls.resolve("users-change-email"),data=_.clone(data,!1),this.http.post(url,data)},AuthService.prototype.cancelAccount=function(data){var url;return url=this.urls.resolve("users-cancel-account"),data=_.clone(data,!1),this.http.post(url,data)},AuthService}(taiga.Service),module.service("$tgAuth",AuthService),PublicRegisterMessageDirective=function($config,$navUrls,$routeParams,templates){var template,templateFn;return template=templates.get("auth/login-text.html",!0),templateFn=function(){var nextUrl,publicRegisterEnabled,url;return(publicRegisterEnabled=$config.get("publicRegisterEnabled"))?(url=$navUrls.resolve("register"),$routeParams.next&&$routeParams.next!==$navUrls.resolve("register")&&(nextUrl=encodeURIComponent($routeParams.next),console.log("-----",nextUrl),url+="?next="+nextUrl),template({url:url})):""},{restrict:"AE",scope:{},template:templateFn}},module.directive("tgPublicRegisterMessage",["$tgConfig","$tgNavUrls","$routeParams","$tgTemplate",PublicRegisterMessageDirective]),LoginDirective=function($auth,$confirm,$location,$config,$routeParams,$navUrls,$events,$translate){var link;return link=function($scope,$el,$attrs){
var form,onError,onSuccess,submit;return form=new checksley.Form($el.find("form.login-form")),$routeParams.next&&$routeParams.next!==$navUrls.resolve("login")?$scope.nextUrl=decodeURIComponent($routeParams.next):$scope.nextUrl=$navUrls.resolve("home"),onSuccess=function(response){return $events.setupConnection(),$location.url($scope.nextUrl)},onError=function(response){return $confirm.notify("light-error",$translate.instant("LOGIN_FORM.ERROR_AUTH_INCORRECT"))},submit=debounce(2e3,function(_this){return function(event){var data,loginFormType,promise;return event.preventDefault(),form.validate()?(data={username:$el.find("form.login-form input[name=username]").val(),password:$el.find("form.login-form input[name=password]").val()},loginFormType=$config.get("loginFormType","normal"),promise=$auth.login(data,loginFormType),promise.then(onSuccess,onError)):void 0}}(this)),$el.on("submit","form",submit),window.prerenderReady=!0,$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgLogin",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgEvents","$translate",LoginDirective]),RegisterDirective=function($auth,$confirm,$location,$navUrls,$config,$routeParams,$analytics,$translate){var link;return link=function($scope,$el,$attrs){var form,onErrorSubmit,onSuccessSubmit,submit;return $config.get("publicRegisterEnabled")||($location.path($navUrls.resolve("not-found")),$location.replace()),$scope.data={},form=$el.find("form").checksley({onlyOneErrorElement:!0}),$routeParams.next&&$routeParams.next!==$navUrls.resolve("register")?$scope.nextUrl=decodeURIComponent($routeParams.next):$scope.nextUrl=$navUrls.resolve("home"),onSuccessSubmit=function(response){return $analytics.trackEvent("auth","register","user registration",1),$confirm.notify("success",$translate.instant("LOGIN_FORM.SUCCESS")),$location.url($scope.nextUrl)},onErrorSubmit=function(response){var text;return response.data._error_message&&(text=$translate.instant("COMMON.GENERIC_ERROR",{error:response.data._error_message}),$confirm.notify("light-error",text)),form.setErrors(response.data)},submit=debounce(2e3,function(_this){return function(event){var promise;return event.preventDefault(),form.validate()?(promise=$auth.register($scope.data),promise.then(onSuccessSubmit,onErrorSubmit)):void 0}}(this)),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()}),window.prerenderReady=!0},{link:link}},module.directive("tgRegister",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$tgConfig","$routeParams","$tgAnalytics","$translate",RegisterDirective]),ForgotPasswordDirective=function($auth,$confirm,$location,$navUrls,$translate){var link;return link=function($scope,$el,$attrs){var form,onErrorSubmit,onSuccessSubmit,submit;return $scope.data={},form=$el.find("form").checksley(),onSuccessSubmit=function(response){var text;return $location.path($navUrls.resolve("login")),text=$translate.instant("FORGOT_PASSWORD_FORM.SUCCESS"),$confirm.success(text)},onErrorSubmit=function(response){var text;return text=$translate.instant("FORGOT_PASSWORD_FORM.ERROR"),$confirm.notify("light-error",text)},submit=debounce(2e3,function(_this){return function(event){var promise;return event.preventDefault(),form.validate()?(promise=$auth.forgotPassword($scope.data),promise.then(onSuccessSubmit,onErrorSubmit)):void 0}}(this)),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()}),window.prerenderReady=!0},{link:link}},module.directive("tgForgotPassword",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$translate",ForgotPasswordDirective]),ChangePasswordFromRecoveryDirective=function($auth,$confirm,$location,$params,$navUrls,$translate){var link;return link=function($scope,$el,$attrs){var form,onErrorSubmit,onSuccessSubmit,submit,text;return $scope.data={},null!=$params.token?($scope.tokenInParams=!0,$scope.data.token=$params.token):($location.path($navUrls.resolve("login")),text=$translate.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),$confirm.notify("light-error",text)),form=$el.find("form").checksley(),onSuccessSubmit=function(response){return $location.path($navUrls.resolve("login")),text=$translate.instant("CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS"),$confirm.success(text)},onErrorSubmit=function(response){return text=$translate.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),$confirm.notify("light-error",text)},submit=debounce(2e3,function(_this){return function(event){var promise;return event.preventDefault(),form.validate()?(promise=$auth.changePasswordFromRecovery($scope.data),promise.then(onSuccessSubmit,onErrorSubmit)):void 0}}(this)),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgChangePasswordFromRecovery",["$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",ChangePasswordFromRecoveryDirective]),InvitationDirective=function($auth,$confirm,$location,$params,$navUrls,$analytics,$translate){var link;return link=function($scope,$el,$attrs){var loginForm,onErrorSubmitLogin,onErrorSubmitRegister,onSuccessSubmitLogin,onSuccessSubmitRegister,promise,registerForm,submitLogin,submitRegister,token;return token=$params.token,promise=$auth.getInvitation(token),promise.then(function(invitation){return $scope.invitation=invitation}),promise.then(null,function(response){var text;return $location.path($navUrls.resolve("login")),text=$translate.instant("INVITATION_LOGIN_FORM.NOT_FOUND"),$confirm.notify("light-error",text)}),$scope.dataLogin={token:token},loginForm=$el.find("form.login-form").checksley({onlyOneErrorElement:!0}),onSuccessSubmitLogin=function(response){var text;return $analytics.trackEvent("auth","invitationAccept","invitation accept with existing user",1),$location.path($navUrls.resolve("project",{project:$scope.invitation.project_slug})),text=$translate.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:$scope.invitation.project_name}),$confirm.notify("success",text)},onErrorSubmitLogin=function(response){return $confirm.notify("light-error",response.data._error_message)},submitLogin=debounce(2e3,function(_this){return function(event){return event.preventDefault(),loginForm.validate()?(promise=$auth.acceptInvitiationWithExistingUser($scope.dataLogin),promise.then(onSuccessSubmitLogin,onErrorSubmitLogin)):void 0}}(this)),$el.on("submit","form.login-form",submitLogin),$el.on("click",".button-login",submitLogin),$scope.dataRegister={token:token},registerForm=$el.find("form.register-form").checksley({onlyOneErrorElement:!0}),onSuccessSubmitRegister=function(response){return $analytics.trackEvent("auth","invitationAccept","invitation accept with new user",1),$location.path($navUrls.resolve("project",{project:$scope.invitation.project_slug})),$confirm.notify("success","You've successfully joined this project","Welcome to "+_.escape($scope.invitation.project_name))},onErrorSubmitRegister=function(response){var text;return response.data._error_message&&(text=$translate.instant("COMMON.GENERIC_ERROR",{error:response.data._error_message}),$confirm.notify("light-error",text)),registerForm.setErrors(response.data)},submitRegister=debounce(2e3,function(_this){return function(event){return event.preventDefault(),registerForm.validate()?(promise=$auth.acceptInvitiationWithNewUser($scope.dataRegister),promise.then(onSuccessSubmitRegister,onErrorSubmitRegister)):void 0}}(this)),$el.on("submit","form.register-form",submitRegister),$el.on("click",".button-register",submitRegister),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgInvitation",["$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$tgAnalytics","$translate",InvitationDirective]),ChangeEmailDirective=function($repo,$model,$auth,$confirm,$location,$params,$navUrls,$translate){var link;return link=function($scope,$el,$attrs){var form,onErrorSubmit,onSuccessSubmit,submit;return $scope.data={},$scope.data.email_token=$params.email_token,form=$el.find("form").checksley(),onSuccessSubmit=function(response){var text;return $auth.isAuthenticated()?$repo.queryOne("users",$auth.getUser().id).then(function(_this){return function(data){return $auth.setUser(data),$location.path($navUrls.resolve("home"))}}(this)):$location.path($navUrls.resolve("login")),text=$translate.instant("CHANGE_EMAIL_FORM.SUCCESS"),$confirm.success(text)},onErrorSubmit=function(response){var text;return text=$translate.instant("COMMON.GENERIC_ERROR",{error:response.data._error_message}),$confirm.notify("light-error",text)},submit=function(){var promise;if(form.validate())return promise=$auth.changeEmail($scope.data),promise.then(onSuccessSubmit,onErrorSubmit)},$el.on("submit",function(event){return event.preventDefault(),submit()}),$el.on("click","a.button-change-email",function(event){return event.preventDefault(),submit()}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgChangeEmail",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",ChangeEmailDirective]),CancelAccountDirective=function($repo,$model,$auth,$confirm,$location,$params,$navUrls){var link;return link=function($scope,$el,$attrs){var form,onErrorSubmit,onSuccessSubmit,submit;return $scope.data={},$scope.data.cancel_token=$params.cancel_token,form=$el.find("form").checksley(),onSuccessSubmit=function(response){var text;return $auth.logout(),$location.path($navUrls.resolve("home")),text=$translate.instant("CANCEL_ACCOUNT.SUCCESS"),$confirm.success(text)},onErrorSubmit=function(response){var text;return text=$translate.instant("COMMON.GENERIC_ERROR",{error:response.data._error_message}),$confirm.notify("error",text)},submit=debounce(2e3,function(_this){return function(event){var promise;return event.preventDefault(),form.validate()?(promise=$auth.cancelAccount($scope.data),promise.then(onSuccessSubmit,onErrorSubmit)):void 0}}(this)),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgCancelAccount",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls",CancelAccountDirective])}.call(this),function(){var module;module=angular.module("taigaBacklog",[])}.call(this),function(){var TaigaMainDirective,bindOnce,groupBy,init,module,taiga,urls;taiga=this.taiga,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,module=angular.module("taigaBase",[]),TaigaMainDirective=function($rootscope,$window){var link;return link=function($scope,$el,$attrs){return $window.onresize=function(){return $rootscope.$broadcast("resize")}},{link:link}},module.directive("tgMain",["$rootScope","$window",TaigaMainDirective]),urls={home:"/",projects:"/projects",error:"/error","not-found":"/not-found","permission-denied":"/permission-denied",discover:"/discover","discover-search":"/discover/search",login:"/login","forgot-password":"/forgot-password","change-password":"/change-password/:token","change-email":"/change-email/:token","cancel-account":"/cancel-account/:token",register:"/register",invitation:"/invitation/:token","create-project":"/create-project",profile:"/profile","user-profile":"/profile/:username",project:"/project/:project","project-backlog":"/project/:project/backlog","project-taskboard":"/project/:project/taskboard/:sprint","project-kanban":"/project/:project/kanban","project-issues":"/project/:project/issues","project-search":"/project/:project/search","project-userstories-detail":"/project/:project/us/:ref","project-tasks-detail":"/project/:project/task/:ref","project-issues-detail":"/project/:project/issue/:ref","project-wiki":"/project/:project/wiki","project-wiki-page":"/project/:project/wiki/:slug","project-team":"/project/:project/team","project-admin-home":"/project/:project/admin/project-profile/details","project-admin-project-profile-details":"/project/:project/admin/project-profile/details","project-admin-project-profile-default-values":"/project/:project/admin/project-profile/default-values","project-admin-project-profile-modules":"/project/:project/admin/project-profile/modules","project-admin-project-profile-export":"/project/:project/admin/project-profile/export","project-admin-project-profile-reports":"/project/:project/admin/project-profile/reports","project-admin-project-values-status":"/project/:project/admin/project-values/status","project-admin-project-values-points":"/project/:project/admin/project-values/points","project-admin-project-values-priorities":"/project/:project/admin/project-values/priorities","project-admin-project-values-severities":"/project/:project/admin/project-values/severities","project-admin-project-values-types":"/project/:project/admin/project-values/types","project-admin-project-values-custom-fields":"/project/:project/admin/project-values/custom-fields","project-admin-memberships":"/project/:project/admin/memberships","project-admin-roles":"/project/:project/admin/roles","project-admin-third-parties-webhooks":"/project/:project/admin/third-parties/webhooks","project-admin-third-parties-github":"/project/:project/admin/third-parties/github","project-admin-third-parties-gitlab":"/project/:project/admin/third-parties/gitlab","project-admin-third-parties-bitbucket":"/project/:project/admin/third-parties/bitbucket","project-admin-contrib":"/project/:project/admin/contrib/:plugin","user-settings-user-profile":"/user-settings/user-profile","user-settings-user-change-password":"/user-settings/user-change-password","user-settings-user-avatar":"/user-settings/user-avatar","user-settings-mail-notifications":"/user-settings/mail-notifications"},init=function($log,$navurls){return $log.debug("Initialize navigation urls"),$navurls.update(urls)},module.run(["$log","$tgNavUrls",init])}.call(this),function(){var AnimationFrame,Capslock,CheckPermissionDirective,ClassPermissionDirective,DataPickerConfig,LimitLineLengthDirective,ProjectUrl,Qqueue,SelectedText,Template,ToggleCommentDirective,module,taiga,slice=[].slice;taiga=this.taiga,module=angular.module("taigaCommon",[]),DataPickerConfig=function($translate){return{get:function(){return{i18n:{previousMonth:$translate.instant("COMMON.PICKERDATE.PREV_MONTH"),nextMonth:$translate.instant("COMMON.PICKERDATE.NEXT_MONTH"),months:[$translate.instant("COMMON.PICKERDATE.MONTHS.JAN"),$translate.instant("COMMON.PICKERDATE.MONTHS.FEB"),$translate.instant("COMMON.PICKERDATE.MONTHS.MAR"),$translate.instant("COMMON.PICKERDATE.MONTHS.APR"),$translate.instant("COMMON.PICKERDATE.MONTHS.MAY"),$translate.instant("COMMON.PICKERDATE.MONTHS.JUN"),$translate.instant("COMMON.PICKERDATE.MONTHS.JUL"),$translate.instant("COMMON.PICKERDATE.MONTHS.AUG"),$translate.instant("COMMON.PICKERDATE.MONTHS.SEP"),$translate.instant("COMMON.PICKERDATE.MONTHS.OCT"),$translate.instant("COMMON.PICKERDATE.MONTHS.NOV"),$translate.instant("COMMON.PICKERDATE.MONTHS.DEC")],weekdays:[$translate.instant("COMMON.PICKERDATE.WEEK_DAYS.SUN"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS.MON"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS.TUE"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS.WED"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS.THU"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS.FRI"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS.SAT")],weekdaysShort:[$translate.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI"),$translate.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT")]},isRTL:"true"===$translate.instant("COMMON.PICKERDATE.IS_RTL"),firstDay:parseInt($translate.instant("COMMON.PICKERDATE.FIRST_DAY_OF_WEEK"),10),format:$translate.instant("COMMON.PICKERDATE.FORMAT")}}}},module.factory("tgDatePickerConfigService",["$translate",DataPickerConfig]),SelectedText=function($window,$document){var get;return get=function(){return $window.getSelection?$window.getSelection().toString():$document.selection?$document.selection.createRange().text:""},{get:get}},module.factory("$selectedText",["$window","$document",SelectedText]),CheckPermissionDirective=function(projectService){var link,render;return render=function($el,project,permission){return project&&permission&&project.get("my_permissions").indexOf(permission)>-1?$el.removeClass("hidden"):void 0},link=function($scope,$el,$attrs){var permission,unObserve,unwatch;return $el.addClass("hidden"),permission=$attrs.tgCheckPermission,unwatch=$scope.$watch(function(){return projectService.project},function(){return projectService.project?(render($el,projectService.project,permission),unwatch()):void 0}),unObserve=$attrs.$observe("tgCheckPermission",function(permission){return permission?(render($el,projectService.project,permission),unObserve()):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},CheckPermissionDirective.$inject=["tgProjectService"],module.directive("tgCheckPermission",CheckPermissionDirective),ClassPermissionDirective=function(){var link,name;return name="tgClassPermission",link=function($scope,$el,$attrs){var checkPermissions,tgClassPermissionWatchAction,unbindWatcher;return checkPermissions=function(project,className,permission){var negation;return negation="!"===permission[0],negation&&(permission=permission.slice(1)),negation&&-1===project.my_permissions.indexOf(permission)?$el.addClass(className):negation||-1===project.my_permissions.indexOf(permission)?$el.removeClass(className):$el.addClass(className)},tgClassPermissionWatchAction=function(project){var className,classes,permission,results;if(project){unbindWatcher(),classes=$scope.$eval($attrs[name]),results=[];for(className in classes)permission=classes[className],results.push(checkPermissions(project,className,permission));return results}},unbindWatcher=$scope.$watch("project",tgClassPermissionWatchAction)},{link:link}},module.directive("tgClassPermission",ClassPermissionDirective),AnimationFrame=function(){var add,animationFrame,performAnimation,tail;return animationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,performAnimation=function(_this){return function(time){var fn;return fn=tail.shift(),fn(),tail.length?animationFrame(performAnimation):void 0}}(this),tail=[],add=function(){var fn,i,len,results;for(results=[],i=0,len=arguments.length;len>i;i++)fn=arguments[i],tail.push(fn),1===tail.length?results.push(animationFrame(performAnimation)):results.push(void 0);return results},{add:add}},module.factory("animationFrame",AnimationFrame),ToggleCommentDirective=function(){var link;return link=function($scope,$el,$attrs){return $el.find("textarea").on("focus",function(){return $el.addClass("active")})},{link:link}},module.directive("tgToggleComment",ToggleCommentDirective),ProjectUrl=function($navurls){var get;return get=function(project){var ctx;return ctx={project:project.slug},project.is_backlog_activated&&project.my_permissions.indexOf("view_us")>-1?$navurls.resolve("project-backlog",ctx):project.is_kanban_activated&&project.my_permissions.indexOf("view_us")>-1?$navurls.resolve("project-kanban",ctx):project.is_wiki_activated&&project.my_permissions.indexOf("view_wiki_pages")>-1?$navurls.resolve("project-wiki",ctx):project.is_issues_activated&&project.my_permissions.indexOf("view_issues")>-1?$navurls.resolve("project-issues",ctx):$navurls.resolve("project",ctx)},{get:get}},module.factory("$projectUrl",["$tgNavUrls",ProjectUrl]),LimitLineLengthDirective=function(){var link;return link=function($scope,$el,$attrs){var maxColsPerLine;return maxColsPerLine=parseInt($el.attr("cols")),$el.on("keyup",function(event){var code,lines;return code=event.keyCode,lines=$el.val().split("\n"),_.each(lines,function(line,index){return lines[index]=line.substring(0,maxColsPerLine-2)}),$el.val(lines.join("\n"))})},{link:link}},module.directive("tgLimitLineLength",LimitLineLengthDirective),Qqueue=function($q){var deferred,lastPromise,qqueue;return deferred=$q.defer(),deferred.resolve(),lastPromise=deferred.promise,qqueue={bindAdd:function(_this){return function(fn){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],lastPromise=lastPromise.then(function(){return fn.apply(_this,args)})}}}(this),add:function(_this){return function(fn){return lastPromise=lastPromise?lastPromise.then(fn):fn(),qqueue}}(this)}},module.factory("$tgQqueue",["$q",Qqueue]),Template=function($templateCache){return{get:function(_this){return function(name,lodash){var tmp;return null==lodash&&(lodash=!1),tmp=$templateCache.get(name),lodash&&(tmp=_.template(tmp)),tmp}}(this)}},module.factory("$tgTemplate",["$templateCache",Template]),Capslock=function($translate){var link;return link=function($scope,$el,$attrs){var hideIcon,open,showIcon,warningIcon;return open=!1,warningIcon=$("<div>").addClass("icon").addClass("icon-capslock").attr("title",$translate.instant("COMMON.CAPSLOCK_WARNING")),hideIcon=function(){return warningIcon.fadeOut(function(){return open=!1,$(this).remove()})},showIcon=function(e){var element;if(!open)return element=e.currentTarget,$(element).parent().append(warningIcon),$(".icon-capslock").fadeIn(),open=!0},$el.on("blur",function(e){return hideIcon()}),$el.on("keyup.capslock, focus",function(e){return $el.val()===$el.val().toLowerCase()?hideIcon(e):showIcon(e)}),$scope.$on("$destroy",function(){return $el.off(".capslock")})},{link:link}},module.directive("tgCapslock",["$translate",Capslock])}.call(this),function(){var EventsProvider,EventsService,bindMethods,module,startswith,taiga,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};taiga=this.taiga,startswith=this.taiga.startswith,bindMethods=this.taiga.bindMethods,module=angular.module("taigaEvents",[]),EventsService=function(){function EventsService(win,log,config,auth,liveAnnouncementService1,rootScope){this.win=win,this.log=log,this.config=config,this.auth=auth,this.liveAnnouncementService=liveAnnouncementService1,this.rootScope=rootScope,this.processMessage=bind(this.processMessage,this),bindMethods(this)}return EventsService.prototype.initialize=function(sessionId){return this.sessionId=sessionId,this.subscriptions={},this.connected=!1,this.error=!1,this.pendingMessages=[],this.missedHeartbeats=0,this.heartbeatInterval=null,void 0===this.win.WebSocket?this.log.info("WebSockets not supported on your browser"):void 0},EventsService.prototype.setupConnection=function(){var loc,path,scheme,url;return this.stopExistingConnection(),(url=this.config.get("eventsUrl"))?(startswith(url,"ws:")||startswith(url,"wss:")||(loc=this.win.location,scheme="https:"===loc.protocol?"wss:":"ws:",path=_.str.ltrim(url,"/"),url=scheme+"//"+loc.host+"/"+path),this.ws=new this.win.WebSocket(url),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.onError),this.ws.addEventListener("close",this.onClose)):void 0},EventsService.prototype.stopExistingConnection=function(){return void 0!==this.ws?(this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("close",this.onClose),this.ws.removeEventListener("error",this.onError),this.ws.removeEventListener("message",this.onMessage),this.stopHeartBeatMessages(),this.ws.close(),delete this.ws):void 0},EventsService.prototype.notifications=function(){return this.subscribe(null,"notifications",function(_this){return function(data){return _this.liveAnnouncementService.show(data.title,data.desc),_this.rootScope.$digest()}}(this))},EventsService.prototype.startHeartBeatMessages=function(){var heartbeatIntervalTime,maxMissedHeartbeats;if(!this.heartbeatInterval)return maxMissedHeartbeats=this.config.get("eventsMaxMissedHeartbeats",5),heartbeatIntervalTime=this.config.get("eventsHeartbeatIntervalTime",6e4),this.missedHeartbeats=0,this.heartbeatInterval=setInterval(function(_this){return function(){var e,error1;try{if(_this.missedHeartbeats>=maxMissedHeartbeats)throw new Error("Too many missed heartbeats PINGs.");return _this.missedHeartbeats++,_this.sendMessage({cmd:"ping"}),_this.log.debug("HeartBeat send PING")}catch(error1){return e=error1,_this.log.error("HeartBeat error: "+e.message),_this.stopHeartBeatMessages()}}}(this),heartbeatIntervalTime),this.log.debug("HeartBeat enabled")},EventsService.prototype.stopHeartBeatMessages=function(){return this.heartbeatInterval?(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null,this.log.debug("HeartBeat disabled")):void 0},EventsService.prototype.processHeartBeatPongMessage=function(data){return this.missedHeartbeats=0,this.log.debug("HeartBeat recived PONG")},EventsService.prototype.serialize=function(message){return _.isObject(message)?JSON.stringify(message):message},EventsService.prototype.sendMessage=function(message){var i,len,messages,msg,results;if(this.pendingMessages.push(message),this.connected){for(messages=_.map(this.pendingMessages,this.serialize),this.pendingMessages=[],results=[],i=0,len=messages.length;len>i;i++)msg=messages[i],results.push(this.ws.send(msg));return results}},EventsService.prototype.processMessage=function(data){var routingKey,subscription;return routingKey=data.routing_key,null!=this.subscriptions[routingKey]?(subscription=this.subscriptions[routingKey],subscription.scope?subscription.scope.$apply(function(){return subscription.callback(data.data)}):subscription.callback(data.data)):void 0},EventsService.prototype.subscribe=function(scope,routingKey,callback){var message,subscription;if(!this.error)return this.log.debug("Subscribe to: "+routingKey),subscription={scope:scope,routingKey:routingKey,callback:_.debounce(callback,500,{leading:!0,trailing:!1})},message={cmd:"subscribe",routing_key:routingKey},this.subscriptions[routingKey]=subscription,this.sendMessage(message),scope?scope.$on("$destroy",function(_this){return function(){return _this.unsubscribe(routingKey)}}(this)):void 0},EventsService.prototype.unsubscribe=function(routingKey){var message;if(!this.error)return this.log.debug("Unsubscribe from: "+routingKey),message={cmd:"unsubscribe",routing_key:routingKey},this.sendMessage(message)},EventsService.prototype.onOpen=function(){var message,token;return this.connected=!0,this.startHeartBeatMessages(),this.notifications(),this.log.debug("WebSocket connection opened"),token=this.auth.getToken(),message={cmd:"auth",data:{token:token,sessionId:this.sessionId}},this.sendMessage(message)},EventsService.prototype.onMessage=function(event){var data;return this.log.debug("WebSocket message received: "+event.data),data=JSON.parse(event.data),"pong"===data.cmd?this.processHeartBeatPongMessage(data):this.processMessage(data)},EventsService.prototype.onError=function(error){return this.log.error("WebSocket error: "+error),this.error=!0},EventsService.prototype.onClose=function(){return this.log.debug("WebSocket closed."),this.connected=!1,this.stopHeartBeatMessages()},EventsService}(),EventsProvider=function(){function EventsProvider(){}return EventsProvider.prototype.setSessionId=function(sessionId){return this.sessionId=sessionId},EventsProvider.prototype.$get=function($win,$log,$conf,$auth,liveAnnouncementService,$rootScope){var service;return service=new EventsService($win,$log,$conf,$auth,liveAnnouncementService,$rootScope),service.initialize(this.sessionId),service},EventsProvider.prototype.$get.$inject=["$window","$log","$tgConfig","$tgAuth","tgLiveAnnouncementService","$rootScope"],EventsProvider}(),module.provider("$tgEvents",EventsProvider)}.call(this),function(){var FeedbackDirective,bindOnce,debounce,groupBy,mixOf,module,taiga,trim;taiga=this.taiga,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,mixOf=this.taiga.mixOf,debounce=this.taiga.debounce,trim=this.taiga.trim,module=angular.module("taigaFeedback",[]),FeedbackDirective=function($lightboxService,$repo,$confirm,$loading,feedbackService){var directive,link;return link=function($scope,$el,$attrs){var form,openLightbox,submit,submitButton;return form=$el.find("form").checksley(),submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.create("feedback",$scope.feedback),promise.then(function(data){return currentLoading.finish(),$lightboxService.close($el),$confirm.notify("success","\\o/ we'll be happy to read your")}),promise.then(null,function(){return currentLoading.finish(),$confirm.notify("error")})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),openLightbox=function(){return $scope.feedback={},$lightboxService.open($el),$el.find("textarea").focus()},$scope.$on("$destroy",function(){return $el.off()}),openLightbox()},directive={link:link,templateUrl:"common/lightbox-feedback.html",scope:{}}},module.directive("tgLbFeedback",["lightboxService","$tgRepo","$tgConfirm","$tgLoading","tgFeedbackService",FeedbackDirective])}.call(this),function(){var module;module=angular.module("taigaIntegrations",[])}.call(this),function(){var module;module=angular.module("taigaIssues",[])}.call(this),function(){var module;module=angular.module("taigaKanban",[])}.call(this),function(){var module;module=angular.module("taigaPlugins",["ngRoute"])}.call(this),function(){var module;module=angular.module("taigaProject",[])}.call(this),function(){var RelatedTaskAssignedToInlineEditionDirective,RelatedTaskCreateButtonDirective,RelatedTaskCreateFormDirective,RelatedTaskRowDirective,RelatedTasksDirective,debounce,module,taiga,trim;taiga=this.taiga,trim=this.taiga.trim,debounce=this.taiga.debounce,module=angular.module("taigaRelatedTasks",[]),RelatedTaskRowDirective=function($repo,$compile,$confirm,$rootscope,$loading,$template,$translate){var link,templateEdit,templateView;return templateView=$template.get("task/related-task-row.html",!0),templateEdit=$template.get("task/related-task-row-edit.html",!0),link=function($scope,$el,$attrs,$model){var renderEdit,renderView,saveTask;return saveTask=debounce(2e3,function(task){var currentLoading,promise;return task.subject=$el.find("input").val(),currentLoading=$loading().target($el.find(".task-name")).start(),promise=$repo.save(task),promise.then(function(_this){return function(){return currentLoading.finish(),$rootscope.$broadcast("related-tasks:update")}}(this)),promise.then(null,function(_this){return function(){return currentLoading.finish(),$el.find("input").val(task.subject),$confirm.notify("error")}}(this)),promise}),renderEdit=function(task){return $el.html($compile(templateEdit({task:task}))($scope)),$el.on("keyup","input",function(event){return 13===event.keyCode?saveTask($model.$modelValue).then(function(){return renderView($model.$modelValue)}):27===event.keyCode?renderView($model.$modelValue):void 0}),$el.on("click",".icon-floppy",function(event){return saveTask($model.$modelValue).then(function(){return renderView($model.$modelValue)})}),$el.on("click",".cancel-edit",function(event){return renderView($model.$modelValue)})},renderView=function(task){var perms;return $el.off(),perms={modify_task:-1!==$scope.project.my_permissions.indexOf("modify_task"),delete_task:-1!==$scope.project.my_permissions.indexOf("delete_task")},$el.html($compile(templateView({task:task,perms:perms}))($scope)),$el.on("click",".icon-edit",function(){return renderEdit($model.$modelValue),$el.find("input").focus().select()}),$el.on("click",".delete-task",function(event){var message,title;return title=$translate.instant("TASK.TITLE_DELETE_ACTION"),task=$model.$modelValue,message=task.subject,$confirm.askOnDelete(title,message).then(function(askResponse){var promise;return promise=$repo.remove(task),promise.then(function(){return askResponse.finish(),$scope.$emit("related-tasks:delete")}),promise.then(null,function(){
return askResponse.finish(!1),$confirm.notify("error")})})})},$scope.$watch($attrs.ngModel,function(val){return val?renderView(val):void 0}),$scope.$on("related-tasks:assigned-to-changed",function(){return $rootscope.$broadcast("related-tasks:update")}),$scope.$on("related-tasks:status-changed",function(){return $rootscope.$broadcast("related-tasks:update")}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,require:"ngModel"}},module.directive("tgRelatedTaskRow",["$tgRepo","$compile","$tgConfirm","$rootScope","$tgLoading","$tgTemplate","$translate",RelatedTaskRowDirective]),RelatedTaskCreateFormDirective=function($repo,$compile,$confirm,$tgmodel,$loading,$analytics,$template){var link,newTask,template;return template=$template.get("task/related-task-create-form.html",!0),newTask={subject:"",assigned_to:null},link=function($scope,$el,$attrs){var close,createTask,render;return createTask=debounce(2e3,function(task){var currentLoading,promise;return task.subject=$el.find("input").val(),task.assigned_to=$scope.newTask.assigned_to,task.status=$scope.newTask.status,$scope.newTask.status=$scope.project.default_task_status,$scope.newTask.assigned_to=null,currentLoading=$loading().target($el.find(".task-name")).start(),promise=$repo.create("tasks",task),promise.then(function(){return $analytics.trackEvent("task","create","create task on userstory",1),currentLoading.finish(),$scope.$emit("related-tasks:add")}),promise.then(null,function(){return $el.find("input").val(task.subject),currentLoading.finish(),$confirm.notify("error")}),promise}),close=function(){return $el.off(),$el.html(""),$scope.newRelatedTaskFormOpen=!1},render=function(){return $scope.newRelatedTaskFormOpen=!0,$el.html($compile(template())($scope)),$el.find("input").focus().select(),$el.addClass("active"),$el.on("keyup","input",function(event){return 13===event.keyCode?createTask(newTask).then(function(){return render()}):27===event.keyCode?$scope.$apply(function(){return close()}):void 0}),$el.on("click",".icon-delete",function(event){return $scope.$apply(function(){return close()})}),$el.on("click",".icon-floppy",function(event){return createTask(newTask).then(function(){return close()})})},taiga.bindOnce($scope,"us",function(val){return newTask.status=$scope.project.default_task_status,newTask.project=$scope.project.id,newTask.user_story=$scope.us.id,$scope.newTask=$tgmodel.make_model("tasks",newTask),$el.html("")}),$scope.$on("related-tasks:show-form",function(){return render()}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgRelatedTaskCreateForm",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgLoading","$tgAnalytics","$tgTemplate",RelatedTaskCreateFormDirective]),RelatedTaskCreateButtonDirective=function($repo,$compile,$confirm,$tgmodel,$template){var link,template;return template=$template.get("common/components/add-button.html",!0),link=function($scope,$el,$attrs){return $scope.$watch("project",function(val){return val?($el.off(),-1!==$scope.project.my_permissions.indexOf("add_task")?$el.html($compile(template())($scope)):$el.html(""),$el.on("click",".add-button",function(event){return $scope.$emit("related-tasks:add-new-clicked")})):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgRelatedTaskCreateButton",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgTemplate",RelatedTaskCreateButtonDirective]),RelatedTasksDirective=function($repo,$rs,$rootscope){var link;return link=function($scope,$el,$attrs){var loadTasks;return loadTasks=function(){return $rs.tasks.list($scope.projectId,null,$scope.usId).then(function(_this){return function(tasks){return $scope.tasks=_.sortBy(tasks,"ref"),tasks}}(this))},$scope.$on("related-tasks:add",function(){return loadTasks().then(function(){return $rootscope.$broadcast("related-tasks:update")})}),$scope.$on("related-tasks:delete",function(){return loadTasks().then(function(){return $rootscope.$broadcast("related-tasks:update")})}),$scope.$on("related-tasks:add-new-clicked",function(){return $scope.$broadcast("related-tasks:show-form")}),taiga.bindOnce($scope,"us",function(val){return loadTasks()}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgRelatedTasks",["$tgRepo","$tgResources","$rootScope",RelatedTasksDirective]),RelatedTaskAssignedToInlineEditionDirective=function($repo,$rootscope,$translate){var link,template;return template=_.template('<img src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>'),link=function($scope,$el,$attrs){var $ctrl,autoSave,notAutoSave,task,updateRelatedTask;return updateRelatedTask=function(task){var ctx,member;return ctx={name:$translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},member=$scope.usersById[task.assigned_to],member&&(ctx.imgurl=member.photo,ctx.name=member.full_name_display),$el.find(".avatar").html(template(ctx)),$el.find(".task-assignedto").attr("title",ctx.name)},$ctrl=$el.controller(),task=$scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition),notAutoSave=$scope.$eval($attrs.notAutoSave),autoSave=!notAutoSave,updateRelatedTask(task),$el.on("click",".task-assignedto",function(event){return $rootscope.$broadcast("assigned-to:add",task)}),taiga.bindOnce($scope,"project",function(project){return-1===project.my_permissions.indexOf("modify_task")?($el.unbind("click"),$el.find("a").addClass("not-clickable")):void 0}),$scope.$on("assigned-to:added",debounce(2e3,function(_this){return function(ctx,userId,updatedRelatedTask){return updatedRelatedTask.id===task.id?(updatedRelatedTask.assigned_to=userId,autoSave&&$repo.save(updatedRelatedTask).then(function(){return $scope.$emit("related-tasks:assigned-to-changed")}),updateRelatedTask(updatedRelatedTask)):void 0}}(this))),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgRelatedTaskAssignedToInlineEdition",["$tgRepo","$rootScope","$translate",RelatedTaskAssignedToInlineEditionDirective])}.call(this),function(){var ResourcesService,initResources,initUrls,module,taiga,urls,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,ResourcesService=function(superClass){function ResourcesService(){return ResourcesService.__super__.constructor.apply(this,arguments)}return extend(ResourcesService,superClass),ResourcesService}(taiga.Service),urls={auth:"/auth","auth-register":"/auth/register",invitations:"/invitations",users:"/users",by_username:"/users/by_username","users-password-recovery":"/users/password_recovery","users-change-password-from-recovery":"/users/change_password_from_recovery","users-change-password":"/users/change_password","users-change-email":"/users/change_email","users-cancel-account":"/users/cancel","user-stats":"/users/%s/stats","user-liked":"/users/%s/liked","user-voted":"/users/%s/voted","user-watched":"/users/%s/watched","user-contacts":"/users/%s/contacts",permissions:"/permissions","notify-policies":"/notify-policies","user-storage":"/user-storage",memberships:"/memberships","bulk-create-memberships":"/memberships/bulk_create",roles:"/roles",permissions:"/permissions",resolver:"/resolver",projects:"/projects","project-templates":"/project-templates","project-modules":"/projects/%s/modules","bulk-update-projects-order":"/projects/bulk_update_order","project-like":"/projects/%s/like","project-unlike":"/projects/%s/unlike","project-watch":"/projects/%s/watch","project-unwatch":"/projects/%s/unwatch","userstory-statuses":"/userstory-statuses",points:"/points","task-statuses":"/task-statuses","issue-statuses":"/issue-statuses","issue-types":"/issue-types",priorities:"/priorities",severities:"/severities",milestones:"/milestones",userstories:"/userstories","bulk-create-us":"/userstories/bulk_create","bulk-update-us-backlog-order":"/userstories/bulk_update_backlog_order","bulk-update-us-sprint-order":"/userstories/bulk_update_sprint_order","bulk-update-us-kanban-order":"/userstories/bulk_update_kanban_order","userstories-filters":"/userstories/filters_data","userstory-upvote":"/userstories/%s/upvote","userstory-downvote":"/userstories/%s/downvote","userstory-watch":"/userstories/%s/watch","userstory-unwatch":"/userstories/%s/unwatch",tasks:"/tasks","bulk-create-tasks":"/tasks/bulk_create","bulk-update-task-taskboard-order":"/tasks/bulk_update_taskboard_order","task-upvote":"/tasks/%s/upvote","task-downvote":"/tasks/%s/downvote","task-watch":"/tasks/%s/watch","task-unwatch":"/tasks/%s/unwatch",issues:"/issues","bulk-create-issues":"/issues/bulk_create","issues-filters":"/issues/filters_data","issue-upvote":"/issues/%s/upvote","issue-downvote":"/issues/%s/downvote","issue-watch":"/issues/%s/watch","issue-unwatch":"/issues/%s/unwatch",wiki:"/wiki","wiki-restore":"/wiki/%s/restore","wiki-links":"/wiki-links","history/us":"/history/userstory","history/issue":"/history/issue","history/task":"/history/task","history/wiki":"/history/wiki","attachments/us":"/userstories/attachments","attachments/issue":"/issues/attachments","attachments/task":"/tasks/attachments","attachments/wiki_page":"/wiki/attachments","custom-attributes/userstory":"/userstory-custom-attributes","custom-attributes/issue":"/issue-custom-attributes","custom-attributes/task":"/task-custom-attributes","custom-attributes-values/userstory":"/userstories/custom-attributes-values","custom-attributes-values/issue":"/issues/custom-attributes-values","custom-attributes-values/task":"/tasks/custom-attributes-values",webhooks:"/webhooks","webhooks-test":"/webhooks/%s/test",webhooklogs:"/webhooklogs","webhooklogs-resend":"/webhooklogs/%s/resend","userstories-csv":"/userstories/csv?uuid=%s","tasks-csv":"/tasks/csv?uuid=%s","issues-csv":"/issues/csv?uuid=%s","timeline-profile":"/timeline/profile","timeline-user":"/timeline/user","timeline-project":"/timeline/project",search:"/search",exporter:"/exporter",importer:"/importer/load_dump",feedback:"/feedback",locales:"/locales",applications:"/applications","application-tokens":"/application-tokens","stats-discover":"/stats/discover"},initUrls=function($log,$urls){return $log.debug("Initialize api urls"),$urls.update(urls)},initResources=function($log,$rs){var i,len,provider,providers,results;for($log.debug("Initialize resources"),providers=_.toArray(arguments).slice(2),results=[],i=0,len=providers.length;len>i;i++)provider=providers[i],results.push(provider($rs));return results},module=angular.module("taigaResources",["taigaBase"]),module.service("$tgResources",ResourcesService),module.run(["$log","$tgUrls",initUrls]),module.run(["$log","$tgResources","$tgProjectsResourcesProvider","$tgCustomAttributesResourcesProvider","$tgCustomAttributesValuesResourcesProvider","$tgMembershipsResourcesProvider","$tgNotifyPoliciesResourcesProvider","$tgInvitationsResourcesProvider","$tgRolesResourcesProvider","$tgUserSettingsResourcesProvider","$tgSprintsResourcesProvider","$tgUserstoriesResourcesProvider","$tgTasksResourcesProvider","$tgIssuesResourcesProvider","$tgWikiResourcesProvider","$tgSearchResourcesProvider","$tgMdRenderResourcesProvider","$tgHistoryResourcesProvider","$tgKanbanResourcesProvider","$tgModulesResourcesProvider","$tgWebhooksResourcesProvider","$tgWebhookLogsResourcesProvider","$tgLocalesResourcesProvider","$tgUsersResourcesProvider",initResources])}.call(this),function(){var SearchBoxDirective,SearchController,SearchDirective,bindOnce,debounce,debounceLeading,groupBy,mixOf,module,taiga,trim,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,mixOf=this.taiga.mixOf,debounceLeading=this.taiga.debounceLeading,trim=this.taiga.trim,debounce=this.taiga.debounce,module=angular.module("taigaSearch",[]),SearchController=function(superClass){function SearchController(scope1,repo,rs,params,q,location,appMetaService,navUrls,translate){var loadSearchData,promise;this.scope=scope1,this.repo=repo,this.rs=rs,this.params=params,this.q=q,this.location=location,this.appMetaService=appMetaService,this.navUrls=navUrls,this.translate=translate,this.scope.sectionName="Search",promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("SEARCH.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.translate.instant("SEARCH.PAGE_DESCRIPTION",{projectName:_this.scope.project.name,projectDescription:_this.scope.project.description}),_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this)),this.scope.searchTerm=null,loadSearchData=debounceLeading(100,function(_this){return function(t){return _this.loadSearchData(t)}}(this)),bindOnce(this.scope,"projectId",function(_this){return function(projectId){return!_this.scope.searchResults&&_this.scope.searchTerm?_this.loadSearchData():void 0}}(this)),this.scope.$watch("searchTerm",function(_this){return function(term){return void 0!==term&&_this.scope.projectId?_this.loadSearchData(term):void 0}}(this))}return extend(SearchController,superClass),SearchController.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$translate"],SearchController.prototype.loadFilters=function(){var defered;return defered=this.q.defer(),defered.resolve(),defered.promise},SearchController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.issueStatusById=groupBy(project.issue_statuses,function(x){return x.id}),_this.scope.taskStatusById=groupBy(project.task_statuses,function(x){return x.id}),_this.scope.severityById=groupBy(project.severities,function(x){return x.id}),_this.scope.priorityById=groupBy(project.priorities,function(x){return x.id}),_this.scope.usStatusById=groupBy(project.us_statuses,function(x){return x.id}),project}}(this))},SearchController.prototype.loadSearchData=function(term){return null==term&&(term=""),this.scope.loading=!0,this._loadSearchData(term).then(function(_this){return function(data){return _this.scope.searchResults=data,_this.scope.loading=!1}}(this))},SearchController.prototype._loadSearchData=function(term){return null==term&&(term=""),this._promise&&this._promise.abort(),this._promise=this.rs.search["do"](this.scope.projectId,term),this._promise},SearchController.prototype.loadInitialData=function(){return this.loadProject().then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.fillUsersAndRoles(project.members,project.roles)}}(this))},SearchController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("SearchController",SearchController),SearchBoxDirective=function(projectService,$lightboxService,$navurls,$location,$route){var link;return link=function($scope,$el,$attrs){var openLightbox,project,submit;return project=null,submit=debounce(2e3,function(_this){return function(event){var form,text,url;return event.preventDefault(),form=$el.find("form").checksley(),form.validate()?(text=$el.find("#search-text").val(),url=$navurls.resolve("project-search",{project:project.get("slug")}),$scope.$apply(function(){return $lightboxService.close($el),$location.path(url),$location.search("text",text).path(url),$route.reload()})):void 0}}(this)),openLightbox=function(){return project=projectService.project,$lightboxService.open($el).then(function(){return $el.find("#search-text").focus()})},$el.on("submit","form",submit),openLightbox()},{templateUrl:"search/lightbox-search.html",link:link}},SearchBoxDirective.$inject=["tgProjectService","lightboxService","$tgNavUrls","$tgLocation","$route"],module.directive("tgSearchBox",SearchBoxDirective),SearchDirective=function($log,$compile,$templatecache,$routeparams,$location){var link,linkTable;return linkTable=function($scope,$el,$attrs,$ctrl){var activeSectionName,applyAutoTab,getActiveSection,lastSearchResults,markSectionTabActive,renderFilterTabs,renderTableContent,tabsDom,templates;return applyAutoTab=!0,activeSectionName="userstories",tabsDom=$el.find(".search-filter"),lastSearchResults=null,getActiveSection=function(data){var i,len,maxVal,name,ref,selectedSection,value;if(maxVal=0,selectedSection={},selectedSection.name="userstories",selectedSection.value=[],!applyAutoTab)return selectedSection.name=activeSectionName,selectedSection.value=data[activeSectionName],selectedSection;if(data)for(ref=["userstories","issues","tasks","wikipages"],i=0,len=ref.length;len>i;i++)if(name=ref[i],value=data[name],value.length>maxVal){maxVal=value.length,selectedSection.name=name,selectedSection.value=value;break}return 0===maxVal?selectedSection:selectedSection},renderFilterTabs=function(data){var name,results,value;results=[];for(name in data)value=data[name],tabsDom.find("li."+name).show(),results.push(tabsDom.find("li."+name+" .num").html(value.length));return results},markSectionTabActive=function(section){return tabsDom.find("a.active").removeClass("active"),tabsDom.find("li."+section.name+" a").addClass("active"),applyAutoTab=!1,activeSectionName=section.name},templates={issues:$templatecache.get("search-issues"),tasks:$templatecache.get("search-tasks"),userstories:$templatecache.get("search-userstories"),wikipages:$templatecache.get("search-wikipages")},renderTableContent=function(section){var element,oldElements,oldScope,scope,template;return oldElements=$el.find(".search-result-table").children(),oldScope=oldElements.scope(),oldScope&&(oldScope.$destroy(),oldElements.remove()),scope=$scope.$new(),scope[section.name]=section.value,template=angular.element.parseHTML(trim(templates[section.name])),element=$compile(template)(scope),$el.find(".search-result-table").html(element)},$scope.$watch("searchResults",function(data){var activeSection;return(lastSearchResults=data)?(activeSection=getActiveSection(data),renderFilterTabs(data),renderTableContent(activeSection),markSectionTabActive(activeSection)):void 0}),$scope.$watch("searchTerm",function(searchTerm){return void 0!==searchTerm?$location.search("text",searchTerm):void 0}),$el.on("click",".search-filter li > a",function(event){var section,sectionData,sectionName,target;return event.preventDefault(),target=angular.element(event.currentTarget),sectionName=target.parent().data("name"),sectionData=lastSearchResults?lastSearchResults[sectionName]:[],section={name:sectionName,value:sectionData},$scope.$apply(function(){return renderTableContent(section),markSectionTabActive(section)})})},link=function($scope,$el,$attrs){var $ctrl,searchText;return $ctrl=$el.controller(),linkTable($scope,$el,$attrs,$ctrl),searchText=$routeparams.text,$scope.$watch("projectId",function(projectId){return null!=projectId?$scope.searchTerm=searchText:void 0})},{link:link}},module.directive("tgSearch",["$log","$compile","$templateCache","$routeParams","$tgLocation",SearchDirective])}.call(this),function(){var module;module=angular.module("taigaTaskboard",[])}.call(this),function(){var module;module=angular.module("taigaTasks",[])}.call(this),function(){var module;module=angular.module("taigaTeam",[])}.call(this),function(){var module;module=angular.module("taigaUserSettings",[])}.call(this),function(){var module;module=angular.module("taigaUserStories",[])}.call(this),function(){var module;module=angular.module("taigaWiki",[])}.call(this),function(){var AnalyticsService,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,module=angular.module("taigaCommon"),AnalyticsService=function(superClass){function AnalyticsService(rootscope,log,config,win,doc,location){var conf;this.rootscope=rootscope,this.log=log,this.config=config,this.win=win,this.doc=doc,this.location=location,this.initialized=!1,conf=this.config.get("analytics",{}),this.accountId=conf.accountId,this.pageEvent=conf.pageEvent||"$routeChangeSuccess",this.trackRoutes=conf.trackRoutes||!0,this.ignoreFirstPageLoad=conf.ignoreFirstPageLoad||!1}return extend(AnalyticsService,superClass),AnalyticsService.$inject=["$rootScope","$log","$tgConfig","$window","$document","$location"],AnalyticsService.prototype.initialize=function(){return this.accountId?(this.injectAnalytics(),this.win.ga("create",this.accountId,"auto"),this.win.ga("require","displayfeatures"),this.trackRoutes&&!this.ignoreFirstPageLoad&&this.win.ga("send","pageview",this.getUrl()),this.trackRoutes&&this.rootscope.$on(this.pageEvent,function(_this){return function(){return _this.trackPage(_this.getUrl(),"Taiga")}}(this)),this.initialized=!0):void this.log.debug("Analytics: no acount id provided. Disabling.")},AnalyticsService.prototype.getUrl=function(){return this.location.path()},AnalyticsService.prototype.injectAnalytics=function(){var fn;return(fn=function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r,i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src=g,m.parentNode.insertBefore(a,m)})(window,document,"script","//www.google-analytics.com/analytics.js","ga")},AnalyticsService.prototype.trackPage=function(url,title){return this.initialized&&this.win.ga?(title=title||this.doc[0].title,this.win.ga("send","pageview",{page:url,title:title})):void 0},AnalyticsService.prototype.trackEvent=function(category,action,label,value){return this.initialized&&this.win.ga?this.win.ga("send","event",category,action,label,value):void 0},AnalyticsService}(taiga.Service),module.service("$tgAnalytics",AnalyticsService)}.call(this),function(){var BindScope,module;module=angular.module("taigaCommon"),BindScope=function(config){var link;return config.debugInfo||(jQuery.fn.scope=function(){return this.data("scope")}),link=function($scope,$el){return config.debugInfo?void 0:$el.data("scope",$scope).addClass("tg-scope")},{link:link}},module.directive("tgBindScope",["$tgConfig",BindScope])}.call(this),function(){var CompileHtmlDirective;CompileHtmlDirective=function($compile){var link;return link=function(scope,element,attrs){return scope.$watch(attrs.tgCompileHtml,function(newValue,oldValue){return element.html(newValue),$compile(element.contents())(scope)})},{link:link}},CompileHtmlDirective.$inject=["$compile"],angular.module("taigaCommon").directive("tgCompileHtml",CompileHtmlDirective)}.call(this),function(){var AssignedToDirective,BlockButtonDirective,CreatedByDisplayDirective,DateRangeDirective,DateSelectorDirective,DeleteButtonDirective,EditableDescriptionDirective,EditableSubjectDirective,EditableWysiwyg,ListItemAssignedtoDirective,ListItemIssueStatusDirective,ListItemPriorityDirective,ListItemSeverityDirective,ListItemTaskStatusDirective,ListItemTypeDirective,ListItemUsStatusDirective,SprintProgressBarDirective,TgMainTitleDirective,TgProgressBarDirective,WatchersDirective,bindOnce,module,taiga;taiga=this.taiga,bindOnce=this.taiga.bindOnce,module=angular.module("taigaCommon"),DateRangeDirective=function($translate){var link,renderRange;return renderRange=function($el,first,second){var endDate,initDate,prettyDate;return prettyDate=$translate.instant("BACKLOG.SPRINTS.DATE"),initDate=moment(first).format(prettyDate),endDate=moment(second).format(prettyDate),$el.html(initDate+"-"+endDate)},link=function($scope,$el,$attrs){var first,ref,second;return ref=$attrs.tgDateRange.split(","),first=ref[0],second=ref[1],bindOnce($scope,first,function(valFirst){return bindOnce($scope,second,function(valSecond){return renderRange($el,valFirst,valSecond)})})},{link:link}},module.directive("tgDateRange",["$translate",DateRangeDirective]),DateSelectorDirective=function($rootscope,datePickerConfigService){var link;return link=function($scope,$el,$attrs,$model){var initialize,selectedDate,unbind;return selectedDate=null,initialize=function(){var datePickerConfig;return datePickerConfig=datePickerConfigService.get(),_.merge(datePickerConfig,{field:$el[0],onSelect:function(_this){return function(date){return selectedDate=date}}(this),onOpen:function(_this){return function(){return null!=selectedDate?$el.picker.setDate(selectedDate):void 0}}(this)}),$el.picker=new Pikaday(datePickerConfig)},unbind=$rootscope.$on("$translateChangeEnd",function(_this){return function(ctx){return initialize()}}(this)),$scope.$watch($attrs.ngModel,function(val){return null==val||$el.picker||initialize(),null!=val?$el.picker.setDate(val):void 0}),$scope.$on("$destroy",function(){return $el.off(),unbind()})},{link:link,require:"ngModel"}},module.directive("tgDateSelector",["$rootScope","tgDatePickerConfigService",DateSelectorDirective]),SprintProgressBarDirective=function(){var link,renderProgress;return renderProgress=function($el,percentage,visual_percentage){return $el.hasClass(".current-progress")?$el.css("width",percentage+"%"):($el.find(".current-progress").css("width",visual_percentage+"%"),$el.find(".number").html(percentage+" %"))},link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.tgSprintProgressbar,function(sprint){var closedPoints,percentage,totalPoints,visual_percentage;return closedPoints=sprint.closed_points,totalPoints=sprint.total_points,percentage=0,0!==totalPoints&&(percentage=Math.round(100*(closedPoints/totalPoints))),visual_percentage=0,0!==totalPoints&&(visual_percentage=Math.round(98*(closedPoints/totalPoints))),renderProgress($el,percentage,visual_percentage)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgSprintProgressbar",SprintProgressBarDirective),CreatedByDisplayDirective=function($template,$compile,$translate,$navUrls){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.ngModel,function(model){var ref;return null!=model?($scope.owner=model.owner_extra_info||{full_name_display:$translate.instant("COMMON.EXTERNAL_USER"),photo:"/"+window._version+"/images/user-noimage.png"},$scope.url=(null!=(ref=$scope.owner)?ref.is_active:void 0)?$navUrls.resolve("user-profile",{username:$scope.owner.username}):"",$scope.date=moment(model.created_date).format($translate.instant("COMMON.DATETIME"))):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel",scope:!0,templateUrl:"common/components/created-by.html"}},module.directive("tgCreatedByDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls",CreatedByDisplayDirective]),WatchersDirective=function($rootscope,$confirm,$repo,$qqueue,$template,$compile,$translate){var link,template;return template=$template.get("common/components/watchers.html",!0),link=function($scope,$el,$attrs,$model){var deleteWatcher,isEditable,renderWatchers,save;return isEditable=function(){var ref,ref1;return-1!==(null!=(ref=$scope.project)&&null!=(ref1=ref.my_permissions)?ref1.indexOf($attrs.requiredPerm):void 0)},save=$qqueue.bindAdd(function(_this){return function(watchers){var item,promise;return item=$model.$modelValue.clone(),item.watchers=watchers,$model.$setViewValue(item),promise=$repo.save($model.$modelValue),promise.then(function(){return watchers=_.map(watchers,function(watcherId){return $scope.usersById[watcherId]}),renderWatchers(watchers),$rootscope.$broadcast("object:updated")}),promise.then(null,function(){return $model.$modelValue.revert(),$confirm.notify("error")})}}(this)),deleteWatcher=$qqueue.bindAdd(function(_this){return function(watcherIds){var item,promise;return item=$model.$modelValue.clone(),item.watchers=watcherIds,$model.$setViewValue(item),promise=$repo.save($model.$modelValue),promise.then(function(){var watchers;return watchers=_.map(item.watchers,function(watcherId){return $scope.usersById[watcherId]}),renderWatchers(watchers),$rootscope.$broadcast("object:updated")}),promise.then(null,function(){return item.revert(),$confirm.notify("error")})}}(this)),renderWatchers=function(watchers){var ctx,html;return ctx={watchers:watchers,isEditable:isEditable()},html=$compile(template(ctx))($scope),$el.html(html)},$el.on("click",".js-delete-watcher",function(event){var message,target,title,watcherId;return event.preventDefault(),isEditable()?(target=angular.element(event.currentTarget),watcherId=target.data("watcher-id"),title=$translate.instant("COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER"),message=$scope.usersById[watcherId].full_name_display,$confirm.askOnDelete(title,message).then(function(_this){return function(askResponse){var watcherIds;return askResponse.finish(),watcherIds=_.clone($model.$modelValue.watchers,!1),watcherIds=_.pull(watcherIds,watcherId),deleteWatcher(watcherIds)}}(this))):void 0}),$scope.$on("watcher:added",function(ctx,watcherId){var watchers;return watchers=_.clone($model.$modelValue.watchers,!1),watchers.push(watcherId),watchers=_.uniq(watchers),save(watchers)}),$scope.$watch($attrs.ngModel,function(item){var watchers;if(null!=item)return watchers=_.map(item.watchers,function(watcherId){return $scope.usersById[watcherId]}),renderWatchers(watchers)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,require:"ngModel"}},module.directive("tgWatchers",["$rootScope","$tgConfirm","$tgRepo","$tgQqueue","$tgTemplate","$compile","$translate",WatchersDirective]),AssignedToDirective=function($rootscope,$confirm,$repo,$loading,$qqueue,$template,$translate,$compile,$currentUserService){var link,template;return template=$template.get("common/components/assigned-to.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,renderAssignedTo,save;return isEditable=function(){var ref,ref1;return-1!==(null!=(ref=$scope.project)&&null!=(ref1=ref.my_permissions)?ref1.indexOf($attrs.requiredPerm):void 0)},save=$qqueue.bindAdd(function(_this){return function(userId){var currentLoading,promise;return $model.$modelValue.assigned_to=userId,currentLoading=$loading().target($el).start(),promise=$repo.save($model.$modelValue),promise.then(function(){return currentLoading.finish(),renderAssignedTo($model.$modelValue),$rootscope.$broadcast("object:updated")}),promise.then(null,function(){return $model.$modelValue.revert(),$confirm.notify("error"),currentLoading.finish()}),promise}}(this)),renderAssignedTo=function(assignedObject){var ctx,fullName,html,isIocaine,isUnassigned,photo;return null!=(null!=assignedObject?assignedObject.assigned_to:void 0)?(fullName=assignedObject.assigned_to_extra_info.full_name_display,photo=assignedObject.assigned_to_extra_info.photo,isUnassigned=!1):(fullName=$translate.instant("COMMON.ASSIGNED_TO.ASSIGN"),photo="/"+window._version+"/images/unnamed.png",isUnassigned=!0),isIocaine=null!=assignedObject?assignedObject.is_iocaine:void 0,ctx={fullName:fullName,photo:photo,isUnassigned:isUnassigned,isEditable:isEditable(),isIocaine:isIocaine,fullNameVisible:!(isUnassigned&&!$currentUserService.isAuthenticated())},html=$compile(template(ctx))($scope),$el.html(html)},$el.on("click",".user-assigned",function(event){return event.preventDefault(),isEditable()?$scope.$apply(function(){return $rootscope.$broadcast("assigned-to:add",$model.$modelValue)}):void 0}),$el.on("click",".assign-to-me",function(event){return event.preventDefault(),isEditable()?($model.$modelValue.assigned_to=$currentUserService.getUser().get("id"),save($currentUserService.getUser().get("id"))):void 0}),$el.on("click",".icon-delete",function(event){var title;return event.preventDefault(),isEditable()?(title=$translate.instant("COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED"),
$confirm.ask(title).then(function(_this){return function(response){return response.finish(),$model.$modelValue.assigned_to=null,save(null)}}(this))):void 0}),$scope.$on("assigned-to:added",function(ctx,userId,item){return item.id===$model.$modelValue.id?save(userId):void 0}),$scope.$watch($attrs.ngModel,function(instance){return renderAssignedTo(instance)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,require:"ngModel"}},module.directive("tgAssignedTo",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQqueue","$tgTemplate","$translate","$compile","tgCurrentUserService",AssignedToDirective]),BlockButtonDirective=function($rootscope,$loading,$template){var link,template;return template=$template.get("common/components/block-button.html"),link=function($scope,$el,$attrs,$model){var isEditable;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_us")},$scope.$watch($attrs.ngModel,function(item){return item?(isEditable()&&$el.find(".item-block").addClass("editable"),item.is_blocked?($el.find(".item-block").removeClass("is-active"),$el.find(".item-unblock").addClass("is-active")):($el.find(".item-block").addClass("is-active"),$el.find(".item-unblock").removeClass("is-active"))):void 0}),$el.on("click",".item-block",function(event){return event.preventDefault(),$rootscope.$broadcast("block",$model.$modelValue)}),$el.on("click",".item-unblock",function(event){var currentLoading,finish;return event.preventDefault(),currentLoading=$loading().target($el.find(".item-unblock")).start(),finish=function(){return currentLoading.finish()},$rootscope.$broadcast("unblock",$model.$modelValue,finish)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel",template:template}},module.directive("tgBlockButton",["$rootScope","$tgLoading","$tgTemplate",BlockButtonDirective]),DeleteButtonDirective=function($log,$repo,$confirm,$location,$template){var link,template;return template=$template.get("common/components/delete-button.html"),link=function($scope,$el,$attrs,$model){return $attrs.onDeleteGoToUrl?$attrs.onDeleteTitle?($el.on("click",".button-delete",function(event){var subtitle,title;return title=$attrs.onDeleteTitle,subtitle=$model.$modelValue.subject,$confirm.askOnDelete(title,subtitle).then(function(_this){return function(askResponse){var promise;return promise=$repo.remove($model.$modelValue),promise.then(function(){var url;return askResponse.finish(),url=$scope.$eval($attrs.onDeleteGoToUrl),$location.path(url)}),promise.then(null,function(){return askResponse.finish(!1),$confirm.notify("error")})}}(this))}),$scope.$on("$destroy",function(){return $el.off()})):$log.error("DeleteButtonDirective requires on-delete-title set in scope."):$log.error("DeleteButtonDirective requires on-delete-go-to-url set in scope.")},{link:link,restrict:"EA",require:"ngModel",template:template}},module.directive("tgDeleteButton",["$log","$tgRepo","$tgConfirm","$tgLocation","$tgTemplate",DeleteButtonDirective]),EditableSubjectDirective=function($rootscope,$repo,$confirm,$loading,$qqueue,$template){var link,template;return template=$template.get("common/components/editable-subject.html"),link=function($scope,$el,$attrs,$model){var isEditable,save;return $scope.$on("object:updated",function(){return $el.find(".edit-subject").hide(),$el.find(".view-subject").show()}),isEditable=function(){return-1!==$scope.project.my_permissions.indexOf($attrs.requiredPerm)},save=$qqueue.bindAdd(function(_this){return function(subject){var currentLoading,promise;return $model.$modelValue.subject=subject,currentLoading=$loading().target($el.find(".save-container")).start(),promise=$repo.save($model.$modelValue),promise.then(function(){return $confirm.notify("success"),$rootscope.$broadcast("object:updated"),$el.find(".edit-subject").hide(),$el.find(".view-subject").show()}),promise.then(null,function(){return $confirm.notify("error")}),promise["finally"](function(){return currentLoading.finish()}),promise}}(this)),$el.click(function(){return isEditable()?($el.find(".edit-subject").show(),$el.find(".view-subject").hide(),$el.find("input").focus()):void 0}),$el.on("click",".save",function(e){var subject;return e.preventDefault(),subject=$scope.item.subject,save(subject)}),$el.on("keyup","input",function(event){var subject;return 13===event.keyCode?(subject=$scope.item.subject,save(subject)):27===event.keyCode?($scope.$apply(function(_this){return function(){return $model.$modelValue.revert()}}(this)),$el.find("div.edit-subject").hide(),$el.find("div.view-subject").show()):void 0}),$el.find("div.edit-subject").hide(),$el.find("div.view-subject span.edit").hide(),$scope.$watch($attrs.ngModel,function(value){return value?($scope.item=value,isEditable()?void 0:$el.find(".view-subject .edit").remove()):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel",template:template}},module.directive("tgEditableSubject",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate",EditableSubjectDirective]),EditableDescriptionDirective=function($rootscope,$repo,$confirm,$compile,$loading,$selectedText,$qqueue,$template){var link,noDescriptionMegEditMode,noDescriptionMegReadMode,template;return template=$template.get("common/components/editable-description.html"),noDescriptionMegEditMode=$template.get("common/components/editable-description-msg-edit-mode.html"),noDescriptionMegReadMode=$template.get("common/components/editable-description-msg-read-mode.html"),link=function($scope,$el,$attrs,$model){var isEditable,save;return $el.find(".edit-description").hide(),$el.find(".view-description .edit").hide(),$scope.$on("object:updated",function(){return $el.find(".edit-description").hide(),$el.find(".view-description").show()}),isEditable=function(){return-1!==$scope.project.my_permissions.indexOf($attrs.requiredPerm)},save=$qqueue.bindAdd(function(_this){return function(description){var currentLoading,promise;return $model.$modelValue.description=description,currentLoading=$loading().target($el.find(".save-container")).start(),promise=$repo.save($model.$modelValue),promise.then(function(){return $confirm.notify("success"),$rootscope.$broadcast("object:updated"),$el.find(".edit-description").hide(),$el.find(".view-description").show()}),promise.then(null,function(){return $confirm.notify("error")}),promise["finally"](function(){return currentLoading.finish()})}}(this)),$el.on("mouseup",".view-description",function(event){var target;return target=angular.element(event.target),!isEditable()||target.is("a")||$selectedText.get().length?void 0:($el.find(".edit-description").show(),$el.find(".view-description").hide(),$el.find("textarea").focus())}),$el.on("click","a",function(event){var href,target;return target=angular.element(event.target),href=target.attr("href"),0===href.indexOf("#")?(event.preventDefault(),$("body").scrollTop($(href).offset().top)):void 0}),$el.on("click",".save",function(e){var description;return e.preventDefault(),description=$scope.item.description,save(description)}),$el.on("keydown","textarea",function(event){return 27===event.keyCode?($scope.$apply(function(_this){return function(){return $scope.item.revert()}}(this)),$el.find(".edit-description").hide(),$el.find(".view-description").show()):void 0}),$scope.$watch($attrs.ngModel,function(value){return value?($scope.item=value,isEditable()?($el.find(".view-description .edit").show(),$el.find(".view-description .us-content").addClass("editable"),$scope.noDescriptionMsg=$compile(noDescriptionMegEditMode)($scope)):$scope.noDescriptionMsg=$compile(noDescriptionMegReadMode)($scope)):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel",template:template}},module.directive("tgEditableDescription",["$rootScope","$tgRepo","$tgConfirm","$compile","$tgLoading","$selectedText","$tgQqueue","$tgTemplate",EditableDescriptionDirective]),EditableWysiwyg=function(attachmentsService,attachmentsFullService){var link;return link=function($scope,$el,$attrs,$model){var isInEditMode,uploadFile;return isInEditMode=function(){return $el.find("textarea").is(":visible")},uploadFile=function(file,type){return attachmentsService.validate(file)?attachmentsFullService.addAttachment($model.$modelValue.project,$model.$modelValue.id,type,file).then(function(result){return taiga.isImage(result.getIn(["file","name"]))?"!["+result.getIn(["file","name"])+"]("+result.getIn(["file","url"])+")":"["+result.getIn(["file","name"])+"]("+result.getIn(["file","url"])+")"}):void 0},$el.on("dragover",function(e){var textarea;return textarea=$el.find("textarea").focus(),!1}),$el.on("drop",function(e){var dataTransfer,promises,textarea,type;return e.stopPropagation(),e.preventDefault(),isInEditMode()?(dataTransfer=e.dataTransfer||e.originalEvent&&e.originalEvent.dataTransfer,textarea=$el.find("textarea"),textarea.addClass("in-progress"),type=$model.$modelValue._name,"userstories"===type?type="us":"tasks"===type?type="task":"issues"===type?type="issue":"wiki"===type&&(type="wiki_page"),promises=_.map(dataTransfer.files,function(file){return uploadFile(file,type)}),Promise.all(promises).then(function(result){return textarea=$el.find("textarea"),$.markItUp({replaceWith:result.join(" ")}),textarea.removeClass("in-progress")})):void 0})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgEditableWysiwyg",["tgAttachmentsService","tgAttachmentsFullService",EditableWysiwyg]),ListItemUsStatusDirective=function(){var link;return link=function($scope,$el,$attrs){var us;return us=$scope.$eval($attrs.tgListitemUsStatus),bindOnce($scope,"usStatusById",function(usStatusById){return $el.html(usStatusById[us.status].name)})},{link:link}},module.directive("tgListitemUsStatus",ListItemUsStatusDirective),ListItemTaskStatusDirective=function(){var link;return link=function($scope,$el,$attrs){var task;return task=$scope.$eval($attrs.tgListitemTaskStatus),bindOnce($scope,"taskStatusById",function(taskStatusById){return $el.html(taskStatusById[task.status].name)})},{link:link}},module.directive("tgListitemTaskStatus",ListItemTaskStatusDirective),ListItemAssignedtoDirective=function($template,$translate){var link,template;return template=$template.get("common/components/list-item-assigned-to-avatar.html",!0),link=function($scope,$el,$attrs){return bindOnce($scope,"usersById",function(usersById){var ctx,item,member;return item=$scope.$eval($attrs.tgListitemAssignedto),ctx={name:$translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},member=usersById[item.assigned_to],member&&(ctx.imgurl=member.photo,ctx.name=member.full_name_display),$el.html(template(ctx))})},{link:link}},module.directive("tgListitemAssignedto",["$tgTemplate","$translate",ListItemAssignedtoDirective]),ListItemIssueStatusDirective=function(){var link;return link=function($scope,$el,$attrs){var issue;return issue=$scope.$eval($attrs.tgListitemIssueStatus),bindOnce($scope,"issueStatusById",function(issueStatusById){return $el.html(issueStatusById[issue.status].name)})},{link:link}},module.directive("tgListitemIssueStatus",ListItemIssueStatusDirective),ListItemTypeDirective=function(){var link;return link=function($scope,$el,$attrs){var render;return render=function(issueTypeById,issue){var domNode,type;return type=issueTypeById[issue.type],domNode=$el.find(".level"),domNode.css("background-color",type.color),domNode.attr("title",type.name)},bindOnce($scope,"issueTypeById",function(issueTypeById){var issue;return issue=$scope.$eval($attrs.tgListitemType),render(issueTypeById,issue)}),$scope.$watch($attrs.tgListitemType,function(issue){return render($scope.issueTypeById,issue)})},{link:link,templateUrl:"common/components/level.html"}},module.directive("tgListitemType",ListItemTypeDirective),ListItemPriorityDirective=function(){var link;return link=function($scope,$el,$attrs){var render;return render=function(priorityById,issue){var domNode,priority;return priority=priorityById[issue.priority],domNode=$el.find(".level"),domNode.css("background-color",priority.color),domNode.attr("title",priority.name)},bindOnce($scope,"priorityById",function(priorityById){var issue;return issue=$scope.$eval($attrs.tgListitemPriority),render(priorityById,issue)}),$scope.$watch($attrs.tgListitemPriority,function(issue){return render($scope.priorityById,issue)})},{link:link,templateUrl:"common/components/level.html"}},module.directive("tgListitemPriority",ListItemPriorityDirective),ListItemSeverityDirective=function(){var link;return link=function($scope,$el,$attrs){var render;return render=function(severityById,issue){var domNode,severity;return severity=severityById[issue.severity],domNode=$el.find(".level"),domNode.css("background-color",severity.color),domNode.attr("title",severity.name)},bindOnce($scope,"severityById",function(severityById){var issue;return issue=$scope.$eval($attrs.tgListitemSeverity),render(severityById,issue)}),$scope.$watch($attrs.tgListitemSeverity,function(issue){return render($scope.severityById,issue)})},{link:link,templateUrl:"common/components/level.html"}},module.directive("tgListitemSeverity",ListItemSeverityDirective),TgProgressBarDirective=function($template){var link,render,template;return template=$template.get("common/components/progress-bar.html",!0),render=function(el,percentage){return el.html(template({percentage:percentage}))},link=function($scope,$el,$attrs){var element;return element=angular.element($el),$scope.$watch($attrs.tgProgressBar,function(percentage){return percentage=_.max([0,percentage]),percentage=_.min([100,percentage]),render($el,percentage)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgProgressBar",["$tgTemplate",TgProgressBarDirective]),TgMainTitleDirective=function($translate){var link;return link=function($scope,$el,$attrs){return $attrs.$observe("i18nSectionName",function(i18nSectionName){return $scope.sectionName=i18nSectionName}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,templateUrl:"common/components/main-title.html",scope:{projectName:"=projectName"}}},module.directive("tgMainTitle",["$translate",TgMainTitleDirective])}.call(this),function(){var ConfirmService,NOTIFICATION_MSG,bindMethods,cancelTimeout,debounce,module,taiga,timeout,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,timeout=this.taiga.timeout,cancelTimeout=this.taiga.cancelTimeout,debounce=this.taiga.debounce,bindMethods=this.taiga.bindMethods,NOTIFICATION_MSG={success:{title:"NOTIFICATION.OK",message:"NOTIFICATION.SAVED"},error:{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"},"light-error":{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"}},ConfirmService=function(superClass){function ConfirmService(q,lightboxService,loading,translate){this.q=q,this.lightboxService=lightboxService,this.loading=loading,this.translate=translate,bindMethods(this)}return extend(ConfirmService,superClass),ConfirmService.$inject=["$q","lightboxService","$tgLoading","$translate"],ConfirmService.prototype.hide=function(el){return el?(this.lightboxService.close(el),el.off(".confirm-dialog")):void 0},ConfirmService.prototype.ask=function(title,subtitle,message,lightboxSelector){var defered,el;return null==lightboxSelector&&(lightboxSelector=".lightbox-generic-ask"),defered=this.q.defer(),el=angular.element(lightboxSelector),el.find("h2.title").text(title),el.find("span.subtitle").text(subtitle),el.find("span.message").text(message),el.on("click.confirm-dialog","a.button-green",debounce(2e3,function(_this){return function(event){var currentLoading,target;return event.preventDefault(),target=angular.element(event.currentTarget),currentLoading=_this.loading().target(target).start(),defered.resolve({finish:function(ok){return null==ok&&(ok=!0),currentLoading.finish(),ok?_this.hide(el):void 0}})}}(this))),el.on("click.confirm-dialog","a.button-red",function(_this){return function(event){return event.preventDefault(),defered.reject(),_this.hide(el)}}(this)),this.lightboxService.open(el),defered.promise},ConfirmService.prototype.askOnDelete=function(title,message){return this.ask(title,this.translate.instant("NOTIFICATION.ASK_DELETE"),message)},ConfirmService.prototype.askChoice=function(title,subtitle,choices,replacement,warning,lightboxSelector){var choicesField,defered,el;return null==lightboxSelector&&(lightboxSelector=".lightbox-ask-choice"),defered=this.q.defer(),el=angular.element(lightboxSelector),el.find(".title").text(title),el.find(".subtitle").text(subtitle),replacement?el.find(".replacement").text(replacement):el.find(".replacement").remove(),warning?el.find(".warning").text(warning):el.find(".warning").remove(),choicesField=el.find(".choices"),choicesField.html(""),_.each(choices,function(value,key){return value=_.escape(value),choicesField.append(angular.element("<option value='"+key+"'>"+value+"</option>"))}),el.on("click.confirm-dialog","a.button-green",debounce(2e3,function(_this){return function(event){var currentLoading,target;return event.preventDefault(),target=angular.element(event.currentTarget),currentLoading=_this.loading().target(target).start(),defered.resolve({selected:choicesField.val(),finish:function(ok){return null==ok&&(ok=!0),currentLoading.finish(),ok?_this.hide(el):void 0}})}}(this))),el.on("click.confirm-dialog","a.button-red",function(_this){return function(event){return event.preventDefault(),defered.reject(),_this.hide(el)}}(this)),this.lightboxService.open(el),defered.promise},ConfirmService.prototype.error=function(message){var defered,el;return defered=this.q.defer(),el=angular.element(".lightbox-generic-error"),el.find("h2.title").html(message),el.on("click.confirm-dialog","a.button-green",function(_this){return function(event){return event.preventDefault(),defered.resolve(),_this.hide(el)}}(this)),el.on("click.confirm-dialog","a.close",function(_this){return function(event){return event.preventDefault(),defered.resolve(),_this.hide(el)}}(this)),this.lightboxService.open(el),defered.promise},ConfirmService.prototype.success=function(title,message){var defered,el;return defered=this.q.defer(),el=angular.element(".lightbox-generic-success"),title&&el.find("h2.title").html(title),message&&el.find("p.message").html(message),el.on("click.confirm-dialog","a.button-green",function(_this){return function(event){return event.preventDefault(),defered.resolve(),_this.hide(el)}}(this)),el.on("click.confirm-dialog","a.close",function(_this){return function(event){return event.preventDefault(),defered.resolve(),_this.hide(el)}}(this)),this.lightboxService.open(el),defered.promise},ConfirmService.prototype.loader=function(title,message){var el;return el=angular.element(".lightbox-generic-loading"),title&&el.find("h2.title").html(title),message&&el.find("p.message").html(message),{start:function(_this){return function(){return _this.lightboxService.open(el)}}(this),stop:function(_this){return function(){return _this.lightboxService.close(el)}}(this),update:function(_this){return function(status,title,message,percent){return title&&el.find("h2.title").html(title),message&&el.find("p.message").html(message),percent?(el.find(".spin").addClass("hidden"),el.find(".progress-bar-wrapper").removeClass("hidden"),el.find(".progress-bar-wrapper > .bar").width(percent+"%"),el.find(".progress-bar-wrapper > span").html(percent+"%").css("left",percent-9+"%")):(el.find(".spin").removeClass("hidden"),el.find(".progress-bar-wrapper").addClass("hidden"))}}(this)}},ConfirmService.prototype.notify=function(type,message,title,time){var body,el,selector;return selector=".notification-message-"+type,el=angular.element(selector),el.hasClass("active")?void 0:(title?el.find("h4").html(title):el.find("h4").html(this.translate.instant(NOTIFICATION_MSG[type].title)),message?el.find("p").html(message):el.find("p").html(this.translate.instant(NOTIFICATION_MSG[type].message)),body=angular.element("body"),body.find(".notification-message .notification-light").removeClass("active").addClass("inactive"),body.find(selector).removeClass("inactive").addClass("active"),this.tsem&&cancelTimeout(this.tsem),time||(time="error"===type||"light-error"===type?3500:1500),this.tsem=timeout(time,function(_this){return function(){return body.find(selector).removeClass("active").addClass("inactive"),delete _this.tsem}}(this)),el.on("click",".icon-delete, .close",function(_this){return function(event){return body.find(selector).removeClass("active").addClass("inactive")}}(this)))},ConfirmService}(taiga.Service),module=angular.module("taigaCommon"),module.service("$tgConfirm",ConfirmService)}.call(this),function(){var CustomAttributeValueDirective,CustomAttributesValuesController,CustomAttributesValuesDirective,DATE_TYPE,MULTILINE_TYPE,TEXT_TYPE,TYPE_CHOICES,bindMethods,bindOnce,debounce,generateHash,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,bindMethods=this.taiga.bindMethods,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,generateHash=taiga.generateHash,module=angular.module("taigaCommon"),TEXT_TYPE="text",MULTILINE_TYPE="multiline",DATE_TYPE="date",TYPE_CHOICES=[{key:TEXT_TYPE,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT"},{key:MULTILINE_TYPE,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI"},{key:DATE_TYPE,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE"}],CustomAttributesValuesController=function(superClass){function CustomAttributesValuesController(scope,rootscope,repo,rs,confirm,q){this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.rs=rs,this.confirm=confirm,this.q=q,bindMethods(this),this.type=null,this.objectId=null,this.projectId=null,this.customAttributes=[],this.customAttributesValues=null}return extend(CustomAttributesValuesController,superClass),CustomAttributesValuesController.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$tgConfirm","$q"],CustomAttributesValuesController.prototype.initialize=function(type,objectId){return this.project=this.scope.project,this.type=type,this.objectId=objectId,this.projectId=this.scope.projectId},CustomAttributesValuesController.prototype.loadCustomAttributesValues=function(){return this.objectId?this.rs.customAttributesValues[this.type].get(this.objectId).then(function(_this){return function(customAttributesValues){return _this.customAttributes=_this.project[_this.type+"_custom_attributes"],_this.customAttributesValues=customAttributesValues,customAttributesValues}}(this)):this.customAttributesValues},CustomAttributesValuesController.prototype.getAttributeValue=function(attribute){var attributeValue;return attributeValue=_.clone(attribute,!1),attributeValue.value=this.customAttributesValues.attributes_values[attribute.id],attributeValue},CustomAttributesValuesController.prototype.updateAttributeValue=function(attributeValue){var attributesValues,onError,onSuccess;return onSuccess=function(_this){return function(){return _this.rootscope.$broadcast("custom-attributes-values:edit")}}(this),onError=function(_this){return function(response){return _this.confirm.notify("error"),_this.q.reject()}}(this),attributesValues=_.clone(this.customAttributesValues.attributes_values,!0),attributesValues[attributeValue.id]=attributeValue.value,this.customAttributesValues.attributes_values=attributesValues,this.customAttributesValues.id=this.objectId,this.repo.save(this.customAttributesValues).then(onSuccess,onError)},CustomAttributesValuesController}(taiga.Controller),CustomAttributesValuesDirective=function($templates,$storage){var collapsedHash,link,template,templateFn;return template=$templates.get("custom-attributes/custom-attributes-values.html",!0),collapsedHash=function(type){return generateHash(["custom-attributes-collapsed",type])},link=function($scope,$el,$attrs,$ctrls){var $ctrl,$model;return $ctrl=$ctrls[0],$model=$ctrls[1],bindOnce($scope,$attrs.ngModel,function(value){return $ctrl.initialize($attrs.type,value.id),$ctrl.loadCustomAttributesValues()}),$el.on("click",".custom-fields-header a",function(){var collapsed,hash;return hash=collapsedHash($attrs.type),collapsed=!$storage.get(hash),$storage.set(hash,collapsed),collapsed?($el.find(".custom-fields-header a").removeClass("open"),$el.find(".custom-fields-body").removeClass("open")):($el.find(".custom-fields-header a").addClass("open"),$el.find(".custom-fields-body").addClass("open"))}),$scope.$on("$destroy",function(){return $el.off()})},templateFn=function($el,$attrs){var collapsed;return collapsed=$storage.get(collapsedHash($attrs.type))||!1,template({requiredEditionPerm:$attrs.requiredEditionPerm,collapsed:collapsed})},{require:["tgCustomAttributesValues","ngModel"],controller:CustomAttributesValuesController,controllerAs:"ctrl",restrict:"AE",scope:!0,link:link,template:templateFn}},module.directive("tgCustomAttributesValues",["$tgTemplate","$tgStorage","$translate",CustomAttributesValuesDirective]),CustomAttributeValueDirective=function($template,$selectedText,$compile,$translate,datePickerConfigService){var link,template,templateEdit;return template=$template.get("custom-attributes/custom-attribute-value.html",!0),templateEdit=$template.get("custom-attributes/custom-attribute-value-edit.html",!0),link=function($scope,$el,$attrs,$ctrl){var attributeValue,isEditable,prettyDate,render,setFocusAndSelectOnInputField,submit;return prettyDate=$translate.instant("COMMON.PICKERDATE.FORMAT"),render=function(attributeValue,edit){var ctx,datePickerConfig,editable,html,value;return null==edit&&(edit=!1),value=attributeValue.type===DATE_TYPE&&attributeValue.value?moment(attributeValue.value,"YYYY-MM-DD").format(prettyDate):attributeValue.value,editable=isEditable(),ctx={id:attributeValue.id,name:attributeValue.name,description:attributeValue.description,value:value,isEditable:editable,type:attributeValue.type},!editable||!edit&&value?(html=template(ctx),html=$compile(html)($scope),$el.html(html)):(html=templateEdit(ctx),html=$compile(html)($scope),$el.html(html),attributeValue.type===DATE_TYPE?(datePickerConfig=datePickerConfigService.get(),_.merge(datePickerConfig,{field:$el.find("input[name=value]")[0],onSelect:function(_this){return function(date){var selectedDate;return selectedDate=date}}(this),onOpen:function(_this){return function(){return"undefined"!=typeof selectedDate&&null!==selectedDate?$el.picker.setDate(selectedDate):void 0}}(this)}),$el.picker=new Pikaday(datePickerConfig)):void 0)},isEditable=function(){var permissions,requiredEditionPerm;return permissions=$scope.project.my_permissions,requiredEditionPerm=$attrs.requiredEditionPerm,permissions.indexOf(requiredEditionPerm)>-1},submit=debounce(2e3,function(_this){return function(event){return event.preventDefault(),attributeValue.value=$el.find("input[name=value], textarea[name='value']").val(),attributeValue.type===DATE_TYPE&&(moment(attributeValue.value,prettyDate).isValid()?attributeValue.value=moment(attributeValue.value,prettyDate).format("YYYY-MM-DD"):attributeValue.value=""),$scope.$apply(function(){return $ctrl.updateAttributeValue(attributeValue).then(function(){return render(attributeValue,!1)})})}}(this)),setFocusAndSelectOnInputField=function(){return $el.find("input[name='value'], textarea[name='value']").focus().select()},attributeValue=$scope.$eval($attrs.tgCustomAttributeValue),render(attributeValue),$el.on("click",".js-value-view-mode",function(){return isEditable()&&!$selectedText.get().length?(render(attributeValue,!0),setFocusAndSelectOnInputField()):void 0}),$el.on("click","a.icon-edit",function(event){return event.preventDefault(),render(attributeValue,!0),setFocusAndSelectOnInputField()}),$el.on("keyup","input[name=value], textarea[name='value']",function(event){return 13===event.keyCode&&"textarea"!==event.currentTarget.type?submit(event):27===event.keyCode?render(attributeValue,!1):void 0}),$el.on("submit","form",submit),$el.on("click","a.icon-floppy",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link,require:"^tgCustomAttributesValues",restrict:"AE"}},module.directive("tgCustomAttributeValue",["$tgTemplate","$selectedText","$compile","$translate","tgDatePickerConfigService",CustomAttributeValueDirective])}.call(this),function(){var EstimationsService,LbUsEstimationDirective,UsEstimationDirective,groupBy,module,taiga,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};taiga=this.taiga,groupBy=this.taiga.groupBy,module=angular.module("taigaCommon"),LbUsEstimationDirective=function($tgEstimationsService,$rootScope,$repo,$template,$compile){var link;return link=function($scope,$el,$attrs,$model){return $scope.$watch($attrs.ngModel,function(us){var estimationProcess;return us?(estimationProcess=$tgEstimationsService.create($el,us,$scope.project),estimationProcess.onSelectedPointForRole=function(roleId,pointId){return $scope.$apply(function(){return $model.$setViewValue(us)})},estimationProcess.render=function(){var ctx,html,mainTemplate,template;return ctx={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable},mainTemplate="common/estimation/us-estimation-points-per-role.html",template=$template.get(mainTemplate,!0),html=template(ctx),html=$compile(html)($scope),this.$el.html(html)},estimationProcess.render()):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgLbUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile",LbUsEstimationDirective]),UsEstimationDirective=function($tgEstimationsService,$rootScope,$repo,$qqueue,$template,$compile){var link;return link=function($scope,$el,$attrs,$model){return $scope.$watch($attrs.ngModel,function(us){var estimationProcess;return us?(estimationProcess=$tgEstimationsService.create($el,us,$scope.project),estimationProcess.onSelectedPointForRole=function(roleId,pointId){return this.save(roleId,pointId).then(function(){return $rootScope.$broadcast("object:updated")})},estimationProcess.render=function(){var ctx,html,mainTemplate,template;return ctx={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable},mainTemplate="common/estimation/us-estimation-points-per-role.html",template=$template.get(mainTemplate,!0),html=template(ctx),html=$compile(html)($scope),this.$el.html(html)},estimationProcess.render()):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgQqueue","$tgTemplate","$compile",UsEstimationDirective]),EstimationsService=function($template,$qqueue,$repo,$confirm,$q){var EstimationProcess,create,pointsTemplate;return pointsTemplate=$template.get("common/estimation/us-estimation-points.html",!0),EstimationProcess=function(){function EstimationProcess($el1,us1,project1){this.$el=$el1,this.us=us1,this.project=project1,this.bindClickEvents=bind(this.bindClickEvents,this),this.isEditable=-1!==this.project.my_permissions.indexOf("modify_us"),this.roles=this.project.roles,this.points=this.project.points,this.pointsById=groupBy(this.points,function(x){return x.id}),this.onSelectedPointForRole=function(roleId,pointId){},this.render=function(){}}return EstimationProcess.prototype.save=function(roleId,pointId){var deferred;return deferred=$q.defer(),$qqueue.add(function(_this){return function(){var onError,onSuccess;return onSuccess=function(){return deferred.resolve()},onError=function(){return $confirm.notify("error"),
_this.us.revert(),_this.render(),deferred.reject()},$repo.save(_this.us).then(onSuccess,onError)}}(this)),deferred.promise},EstimationProcess.prototype.calculateTotalPoints=function(){var notNullValues,values;return values=_.map(this.us.points,function(_this){return function(v,k){var ref;return null!=(ref=_this.pointsById[v])?ref.value:void 0}}(this)),0===values.length?"0":(notNullValues=_.filter(values,function(v){return null!=v}),0===notNullValues.length?"?":_.reduce(notNullValues,function(acc,num){return acc+num}))},EstimationProcess.prototype.calculateRoles=function(){var computableRoles,roles;return computableRoles=_.filter(this.project.roles,"computable"),roles=_.map(computableRoles,function(_this){return function(role){var pointId,pointObj;return pointId=_this.us.points[role.id],pointObj=_this.pointsById[pointId],role=_.clone(role,!0),role.points=null!=pointObj&&null!=pointObj.name?pointObj.name:"?",role}}(this))},EstimationProcess.prototype.bindClickEvents=function(){return this.$el.on("click",".total.clickable",function(_this){return function(event){var roleId,target;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),roleId=target.data("role-id"),_this.renderPointsSelector(roleId,target),target.siblings().removeClass("active"),target.addClass("active")}}(this)),this.$el.on("click",".point",function(_this){return function(event){var pointId,points,roleId,target;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),roleId=target.data("role-id"),pointId=target.data("point-id"),_this.$el.find(".popover").popover().close(),points=_.clone(_this.us.points,!0),points[roleId]=pointId,_this.us.points=points,_this.render(),_this.onSelectedPointForRole(roleId,pointId)}}(this))},EstimationProcess.prototype.renderPointsSelector=function(roleId,target){var horizontalList,html,maxPointLength,points,pop;return points=_.map(this.points,function(_this){return function(point){return point=_.clone(point,!0),point.selected=_this.us.points[roleId]===point.id?!1:!0,point}}(this)),maxPointLength=5,horizontalList=_.some(points,function(_this){return function(point){return point.name.length>maxPointLength}}(this)),html=pointsTemplate({points:points,roleId:roleId,horizontal:horizontalList}),this.$el.find(".popover").popover().close(),this.$el.find(".pop-points-open").remove(),null!=target?this.$el.find(target).append(html):this.$el.append(html),this.$el.find(".pop-points-open").popover().open(function(){return $(this).removeClass("active").closest("li").removeClass("active")}),this.$el.find(".pop-points-open").show(),pop=this.$el.find(".pop-points-open"),pop.offset().top+pop.height()>document.body.clientHeight?pop.addClass("pop-bottom"):void 0},EstimationProcess}(),create=function($el,us,project){var estimationProcess;return $el.unbind("click"),estimationProcess=new EstimationProcess($el,us,project),estimationProcess.isEditable&&estimationProcess.bindClickEvents(),estimationProcess},{create:create}},module.factory("$tgEstimationsService",["$tgTemplate","$tgQqueue","$tgRepo","$tgConfirm","$q",EstimationsService])}.call(this),function(){var defaultFilter,module,momentFormat,momentFromNow,sizeFormat,taiga,unslugify,yesNoFilter;taiga=this.taiga,module=angular.module("taigaCommon"),defaultFilter=function(){return function(value,defaultValue){return value===[null,void 0]?defaultValue:value}},module.filter("default",defaultFilter),yesNoFilter=function($translate){return function(value){return value?$translate.instant("COMMON.YES"):$translate.instant("COMMON.NO")}},module.filter("yesNo",["$translate",yesNoFilter]),unslugify=function(){return taiga.unslugify},module.filter("unslugify",unslugify),momentFormat=function(){return function(input,format){return input?moment(input).format(format):""}},module.filter("momentFormat",momentFormat),momentFromNow=function(){return function(input,without_suffix){return input?moment(input).fromNow(without_suffix||!1):""}},module.filter("momentFromNow",momentFromNow),sizeFormat=function(_this){return function(){return _this.taiga.sizeFormat}}(this),module.filter("sizeFormat",sizeFormat)}.call(this),function(){var HistoryController,HistoryDirective,IGNORED_FIELDS,bindOnce,debounce,module,taiga,trim,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,trim=this.taiga.trim,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaCommon"),IGNORED_FIELDS={"userstories.userstory":["watchers","kanban_order","backlog_order","sprint_order","finish_date","tribe_gig"],"tasks.task":["watchers","us_order","taskboard_order"],"issues.issue":["watchers"]},HistoryController=function(superClass){function HistoryController(scope,repo,rs){this.scope=scope,this.repo=repo,this.rs=rs}return extend(HistoryController,superClass),HistoryController.$inject=["$scope","$tgRepo","$tgResources"],HistoryController.prototype.initialize=function(type,objectId){return this.type=type,this.objectId=objectId},HistoryController.prototype.loadHistory=function(type,objectId){return this.rs.history.get(type,objectId).then(function(_this){return function(history){var changeModel,historyEntry,historyResult,i,j,len,len1;for(i=0,len=history.length;len>i;i++)historyResult=history[i],null!=historyResult.values_diff.description_diff&&(historyResult.values_diff.description=historyResult.values_diff.description_diff),delete historyResult.values_diff.description_html,delete historyResult.values_diff.description_diff,null!=historyResult.values_diff.blocked_note_diff&&(historyResult.values_diff.blocked_note=historyResult.values_diff.blocked_note_diff),delete historyResult.values_diff.blocked_note_html,delete historyResult.values_diff.blocked_note_diff;for(j=0,len1=history.length;len1>j;j++)historyEntry=history[j],changeModel=historyEntry.key.split(":")[0],null!=IGNORED_FIELDS[changeModel]&&(historyEntry.values_diff=_.removeKeys(historyEntry.values_diff,IGNORED_FIELDS[changeModel]));return _this.scope.history=_.filter(history,function(item){return Object.keys(item.values_diff).length>0}),_this.scope.comments=_.filter(history,function(item){return""!==item.comment})}}(this))},HistoryController.prototype.deleteComment=function(type,objectId,activityId){return this.rs.history.deleteComment(type,objectId,activityId).then(function(_this){return function(){return _this.loadHistory(type,objectId)}}(this))},HistoryController.prototype.undeleteComment=function(type,objectId,activityId){return this.rs.history.undeleteComment(type,objectId,activityId).then(function(_this){return function(){return _this.loadHistory(type,objectId)}}(this))},HistoryController}(taiga.Controller),HistoryDirective=function($log,$loading,$qqueue,$template,$confirm,$translate,$compile,$navUrls,$rootScope){var link,templateActivity,templateBase,templateBaseEntries,templateChangeAttachment,templateChangeDiff,templateChangeGeneric,templateChangeList,templateChangePoints,templateDeletedComment,templateFn;return templateChangeDiff=$template.get("common/history/history-change-diff.html",!0),templateChangePoints=$template.get("common/history/history-change-points.html",!0),templateChangeGeneric=$template.get("common/history/history-change-generic.html",!0),templateChangeAttachment=$template.get("common/history/history-change-attachment.html",!0),templateChangeList=$template.get("common/history/history-change-list.html",!0),templateDeletedComment=$template.get("common/history/history-deleted-comment.html",!0),templateActivity=$template.get("common/history/history-activity.html",!0),templateBaseEntries=$template.get("common/history/history-base-entries.html",!0),templateBase=$template.get("common/history/history-base.html",!0),link=function($scope,$el,$attrs,$ctrl){var countChanges,formatChange,getHumanizedFieldName,getPrettyDateFormat,objectId,renderActivity,renderAttachmentEntry,renderChange,renderChangeEntries,renderChangeEntry,renderChangesHelperText,renderComment,renderComments,renderCustomAttributesEntry,renderHistory,save,showAllActivity,showAllComments,type;return type=$attrs.type,objectId=null,showAllComments=!1,showAllActivity=!1,getPrettyDateFormat=function(){return $translate.instant("ACTIVITY.DATETIME")},bindOnce($scope,$attrs.ngModel,function(model){return type=$attrs.type,objectId=model.id,$ctrl.initialize(type,objectId),$ctrl.loadHistory(type,objectId)}),getHumanizedFieldName=function(field){var humanizedFieldNames;return humanizedFieldNames={subject:$translate.instant("ACTIVITY.FIELDS.SUBJECT"),name:$translate.instant("ACTIVITY.FIELDS.NAME"),description:$translate.instant("ACTIVITY.FIELDS.DESCRIPTION"),content:$translate.instant("ACTIVITY.FIELDS.CONTENT"),status:$translate.instant("ACTIVITY.FIELDS.STATUS"),is_closed:$translate.instant("ACTIVITY.FIELDS.IS_CLOSED"),finish_date:$translate.instant("ACTIVITY.FIELDS.FINISH_DATE"),type:$translate.instant("ACTIVITY.FIELDS.TYPE"),priority:$translate.instant("ACTIVITY.FIELDS.PRIORITY"),severity:$translate.instant("ACTIVITY.FIELDS.SEVERITY"),assigned_to:$translate.instant("ACTIVITY.FIELDS.ASSIGNED_TO"),watchers:$translate.instant("ACTIVITY.FIELDS.WATCHERS"),milestone:$translate.instant("ACTIVITY.FIELDS.MILESTONE"),user_story:$translate.instant("ACTIVITY.FIELDS.USER_STORY"),project:$translate.instant("ACTIVITY.FIELDS.PROJECT"),is_blocked:$translate.instant("ACTIVITY.FIELDS.IS_BLOCKED"),blocked_note:$translate.instant("ACTIVITY.FIELDS.BLOCKED_NOTE"),points:$translate.instant("ACTIVITY.FIELDS.POINTS"),client_requirement:$translate.instant("ACTIVITY.FIELDS.CLIENT_REQUIREMENT"),team_requirement:$translate.instant("ACTIVITY.FIELDS.TEAM_REQUIREMENT"),is_iocaine:$translate.instant("ACTIVITY.FIELDS.IS_IOCAINE"),tags:$translate.instant("ACTIVITY.FIELDS.TAGS"),attachments:$translate.instant("ACTIVITY.FIELDS.ATTACHMENTS"),is_deprecated:$translate.instant("ACTIVITY.FIELDS.IS_DEPRECATED"),blocked_note:$translate.instant("ACTIVITY.FIELDS.BLOCKED_NOTE"),is_blocked:$translate.instant("ACTIVITY.FIELDS.IS_BLOCKED"),order:$translate.instant("ACTIVITY.FIELDS.ORDER"),backlog_order:$translate.instant("ACTIVITY.FIELDS.BACKLOG_ORDER"),sprint_order:$translate.instant("ACTIVITY.FIELDS.SPRINT_ORDER"),kanban_order:$translate.instant("ACTIVITY.FIELDS.KANBAN_ORDER"),taskboard_order:$translate.instant("ACTIVITY.FIELDS.TASKBOARD_ORDER"),us_order:$translate.instant("ACTIVITY.FIELDS.US_ORDER")},humanizedFieldNames[field]||field},countChanges=function(comment){return _.keys(comment.values_diff).length},formatChange=function(change){return _.isArray(change)?0===change.length?$translate.instant("ACTIVITY.VALUES.EMPTY"):change.join(", "):""===change?$translate.instant("ACTIVITY.VALUES.EMPTY"):null==change||change===!1?$translate.instant("ACTIVITY.VALUES.NO"):change===!0?$translate.instant("ACTIVITY.VALUES.YES"):change},renderAttachmentEntry=function(value){var attachments;return attachments=_.map(value,function(changes,type){return"new"===type?_.map(changes,function(change){return templateChangeDiff({name:$translate.instant("ACTIVITY.NEW_ATTACHMENT"),diff:change.filename})}):"deleted"===type?_.map(changes,function(change){return templateChangeDiff({name:$translate.instant("ACTIVITY.DELETED_ATTACHMENT"),diff:change.filename})}):_.map(changes,function(change){var diff,name;return name=$translate.instant("ACTIVITY.UPDATED_ATTACHMENT",{filename:change.filename}),diff=_.map(change.changes,function(values,name){return{name:getHumanizedFieldName(name),from:formatChange(values[0]),to:formatChange(values[1])}}),templateChangeAttachment({name:name,diff:diff})})}),_.flatten(attachments).join("\n")},renderCustomAttributesEntry=function(value){var customAttributes;return customAttributes=_.map(value,function(changes,type){return"new"===type?_.map(changes,function(change){var html;return html=templateChangeGeneric({name:change.name,from:formatChange(""),to:formatChange(change.value)}),html=$compile(html)($scope),html[0].outerHTML}):"deleted"===type?_.map(changes,function(change){return templateChangeDiff({name:$translate.instant("ACTIVITY.DELETED_CUSTOM_ATTRIBUTE"),diff:change.name})}):_.map(changes,function(change){var customAttrsChanges;return customAttrsChanges=_.map(change.changes,function(values){return templateChangeGeneric({name:change.name,from:formatChange(values[0]),to:formatChange(values[1])})}),_.flatten(customAttrsChanges).join("\n")})}),_.flatten(customAttributes).join("\n")},renderChangeEntry=function(field,value){var added,from,html,name,removed,to;return"description"===field?templateChangeDiff({name:getHumanizedFieldName("description"),diff:value[1]}):"blocked_note"===field?templateChangeDiff({name:getHumanizedFieldName("blocked_note"),diff:value[1]}):"points"===field?(html=templateChangePoints({points:value}),html=$compile(html)($scope),html[0].outerHTML):"attachments"===field?renderAttachmentEntry(value):"custom_attributes"===field?renderCustomAttributesEntry(value):"tags"===field||"watchers"===field?(name=getHumanizedFieldName(field),removed=_.difference(value[0],value[1]),added=_.difference(value[1],value[0]),html=templateChangeList({name:name,removed:removed,added:added}),html=$compile(html)($scope),html[0].outerHTML):"assigned_to"===field?(name=getHumanizedFieldName(field),from=formatChange(value[0]||$translate.instant("ACTIVITY.VALUES.UNASSIGNED")),to=formatChange(value[1]||$translate.instant("ACTIVITY.VALUES.UNASSIGNED")),templateChangeGeneric({name:name,from:from,to:to})):(name=getHumanizedFieldName(field),from=formatChange(value[0]),to=formatChange(value[1]),templateChangeGeneric({name:name,from:from,to:to}))},renderChangeEntries=function(change){return _.map(change.values_diff,function(value,field){return renderChangeEntry(field,value)})},renderChangesHelperText=function(change){var size;return size=countChanges(change),$translate.instant("ACTIVITY.SIZE_CHANGE",{size:size},"messageformat")},renderComment=function(comment){var html,ref,ref1,ref2;return comment.delete_comment_date||(null!=(ref=comment.delete_comment_user)?ref.name:void 0)?(html=templateDeletedComment({deleteCommentDate:comment.delete_comment_date?moment(comment.delete_comment_date).format(getPrettyDateFormat()):void 0,deleteCommentUser:comment.delete_comment_user.name,deleteComment:comment.comment_html,activityId:comment.id,canRestoreComment:$scope.user&&(comment.delete_comment_user.pk===$scope.user.id||$scope.project.my_permissions.indexOf("modify_project")>-1)}),html=$compile(html)($scope),html[0].outerHTML):(html=templateActivity({avatar:comment.user.photo,userFullName:comment.user.name,userProfileUrl:comment.user.is_active?$navUrls.resolve("user-profile",{username:comment.user.username}):"",creationDate:moment(comment.created_at).format(getPrettyDateFormat()),comment:comment.comment_html,changesText:renderChangesHelperText(comment),changes:renderChangeEntries(comment),mode:"comment",deleteCommentActionTitle:$translate.instant("COMMENTS.DELETE"),deleteCommentDate:comment.delete_comment_date?moment(comment.delete_comment_date).format(getPrettyDateFormat()):void 0,deleteCommentUser:(null!=(ref1=comment.delete_comment_user)?ref1.name:void 0)?comment.delete_comment_user.name:void 0,activityId:comment.id,canDeleteComment:comment.user.pk===(null!=(ref2=$scope.user)?ref2.id:void 0)||$scope.project.my_permissions.indexOf("modify_project")>-1}),html=$compile(html)($scope),html[0].outerHTML)},renderChange=function(change){var ref;return templateActivity({avatar:change.user.photo,userFullName:change.user.name,userProfileUrl:change.user.is_active?$navUrls.resolve("user-profile",{username:change.user.username}):"",creationDate:moment(change.created_at).format(getPrettyDateFormat()),comment:change.comment_html,changes:renderChangeEntries(change),changesText:"",mode:"activity",deleteCommentDate:change.delete_comment_date?moment(change.delete_comment_date).format(getPrettyDateFormat()):void 0,deleteCommentUser:(null!=(ref=change.delete_comment_user)?ref.name:void 0)?change.delete_comment_user.name:void 0,activityId:change.id})},renderHistory=function(entries,totalEntries){var html,showMore;return showMore=entries.length===totalEntries?0:totalEntries-entries.length,html=templateBaseEntries({entries:entries,showMore:showMore}),html=$compile(html)($scope)},renderComments=function(){var comments,html,totalComments;return comments=$scope.comments||[],totalComments=comments.length,showAllComments||(comments=_.last(comments,4)),comments=_.map(comments,function(x){return renderComment(x)}),html=renderHistory(comments,totalComments),$el.find(".comments-list").html(html)},renderActivity=function(){var changes,html,totalChanges;return changes=$scope.history||[],totalChanges=changes.length,showAllActivity||(changes=_.last(changes,4)),changes=_.map(changes,function(x){return renderChange(x)}),html=renderHistory(changes,totalChanges),$el.find(".changes-list").html(html)},save=$qqueue.bindAdd(function(_this){return function(target){var currentLoading,model,onError,onSuccess;return $scope.$broadcast("markdown-editor:submit"),$el.find(".comment-list").addClass("activeanimation"),currentLoading=$loading().target(target).start(),onSuccess=function(){return $rootScope.$broadcast("comment:new"),$ctrl.loadHistory(type,objectId)["finally"](function(){return currentLoading.finish()})},onError=function(){return currentLoading.finish(),$confirm.notify("error")},model=$scope.$eval($attrs.ngModel),$ctrl.repo.save(model).then(onSuccess,onError)}}(this)),$scope.$watch("comments",renderComments),$scope.$watch("history",renderActivity),$scope.$on("object:updated",function(){return $ctrl.loadHistory(type,objectId)}),$el.on("click",".add-comment button.button-green",debounce(2e3,function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),save(target)})),$el.on("click","a",function(event){var href,target;return target=angular.element(event.target),href=target.attr("href"),href&&0===href.indexOf("#")?(event.preventDefault(),$("body").scrollTop($(href).offset().top)):void 0}),$el.on("click",".show-more",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),target.parent().is(".changes-list")?(showAllActivity=!showAllActivity,renderActivity()):(showAllComments=!showAllComments,renderComments())}),$el.on("click",".show-deleted-comment",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),target.parents(".activity-single").find(".hide-deleted-comment").show(),target.parents(".activity-single").find(".show-deleted-comment").hide(),target.parents(".activity-single").find(".comment-body").show()}),$el.on("click",".hide-deleted-comment",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),target.parents(".activity-single").find(".hide-deleted-comment").hide(),target.parents(".activity-single").find(".show-deleted-comment").show(),target.parents(".activity-single").find(".comment-body").hide()}),$el.on("click",".changes-title",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),target.parent().find(".change-entry").toggleClass("active")}),$el.on("focus",".add-comment textarea",function(event){return $(this).addClass("active")}),$el.on("click",".history-tabs li a",function(event){var target;return target=angular.element(event.currentTarget),$el.find(".history-tabs li a").removeClass("active"),target.addClass("active"),$el.find(".history section").addClass("hidden"),$el.find(".history section."+target.data("section-class")).removeClass("hidden")}),$el.on("click",".comment-delete",debounce(2e3,function(event){var activityId,target;return event.preventDefault(),target=angular.element(event.currentTarget),activityId=target.data("activity-id"),$ctrl.deleteComment(type,objectId,activityId)})),$el.on("click",".comment-restore",debounce(2e3,function(event){var activityId,target;return event.preventDefault(),target=angular.element(event.currentTarget),activityId=target.data("activity-id"),$ctrl.undeleteComment(type,objectId,activityId)})),$scope.$on("$destroy",function(){return $el.off()})},templateFn=function($el,$attrs){var html;return html=templateBase({ngmodel:$attrs.ngModel,type:$attrs.type,mode:$attrs.mode})},{controller:HistoryController,template:templateFn,restrict:"AE",link:link}},module.directive("tgHistory",["$log","$tgLoading","$tgQqueue","$tgTemplate","$tgConfirm","$translate","$compile","$tgNavUrls","$rootScope",HistoryDirective])}.call(this),function(){var ImportProjectButtonDirective,module;module=angular.module("taigaCommon"),ImportProjectButtonDirective=function($rs,$confirm,$location,$navUrls,$translate){var link;return link=function($scope,$el,$attrs){return $el.on("click",".import-project-button",function(event){return event.preventDefault(),$el.find("input.import-file").val(""),$el.find("input.import-file").trigger("click")}),$el.on("change","input.import-file",function(event){var file,loader,onError,onSuccess;return event.preventDefault(),(file=event.target.files[0])?(loader=$confirm.loader($translate.instant("PROJECT.IMPORT.UPLOADING_FILE")),onSuccess=function(result){var ctx,message,msg,title;return loader.stop(),202===result.status?(title=$translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE"),message=$translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE"),$confirm.success(title,message)):(ctx={project:result.data.slug},$location.path($navUrls.resolve("project-admin-project-profile-details",ctx)),msg=$translate.instant("PROJECT.IMPORT.SYNC_SUCCESS"),$confirm.notify("success",msg))},onError=function(result){var errorMsg,ref;return loader.stop(),errorMsg=$translate.instant("PROJECT.IMPORT.ERROR"),429===result.status?errorMsg=$translate.instant("PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST"):(null!=(ref=result.data)?ref._error_message:void 0)&&(errorMsg=$translate.instant("PROJECT.IMPORT.ERROR_MESSAGE",{error_message:result.data._error_message})),$confirm.notify("error",errorMsg)},loader.start(),$rs.projects["import"](file,loader.update).then(onSuccess,onError)):void 0})},{link:link}},module.directive("tgImportProjectButton",["$tgResources","$tgConfirm","$location","$tgNavUrls","$translate",ImportProjectButtonDirective])}.call(this),function(){var AssignedToLightboxDirective,AttachmentPreviewLightboxDirective,BlockLightboxDirective,BlockingMessageInputDirective,CreateBulkUserstoriesDirective,CreateEditUserstoryDirective,LightboxDirective,LightboxKeyboardNavigationService,LightboxService,WatchersLightboxDirective,bindOnce,debounce,module,sizeFormat,timeout,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;module=angular.module("taigaCommon"),bindOnce=this.taiga.bindOnce,timeout=this.taiga.timeout,debounce=this.taiga.debounce,sizeFormat=this.taiga.sizeFormat,LightboxService=function(superClass){function LightboxService(animationFrame,q){this.animationFrame=animationFrame,this.q=q}return extend(LightboxService,superClass),LightboxService.prototype.open=function($el){var defered,docEl,lightboxContent;return defered=this.q.defer(),lightboxContent=$el.children().not(".close"),lightboxContent.hide(),this.animationFrame.add(function(){return $el.css("display","flex")}),this.animationFrame.add(function(){return $el.addClass("open"),$el.one("transitionend",function(_this){return function(){return $el.find("input,textarea").first().focus()}}(this))}),this.animationFrame.add(function(_this){return function(){return lightboxContent.show(),defered.resolve()}}(this)),docEl=angular.element(document),docEl.on("keydown.lightbox",function(_this){return function(e){var code;return code=e.keyCode?e.keyCode:e.which,27===code?_this.close($el):void 0}}(this)),defered.promise},LightboxService.prototype.close=function($el){var docEl,scope;return docEl=angular.element(document),docEl.off(".lightbox"),docEl.off(".keyboard-navigation"),$el.one("transitionend",function(_this){return function(){return $el.removeAttr("style"),$el.removeClass("open").removeClass("close")}}(this)),$el.addClass("close"),$el.hasClass("remove-on-close")?(scope=$el.data("scope"),scope.$destroy(),$el.remove()):void 0},LightboxService.prototype.closeAll=function(){var docEl,i,len,lightboxEl,ref,results;for(docEl=angular.element(document),ref=docEl.find(".lightbox.open"),results=[],i=0,len=ref.length;len>i;i++)lightboxEl=ref[i],results.push(this.close($(lightboxEl)));return results},LightboxService}(taiga.Service),module.service("lightboxService",["animationFrame","$q",LightboxService]),LightboxKeyboardNavigationService=function(superClass){function LightboxKeyboardNavigationService(){return LightboxKeyboardNavigationService.__super__.constructor.apply(this,arguments)}return extend(LightboxKeyboardNavigationService,superClass),LightboxKeyboardNavigationService.prototype.stop=function(){var docEl;return docEl=angular.element(document),docEl.off(".keyboard-navigation")},LightboxKeyboardNavigationService.prototype.dispatch=function($el,code){var activeElement,next,prev;if(activeElement=$el.find(".selected"),13===code)return 1===$el.find(".user-list-single").length?$el.find(".user-list-single:first").trigger("click"):activeElement.trigger("click");if(40===code){if(!activeElement.length)return $el.find('.user-list-single:not(".is-active"):first').addClass("selected");if(next=activeElement.next(".user-list-single"),next.length)return activeElement.removeClass("selected"),next.addClass("selected")}else if(38===code){if(!activeElement.length)return $el.find(".user-list-single:last").addClass("selected");if(prev=activeElement.prev('.user-list-single:not(".is-active")'),prev.length)return activeElement.removeClass("selected"),prev.addClass("selected")}},LightboxKeyboardNavigationService.prototype.init=function($el){var docEl;return this.stop(),docEl=angular.element(document),docEl.on("keydown.keyboard-navigation",function(_this){return function(event){var code;return code=event.keyCode?event.keyCode:event.which,40===code||38===code||13===code?(event.preventDefault(),_this.dispatch($el,code)):void 0}}(this))},LightboxKeyboardNavigationService}(taiga.Service),module.service("lightboxKeyboardNavigationService",LightboxKeyboardNavigationService),LightboxDirective=function(lightboxService){var link;return link=function($scope,$el,$attrs){return $el.on("click",".close",function(event){return event.preventDefault(),lightboxService.close($el)})},{restrict:"C",link:link}},module.directive("lightbox",["lightboxService",LightboxDirective]),BlockLightboxDirective=function($rootscope,$tgrepo,$confirm,lightboxService,$loading,$qqueue,$translate){var link;return link=function($scope,$el,$attrs,$model){var block,title,unblock;return title=$translate.instant($attrs.title),$el.find("h2.title").text(title),unblock=$qqueue.bindAdd(function(_this){return function(item,finishCallback){var promise;return promise=$tgrepo.save(item),promise.then(function(){return $confirm.notify("success"),$rootscope.$broadcast("object:updated"),$model.$setViewValue(item),finishCallback()}),promise.then(null,function(){return $confirm.notify("error"),item.revert(),$model.$setViewValue(item)}),promise["finally"](function(){return finishCallback()}),promise}}(this)),block=$qqueue.bindAdd(function(_this){return function(item){var currentLoading,promise;return $model.$setViewValue(item),currentLoading=$loading().target($el.find(".button-green")).start(),promise=$tgrepo.save($model.$modelValue),promise.then(function(){return $confirm.notify("success"),$rootscope.$broadcast("object:updated")}),promise.then(null,function(){return $confirm.notify("error"),item.revert(),$model.$setViewValue(item)}),promise["finally"](function(){return currentLoading.finish(),lightboxService.close($el)})}}(this)),$scope.$on("block",function(){return $el.find(".reason").val($model.$modelValue.blocked_note),lightboxService.open($el)}),$scope.$on("unblock",function(_this){return function(event,model,finishCallback){var item;return item=$model.$modelValue.clone(),item.is_blocked=!1,item.blocked_note="",unblock(item,finishCallback)}}(this)),$scope.$on("$destroy",function(){return $el.off()}),$el.on("click",".button-green",function(event){var item;return event.preventDefault(),item=$model.$modelValue.clone(),item.is_blocked=!0,item.blocked_note=$el.find(".reason").val(),block(item)})},{templateUrl:"common/lightbox/lightbox-block.html",link:link,require:"ngModel"}},module.directive("tgLbBlock",["$rootScope","$tgRepo","$tgConfirm","lightboxService","$tgLoading","$tgQqueue","$translate",BlockLightboxDirective]),BlockingMessageInputDirective=function($log,$template,$compile){var link,template,templateFn;return template=$template.get("common/lightbox/lightbox-blocking-message-input.html",!0),link=function($scope,$el,$attrs,$model){return $attrs.watch?$scope.$watch($attrs.watch,function(value){return value===!0&&value===!0?$el.find(".blocked-note").removeClass("hidden"):$el.find(".blocked-note").addClass("hidden")}):$log.error("No watch attribute on tg-blocking-message-input directive")},templateFn=function($el,$attrs){return template({ngmodel:$attrs.ngModel})},{template:templateFn,link:link,require:"ngModel",restrict:"EA"}},module.directive("tgBlockingMessageInput",["$log","$tgTemplate","$compile",BlockingMessageInputDirective]),CreateEditUserstoryDirective=function($repo,$model,$rs,$rootScope,lightboxService,$loading,$translate,$confirm,$q,attachmentsService){var link;return link=function($scope,$el,attrs){var attachmentsToAdd,attachmentsToDelete,createAttachments,deleteAttachments,resetAttachments,submit,submitButton;return $scope.createEditUs={},$scope.isNew=!0,attachmentsToAdd=Immutable.List(),attachmentsToDelete=Immutable.List(),resetAttachments=function(){return attachmentsToAdd=Immutable.List(),attachmentsToDelete=Immutable.List()},$scope.addAttachment=function(attachment){return attachmentsToAdd=attachmentsToAdd.push(attachment)},$scope.deleteAttachment=function(attachment){return attachmentsToDelete=attachmentsToDelete.push(attachment)},$scope.$on("usform:new",function(ctx,projectId,status,statusList){return $scope.isNew=!0,$scope.usStatusList=statusList,$scope.attachments=Immutable.List(),resetAttachments(),$scope.us=$model.make_model("userstories",{project:projectId,points:{},status:status,is_archived:!1,tags:[]}),$el.find(".button-green").html($translate.instant("COMMON.CREATE")),$el.find(".title").html($translate.instant("LIGHTBOX.CREATE_EDIT_US.NEW_US")),$el.find(".tag-input").val(""),$el.find(".blocked-note").addClass("hidden"),$el.find("label.blocked").removeClass("selected"),$el.find("label.team-requirement").removeClass("selected"),$el.find("label.client-requirement").removeClass("selected"),lightboxService.open($el)}),$scope.$on("usform:edit",function(ctx,us,attachments){return $scope.us=us,$scope.attachments=Immutable.fromJS(attachments),$scope.isNew=!1,resetAttachments(),$el.find(".button-green").html($translate.instant("COMMON.SAVE")),$el.find(".title").html($translate.instant("LIGHTBOX.CREATE_EDIT_US.EDIT_US")),$el.find(".tag-input").val(""),us.is_blocked?($el.find(".blocked-note").removeClass("hidden"),$el.find("label.blocked").addClass("selected")):($el.find(".blocked-note").addClass("hidden"),$el.find("label.blocked").removeClass("selected")),us.team_requirement?$el.find("label.team-requirement").addClass("selected"):$el.find("label.team-requirement").removeClass("selected"),us.client_requirement?$el.find("label.client-requirement").addClass("selected"):$el.find("label.client-requirement").removeClass("selected"),lightboxService.open($el)}),createAttachments=function(obj){var promises;return promises=_.map(attachmentsToAdd.toJS(),function(attachment){
return attachmentsService.upload(attachment.file,obj.id,$scope.us.project,"us")}),$q.all(promises)},deleteAttachments=function(obj){var promises;return promises=_.map(attachmentsToDelete.toJS(),function(attachment){return attachmentsService["delete"]("us",attachment.id)}),$q.all(promises)},submit=debounce(2e3,function(_this){return function(event){var broadcastEvent,currentLoading,form,promise;return event.preventDefault(),form=$el.find("form").checksley(),form.validate()?(currentLoading=$loading().target(submitButton).start(),$scope.isNew?(promise=$repo.create("userstories",$scope.us),broadcastEvent="usform:new:success"):(promise=$repo.save($scope.us),broadcastEvent="usform:edit:success"),promise.then(function(data){return deleteAttachments(data).then(function(_this){return function(){return createAttachments(data)}}(this)),data}),promise.then(function(data){return currentLoading.finish(),lightboxService.close($el),$rootScope.$broadcast(broadcastEvent,data)}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$el.on("click",".close",function(event){return event.preventDefault(),$scope.$apply(function(){return $scope.us.revert()}),lightboxService.close($el)}),$el.keydown(function(event){var code;return code=event.keyCode?event.keyCode:event.which,27===code?(lightboxService.close($el),$scope.$apply(function(){return $scope.us.revert()})):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgLbCreateEditUserstory",["$tgRepo","$tgModel","$tgResources","$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$q","tgAttachmentsService",CreateEditUserstoryDirective]),CreateBulkUserstoriesDirective=function($repo,$rs,$rootscope,lightboxService,$loading){var link;return link=function($scope,$el,attrs){var submit,submitButton;return $scope.$on("usform:bulk",function(ctx,projectId,status){return $scope["new"]={projectId:projectId,statusId:status,bulk:""},lightboxService.open($el)}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,form,promise;return event.preventDefault(),form=$el.find("form").checksley({onlyOneErrorElement:!0}),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$rs.userstories.bulkCreate($scope["new"].projectId,$scope["new"].statusId,$scope["new"].bulk),promise.then(function(result){return currentLoading.finish(),$rootscope.$broadcast("usform:bulk:success",result),lightboxService.close($el)}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgLbCreateBulkUserstories",["$tgRepo","$tgResources","$rootScope","lightboxService","$tgLoading",CreateBulkUserstoriesDirective]),AssignedToLightboxDirective=function(lightboxService,lightboxKeyboardNavigationService,$template,$compile){var link;return link=function($scope,$el,$attrs){var closeLightbox,filterUsers,normalizeString,render,selectedItem,selectedUser,usersTemplate;return selectedUser=null,selectedItem=null,usersTemplate=$template.get("common/lightbox/lightbox-assigned-to-users.html",!0),normalizeString=function(string){var normalizedString;return normalizedString=string,normalizedString=normalizedString.replace("Á","A").replace("Ä","A").replace("À","A"),normalizedString=normalizedString.replace("É","E").replace("Ë","E").replace("È","E"),normalizedString=normalizedString.replace("Í","I").replace("Ï","I").replace("Ì","I"),normalizedString=normalizedString.replace("Ó","O").replace("Ö","O").replace("Ò","O"),normalizedString=normalizedString.replace("Ú","U").replace("Ü","U").replace("Ù","U")},filterUsers=function(text,user){var username;return username=user.full_name_display.toUpperCase(),username=normalizeString(username),text=text.toUpperCase(),text=normalizeString(text),_.contains(username,text)},render=function(selected,text){var ctx,html,users;return users=_.clone($scope.activeUsers,!0),null!=selected&&(users=_.reject(users,{id:selected.id})),null!=text&&(users=_.filter(users,_.partial(filterUsers,text))),ctx={selected:selected,users:_.first(users,5),showMore:users.length>5},html=usersTemplate(ctx),html=$compile(html)($scope),$el.find(".assigned-to-list").html(html)},closeLightbox=function(){return lightboxKeyboardNavigationService.stop(),lightboxService.close($el)},$scope.$on("assigned-to:add",function(ctx,item){var assignedToId;return selectedItem=item,assignedToId=item.assigned_to,selectedUser=$scope.usersById[assignedToId],render(selectedUser),lightboxService.open($el).then(function(){return $el.find("input").focus(),lightboxKeyboardNavigationService.init($el)})}),$scope.$watch("usersSearch",function(searchingText){return null!=searchingText?(render(selectedUser,searchingText),$el.find("input").focus()):void 0}),$el.on("click",".user-list-single",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),closeLightbox(),$scope.$apply(function(){return $scope.$broadcast("assigned-to:added",target.data("user-id"),selectedItem),$scope.usersSearch=null})}),$el.on("click",".remove-assigned-to",function(event){return event.preventDefault(),event.stopPropagation(),closeLightbox(),$scope.$apply(function(){return $scope.usersSearch=null,$scope.$broadcast("assigned-to:added",null,selectedItem)})}),$el.on("click",".close",function(event){return event.preventDefault(),closeLightbox(),$scope.$apply(function(){return $scope.usersSearch=null})}),$scope.$on("$destroy",function(){return $el.off()})},{templateUrl:"common/lightbox/lightbox-assigned-to.html",link:link}},module.directive("tgLbAssignedto",["lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",AssignedToLightboxDirective]),WatchersLightboxDirective=function($repo,lightboxService,lightboxKeyboardNavigationService,$template,$compile){var link;return link=function($scope,$el,$attrs){var closeLightbox,getFilteredUsers,render,selectedItem,usersTemplate;return selectedItem=null,usersTemplate=$template.get("common/lightbox/lightbox-assigned-to-users.html",!0),getFilteredUsers=function(text){var _filterUsers,users;return null==text&&(text=""),_filterUsers=function(text,user){var username;return selectedItem&&_.find(selectedItem.watchers,function(x){return x===user.id})?!1:(username=user.full_name_display.toUpperCase(),text=text.toUpperCase(),_.contains(username,text))},users=_.clone($scope.activeUsers,!0),users=_.filter(users,_.partial(_filterUsers,text))},render=function(users){var ctx,html;return ctx={selected:!1,users:_.first(users,5),showMore:users.length>5},html=usersTemplate(ctx),html=$compile(html)($scope),$el.find(".ticket-watchers").html(html)},closeLightbox=function(){return lightboxKeyboardNavigationService.stop(),lightboxService.close($el)},$scope.$on("watcher:add",function(ctx,item){var users;return selectedItem=item,users=getFilteredUsers(),render(users),lightboxService.open($el).then(function(){return $el.find("input").focus(),lightboxKeyboardNavigationService.init($el)})}),$scope.$watch("usersSearch",function(searchingText){var users;if(null!=searchingText)return users=getFilteredUsers(searchingText),render(users),$el.find("input").focus()}),$el.on("click",".user-list-single",debounce(2e3,function(event){var target;return closeLightbox(),event.preventDefault(),target=angular.element(event.currentTarget),$scope.$apply(function(){return $scope.usersSearch=null,$scope.$broadcast("watcher:added",target.data("user-id"))})})),$el.on("click",".close",function(event){return event.preventDefault(),closeLightbox(),$scope.$apply(function(){return $scope.usersSearch=null})}),$scope.$on("$destroy",function(){return $el.off()})},{templateUrl:"common/lightbox/lightbox-users.html",link:link}},module.directive("tgLbWatchers",["$tgRepo","lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",WatchersLightboxDirective]),AttachmentPreviewLightboxDirective=function(lightboxService,$template,$compile){var link;return link=function($scope,$el,attrs){return lightboxService.open($el)},{templateUrl:"common/lightbox/lightbox-attachment-preview.html",link:link,scope:!0}},module.directive("tgLbAttachmentPreview",["lightboxService","$tgTemplate","$compile",AttachmentPreviewLightboxDirective])}.call(this),function(){var Loader,LoaderDirective,module,sizeFormat,taiga,timeout;taiga=this.taiga,sizeFormat=this.taiga.sizeFormat,timeout=this.taiga.timeout,module=angular.module("taigaCommon"),LoaderDirective=function(tgLoader,$rootscope){var link;return link=function($scope,$el,$attrs){return tgLoader.onStart(function(){return $(document.body).addClass("loader-active"),$el.addClass("active")}),tgLoader.onEnd(function(){return $(document.body).removeClass("loader-active"),$el.removeClass("active")})},{link:link}},module.directive("tgLoader",["tgLoader","$rootScope",LoaderDirective]),Loader=function($rootscope){var autoClose,config,lastResponseDate,open,pageLoaded,requestCount,start,startLoadTime;return config={minTime:300},open=!1,startLoadTime=0,requestCount=0,lastResponseDate=0,pageLoaded=function(force){var diff,endTime,timeoutValue;return null==force&&(force=!1),startLoadTime&&(timeoutValue=0,force||(endTime=(new Date).getTime(),diff=endTime-startLoadTime,diff<config.minTime&&(timeoutValue=config.minTime-diff)),timeout(timeoutValue,function(){return $rootscope.$broadcast("loader:end"),open=!1,window.prerenderReady=!0})),startLoadTime=0,requestCount=0,lastResponseDate=0},autoClose=function(){var intervalAuto;return intervalAuto=setInterval(function(){return lastResponseDate&&0===requestCount?(pageLoaded(),clearInterval(intervalAuto)):void 0},50)},start=function(){return startLoadTime=(new Date).getTime(),$rootscope.$broadcast("loader:start"),open=!0},{pageLoaded:pageLoaded,start:function(auto){return null==auto&&(auto=!1),!open&&(start(),auto)?autoClose():void 0},onStart:function(fn){return $rootscope.$on("loader:start",fn)},onEnd:function(fn){return $rootscope.$on("loader:end",fn)},logRequest:function(){return requestCount++},logResponse:function(){return requestCount--,lastResponseDate=(new Date).getTime()}}},Loader.$inject=["$rootScope"],module.factory("tgLoader",Loader)}.call(this),function(){var LoadingDirective,TgLoadingService,module,slice=[].slice;module=angular.module("taigaCommon"),TgLoadingService=function($compile){var spinner;return spinner="<img class='loading-spinner' src='/"+window._version+"/svg/spinner-circle.svg' alt='loading...' />",function(){var service;return service={settings:{target:null,scope:null,classes:[],timeout:0,template:null},target:function(target){return service.settings.target=target,service},scope:function(scope){return service.settings.scope=scope,service},template:function(template){return service.settings.template=template,service},removeClasses:function(){var classess;return classess=1<=arguments.length?slice.call(arguments,0):[],service.settings.classes=classess,service},timeout:function(timeout){return service.settings.timeout=timeout,service},start:function(){var target,timeoutId;return target=service.settings.target,service.settings.classes.map(function(className){return target.removeClass(className)}),timeoutId=setTimeout(function(){return target.hasClass("loading")?void 0:(service.settings.template||(service.settings.template=target.html()),target.addClass("loading"),target.html(spinner))},service.settings.timeout),service.settings.timeoutId=timeoutId,service},finish:function(){var removeClasses,target,timeoutId;return target=service.settings.target,timeoutId=service.settings.timeoutId,timeoutId&&(clearTimeout(timeoutId),removeClasses=service.settings.classes,removeClasses.map(function(className){return service.settings.target.addClass(className)}),target.html(service.settings.template),target.removeClass("loading"),service.settings.scope&&$compile(target.contents())(service.settings.scope)),service}}}},TgLoadingService.$inject=["$compile"],module.factory("$tgLoading",TgLoadingService),LoadingDirective=function($loading){var link;return link=function($scope,$el,attr){var currentLoading,template;return currentLoading=null,template=$el.html(),$scope.$watch(attr.tgLoading,function(_this){return function(showLoading){return showLoading?currentLoading=$loading().target($el).timeout(100).template(template).scope($scope).start():currentLoading?currentLoading.finish():void 0}}(this))},{link:link}},module.directive("tgLoading",["$tgLoading",LoadingDirective])}.call(this),function(){var RelatedTaskStatusDirective,UsStatusDirective,bindOnce,debounce,module,taiga;taiga=this.taiga,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaCommon"),UsStatusDirective=function($repo,$template){var link,template;return template=$template.get("common/popover/popover-us-status.html",!0),link=function($scope,$el,$attrs){var $ctrl,render,us;return $ctrl=$el.controller(),render=function(us){var usStatusById,usStatusDom,usStatusDomParent;return usStatusDomParent=$el.find(".us-status"),usStatusDom=$el.find(".us-status .us-status-bind"),usStatusById=$scope.usStatusById,usStatusById[us.status]?(usStatusDom.text(usStatusById[us.status].name),usStatusDomParent.css("color",usStatusById[us.status].color)):void 0},$el.on("click",".us-status",function(event){return event.preventDefault(),event.stopPropagation(),$el.find(".pop-status").popover().open()}),$el.on("click",".status",debounce(2e3,function(event){var target,us;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),us=$scope.$eval($attrs.tgUsStatus),us.status=target.data("status-id"),render(us),$el.find(".pop-status").popover().close(),$scope.$apply(function(){return $repo.save(us).then(function(){return $scope.$eval($attrs.onUpdate)})})})),$scope.$on("userstories:loaded",function(){return render($scope.$eval($attrs.tgUsStatus))}),$scope.$on("$destroy",function(){return $el.off()}),us=$scope.$eval($attrs.tgUsStatus),render(us),bindOnce($scope,"project",function(project){var html;return html=template({statuses:project.us_statuses}),$el.append(html),-1===$scope.project.my_permissions.indexOf("modify_us")?($el.unbind("click"),$el.find("a").addClass("not-clickable")):void 0})},{link:link}},module.directive("tgUsStatus",["$tgRepo","$tgTemplate",UsStatusDirective]),RelatedTaskStatusDirective=function($repo,$template){var link,selectionTemplate,updateTaskStatus;return selectionTemplate=$template.get("common/popover/popover-related-task-status.html",!0),updateTaskStatus=function($el,task,taskStatusById){var taskStatusDom,taskStatusDomParent;return taskStatusDomParent=$el.find(".us-status"),taskStatusDom=$el.find(".task-status .task-status-bind"),taskStatusById[task.status]?(taskStatusDom.text(taskStatusById[task.status].name),taskStatusDomParent.css("color",taskStatusById[task.status].color)):void 0},link=function($scope,$el,$attrs){var $ctrl,autoSave,notAutoSave,task;return $ctrl=$el.controller(),task=$scope.$eval($attrs.tgRelatedTaskStatus),notAutoSave=$scope.$eval($attrs.notAutoSave),autoSave=!notAutoSave,$el.on("click",".task-status",function(event){return event.preventDefault(),event.stopPropagation(),$el.find(".pop-status").popover().open()}),$el.on("click",".status",debounce(2e3,function(event){var target;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),task.status=target.data("status-id"),$el.find(".pop-status").popover().close(),updateTaskStatus($el,task,$scope.taskStatusById),autoSave?$scope.$apply(function(){return $repo.save(task).then(function(){return $scope.$eval($attrs.onUpdate),$scope.$emit("related-tasks:status-changed")})}):void 0})),taiga.bindOnce($scope,"project",function(project){return $el.append(selectionTemplate({statuses:project.task_statuses})),updateTaskStatus($el,task,$scope.taskStatusById),-1===project.my_permissions.indexOf("modify_task")?($el.unbind("click"),$el.find("a").addClass("not-clickable")):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgRelatedTaskStatus",["$tgRepo","$tgTemplate",RelatedTaskStatusDirective]),$.fn.popover=function(){var $el,close,closeAll,closePopover,isVisible,open;return $el=this,isVisible=function(_this){return function(){var docViewBottom,docViewLeft,docViewRight,docViewTop,docViewWidth,elemBottom,elemLeft,elemRight,elemTop,elemWidth;return $el.css({display:"block",visibility:"hidden"}),docViewTop=$(window).scrollTop(),docViewBottom=docViewTop+$(window).height(),docViewWidth=$(window).width(),docViewRight=docViewWidth,docViewLeft=0,elemTop=$el.offset().top,elemBottom=elemTop+$el.height(),elemWidth=$el.width(),elemLeft=$el.offset().left,elemRight=$el.offset().left+elemWidth,$el.css({display:"none",visibility:"visible"}),docViewBottom>=elemBottom&&elemTop>=docViewTop&&elemLeft>=docViewLeft&&docViewRight>=elemRight}}(this),closePopover=function(_this){return function(onClose){return onClose&&onClose.call($el),$el.fadeOut(function(){return $el.removeClass("active").removeClass("fix")}),$el.off("popup:close")}}(this),closeAll=function(_this){return function(){return $(".popover.active").each(function(){return $(this).trigger("popup:close")})}}(this),open=function(_this){return function(onClose){return $el.hasClass("active")?close():(closeAll(),isVisible()||$el.addClass("fix"),$el.fadeIn(function(){return $el.addClass("active"),$(document.body).off("popover"),$(document.body).one("click.popover",function(){return closeAll()})}),$el.on("popup:close",function(e){return closePopover(onClose)}))}}(this),close=function(_this){return function(){return $el.trigger("popup:close")}}(this),{open:open,close:close,closeAll:closeAll}}}.call(this),function(){var ExceptionHandlerFactory,module,taiga;taiga=this.taiga,module=angular.module("taigaCommon"),ExceptionHandlerFactory=function($log,config){var ravenConfig;return this.config=config,ravenConfig=this.config.get("ravenConfig",null),ravenConfig?($log.debug("Using the RavenJS exception handler."),Raven.config(ravenConfig).install(),function(exception,cause){return $log.error.apply($log,arguments),Raven.captureException(exception)}):($log.debug("Using the default logging exception handler."),function(exception,cause){return $log.error.apply($log,arguments)})},module.factory("$exceptionHandler",["$log","$tgConfig",ExceptionHandlerFactory])}.call(this),function(){var ColorizeTagsDirective,LbTagLineDirective,TagLineDirective,TagsDirective,bindOnce,module,taiga,trim,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};taiga=this.taiga,trim=this.taiga.trim,bindOnce=this.taiga.bindOnce,module=angular.module("taigaCommon"),TagsDirective=function(){var formatter,link,parser;return formatter=function(v){return _.isArray(v)?v.join(", "):""},parser=function(v){var result;return v?(result=_(v.split(",")).map(function(x){return _.str.trim(x)}),result.value()):[]},link=function($scope,$el,$attrs,$ctrl){return $ctrl.$formatters.push(formatter),$ctrl.$parsers.push(parser),$scope.$on("$destroy",function(){return $el.off()})},{require:"ngModel",link:link}},module.directive("tgTags",TagsDirective),ColorizeTagsDirective=function(){var link,templates;return templates={backlog:_.template('<% _.each(tags, function(tag) { %>\n    <span class="tag" style="border-left: 5px solid <%- tag.color %>"><%- tag.name %></span>\n<% }) %>'),kanban:_.template('<% _.each(tags, function(tag) { %>\n    <a class="kanban-tag" href="" style="border-color: <%- tag.color %>" title="<%- tag.name %>" />\n<% }) %>'),taskboard:_.template('<% _.each(tags, function(tag) { %>\n    <a class="taskboard-tag" href="" style="border-color: <%- tag.color %>" title="<%- tag.name %>" />\n<% }) %>')},link=function($scope,$el,$attrs,$ctrl){var render;return render=function(srcTags){var html,tags,template;return template=templates[$attrs.tgColorizeTagsType],srcTags.sort(),tags=_.map(srcTags,function(tag){var color;return color=$scope.project.tags_colors[tag],{name:tag,color:color}}),html=template({tags:tags}),$el.html(html)},$scope.$watch($attrs.tgColorizeTags,function(tags){return null!=tags?render(tags):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgColorizeTags",ColorizeTagsDirective),LbTagLineDirective=function($rs,$template,$compile){var COMMA_KEY,ENTER_KEY,link,templateTags;return ENTER_KEY=13,COMMA_KEY=188,templateTags=$template.get("common/tag/lb-tag-line-tags.html",!0),link=function($scope,$el,$attrs,$model){var addValue,deleteValue,hideSaveButton,renderTags,resetInput,saveInputTag,showSaveButton;return renderTags=function(tags,tagsColors){var ctx,html;return ctx={tags:_.map(tags,function(t){return{name:t,color:tagsColors[t]}})},_.map(ctx.tags,function(_this){return function(tag){return tag.color?tag.style="border-left: 5px solid "+tag.color:void 0}}(this)),html=$compile(templateTags(ctx))($scope),$el.find("div.tags-container").html(html)},showSaveButton=function(){return $el.find(".save").removeClass("hidden")},hideSaveButton=function(){return $el.find(".save").addClass("hidden")},resetInput=function(){return $el.find("input").val(""),$el.find("input").autocomplete("close")},addValue=function(value){var tags;return value=trim(value.toLowerCase()),0!==value.length?(tags=_.clone($model.$modelValue,!1),null==tags&&(tags=[]),indexOf.call(tags,value)<0&&tags.push(value),$scope.$apply(function(){return $model.$setViewValue(tags)}),hideSaveButton()):void 0},deleteValue=function(value){var tags;return value=trim(value.toLowerCase()),0!==value.length?(tags=_.clone($model.$modelValue,!1),tags=_.pull(tags,value),$scope.$apply(function(){return $model.$setViewValue(tags)})):void 0},saveInputTag=function(){var value;return value=$el.find("input").val(),addValue(value),resetInput()},$el.on("keypress","input",function(event){var target;return target=angular.element(event.currentTarget),event.keyCode===ENTER_KEY?(event.preventDefault(),saveInputTag()):","===String.fromCharCode(event.keyCode)?(event.preventDefault(),saveInputTag()):target.val().length?showSaveButton():hideSaveButton()}),$el.on("click",".save",function(event){return event.preventDefault(),saveInputTag()}),$el.on("click",".icon-delete",function(event){var target,value;return event.preventDefault(),target=angular.element(event.currentTarget),value=target.siblings(".tag-name").text(),deleteValue(value)}),bindOnce($scope,"project",function(project){var positioningFunction;return positioningFunction=function(position,elements){var menu;return menu=elements.element.element,menu.css("width",elements.target.width),menu.css("top",position.top),menu.css("left",position.left)},$el.find("input").autocomplete({source:_.keys(project.tags_colors),position:{my:"left top",using:positioningFunction},select:function(event,ui){return addValue(ui.item.value),ui.item.value=""}})}),$scope.$watch($attrs.ngModel,function(tags){var ref,tagsColors;return tagsColors=(null!=(ref=$scope.project)?ref.tags_colors:void 0)||[],renderTags(tags,tagsColors)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,require:"ngModel",templateUrl:"common/tag/lb-tag-line.html"}},module.directive("tgLbTagLine",["$tgResources","$tgTemplate","$compile",LbTagLineDirective]),TagLineDirective=function($rootScope,$repo,$rs,$confirm,$qqueue,$template,$compile){var COMMA_KEY,ENTER_KEY,ESC_KEY,link,templateTags;return ENTER_KEY=13,ESC_KEY=27,COMMA_KEY=188,templateTags=$template.get("common/tag/tags-line-tags.html",!0),link=function($scope,$el,$attrs,$model){var addValue,deleteValue,hideAddTagButton,hideAddTagButtonText,hideInput,hideSaveButton,isEditable,renderInReadModeOnly,renderTags,resetInput,saveInputTag,showAddTagButton,showAddTagButtonText,showInput,showSaveButton;return isEditable=function(){return null!=$attrs.requiredPerm?-1!==$scope.project.my_permissions.indexOf($attrs.requiredPerm):!0},renderTags=function(tags,tagsColors){var ctx,html;return ctx={tags:_.map(tags,function(t){return{name:t,color:tagsColors[t]}}),isEditable:isEditable()},html=$compile(templateTags(ctx))($scope),$el.find("div.tags-container").html(html)},renderInReadModeOnly=function(){return $el.find(".add-tag").remove(),$el.find("input").remove(),$el.find(".save").remove()},showAddTagButton=function(){return $el.find(".add-tag").removeClass("hidden")},hideAddTagButton=function(){return $el.find(".add-tag").addClass("hidden")},showAddTagButtonText=function(){return $el.find(".add-tag-text").removeClass("hidden")},hideAddTagButtonText=function(){return $el.find(".add-tag-text").addClass("hidden")},showSaveButton=function(){return $el.find(".save").removeClass("hidden")},hideSaveButton=function(){return $el.find(".save").addClass("hidden")},showInput=function(){return $el.find("input").removeClass("hidden").focus()},hideInput=function(){return $el.find("input").addClass("hidden").blur()},resetInput=function(){return $el.find("input").val(""),$el.find("input").autocomplete("close")},addValue=$qqueue.bindAdd(function(value){var model,onError,onSuccess,tags;return value=trim(value.toLowerCase()),0!==value.length?(tags=_.clone($model.$modelValue.tags,!1),null==tags&&(tags=[]),indexOf.call(tags,value)<0&&tags.push(value),model=$model.$modelValue.clone(),model.tags=tags,$model.$setViewValue(model),onSuccess=function(){return $rootScope.$broadcast("object:updated")},onError=function(){return $confirm.notify("error"),model.revert(),$model.$setViewValue(model)},hideSaveButton(),$repo.save(model).then(onSuccess,onError)):void 0}),deleteValue=$qqueue.bindAdd(function(value){var model,onError,onSuccess,tags;return value=trim(value.toLowerCase()),0!==value.length?(tags=_.clone($model.$modelValue.tags,!1),tags=_.pull(tags,value),model=$model.$modelValue.clone(),model.tags=tags,$model.$setViewValue(model),onSuccess=function(){return $rootScope.$broadcast("object:updated")},onError=function(){return $confirm.notify("error"),model.revert(),$model.$setViewValue(model)},$repo.save(model).then(onSuccess,onError)):void 0}),saveInputTag=function(){var value;return value=$el.find("input").val(),addValue(value),resetInput()},$el.on("keypress","input",function(event){var target;return target=angular.element(event.currentTarget),event.keyCode===ENTER_KEY?saveInputTag():","===String.fromCharCode(event.keyCode)?(event.preventDefault(),saveInputTag()):target.val().length?showSaveButton():hideSaveButton()}),$el.on("keyup","input",function(event){return event.keyCode===ESC_KEY?(resetInput(),hideInput(),hideSaveButton(),showAddTagButton()):void 0}),$el.on("click",".save",function(event){return event.preventDefault(),saveInputTag()}),$el.on("click",".add-tag",function(event){return event.preventDefault(),hideAddTagButton(),showInput()}),$el.on("click",".icon-delete",function(event){var target,value;return event.preventDefault(),target=angular.element(event.currentTarget),value=target.siblings(".tag-name").text(),deleteValue(value)}),bindOnce($scope,"project.tags_colors",function(tags_colors){var positioningFunction;return isEditable()?(showAddTagButton(),positioningFunction=function(position,elements){var menu;return menu=elements.element.element,menu.css("width",elements.target.width),menu.css("top",position.top),menu.css("left",position.left)},$el.find("input").autocomplete({source:_.keys(tags_colors),position:{my:"left top",using:positioningFunction},select:function(event,ui){return addValue(ui.item.value),ui.item.value=""}})):void renderInReadModeOnly()}),$scope.$watch($attrs.ngModel,function(model){var ref,ref1,tagsColors;if(model)return(null!=(ref=model.tags)?ref.length:void 0)?hideAddTagButtonText():showAddTagButtonText(),tagsColors=(null!=(ref1=$scope.project)?ref1.tags_colors:void 0)||[],renderTags(model.tags,tagsColors)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,require:"ngModel",templateUrl:"common/tag/tag-line.html"}},module.directive("tgTagLine",["$rootScope","$tgRepo","$tgResources","$tgConfirm","$tgQqueue","$tgTemplate","$compile",TagLineDirective])}.call(this),function(){var MarkitupDirective,bindOnce,module,taiga,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};taiga=this.taiga,bindOnce=this.taiga.bindOnce,module=angular.module("taigaCommon"),MarkitupDirective=function($rootscope,$rs,$selectedText,$template,$compile,$translate){var link,previewTemplate;return previewTemplate=$template.get("common/wysiwyg/wysiwyg-markitup-preview.html",!0),link=function($scope,$el,$attrs,$model){var addLine,cancelablePromise,closePreviewMode,element,markdownTitle,prepareUrlFormatting,preview,previewDomNode,renderMarkItUp,setCaretPosition,unbind,urlFormatting;return element=angular.element($el),previewDomNode=$("<div/>",{"class":"preview"}),closePreviewMode=function(){return element.parents(".markdown").find(".preview").remove(),element.parents(".markItUp").show()},$scope.$on("markdown-editor:submit",function(){return closePreviewMode()}),cancelablePromise=null,preview=function(){var markItUpDomNode,markdownDomNode;return markdownDomNode=element.parents(".markdown"),markItUpDomNode=element.parents(".markItUp"),$rs.mdrender.render($scope.projectId,$model.$modelValue).then(function(data){var html,markdown;return html=previewTemplate({data:data.data}),html=$compile(html)($scope),markdownDomNode.append(html),markItUpDomNode.hide(),markdown=element.closest(".markdown"),markdown.on("mouseup.preview",".preview",function(event){var target;return event.preventDefault(),target=angular.element(event.target),target.is("a")||!$selectedText.get().length?(markdown.off(".preview"),closePreviewMode()):void 0})})},setCaretPosition=function(textarea,caretPosition){var line,range,scrollRelation,totalLines;return textarea.createTextRange?(range=textarea.createTextRange(),range.move("character",caretPosition),range.select()):textarea.selectionStart&&(textarea.focus(),textarea.setSelectionRange(caretPosition,caretPosition)),totalLines=textarea.value.split("\n").length,line=textarea.value.slice(0,+(caretPosition-1)+1||9e9).split("\n").length,scrollRelation=line/totalLines,$el.scrollTop(scrollRelation*$el[0].scrollHeight-$el.height()/2)},addLine=function(textarea,nline,replace){var cursorPosition,j,key,len,line,lines;for(lines=textarea.value.split("\n"),replace?lines[nline]=replace+lines[nline]:lines[nline]="",cursorPosition=0,key=j=0,len=lines.length;len>j&&(line=lines[key],cursorPosition+=line.length+1||1,key!==nline);key=++j);return textarea.value=lines.join("\n"),replace?cursorPosition-lines[nline].length+replace.length-1:cursorPosition},prepareUrlFormatting=function(markItUp){var indices,regex,result;for(regex=/(<<<|>>>)/gi,result=0,indices=[];result=regex.exec(markItUp.textarea.value);)indices.push(result.index);return markItUp.donotparse=indices},urlFormatting=function(markItUp){var endIndex,ref,ref1,regex,result,startIndex,url,value;for(regex=/<<</gi,result=0,startIndex=0;;){if(result=regex.exec(markItUp.textarea.value),!result)break;if(ref=result.index,indexOf.call(markItUp.donotparse,ref)<0){startIndex=result.index;break}}if(result){for(regex=/>>>/gi,endIndex=0;;){if(result=regex.exec(markItUp.textarea.value),!result)break;if(ref1=result.index,indexOf.call(markItUp.donotparse,ref1)<0){endIndex=result.index;break}}return value=markItUp.textarea.value,url=value.substring(startIndex,endIndex).replace("<<<","").replace(">>>",""),url=url.replace("(","%28").replace(")","%29"),url=url.replace("[","%5B").replace("]","%5D"),value=value.substring(0,startIndex)+url+value.substring(endIndex+3,value.length),markItUp.textarea.value=value,markItUp.donotparse=void 0}},markdownTitle=function(markItUp,char){var heading,i,j,n,ref;for(heading="",n=$.trim(markItUp.selection||markItUp.placeHolder).length,
i=j=0,ref=n-1;ref>=0?ref>=j:j>=ref;i=ref>=0?++j:--j)heading+=char;return"\n"+heading+"\n"},renderMarkItUp=function(){var markdownSettings;return markdownSettings={nameSpace:"markdown",onShiftEnter:{keepDefault:!1,openWith:"\n\n"},onEnter:{keepDefault:!1,replaceWith:function(){return $(".textcomplete-dropdown").is(":visible")?void 0:"\n"},afterInsert:function(data){var cursorLine,emptyListItem,lastLine,lines,markdownCaretPositon,match,newLineContent,nline,replace;return lines=data.textarea.value.split("\n"),cursorLine=data.caretPosition>0?data.textarea.value.slice(0,+(data.caretPosition-1)+1||9e9).split("\n").length:1,newLineContent=data.textarea.value.slice(data.caretPosition).split("\n")[0],lastLine=lines[cursorLine-1],match=lastLine.match(/^(\s*- ).*/),match&&(emptyListItem=lastLine.match(/^(\s*)\-\s$/),emptyListItem?(nline=cursorLine-1,replace=null):(nline=cursorLine,replace=""+match[1]),markdownCaretPositon=addLine(data.textarea,nline,replace)),match=lastLine.match(/^(\s*\* ).*/),match&&(emptyListItem=lastLine.match(/^(\s*\* )$/),emptyListItem?(nline=cursorLine-1,replace=null):(nline=cursorLine,replace=""+match[1]),markdownCaretPositon=addLine(data.textarea,nline,replace)),match=lastLine.match(/^(\s*)(\d+)\.\s/),match&&(emptyListItem=lastLine.match(/^(\s*)(\d+)\.\s$/),emptyListItem?(nline=cursorLine-1,replace=null):(nline=cursorLine,replace=match[1]+(parseInt(match[2],10)+1)+". "),markdownCaretPositon=addLine(data.textarea,nline,replace)),markdownCaretPositon?setCaretPosition(data.textarea,markdownCaretPositon):void 0}},markupSet:[{name:$translate.instant("COMMON.WYSIWYG.H1_BUTTON"),key:"1",placeHolder:$translate.instant("COMMON.WYSIWYG.H1_SAMPLE_TEXT"),closeWith:function(markItUp){return markdownTitle(markItUp,"=")}},{name:$translate.instant("COMMON.WYSIWYG.H2_BUTTON"),key:"2",placeHolder:$translate.instant("COMMON.WYSIWYG.H2_SAMPLE_TEXT"),closeWith:function(markItUp){return markdownTitle(markItUp,"-")}},{name:$translate.instant("COMMON.WYSIWYG.H3_BUTTON"),key:"3",openWith:"### ",placeHolder:$translate.instant("COMMON.WYSIWYG.H3_SAMPLE_TEXT")},{separator:"---------------"},{name:$translate.instant("COMMON.WYSIWYG.BOLD_BUTTON"),key:"B",openWith:"**",closeWith:"**",placeHolder:$translate.instant("COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT")},{name:$translate.instant("COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT"),key:"I",openWith:"_",closeWith:"_",placeHolder:$translate.instant("COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT")},{name:$translate.instant("COMMON.WYSIWYG.STRIKE_BUTTON"),key:"S",openWith:"~~",closeWith:"~~",placeHolder:$translate.instant("COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT")},{separator:"---------------"},{name:$translate.instant("COMMON.WYSIWYG.BULLETED_LIST_BUTTON"),openWith:"- ",placeHolder:$translate.instant("COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT")},{name:$translate.instant("COMMON.WYSIWYG.NUMERIC_LIST_BUTTON"),openWith:function(markItUp){return markItUp.line+". "},placeHolder:$translate.instant("COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT")},{separator:"---------------"},{name:$translate.instant("COMMON.WYSIWYG.PICTURE_BUTTON"),key:"P",openWith:"![",closeWith:'](<<<[![Url:!:http://]!]>>> "[![Title]!]")',placeHolder:$translate.instant("COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT"),beforeInsert:function(markItUp){return prepareUrlFormatting(markItUp)},afterInsert:function(markItUp){return urlFormatting(markItUp)}},{name:$translate.instant("COMMON.WYSIWYG.LINK_BUTTON"),key:"L",openWith:"[",closeWith:'](<<<[![Url:!:http://]!]>>> "[![Title]!]")',placeHolder:$translate.instant("COMMON.WYSIWYG.LINK_SAMPLE_TEXT"),beforeInsert:function(markItUp){return prepareUrlFormatting(markItUp)},afterInsert:function(markItUp){return urlFormatting(markItUp)}},{separator:"---------------"},{name:$translate.instant("COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON"),openWith:"> ",placeHolder:$translate.instant("COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT")},{name:$translate.instant("COMMON.WYSIWYG.CODE_BLOCK_BUTTON"),openWith:"```\n",placeHolder:$translate.instant("COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT"),closeWith:"\n```"},{separator:"---------------"},{name:$translate.instant("COMMON.WYSIWYG.PREVIEW_BUTTON"),call:preview,className:"preview-icon"}],afterInsert:function(event){var target;return target=angular.element(event.textarea),$model.$setViewValue(target.val())}},element.markItUpRemove().markItUp(markdownSettings).textcomplete([{cache:!0,match:/(^|\s)#([a-z0-9]+)$/i,search:function(term,callback){var filter,searchProps,searchTypes;return term=taiga.slugify(term),searchTypes=["issues","tasks","userstories"],searchProps=["ref","subject"],filter=function(_this){return function(item){var j,len,prop;for(j=0,len=searchProps.length;len>j;j++)if(prop=searchProps[j],taiga.slugify(item[prop]).indexOf(term)>=0)return!0;return!1}}(this),cancelablePromise&&cancelablePromise.abort(),cancelablePromise=$rs.search["do"]($scope.projectId,term),cancelablePromise.then(function(_this){return function(res){var j,len,results,type;if(res.count<1||res.count===res.wikipages.length)return callback([]);for(results=[],j=0,len=searchTypes.length;len>j;j++)type=searchTypes[j],res[type]&&res[type].length>0?results.push(callback(res[type].filter(filter),!0)):results.push(void 0);return results}}(this)),callback([])},replace:function(res){return"$1#"+res.ref+" "},template:function(res,term){return"#"+res.ref+" - "+res.subject}},{cache:!0,match:/(^|\s)@([a-z0-9\-\._]{2,})$/i,search:function(term,callback){var searchProps,username;return username=taiga.slugify(term),searchProps=["username","full_name","full_name_display"],callback($scope.project.members.length<1?[]:$scope.project.members.filter(function(_this){return function(user){var j,len,prop;for(j=0,len=searchProps.length;len>j;j++)if(prop=searchProps[j],taiga.slugify(user[prop]).indexOf(username)>=0)return!0;return!1}}(this)))},replace:function(user){return"$1@"+user.username+" "},template:function(user){return user.username+" - "+user.full_name_display}},{cache:!0,match:/(^|\s)\[\[([a-z0-9\-]+)$/i,search:function(term,callback){return term=taiga.slugify(term),$rs.search["do"]($scope.projectId,term).then(function(_this){return function(res){return res.count<1&&callback([]),res.count<1||!res.wikipages||res.wikipages.length<=0?callback([]):callback(res.wikipages.filter(function(page){return taiga.slugify(page.slug).indexOf(term)>=0}),!0),callback([])}}(this))},replace:function(res){return"$1[["+res.slug+"]]"},template:function(res,term){return res.slug}}],{debounce:200})},renderMarkItUp(),unbind=$rootscope.$on("$translateChangeEnd",renderMarkItUp),element.on("keypress",function(event){return $scope.$apply()}),$scope.$on("$destroy",function(){return $el.off(),unbind()})},{link:link,require:"ngModel"}},module.directive("tgMarkitup",["$rootScope","$tgResources","$selectedText","$tgTemplate","$compile","$translate",MarkitupDirective])}.call(this),function(){var BacklogFiltersDirective,bindOnce,debounceLeading,groupBy,mixOf,module,scopeDefer,taiga,toggleText;taiga=this.taiga,mixOf=this.taiga.mixOf,toggleText=this.taiga.toggleText,scopeDefer=this.taiga.scopeDefer,bindOnce=this.taiga.bindOnce,groupBy=this.taiga.groupBy,debounceLeading=this.taiga.debounceLeading,module=angular.module("taigaBacklog"),BacklogFiltersDirective=function($q,$log,$location,$templates){var link,template,templateSelected;return template=$templates.get("backlog/filters.html",!0),templateSelected=$templates.get("backlog/filter-selected.html",!0),link=function($scope,$el,$attrs){var $ctrl,currentFiltersType,getFiltersType,initializeSelectedFilters,reloadUserstories,renderFilters,renderSelectedFilters,selectQFilter,selectedFilters,showCategories,showFilters,toggleFilterSelection;return currentFiltersType="",$ctrl=$el.closest(".wrapper").controller(),selectedFilters=[],showFilters=function(title,type){return $el.find(".filters-cats").hide(),$el.find(".filter-list").removeClass("hidden"),$el.find("h2.breadcrumb").removeClass("hidden"),$el.find("h2 a.subfilter span.title").html(title),$el.find("h2 a.subfilter span.title").prop("data-type",type),currentFiltersType=getFiltersType()},showCategories=function(){return $el.find(".filters-cats").show(),$el.find(".filter-list").addClass("hidden"),$el.find("h2.breadcrumb").addClass("hidden")},initializeSelectedFilters=function(){var i,len,name,ref,val,values;showCategories(),selectedFilters=[],ref=$scope.filters;for(name in ref)for(values=ref[name],i=0,len=values.length;len>i;i++)val=values[i],val.selected&&selectedFilters.push(val);return renderSelectedFilters()},renderSelectedFilters=function(){var html;return _.map(selectedFilters,function(_this){return function(f){return f.color?f.style="border-left: 3px solid "+f.color:void 0}}(this)),html=templateSelected({filters:selectedFilters}),$el.find(".filters-applied").html(html)},renderFilters=function(filters){var html;return _.map(filters,function(_this){return function(f){return f.color?f.style="border-left: 3px solid "+f.color:void 0}}(this)),html=template({filters:filters}),$el.find(".filter-list").html(html)},getFiltersType=function(){return $el.find("h2 a.subfilter span.title").prop("data-type")},reloadUserstories=function(){return currentFiltersType=getFiltersType(),$q.all([$ctrl.loadUserstories(),$ctrl.generateFilters()]).then(function(){var currentFilters;return currentFilters=$scope.filters[currentFiltersType],renderFilters(_.reject(currentFilters,"selected"))})},toggleFilterSelection=function(type,id){var filter,filters;return currentFiltersType=getFiltersType(),filters=$scope.filters[type],filter=_.find(filters,{id:id}),filter.selected=!filter.selected,filter.selected?(selectedFilters.push(filter),$scope.$apply(function(){return $ctrl.selectFilter(type,id)})):(selectedFilters=_.reject(selectedFilters,function(selected){return filter.type===selected.type&&filter.id===selected.id}),$ctrl.unselectFilter(type,id)),renderSelectedFilters(selectedFilters),type===currentFiltersType&&renderFilters(_.reject(filters,"selected")),reloadUserstories()},selectQFilter=debounceLeading(100,function(value){return void 0!==value?(0===value.length?$ctrl.replaceFilter("q",null):$ctrl.replaceFilter("q",value),reloadUserstories()):void 0}),$scope.$watch("filtersQ",selectQFilter),$scope.$on("backlog:loaded",function(ctx){return initializeSelectedFilters()}),$scope.$on("filters:update",function(ctx){return $ctrl.generateFilters().then(function(){var filters;return filters=$scope.filters[currentFiltersType],currentFiltersType?renderFilters(_.reject(filters,"selected")):void 0})}),$el.on("click",".filters-cats > ul > li > a",function(event){var tags,target;return event.preventDefault(),target=angular.element(event.currentTarget),tags=$scope.filters[target.data("type")],renderFilters(_.reject(tags,"selected")),showFilters(target.attr("title"),target.data("type"))}),$el.on("click",".filters-inner > .filters-step-cat > .breadcrumb > .back",function(event){return event.preventDefault(),showCategories()}),$el.on("click",".filters-applied a",function(event){var id,target,type;return event.preventDefault(),target=angular.element(event.currentTarget),id=target.data("id"),type=target.data("type"),toggleFilterSelection(type,id)}),$el.on("click",".filter-list .single-filter",function(event){var id,target,type;return event.preventDefault(),target=angular.element(event.currentTarget),target.hasClass("active")?target.removeClass("active"):target.addClass("active"),id=target.data("id"),type=target.data("type"),toggleFilterSelection(type,id)})},{link:link}},module.directive("tgBacklogFilters",["$q","$log","$tgLocation","$tgTemplate",BacklogFiltersDirective])}.call(this),function(){var CreateEditSprint,bindOnce,debounce,module,taiga;taiga=this.taiga,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaBacklog"),CreateEditSprint=function($repo,$confirm,$rs,$rootscope,lightboxService,$loading,$translate){var link;return link=function($scope,$el,attrs){var createSprint,getLastSprint,hasErrors,remove,resetSprint,submit;return hasErrors=!1,createSprint=!0,resetSprint=function(){return $scope.sprint={project:null,name:null,estimated_start:null,estimated_finish:null}},submit=debounce(2e3,function(_this){return function(event){var broadcastEvent,currentLoading,form,newSprint,prettyDate,promise,submitButton,target;return event.preventDefault(),target=angular.element(event.currentTarget),prettyDate=$translate.instant("COMMON.PICKERDATE.FORMAT"),submitButton=$el.find(".submit-button"),form=$el.find("form").checksley(),form.validate()?(hasErrors=!1,newSprint=angular.copy($scope.sprint),broadcastEvent=null,createSprint?(newSprint.estimated_start=moment(newSprint.estimated_start,prettyDate).format("YYYY-MM-DD"),newSprint.estimated_finish=moment(newSprint.estimated_finish,prettyDate).format("YYYY-MM-DD"),promise=$repo.create("milestones",newSprint),broadcastEvent="sprintform:create:success"):(newSprint.setAttr("estimated_start",moment(newSprint.estimated_start,prettyDate).format("YYYY-MM-DD")),newSprint.setAttr("estimated_finish",moment(newSprint.estimated_finish,prettyDate).format("YYYY-MM-DD")),promise=$repo.save(newSprint),broadcastEvent="sprintform:edit:success"),currentLoading=$loading().target(submitButton).start(),promise.then(function(data){return currentLoading.finish(),createSprint&&($scope.sprintsCounter+=1),$rootscope.$broadcast(broadcastEvent,data),lightboxService.close($el)}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("light-error",data._error_message):data.__all__?$confirm.notify("light-error",data.__all__[0]):void 0})):(hasErrors=!0,void $el.find(".last-sprint-name").addClass("disappear"))}}(this)),remove=function(){var message,title;return title=$translate.instant("LIGHTBOX.DELETE_SPRINT.TITLE"),message=$scope.sprint.name,$confirm.askOnDelete(title,message).then(function(_this){return function(askResponse){var onError,onSuccess;return onSuccess=function(){return askResponse.finish(),$scope.milestonesCounter-=1,lightboxService.close($el),$rootscope.$broadcast("sprintform:remove:success",$scope.sprint)},onError=function(){return askResponse.finish(!1),$confirm.notify("error")},$repo.remove($scope.sprint).then(onSuccess,onError)}}(this))},getLastSprint=function(){var openSprints,sortedSprints;return openSprints=_.filter($scope.sprints,function(sprint){return!sprint.closed}),sortedSprints=_.sortBy(openSprints,function(sprint){return moment(sprint.estimated_finish,"YYYY-MM-DD").format("X")}),sortedSprints[sortedSprints.length-1]},$scope.$on("sprintform:create",function(event,projectId){var estimatedFinish,estimatedStart,form,lastSprint,lastSprintNameDom,prettyDate,text;return resetSprint(),form=$el.find("form").checksley(),form.reset(),createSprint=!0,prettyDate=$translate.instant("COMMON.PICKERDATE.FORMAT"),$scope.sprint.project=projectId,$scope.sprint.name=null,$scope.sprint.slug=null,lastSprint=getLastSprint(),estimatedStart=moment(),lastSprint?estimatedStart=moment(lastSprint.estimated_finish):$scope.sprint.estimated_start&&(estimatedStart=moment($scope.sprint.estimated_start)),$scope.sprint.estimated_start=estimatedStart.format(prettyDate),estimatedFinish=moment().add(2,"weeks"),lastSprint?estimatedFinish=moment(lastSprint.estimated_finish).add(2,"weeks"):$scope.sprint.estimated_finish&&(estimatedFinish=moment($scope.sprint.estimated_finish)),$scope.sprint.estimated_finish=estimatedFinish.format(prettyDate),lastSprintNameDom=$el.find(".last-sprint-name"),null!=(null!=lastSprint?lastSprint.name:void 0)&&(text=$translate.instant("LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME",{lastSprint:lastSprint.name}),lastSprintNameDom.html(text)),$el.find(".delete-sprint").addClass("hidden"),text=$translate.instant("LIGHTBOX.ADD_EDIT_SPRINT.TITLE"),$el.find(".title").text(text),text=$translate.instant("COMMON.CREATE"),$el.find(".button-green").text(text),lightboxService.open($el),$el.find(".sprint-name").focus(),$el.find(".last-sprint-name").removeClass("disappear")}),$scope.$on("sprintform:edit",function(ctx,sprint){var editSprint,prettyDate,save;return resetSprint(),createSprint=!1,prettyDate=$translate.instant("COMMON.PICKERDATE.FORMAT"),$scope.$apply(function(){return $scope.sprint=sprint,$scope.sprint.estimated_start=moment($scope.sprint.estimated_start).format(prettyDate),$scope.sprint.estimated_finish=moment($scope.sprint.estimated_finish).format(prettyDate)}),$el.find(".delete-sprint").removeClass("hidden"),editSprint=$translate.instant("BACKLOG.EDIT_SPRINT"),$el.find(".title").text(editSprint),save=$translate.instant("COMMON.SAVE"),$el.find(".button-green").text(save),lightboxService.open($el),$el.find(".sprint-name").focus().select(),$el.find(".last-sprint-name").addClass("disappear")}),$el.on("keyup",".sprint-name",function(event){return $el.find(".sprint-name").val().length>0||hasErrors?$el.find(".last-sprint-name").addClass("disappear"):$el.find(".last-sprint-name").removeClass("disappear")}),$el.on("submit","form",submit),$el.on("click",".delete-sprint .icon-delete",function(event){return event.preventDefault(),remove()}),$scope.$on("$destroy",function(){return $el.off()}),resetSprint()},{link:link}},module.directive("tgLbCreateEditSprint",["$tgRepo","$tgConfirm","$tgResources","$rootScope","lightboxService","$tgLoading","$translate",CreateEditSprint])}.call(this),function(){var BacklogController,BacklogDirective,BurndownBacklogGraphDirective,TgBacklogProgressBarDirective,ToggleBurndownVisibility,UsPointsDirective,UsRolePointsSelectorDirective,bindMethods,bindOnce,generateHash,groupBy,mixOf,module,scopeDefer,taiga,timeout,toggleText,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,toggleText=this.taiga.toggleText,scopeDefer=this.taiga.scopeDefer,bindOnce=this.taiga.bindOnce,groupBy=this.taiga.groupBy,timeout=this.taiga.timeout,bindMethods=this.taiga.bindMethods,generateHash=this.taiga.generateHash,module=angular.module("taigaBacklog"),BacklogController=function(superClass){function BacklogController(scope1,rootscope,repo,confirm,rs,params1,q,location,appMetaService,navUrls,events,analytics,translate,loading,rs2){var promise;this.scope=scope1,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params1,this.q=q,this.location=location,this.appMetaService=appMetaService,this.navUrls=navUrls,this.events=events,this.analytics=analytics,this.translate=translate,this.loading=loading,this.rs2=rs2,bindMethods(this),this.scope.sectionName=this.translate.instant("BACKLOG.SECTION_NAME"),this.showTags=!1,this.activeFilters=!1,this.scope.showGraphPlaceholder=null,this.initializeEventHandlers(),promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("BACKLOG.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.translate.instant("BACKLOG.PAGE_DESCRIPTION",{projectName:_this.scope.project.name,projectDescription:_this.scope.project.description}),_this.appMetaService.setAll(title,description),_this.rs.userstories.getShowTags(_this.scope.projectId)?(_this.showTags=!0,_this.scope.$broadcast("showTags",_this.showTags)):void 0}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(BacklogController,superClass),BacklogController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","$tgLoading","tgResources"],BacklogController.prototype.initializeEventHandlers=function(){return this.scope.$on("usform:bulk:success",function(_this){return function(){return _this.loadUserstories(),_this.loadProjectStats(),_this.analytics.trackEvent("userstory","create","bulk create userstory on backlog",1)}}(this)),this.scope.$on("sprintform:create:success",function(_this){return function(){return _this.loadSprints(),_this.loadProjectStats(),_this.analytics.trackEvent("sprint","create","create sprint on backlog",1)}}(this)),this.scope.$on("usform:new:success",function(_this){return function(){return _this.loadUserstories(),_this.loadProjectStats(),_this.rootscope.$broadcast("filters:update"),_this.analytics.trackEvent("userstory","create","create userstory on backlog",1)}}(this)),this.scope.$on("sprintform:edit:success",function(_this){return function(){return _this.loadProjectStats()}}(this)),this.scope.$on("sprintform:remove:success",function(_this){return function(event,sprint){return _this.loadSprints(),_this.loadProjectStats(),_this.loadUserstories(),sprint.closed&&_this.loadClosedSprints(),_this.rootscope.$broadcast("filters:update")}}(this)),this.scope.$on("usform:edit:success",function(_this){return function(){return _this.loadUserstories(),_this.rootscope.$broadcast("filters:update")}}(this)),this.scope.$on("sprint:us:move",this.moveUs),this.scope.$on("sprint:us:moved",this.loadSprints),this.scope.$on("sprint:us:moved",this.loadProjectStats),this.scope.$on("backlog:load-closed-sprints",this.loadClosedSprints),this.scope.$on("backlog:unload-closed-sprints",this.unloadClosedSprints)},BacklogController.prototype.initializeSubscription=function(){var routingKey1,routingKey2;return routingKey1="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,routingKey1,function(_this){return function(message){return _this.loadUserstories(),_this.loadSprints()}}(this)),routingKey2="changes.project."+this.scope.projectId+".milestones",this.events.subscribe(this.scope,routingKey2,function(_this){return function(message){return _this.loadSprints()}}(this))},BacklogController.prototype.toggleShowTags=function(){return this.scope.$apply(function(_this){return function(){return _this.showTags=!_this.showTags,_this.rs.userstories.storeShowTags(_this.scope.projectId,_this.showTags)}}(this))},BacklogController.prototype.toggleActiveFilters=function(){return this.activeFilters=!this.activeFilters},BacklogController.prototype.loadProjectStats=function(){return this.rs.projects.stats(this.scope.projectId).then(function(_this){return function(stats){var totalPoints;return _this.scope.stats=stats,totalPoints=stats.total_points?stats.total_points:stats.defined_points,totalPoints?_this.scope.stats.completedPercentage=Math.round(100*stats.closed_points/totalPoints):_this.scope.stats.completedPercentage=0,_this.scope.showGraphPlaceholder=!(null!=stats.total_points&&null!=stats.total_milestones),stats}}(this))},BacklogController.prototype.unloadClosedSprints=function(){return this.scope.$apply(function(_this){return function(){return _this.scope.closedSprints=[],_this.rootscope.$broadcast("closed-sprints:reloaded",[])}}(this))},BacklogController.prototype.loadClosedSprints=function(){var params;return params={closed:!0},this.rs.sprints.list(this.scope.projectId,params).then(function(_this){return function(result){var j,len,sprint,sprints;for(sprints=result.milestones,_this.scope.totalClosedMilestones=result.closed,j=0,len=sprints.length;len>j;j++)sprint=sprints[j],sprint.user_stories=_.sortBy(sprint.user_stories,"sprint_order");return _this.scope.closedSprints=sprints,_this.scope.closedSprintsById=groupBy(sprints,function(x){return x.id}),_this.rootscope.$broadcast("closed-sprints:reloaded",sprints),sprints}}(this))},BacklogController.prototype.loadSprints=function(){var params;return params={closed:!1},this.rs.sprints.list(this.scope.projectId,params).then(function(_this){return function(result){var j,len,sprint,sprints;for(sprints=result.milestones,_this.scope.totalMilestones=sprints,_this.scope.totalClosedMilestones=result.closed,_this.scope.totalOpenMilestones=result.open,_this.scope.totalMilestones=_this.scope.totalOpenMilestones+_this.scope.totalClosedMilestones,j=0,len=sprints.length;len>j;j++)sprint=sprints[j],sprint.user_stories=_.sortBy(sprint.user_stories,"sprint_order");return _this.scope.sprints=sprints,_this.scope.openSprints=_.filter(sprints,function(sprint){return!sprint.closed}).reverse(),_this.scope.closedSprints||(_this.scope.closedSprints=[]),_this.scope.sprintsCounter=sprints.length,_this.scope.sprintsById=groupBy(sprints,function(x){return x.id}),_this.rootscope.$broadcast("sprints:loaded",sprints),_this.scope.currentSprint=_this.findCurrentSprint(),sprints}}(this))},BacklogController.prototype.restoreFilters=function(){var selectedStatuses,selectedTags;return selectedTags=this.scope.oldSelectedTags,selectedStatuses=this.scope.oldSelectedStatuses,selectedStatuses||selectedStatuses?(this.scope.filtersQ=this.scope.filtersQOld,this.replaceFilter("q",this.scope.filtersQ),_.each([selectedTags,selectedStatuses],function(_this){return function(filterGrp){return _.each(filterGrp,function(item){var filter,filters;return filters=_this.scope.filters[item.type],filter=_.find(filters,{id:item.id}),filter.selected=!0,_this.selectFilter(item.type,item.id)})}}(this)),this.loadUserstories()):void 0},BacklogController.prototype.resetFilters=function(){var selectedStatuses,selectedTags;return selectedTags=_.filter(this.scope.filters.tags,"selected"),selectedStatuses=_.filter(this.scope.filters.status,"selected"),this.scope.oldSelectedTags=selectedTags,this.scope.oldSelectedStatuses=selectedStatuses,this.scope.filtersQOld=this.scope.filtersQ,this.scope.filtersQ=void 0,this.replaceFilter("q",this.scope.filtersQ),_.each([selectedTags,selectedStatuses],function(_this){return function(filterGrp){return _.each(filterGrp,function(item){var filter,filters;return filters=_this.scope.filters[item.type],filter=_.find(filters,{id:item.id}),filter.selected=!1,_this.unselectFilter(item.type,item.id)})}}(this)),this.loadUserstories()},BacklogController.prototype.loadUserstories=function(){var promise;return this.scope.httpParams=this.getUrlFilters(),this.rs.userstories.storeQueryParams(this.scope.projectId,this.scope.httpParams),promise=this.rs.userstories.listUnassigned(this.scope.projectId,this.scope.httpParams),promise.then(function(_this){return function(userstories){return _this.scope.userstories=_.sortBy(userstories,"backlog_order"),_this.setSearchDataFilters(),scopeDefer(_this.scope,function(){return _this.scope.$broadcast("userstories:loaded")}),userstories}}(this))},BacklogController.prototype.loadBacklog=function(){return this.q.all([this.loadProjectStats(),this.loadSprints(),this.loadUserstories()])},BacklogController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.is_backlog_activated||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.closedMilestones=!!project.total_closed_milestones,_this.scope.$emit("project:loaded",project),_this.scope.points=_.sortBy(project.points,"order"),_this.scope.pointsById=groupBy(project.points,function(x){return x.id}),_this.scope.usStatusById=groupBy(project.us_statuses,function(x){return x.id}),_this.scope.usStatusList=_.sortBy(project.us_statuses,"id"),project}}(this))},BacklogController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.initializeSubscription()}}(this)),promise.then(function(_this){return function(){return _this.loadBacklog()}}(this)).then(function(_this){return function(){return _this.generateFilters()}}(this)).then(function(_this){return function(){return _this.scope.$emit("backlog:loaded")}}(this))},BacklogController.prototype.prepareBulkUpdateData=function(uses,field){return null==field&&(field="backlog_order"),_.map(uses,function(x){return{us_id:x.id,order:x[field]}})},BacklogController.prototype.resortUserStories=function(uses,field){var index,item,items,j,len;for(null==field&&(field="backlog_order"),items=[],index=j=0,len=uses.length;len>j;index=++j)item=uses[index],item[field]=index,item.isModified()&&items.push(item);return items},BacklogController.prototype.moveUs=function(ctx,usList,newUsIndex,newSprintId){var data,items,j,l,len,len1,len2,m,movedFromClosedSprint,movedToClosedSprint,newSprint,oldSprintId,project,promise,promises,sprint,us,userstories;if(oldSprintId=usList[0].milestone,project=usList[0].project,movedFromClosedSprint=!1,movedToClosedSprint=!1,sprint=this.scope.sprintsById[oldSprintId],!sprint&&this.scope.closedSprintsById&&(sprint=this.scope.closedSprintsById[oldSprintId],sprint&&(movedFromClosedSprint=!0)),newSprint=this.scope.sprintsById[newSprintId],!newSprint&&newSprintId&&(newSprint=this.scope.closedSprintsById[newSprintId],newSprint&&(movedToClosedSprint=!0)),newSprintId===oldSprintId)return items=null,userstories=null,userstories=null===newSprintId?this.scope.userstories:newSprint.user_stories,this.scope.$apply(function(){var args,j,key,len,r,us;for(key=j=0,len=usList.length;len>j;key=++j)us=usList[key],r=userstories.indexOf(us),userstories.splice(r,1);return args=[newUsIndex,0].concat(usList),Array.prototype.splice.apply(userstories,args)}),null===newSprintId?(items=this.resortUserStories(userstories,"backlog_order"),data=this.prepareBulkUpdateData(items,"backlog_order"),this.rs.userstories.bulkUpdateBacklogOrder(project,data).then(function(_this){return function(){var j,len,results,us;for(results=[],j=0,len=usList.length;len>j;j++)us=usList[j],results.push(_this.rootscope.$broadcast("sprint:us:moved",us,oldSprintId,newSprintId));return results}}(this))):(items=this.resortUserStories(userstories,"sprint_order"),data=this.prepareBulkUpdateData(items,"sprint_order"),this.rs.userstories.bulkUpdateSprintOrder(project,data).then(function(_this){return function(){var j,len,results,us;for(results=[],j=0,len=usList.length;len>j;j++)us=usList[j],results.push(_this.rootscope.$broadcast("sprint:us:moved",us,oldSprintId,newSprintId));return results}}(this))),promise;if(null===newSprintId){for(j=0,len=usList.length;len>j;j++)us=usList[j],us.milestone=null;return this.scope.$apply(function(_this){return function(){var args,key,l,len1,r,results;for(args=[newUsIndex,0].concat(usList),Array.prototype.splice.apply(_this.scope.userstories,args),results=[],key=l=0,len1=usList.length;len1>l;key=++l)us=usList[key],r=sprint.user_stories.indexOf(us),results.push(sprint.user_stories.splice(r,1));return results}}(this)),promise=this.repo.save(us),promise=promise.then(function(_this){return function(){return items=_this.resortUserStories(_this.scope.userstories,"backlog_order"),data=_this.prepareBulkUpdateData(items,"backlog_order"),_this.rs.userstories.bulkUpdateBacklogOrder(us.project,data).then(function(){return _this.rootscope.$broadcast("sprint:us:moved",us,oldSprintId,newSprintId),movedFromClosedSprint?_this.rootscope.$broadcast("backlog:load-closed-sprints"):void 0})}}(this)),promise.then(null,function(){return console.log("FAIL")}),promise}if(null===oldSprintId){for(l=0,len1=usList.length;len1>l;l++)us=usList[l],us.milestone=newSprintId;this.scope.$apply(function(_this){return function(){var args,key,len2,m,r,results;for(args=[newUsIndex,0].concat(usList),Array.prototype.splice.apply(newSprint.user_stories,args),results=[],key=m=0,len2=usList.length;len2>m;key=++m)us=usList[key],r=_this.scope.userstories.indexOf(us),results.push(_this.scope.userstories.splice(r,1));return results}}(this))}else{for(m=0,len2=usList.length;len2>m;m++)us=usList[m],us.milestone=newSprintId;this.scope.$apply(function(_this){return function(){var args,len3,n,r,results;for(args=[newUsIndex,0].concat(usList),Array.prototype.splice.apply(newSprint.user_stories,args),results=[],n=0,len3=usList.length;len3>n;n++)us=usList[n],r=sprint.user_stories.indexOf(us),results.push(sprint.user_stories.splice(r,1));return results}}(this))}return promises=_.map(usList,function(_this){return function(us){return _this.repo.save(us)}}(this)),promise=this.q.all(promises).then(function(_this){
return function(){return items=_this.resortUserStories(newSprint.user_stories,"sprint_order"),data=_this.prepareBulkUpdateData(items,"sprint_order"),_this.rs.userstories.bulkUpdateSprintOrder(project,data).then(function(result){return _this.rootscope.$broadcast("sprint:us:moved",us,oldSprintId,newSprintId)}),_this.rs.userstories.bulkUpdateBacklogOrder(project,data).then(function(){var len3,n,results;for(results=[],n=0,len3=usList.length;len3>n;n++)us=usList[n],results.push(_this.rootscope.$broadcast("sprint:us:moved",us,oldSprintId,newSprintId));return results}),movedToClosedSprint||movedFromClosedSprint?_this.scope.$broadcast("backlog:load-closed-sprints"):void 0}}(this)),promise.then(null,function(){return console.log("FAIL")}),promise},BacklogController.prototype.isFilterSelected=function(type,id){return null!=this.searchdata[type]&&this.searchdata[type][id]?!0:!1},BacklogController.prototype.setSearchDataFilters=function(){var name,results,urlfilters,val,value;urlfilters=this.getUrlFilters(),urlfilters.q&&(this.scope.filtersQ=this.scope.filtersQ||urlfilters.q),this.searchdata={},results=[];for(name in urlfilters)value=urlfilters[name],null==this.searchdata[name]&&(this.searchdata[name]={}),results.push(function(){var j,len,ref1,results1;for(ref1=taiga.toString(value).split(","),results1=[],j=0,len=ref1.length;len>j;j++)val=ref1[j],results1.push(this.searchdata[name][val]=!0);return results1}.call(this));return results},BacklogController.prototype.getUrlFilters=function(){return _.pick(this.location.search(),"status","tags","q")},BacklogController.prototype.generateFilters=function(){var loadFilters,urlfilters;return urlfilters=this.getUrlFilters(),this.scope.filters={},loadFilters={},loadFilters.project=this.scope.projectId,loadFilters.tags=urlfilters.tags,loadFilters.status=urlfilters.status,loadFilters.q=urlfilters.q,loadFilters.milestone="null",this.rs.userstories.filtersData(loadFilters).then(function(_this){return function(data){var choicesFiltersFormat,selectedStatuses,selectedTags,tagsFilterFormat;return choicesFiltersFormat=function(choices,type,byIdObject){return _.map(choices,function(t){return t.type=type,t})},tagsFilterFormat=function(tags){return _.map(tags,function(t){return t.id=t.name,t.type="tags",t})},_this.scope.filters.status=choicesFiltersFormat(data.statuses,"status",_this.scope.usStatusById),_this.scope.filters.tags=tagsFilterFormat(data.tags),selectedTags=_.filter(_this.scope.filters.tags,"selected"),selectedTags=_.map(selectedTags,"id"),selectedStatuses=_.filter(_this.scope.filters.status,"selected"),selectedStatuses=_.map(selectedStatuses,"id"),_this.markSelectedFilters(_this.scope.filters,urlfilters),_this.rs.userstories.storeQueryParams(_this.scope.projectId,{status:selectedStatuses,tags:selectedTags,project:_this.scope.projectId,milestone:null})}}(this))},BacklogController.prototype.markSelectedFilters=function(filters,urlfilters){var isSelected,j,key,len,name,obj,ref1,ref2,results,searchdata,val,value;searchdata={},ref1=_.omit(urlfilters,"page","orderBy");for(name in ref1)for(value=ref1[name],null==searchdata[name]&&(searchdata[name]={}),ref2=(""+value).split(","),j=0,len=ref2.length;len>j;j++)val=ref2[j],searchdata[name][val]=!0;isSelected=function(type,id){return null!=searchdata[type]&&searchdata[type][id]?!0:!1},results=[];for(key in filters)value=filters[key],results.push(function(){var l,len1,results1;for(results1=[],l=0,len1=value.length;len1>l;l++)obj=value[l],results1.push(obj.selected=isSelected(obj.type,obj.id)?!0:void 0);return results1}());return results},BacklogController.prototype.updateUserStoryStatus=function(){return this.setSearchDataFilters(),this.generateFilters().then(function(_this){return function(){return _this.rootscope.$broadcast("filters:update"),_this.loadProjectStats()}}(this))},BacklogController.prototype.editUserStory=function(projectId,ref,$event){var currentLoading,target;return target=$($event.target),currentLoading=this.loading().target(target).removeClasses("icon-edit").timeout(200).start(),this.rs.userstories.getByRef(projectId,ref).then(function(_this){return function(us){return _this.rs2.attachments.list("us",us.id,projectId).then(function(attachments){return _this.rootscope.$broadcast("usform:edit",us,attachments.toJS()),currentLoading.finish()})}}(this))},BacklogController.prototype.deleteUserStory=function(us){var message,title;return title=this.translate.instant("US.TITLE_DELETE_ACTION"),message=us.subject,this.confirm.askOnDelete(title,message).then(function(_this){return function(askResponse){var promise;return _this.scope.userstories=_.without(_this.scope.userstories,us),promise=_this.repo.remove(us),promise.then(function(){return askResponse.finish(),_this.loadBacklog()}),promise.then(null,function(){return askResponse.finish(!1),_this.confirm.notify("error")})}}(this))},BacklogController.prototype.addNewUs=function(type){switch(type){case"standard":return this.rootscope.$broadcast("usform:new",this.scope.projectId,this.scope.project.default_us_status,this.scope.usStatusList);case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,this.scope.project.default_us_status)}},BacklogController.prototype.addNewSprint=function(){return this.rootscope.$broadcast("sprintform:create",this.scope.projectId)},BacklogController.prototype.findCurrentSprint=function(){var currentDate;return currentDate=(new Date).getTime(),_.find(this.scope.sprints,function(sprint){var end,start;return start=moment(sprint.estimated_start,"YYYY-MM-DD").format("x"),end=moment(sprint.estimated_finish,"YYYY-MM-DD").format("x"),currentDate>=start&&end>=currentDate})},BacklogController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("BacklogController",BacklogController),BacklogDirective=function($repo,$rootscope,$translate){var doomLineTemplate,link,linkDoomLine,linkFilters,linkToolbar,showHideFilter,showHideTags;return doomLineTemplate=_.template('<div class="doom-line"><span><%- text %></span></div>'),linkDoomLine=function($scope,$el,$attrs,$ctrl){var addDoomLineDom,getUsItems,reloadDoomLine,removeDoomlineDom;return reloadDoomLine=function(){var current_sum,domElement,i,j,len,ref1,results,stats,total_points,us;if(null!=$scope.stats&&null!=$scope.stats.total_points&&0!==$scope.stats.total_points){if(removeDoomlineDom(),stats=$scope.stats,total_points=stats.total_points,current_sum=stats.assigned_points,!$scope.userstories)return;for(ref1=$scope.userstories,results=[],i=j=0,len=ref1.length;len>j;i=++j){if(us=ref1[i],current_sum+=us.total_points,current_sum>total_points){domElement=$el.find(".backlog-table-body .us-item-row")[i],addDoomLineDom(domElement);break}results.push(void 0)}return results}},removeDoomlineDom=function(){return $el.find(".doom-line").remove()},addDoomLineDom=function(element){var text;return text=$translate.instant("BACKLOG.DOOMLINE"),$(element).before(doomLineTemplate({text:text}))},getUsItems=function(){var rowElements;return rowElements=$el.find(".backlog-table-body .us-item-row"),_.map(rowElements,function(x){return angular.element(x)})},$scope.$on("userstories:loaded",reloadDoomLine),$scope.$watch("stats",reloadDoomLine)},linkToolbar=function($scope,$el,$attrs,$ctrl){var checkSelected,getUsToMove,lastChecked,moveToCurrentSprint,moveToLatestSprint,moveUssToSprint,shiftPressed;return getUsToMove=function(){var ussDom;return ussDom=$el.find(".backlog-table-body input:checkbox:checked"),_.map(ussDom,function(item){var itemScope;return item=$(item).closest(".tg-scope"),itemScope=item.scope(),itemScope.us.milestone=$scope.sprints[0].id,itemScope.us})},moveUssToSprint=function(selectedUss,sprint){var extraPoints,totalExtraPoints,ussCurrent;return ussCurrent=_($scope.userstories),$scope.userstories=ussCurrent.without.apply(ussCurrent,selectedUss).value(),extraPoints=_.map(selectedUss,function(v,k){return v.total_points}),totalExtraPoints=_.reduce(extraPoints,function(acc,num){return acc+num}),sprint.user_stories=_.union(sprint.user_stories,selectedUss),sprint.total_points+=totalExtraPoints,$repo.saveAll(selectedUss).then(function(){return $ctrl.loadSprints(),$ctrl.loadProjectStats()}),$el.find(".move-to-sprint").hide()},moveToCurrentSprint=function(selectedUss){return moveUssToSprint(selectedUss,$scope.currentSprint)},moveToLatestSprint=function(selectedUss){return moveUssToSprint(selectedUss,$scope.sprints[0])},shiftPressed=!1,lastChecked=null,checkSelected=function(target){var moveToSprintDom,selectedUsDom;return lastChecked=target.closest(".us-item-row"),target.closest(".us-item-row").toggleClass("ui-multisortable-multiple"),moveToSprintDom=$el.find(".move-to-sprint"),selectedUsDom=$el.find(".backlog-table-body input:checkbox:checked"),selectedUsDom.length>0&&$scope.sprints.length>0?moveToSprintDom.show():moveToSprintDom.hide()},$(window).on("keydown.shift-pressed keyup.shift-pressed",function(event){return shiftPressed=!!event.shiftKey,!0}),$el.on("change",".backlog-table-body input:checkbox",function(event){var current,elements,nextAll,prevAll,target;return lastChecked&&shiftPressed&&(elements=[],current=$(event.currentTarget).closest(".us-item-row"),nextAll=lastChecked.nextAll(),prevAll=lastChecked.prevAll(),_.some(nextAll,function(next){return next===current[0]})?elements=lastChecked.nextUntil(current):_.some(prevAll,function(prev){return prev===current[0]})&&(elements=lastChecked.prevUntil(current)),_.map(elements,function(elm){var input;return input=$(elm).find("input:checkbox"),input.prop("checked",!0),checkSelected(input)})),target=angular.element(event.currentTarget),target.closest(".us-item-row").toggleClass("is-checked"),checkSelected(target)}),$el.on("click","#move-to-latest-sprint",function(_this){return function(event){var ussToMove;return ussToMove=getUsToMove(),$scope.$apply(_.partial(moveToLatestSprint,ussToMove))}}(this)),$el.on("click","#move-to-current-sprint",function(_this){return function(event){var ussToMove;return ussToMove=getUsToMove(),$scope.$apply(_.partial(moveToCurrentSprint,ussToMove))}}(this)),$el.on("click","#show-tags",function(event){return event.preventDefault(),$ctrl.toggleShowTags(),showHideTags($ctrl)})},showHideTags=function($ctrl){var elm,text;return elm=angular.element("#show-tags"),$ctrl.showTags?(elm.addClass("active"),text=$translate.instant("BACKLOG.TAGS.HIDE"),elm.text(text)):(elm.removeClass("active"),text=$translate.instant("BACKLOG.TAGS.SHOW"),elm.text(text))},showHideFilter=function($scope,$el,$ctrl){var hideText,showText,sidebar,target;return sidebar=$el.find("sidebar.filters-bar"),sidebar.one("transitionend",function(){return timeout(150,function(){return $rootscope.$broadcast("resize"),$(".burndown").css("visibility","visible")})}),target=angular.element("#show-filters-button"),$(".burndown").css("visibility","hidden"),sidebar.toggleClass("active"),target.toggleClass("active"),hideText=$translate.instant("BACKLOG.FILTERS.HIDE"),showText=$translate.instant("BACKLOG.FILTERS.SHOW"),toggleText(target,[hideText,showText]),sidebar.hasClass("active")?$ctrl.restoreFilters():$ctrl.resetFilters(),$ctrl.toggleActiveFilters()},linkFilters=function($scope,$el,$attrs,$ctrl){return $scope.filtersSearch={},$el.on("click","#show-filters-button",function(event){return event.preventDefault(),$scope.$apply(function(){return showHideFilter($scope,$el,$ctrl)})})},link=function($scope,$el,$attrs,$rootscope){var $ctrl,filters;return $ctrl=$el.controller(),linkToolbar($scope,$el,$attrs,$ctrl),linkFilters($scope,$el,$attrs,$ctrl),linkDoomLine($scope,$el,$attrs,$ctrl),$el.find(".backlog-table-body").disableSelection(),filters=$ctrl.getUrlFilters(),(filters.status||filters.tags||filters.q)&&showHideFilter($scope,$el,$ctrl),$scope.$on("showTags",function(){return showHideTags($ctrl)}),$scope.$on("$destroy",function(){return $el.off(),$(window).off(".shift-pressed")})},{link:link}},module.directive("tgBacklog",["$tgRepo","$rootScope","$translate",BacklogDirective]),UsRolePointsSelectorDirective=function($rootscope,$template,$compile,$translate){var link,selectionTemplate;return selectionTemplate=$template.get("backlog/us-role-points-popover.html",!0),link=function($scope,$el,$attrs){return bindOnce($scope,"project",function(project){var numberOfRoles,roles;return roles=_.filter(project.roles,"computable"),numberOfRoles=_.size(roles),numberOfRoles>1?$el.append($compile(selectionTemplate({roles:roles}))($scope)):($el.find(".icon-arrow-bottom").remove(),$el.find(".header-points").addClass("not-clickable"))}),$scope.$on("uspoints:select",function(ctx,roleId,roleName){return $el.find(".popover").popover().close(),$el.find(".header-points").html(roleName+"/<span>Total</span>")}),$scope.$on("uspoints:clear-selection",function(ctx,roleId){var text;return $el.find(".popover").popover().close(),text=$translate.instant("COMMON.FIELDS.POINTS"),$el.find(".header-points").text(text)}),$el.on("click",function(event){var target;return target=angular.element(event.target),(target.is("span")||target.is("div"))&&event.stopPropagation(),$el.find(".popover").popover().open()}),$el.on("click",".clear-selection",function(event){return event.preventDefault(),event.stopPropagation(),$rootscope.$broadcast("uspoints:clear-selection")}),$el.on("click",".role",function(event){var rolScope,target;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),rolScope=target.scope(),$rootscope.$broadcast("uspoints:select",target.data("role-id"),target.text())}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgUsRolePointsSelector",["$rootScope","$tgTemplate","$compile",UsRolePointsSelectorDirective]),UsPointsDirective=function($tgEstimationsService,$repo,$tgTemplate){var link,rolesTemplate;return rolesTemplate=$tgTemplate.get("common/estimation/us-points-roles-popover.html",!0),link=function($scope,$el,$attrs){var $ctrl,bindClickElements,estimationProcess,filteringRoleId,renderRolesSelector,selectedRoleId,updatingSelectedRoleId;return $ctrl=$el.controller(),updatingSelectedRoleId=null,selectedRoleId=null,filteringRoleId=null,estimationProcess=null,$scope.$on("uspoints:select",function(ctx,roleId,roleName){var us;return us=$scope.$eval($attrs.tgBacklogUsPoints),selectedRoleId=roleId,estimationProcess.render()}),$scope.$on("uspoints:clear-selection",function(ctx){var us;return us=$scope.$eval($attrs.tgBacklogUsPoints),selectedRoleId=null,estimationProcess.render()}),$scope.$watch($attrs.tgBacklogUsPoints,function(us){var roles;return us?(estimationProcess=$tgEstimationsService.create($el,us,$scope.project),roles=estimationProcess.calculateRoles(),0===roles.length?($el.find(".icon-arrow-bottom").remove(),$el.find("a.us-points").addClass("not-clickable")):1===roles.length&&(selectedRoleId=_.keys(us.points)[0]),estimationProcess.isEditable&&bindClickElements(),estimationProcess.onSelectedPointForRole=function(roleId,pointId){return this.save(roleId,pointId).then(function(){return $ctrl.loadProjectStats()})},estimationProcess.render=function(){var ctx,html,mainTemplate,pointId,pointObj,template,text,title,totalPoints;return totalPoints=this.calculateTotalPoints(),null==selectedRoleId||1===roles.length?(text=totalPoints,title=totalPoints):(pointId=this.us.points[selectedRoleId],pointObj=this.pointsById[pointId],text=pointObj.name+" / <span>"+totalPoints+"</span>",title=pointObj.name+" / "+totalPoints),ctx={totalPoints:totalPoints,roles:this.calculateRoles(),editable:this.isEditable,text:text,title:title},mainTemplate="common/estimation/us-estimation-total.html",template=$tgTemplate.get(mainTemplate,!0),html=template(ctx),this.$el.html(html)},estimationProcess.render()):void 0}),renderRolesSelector=function(){var html,roles;return roles=estimationProcess.calculateRoles(),html=rolesTemplate({roles:roles}),$el.append(html),$el.find(".pop-role").popover().open(function(){return $(this).remove()})},bindClickElements=function(){return $el.on("click","a.us-points span",function(event){var us;return event.preventDefault(),event.stopPropagation(),us=$scope.$eval($attrs.tgBacklogUsPoints),updatingSelectedRoleId=selectedRoleId,null!=selectedRoleId?estimationProcess.renderPointsSelector(selectedRoleId):renderRolesSelector()}),$el.on("click",".role",function(event){var popRolesDom,target,us;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),us=$scope.$eval($attrs.tgBacklogUsPoints),updatingSelectedRoleId=target.data("role-id"),popRolesDom=$el.find(".pop-role"),popRolesDom.find("a").removeClass("active"),popRolesDom.find("a[data-role-id='"+updatingSelectedRoleId+"']").addClass("active"),estimationProcess.renderPointsSelector(updatingSelectedRoleId)})},$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgBacklogUsPoints",["$tgEstimationsService","$tgRepo","$tgTemplate",UsPointsDirective]),ToggleBurndownVisibility=function($storage){var hide,link,show;return hide=function(){return $(".js-burndown-graph").removeClass("shown"),$(".js-toggle-burndown-visibility-button").removeClass("active"),$(".js-burndown-graph").removeClass("open")},show=function(firstLoad){return $(".js-toggle-burndown-visibility-button").addClass("active"),firstLoad?$(".js-burndown-graph").addClass("shown"):$(".js-burndown-graph").addClass("open")},link=function($scope,$el,$attrs){var firstLoad,hash,toggleGraph;return firstLoad=!0,hash=generateHash(["is-burndown-grpahs-collapsed"]),$scope.isBurndownGraphCollapsed=$storage.get(hash)||!1,toggleGraph=function(){return $scope.isBurndownGraphCollapsed?hide(firstLoad):show(firstLoad),firstLoad=!1},$scope.$watch("showGraphPlaceholder",function(){return null!=$scope.showGraphPlaceholder?($scope.isBurndownGraphCollapsed=$scope.isBurndownGraphCollapsed||$scope.showGraphPlaceholder,toggleGraph()):void 0}),$el.on("click",".js-toggle-burndown-visibility-button",function(){return $scope.isBurndownGraphCollapsed=!$scope.isBurndownGraphCollapsed,$storage.set(hash,$scope.isBurndownGraphCollapsed),toggleGraph()}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgToggleBurndownVisibility",["$tgStorage",ToggleBurndownVisibility]),BurndownBacklogGraphDirective=function($translate){var link,redrawChart;return redrawChart=function(element,dataToDraw){var client_increment_line,colors,data,evolution_line,milestonesRange,optimal_line,options,results,team_increment_line,width,zero_line;return width=element.width(),element.height(width/6),milestonesRange=function(){results=[];for(var j=0,ref1=dataToDraw.milestones.length-1;ref1>=0?ref1>=j:j>=ref1;ref1>=0?j++:j--)results.push(j);return results}.apply(this),data=[],zero_line=_.map(dataToDraw.milestones,function(ml){return 0}),data.push({data:_.zip(milestonesRange,zero_line),lines:{fillColor:"rgba(0,0,0,0)"},points:{show:!1}}),optimal_line=_.map(dataToDraw.milestones,function(ml){return ml.optimal}),data.push({data:_.zip(milestonesRange,optimal_line),lines:{fillColor:"rgba(120,120,120,0.2)"}}),evolution_line=_.filter(_.map(dataToDraw.milestones,function(ml){return ml.evolution}),function(evolution){return null!=evolution}),data.push({data:_.zip(milestonesRange,evolution_line),lines:{fillColor:"rgba(102,153,51,0.3)"}}),client_increment_line=_.map(dataToDraw.milestones,function(ml){return-ml["team-increment"]-ml["client-increment"]}),data.push({data:_.zip(milestonesRange,client_increment_line),lines:{fillColor:"rgba(255,51,51,0.3)"}}),team_increment_line=_.map(dataToDraw.milestones,function(ml){return-ml["team-increment"]}),data.push({data:_.zip(milestonesRange,team_increment_line),lines:{fillColor:"rgba(153,51,51,0.3)"}}),colors=["rgba(0,0,0,1)","rgba(120,120,120,0.2)","rgba(102,153,51,1)","rgba(153,51,51,1)","rgba(255,51,51,1)"],options={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{ticks:dataToDraw.milestones.length,axisLabel:$translate.instant("BACKLOG.CHART.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5,tickFormatter:function(val,axis){return""}},yaxis:{axisLabel:$translate.instant("BACKLOG.CHART.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:colors,tooltip:!0,tooltipOpts:{content:function(label,xval,yval,flotItem){var ctx;return 1===flotItem.seriesIndex?(ctx={sprintName:dataToDraw.milestones[xval].name,value:Math.abs(yval)},$translate.instant("BACKLOG.CHART.OPTIMAL",ctx)):2===flotItem.seriesIndex?(ctx={sprintName:dataToDraw.milestones[xval].name,value:Math.abs(yval)},$translate.instant("BACKLOG.CHART.REAL",ctx)):3===flotItem.seriesIndex?(ctx={sprintName:dataToDraw.milestones[xval].name,value:Math.abs(yval)},$translate.instant("BACKLOG.CHART.INCREMENT_CLIENT",ctx)):(ctx={sprintName:dataToDraw.milestones[xval].name,value:Math.abs(yval)},$translate.instant("BACKLOG.CHART.INCREMENT_TEAM",ctx))}}},element.empty(),element.plot(data,options).data("plot")},link=function($scope,$el,$attrs){var element;return element=angular.element($el),$scope.$watch("stats",function(value){return null!=$scope.stats?(redrawChart(element,$scope.stats),$scope.$on("resize",function(){return redrawChart(element,$scope.stats)})):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgBurndownBacklogGraph",["$translate",BurndownBacklogGraphDirective]),TgBacklogProgressBarDirective=function($template,$compile){var adjustPercentaje,link,render,template;return template=$template.get("backlog/progress-bar.html",!0),render=function(scope,el,projectPointsPercentaje,closedPointsPercentaje){var html;return html=template({projectPointsPercentaje:projectPointsPercentaje,closedPointsPercentaje:closedPointsPercentaje}),html=$compile(html)(scope),el.html(html)},adjustPercentaje=function(percentage){var adjusted;return adjusted=_.max([0,percentage]),adjusted=_.min([100,adjusted]),Math.round(adjusted)},link=function($scope,$el,$attrs){var element;return element=angular.element($el),$scope.$watch($attrs.tgBacklogProgressBar,function(stats){var closedPoints,closedPointsPercentaje,definedPoints,projectPointsPercentaje,totalPoints;return null!=stats?(totalPoints=stats.total_points?stats.total_points:stats.defined_points,definedPoints=stats.defined_points,closedPoints=stats.closed_points,definedPoints>totalPoints?(projectPointsPercentaje=100*totalPoints/definedPoints,closedPointsPercentaje=100*closedPoints/definedPoints):(projectPointsPercentaje=100,closedPointsPercentaje=100*closedPoints/totalPoints),projectPointsPercentaje=adjustPercentaje(projectPointsPercentaje-3),closedPointsPercentaje=adjustPercentaje(closedPointsPercentaje-3),render($scope,$el,projectPointsPercentaje,closedPointsPercentaje)):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgBacklogProgressBar",["$tgTemplate","$compile",TgBacklogProgressBarDirective])}.call(this),function(){var BacklogEmptySortableDirective,BacklogSortableDirective,SprintSortableDirective,bindOnce,deleteElement,groupBy,mixOf,module,scopeDefer,taiga,toggleText;taiga=this.taiga,mixOf=this.taiga.mixOf,toggleText=this.taiga.toggleText,scopeDefer=this.taiga.scopeDefer,bindOnce=this.taiga.bindOnce,groupBy=this.taiga.groupBy,module=angular.module("taigaBacklog"),deleteElement=function(el){return el.scope().$destroy(),el.off(),el.remove()},BacklogSortableDirective=function($repo,$rs,$rootscope,$tgConfirm,$translate){var link;return link=function($scope,$el,$attrs){var getUsIndex;return getUsIndex=function(_this){return function(us){return $(us).index(".backlog-table-body .row")}}(this),bindOnce($scope,"project",function(project){var filterError;if(project.my_permissions.indexOf("modify_us")>-1)return filterError=function(){var text;return text=$translate.instant("BACKLOG.SORTABLE_FILTER_ERROR"),$tgConfirm.notify("error",text)},$el.sortable({items:".us-item-row",cancel:".popover",connectWith:".sprint",dropOnEmpty:!0,placeholder:"row us-item-row us-item-drag sortable-placeholder",scroll:!0,disableHorizontalScroll:!0,tolerance:"pointer",revert:!1,start:function(){return $(document.body).addClass("drag-active")},stop:function(){return $(document.body).removeClass("drag-active"),$el.hasClass("active-filters")?($el.sortable("cancel"),filterError()):void 0}}),$el.on("multiplesortreceive",function(event,ui){var itemIndex,itemUs;return $el.hasClass("active-filters")?(ui.source.sortable("cancel"),void filterError()):(itemUs=ui.item.scope().us,itemIndex=getUsIndex(ui.item),deleteElement(ui.item),$scope.$emit("sprint:us:move",[itemUs],itemIndex,null),ui.item.find("a").removeClass("noclick"))}),$el.on("multiplesortstop",function(event,ui){var index,items,us;if(0!==$(ui.items[0]).parent().length&&!$el.hasClass("active-filters"))return items=_.sortBy(ui.items,function(item){return $(item).index()}),index=_.min(_.map(items,function(item){return getUsIndex(item)})),us=_.map(items,function(item){var itemUs;return item=$(item),itemUs=item.scope().us,setTimeout(function(_this){return function(){return item.find("a").removeClass("noclick")}}(this),300),itemUs}),$scope.$emit("sprint:us:move",us,index,null)}),$el.on("sortstart",function(event,ui){return ui.item.find("a").addClass("noclick")})}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},BacklogEmptySortableDirective=function($repo,$rs,$rootscope){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,"project",function(project){return project.my_permissions.indexOf("modify_us")>-1?($el.sortable({items:".us-item-row",dropOnEmpty:!0}),$el.on("sortreceive",function(event,ui){var itemIndex,itemUs;return itemUs=ui.item.scope().us,itemIndex=ui.item.index(),deleteElement(ui.item),$scope.$emit("sprint:us:move",[itemUs],itemIndex,null),ui.item.find("a").removeClass("noclick")})):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},SprintSortableDirective=function($repo,$rs,$rootscope){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,"project",function(project){return project.my_permissions.indexOf("modify_us")>-1?($el.sortable({scroll:!0,dropOnEmpty:!0,items:".sprint-table .milestone-us-item-row",disableHorizontalScroll:!0,connectWith:".sprint,.backlog-table-body,.empty-backlog",placeholder:"row us-item-row sortable-placeholder",forcePlaceholderSize:!0}),$el.on("multiplesortreceive",function(event,ui){var index,items,us;return items=_.sortBy(ui.items,function(item){return $(item).index()}),index=_.min(_.map(items,function(item){return $(item).index()})),us=_.map(items,function(item){var itemUs;return item=$(item),itemUs=item.scope().us,deleteElement(item),itemUs}),$scope.$emit("sprint:us:move",us,index,$scope.sprint.id)}),$el.on("multiplesortstop",function(event,ui){var itemIndex,itemUs;if(0!==ui.item.parent().length)return itemUs=ui.item.scope().us,itemIndex=ui.item.index(),setTimeout(function(_this){return function(){return ui.item.find("a").removeClass("noclick")}}(this),300),$scope.$emit("sprint:us:move",[itemUs],itemIndex,$scope.sprint.id)}),$el.on("sortstart",function(event,ui){return ui.item.find("a").addClass("noclick")})):void 0})},{link:link}},module.directive("tgBacklogSortable",["$tgRepo","$tgResources","$rootScope","$tgConfirm","$translate",BacklogSortableDirective]),module.directive("tgBacklogEmptySortable",["$tgRepo","$tgResources","$rootScope",BacklogEmptySortableDirective]),module.directive("tgSprintSortable",["$tgRepo","$tgResources","$rootScope",SprintSortableDirective])}.call(this),function(){var BacklogSprintDirective,BacklogSprintHeaderDirective,ToggleExcludeClosedSprintsVisualization,module,taiga;taiga=this.taiga,module=angular.module("taigaBacklog"),BacklogSprintDirective=function($repo,$rootscope){var link,slideOptions,sprintTableMinHeight,toggleSprint;return sprintTableMinHeight=50,slideOptions={duration:500,easing:"linear"},toggleSprint=function(_this){return function($el){var sprintArrow,sprintTable;return sprintTable=$el.find(".sprint-table"),sprintArrow=$el.find(".icon-arrow-up"),sprintArrow.toggleClass("active"),sprintTable.toggleClass("open")}}(this),link=function($scope,$el,$attrs){return $scope.$watch($attrs.tgBacklogSprint,function(sprint){return sprint=$scope.$eval($attrs.tgBacklogSprint),sprint.closed?$el.addClass("sprint-closed"):toggleSprint($el)}),$el.on("click",".sprint-name > .icon-arrow-up",function(event){return event.preventDefault(),toggleSprint($el),$el.find(".sprint-table").slideToggle(slideOptions)}),$el.on("click",".sprint-name > .icon-edit",function(event){var sprint;return event.preventDefault(),sprint=$scope.$eval($attrs.tgBacklogSprint),$rootscope.$broadcast("sprintform:edit",sprint)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgBacklogSprint",["$tgRepo","$rootScope",BacklogSprintDirective]),BacklogSprintHeaderDirective=function($navUrls,$template,$compile,$translate){var link,template;return template=$template.get("backlog/sprint-header.html"),link=function($scope,$el,$attrs,$model){var isEditable,isVisible,prettyDate,render;return prettyDate=$translate.instant("BACKLOG.SPRINTS.DATE"),isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_milestone")},isVisible=function(){return-1!==$scope.project.my_permissions.indexOf("view_milestones")},render=function(sprint){var compiledTemplate,ctx,estimatedDateRange,finish,start,taskboardUrl,templateScope;return taskboardUrl=$navUrls.resolve("project-taskboard",{project:$scope.project.slug,sprint:sprint.slug}),start=moment(sprint.estimated_start).format(prettyDate),finish=moment(sprint.estimated_finish).format(prettyDate),estimatedDateRange=start+"-"+finish,ctx={name:sprint.name,taskboardUrl:taskboardUrl,estimatedDateRange:estimatedDateRange,closedPoints:sprint.closed_points||0,totalPoints:sprint.total_points||0,isVisible:isVisible(),isEditable:isEditable()},templateScope=$scope.$new(),_.assign(templateScope,ctx),compiledTemplate=$compile(template)(templateScope),$el.html(compiledTemplate)},$scope.$watch($attrs.ngModel,function(sprint){return render(sprint)}),$scope.$on("sprintform:edit:success",function(){return render($model.$modelValue)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgBacklogSprintHeader",["$tgNavUrls","$tgTemplate","$compile","$translate",BacklogSprintHeaderDirective]),ToggleExcludeClosedSprintsVisualization=function($rootscope,$loading,$translate){var excludeClosedSprints,link;return excludeClosedSprints=!0,link=function($scope,$el,$attrs){var currentLoading,loadingElm;return loadingElm=$("<div>"),$el.after(loadingElm),currentLoading=null,$el.on("click",function(event){return event.preventDefault(),excludeClosedSprints=!excludeClosedSprints,currentLoading=$loading().target(loadingElm).start(),excludeClosedSprints?$rootscope.$broadcast("backlog:unload-closed-sprints"):$rootscope.$broadcast("backlog:load-closed-sprints")}),$scope.$on("$destroy",function(){return $el.off()}),$scope.$on("closed-sprints:reloaded",function(_this){return function(ctx,sprints){var key,text;return currentLoading.finish(),key=sprints.length>0?"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS":"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS",text=$translate.instant(key),$el.find(".text").text(text)}}(this))},{link:link}},module.directive("tgBacklogToggleClosedSprintsVisualization",["$rootScope","$tgLoading","$translate",ToggleExcludeClosedSprintsVisualization])}.call(this),function(){var SprintGraphDirective,bindOnce,groupBy,mixOf,module,scopeDefer,taiga,timeout,toggleText;taiga=this.taiga,mixOf=this.taiga.mixOf,toggleText=this.taiga.toggleText,scopeDefer=this.taiga.scopeDefer,bindOnce=this.taiga.bindOnce,groupBy=this.taiga.groupBy,timeout=this.taiga.timeout,module=angular.module("taigaTaskboard"),SprintGraphDirective=function($translate){var link,redrawChart;
return redrawChart=function(element,dataToDraw){var data,days,options,width;return width=element.width(),element.height(240),days=_.map(dataToDraw,function(x){return moment(x.day)}),data=[],data.unshift({data:_.zip(days,_.map(dataToDraw,function(d){return d.optimal_points})),lines:{fillColor:"rgba(120,120,120,0.2)"}}),data.unshift({data:_.zip(days,_.map(dataToDraw,function(d){return d.open_points})),lines:{fillColor:"rgba(102,153,51,0.3)"}}),options={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{tickSize:[1,"day"],min:days[0],max:_.last(days),mode:"time",daysNames:days,axisLabel:$translate.instant("TASKBOARD.CHARTS.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},yaxis:{min:0,axisLabel:$translate.instant("TASKBOARD.CHARTS.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:["rgba(102,153,51,1)","rgba(120,120,120,0.2)"],tooltip:!0,tooltipOpts:{content:function(label,xval,yval,flotItem){var formattedDate,roundedValue;return formattedDate=moment(xval).format($translate.instant("TASKBOARD.CHARTS.DATE")),roundedValue=Math.round(yval),1===flotItem.seriesIndex?$translate.instant("TASKBOARD.CHARTS.OPTIMAL",{formattedDate:formattedDate,roundedValue:roundedValue}):$translate.instant("TASKBOARD.CHARTS.REAL",{formattedDate:formattedDate,roundedValue:roundedValue})}}},element.empty(),element.plot(data,options).data("plot")},link=function($scope,$el,$attrs){var element;return element=angular.element($el),$scope.$on("resize",function(){return $scope.stats?redrawChart(element,$scope.stats.days):void 0}),$scope.$on("taskboard:graph:toggle-visibility",function(){return $el.parent().toggleClass("open"),timeout(100,function(){return $scope.stats?redrawChart(element,$scope.stats.days):void 0})}),$scope.$watch("stats",function(value){return null!=$scope.stats?redrawChart(element,$scope.stats.days):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgSprintGraph",["$translate",SprintGraphDirective])}.call(this),function(){var CreateBulkTasksDirective,CreateEditTaskDirective,bindOnce,debounce,module,taiga;taiga=this.taiga,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,CreateEditTaskDirective=function($repo,$model,$rs,$rootscope,$loading,lightboxService,$translate,$q,attachmentsService){var link;return link=function($scope,$el,attrs){var attachmentsToAdd,attachmentsToDelete,createAttachments,deleteAttachments,resetAttachments,submit,submitButton;return $scope.isNew=!0,attachmentsToAdd=Immutable.List(),attachmentsToDelete=Immutable.List(),resetAttachments=function(){return attachmentsToAdd=Immutable.List(),attachmentsToDelete=Immutable.List()},$scope.addAttachment=function(attachment){return attachmentsToAdd=attachmentsToAdd.push(attachment)},$scope.deleteAttachment=function(attachment){return attachmentsToDelete=attachmentsToDelete.push(attachment)},createAttachments=function(obj){var promises;return promises=_.map(attachmentsToAdd.toJS(),function(attachment){return attachmentsService.upload(attachment.file,obj.id,$scope.task.project,"task")}),$q.all(promises)},deleteAttachments=function(obj){var promises;return console.log(attachmentsToDelete.toJS()),promises=_.map(attachmentsToDelete.toJS(),function(attachment){return attachmentsService["delete"]("task",attachment.id)}),$q.all(promises)},$scope.$on("taskform:new",function(ctx,sprintId,usId){var create,newTask;return $scope.task={project:$scope.projectId,milestone:sprintId,user_story:usId,is_archived:!1,status:$scope.project.default_task_status,assigned_to:null,tags:[]},$scope.isNew=!0,$scope.attachments=Immutable.List(),resetAttachments(),create=$translate.instant("COMMON.CREATE"),$el.find(".button-green").html(create),newTask=$translate.instant("LIGHTBOX.CREATE_EDIT_TASK.TITLE"),$el.find(".title").html(newTask+"  "),$el.find(".tag-input").val(""),lightboxService.open($el)}),$scope.$on("taskform:edit",function(ctx,task,attachments){var edit,save;return $scope.task=task,$scope.isNew=!1,$scope.attachments=Immutable.fromJS(attachments),resetAttachments(),save=$translate.instant("COMMON.SAVE"),edit=$translate.instant("LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT"),$el.find(".button-green").html(save),$el.find(".title").html(edit+"  "),$el.find(".tag-input").val(""),lightboxService.open($el)}),submitButton=$el.find(".submit-button"),submit=debounce(2e3,function(_this){return function(event){var broadcastEvent,currentLoading,form,promise;return event.preventDefault(),form=$el.find("form").checksley(),form.validate()?($scope.isNew?(promise=$repo.create("tasks",$scope.task),broadcastEvent="taskform:new:success"):(promise=$repo.save($scope.task),broadcastEvent="taskform:edit:success"),promise.then(function(data){return createAttachments(data),deleteAttachments(data),data}),currentLoading=$loading().target(submitButton).start(),promise.then(function(data){return currentLoading.finish(),lightboxService.close($el),$rootscope.$broadcast(broadcastEvent,data)})):void 0}}(this)),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},CreateBulkTasksDirective=function($repo,$rs,$rootscope,$loading,lightboxService){var link;return link=function($scope,$el,attrs){var submit,submitButton;return $scope.form={data:"",usId:null},submit=debounce(2e3,function(_this){return function(event){var currentLoading,data,form,projectId,promise,sprintId,usId;return event.preventDefault(),form=$el.find("form").checksley(),form.validate()?(currentLoading=$loading().target(submitButton).start(),data=$scope.form.data,projectId=$scope.projectId,sprintId=$scope.form.sprintId,usId=$scope.form.usId,promise=$rs.tasks.bulkCreate(projectId,sprintId,usId,data),promise.then(function(result){return currentLoading.finish(),$rootscope.$broadcast("taskform:bulk:success",result),lightboxService.close($el)}),promise.then(null,function(){return currentLoading.finish(),console.log("FAIL")})):void 0}}(this)),$scope.$on("taskform:bulk",function(ctx,sprintId,usId){return lightboxService.open($el),$scope.form={data:"",sprintId:sprintId,usId:usId}}),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module=angular.module("taigaTaskboard"),module.directive("tgLbCreateEditTask",["$tgRepo","$tgModel","$tgResources","$rootScope","$tgLoading","lightboxService","$translate","$q","tgAttachmentsService",CreateEditTaskDirective]),module.directive("tgLbCreateBulkTasks",["$tgRepo","$tgResources","$rootScope","$tgLoading","lightboxService",CreateBulkTasksDirective])}.call(this),function(){var TaskboardController,TaskboardDirective,TaskboardSquishColumnDirective,TaskboardTaskDirective,TaskboardUserDirective,bindMethods,bindOnce,groupBy,mixOf,module,scopeDefer,taiga,timeout,toggleText,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,toggleText=this.taiga.toggleText,mixOf=this.taiga.mixOf,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,scopeDefer=this.taiga.scopeDefer,timeout=this.taiga.timeout,bindMethods=this.taiga.bindMethods,module=angular.module("taigaTaskboard"),TaskboardController=function(superClass){function TaskboardController(scope,rootscope,repo,confirm,rs1,params1,q,appMetaService,location,navUrls,events,analytics,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs1,this.params=params1,this.q=q,this.appMetaService=appMetaService,this.location=location,this.navUrls=navUrls,this.events=events,this.analytics=analytics,this.translate=translate,bindMethods(this),this.scope.sectionName=this.translate.instant("TASKBOARD.SECTION_NAME"),this.initializeEventHandlers(),promise=this.loadInitialData(),promise.then(function(_this){return function(){return _this._setMeta()}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(TaskboardController,superClass),TaskboardController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","tgAppMetaService","$tgLocation","$tgNavUrls","$tgEvents","$tgAnalytics","$translate"],TaskboardController.prototype._setMeta=function(){var description,prettyDate,title;return prettyDate=this.translate.instant("BACKLOG.SPRINTS.DATE"),title=this.translate.instant("TASKBOARD.PAGE_TITLE",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name}),description=this.translate.instant("TASKBOARD.PAGE_DESCRIPTION",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name,startDate:moment(this.scope.sprint.estimated_start).format(prettyDate),endDate:moment(this.scope.sprint.estimated_finish).format(prettyDate),completedPercentage:this.scope.stats.completedPercentage||"0",completedPoints:this.scope.stats.completedPointsSum||"--",totalPoints:this.scope.stats.totalPointsSum||"--",openTasks:this.scope.stats.openTasks||"--",totalTasks:this.scope.stats.total_tasks||"--"}),this.appMetaService.setAll(title,description)},TaskboardController.prototype.initializeEventHandlers=function(){return this.scope.$on("taskform:bulk:success",function(_this){return function(){return _this.loadTaskboard(),_this.analytics.trackEvent("task","create","bulk create task on taskboard",1)}}(this)),this.scope.$on("taskform:new:success",function(_this){return function(){return _this.loadTaskboard(),_this.analytics.trackEvent("task","create","create task on taskboard",1)}}(this)),this.scope.$on("taskform:edit:success",function(_this){return function(){return _this.loadTaskboard()}}(this)),this.scope.$on("taskboard:task:move",this.taskMove),this.scope.$on("assigned-to:added",function(_this){return function(ctx,userId,task){var promise;return task.assigned_to=userId,promise=_this.repo.save(task),promise.then(null,function(){return console.log("FAIL")})}}(this))},TaskboardController.prototype.initializeSubscription=function(){var routingKey,routingKey1;return routingKey="changes.project."+this.scope.projectId+".tasks",this.events.subscribe(this.scope,routingKey,function(_this){return function(message){return _this.loadTaskboard()}}(this)),routingKey1="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,routingKey1,function(_this){return function(message){return _this.refreshTagsColors(),_this.loadSprintStats(),_this.loadSprint()}}(this))},TaskboardController.prototype.loadProject=function(){return this.rs.projects.get(this.scope.projectId).then(function(_this){return function(project){return project.is_backlog_activated||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.project=project,_this.scope.pointsList=_.sortBy(project.points,"order"),_this.scope.pointsById=groupBy(project.points,function(e){return e.id}),_this.scope.roleById=groupBy(project.roles,function(e){return e.id}),_this.scope.taskStatusList=_.sortBy(project.task_statuses,"order"),_this.scope.usStatusList=_.sortBy(project.us_statuses,"order"),_this.scope.usStatusById=groupBy(project.us_statuses,function(e){return e.id}),_this.scope.$emit("project:loaded",project),_this.fillUsersAndRoles(project.members,project.roles),project}}(this))},TaskboardController.prototype.loadSprintStats=function(){return this.rs.sprints.stats(this.scope.projectId,this.scope.sprintId).then(function(_this){return function(stats){var completedPointsSum,remainingPointsSum,remainingTasks,totalPointsSum;return totalPointsSum=_.reduce(_.values(stats.total_points),function(res,n){return res+n},0),completedPointsSum=_.reduce(_.values(stats.completed_points),function(res,n){return res+n},0),remainingPointsSum=totalPointsSum-completedPointsSum,remainingTasks=stats.total_tasks-stats.completed_tasks,_this.scope.stats=stats,_this.scope.stats.totalPointsSum=totalPointsSum,_this.scope.stats.completedPointsSum=completedPointsSum,_this.scope.stats.remainingPointsSum=remainingPointsSum,_this.scope.stats.remainingTasks=remainingTasks,stats.totalPointsSum?_this.scope.stats.completedPercentage=Math.round(100*stats.completedPointsSum/stats.totalPointsSum):_this.scope.stats.completedPercentage=0,_this.scope.stats.openTasks=stats.total_tasks-stats.completed_tasks,stats}}(this))},TaskboardController.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then(function(_this){return function(tags_colors){return _this.scope.project.tags_colors=tags_colors}}(this))},TaskboardController.prototype.loadSprint=function(){return this.rs.sprints.get(this.scope.projectId,this.scope.sprintId).then(function(_this){return function(sprint){return _this.scope.sprint=sprint,_this.scope.userstories=_.sortBy(sprint.user_stories,"sprint_order"),sprint}}(this))},TaskboardController.prototype.loadTasks=function(){return this.rs.tasks.list(this.scope.projectId,this.scope.sprintId).then(function(_this){return function(tasks){var i,j,k,len,len1,len2,ref,ref1,ref2,status,task,us,usId;for(_this.scope.tasks=_.sortBy(tasks,"taskboard_order"),_this.scope.usTasks={},ref=_.union(_this.scope.userstories,[{id:null}]),i=0,len=ref.length;len>i;i++)for(us=ref[i],_this.scope.usTasks[us.id]={},ref1=_this.scope.taskStatusList,j=0,len1=ref1.length;len1>j;j++)status=ref1[j],_this.scope.usTasks[us.id][status.id]=[];for(ref2=_this.scope.tasks,k=0,len2=ref2.length;len2>k;k++)task=ref2[k],null!=_this.scope.usTasks[task.user_story]&&null!=_this.scope.usTasks[task.user_story][task.status]&&_this.scope.usTasks[task.user_story][task.status].push(task);return 0===tasks.length&&(usId=_this.scope.userstories.length>0?_this.scope.userstories[0].id:null,_this.scope.usTasks[usId][_this.scope.taskStatusList[0].id].push({isPlaceholder:!0})),tasks}}(this))},TaskboardController.prototype.loadTaskboard=function(){return this.q.all([this.refreshTagsColors(),this.loadSprintStats(),this.loadSprint().then(function(_this){return function(){return _this.loadTasks()}}(this))])},TaskboardController.prototype.loadInitialData=function(){var params,promise;return params={pslug:this.params.pslug,sslug:this.params.sslug},promise=this.repo.resolve(params).then(function(_this){return function(data){return _this.scope.projectId=data.project,_this.scope.sprintId=data.milestone,_this.initializeSubscription(),data}}(this)),promise.then(function(_this){return function(){return _this.loadProject()}}(this)).then(function(_this){return function(){return _this.loadTaskboard()}}(this))},TaskboardController.prototype.refreshTasksOrder=function(tasks){var data,items;return items=this.resortTasks(tasks),data=this.prepareBulkUpdateData(items),this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id,data)},TaskboardController.prototype.resortTasks=function(tasks){var i,index,item,items,len;for(items=[],index=i=0,len=tasks.length;len>i;index=++i)item=tasks[index],item.taskboard_order=index,item.isModified()&&items.push(item);return items},TaskboardController.prototype.prepareBulkUpdateData=function(uses){return _.map(uses,function(x){return{task_id:x.id,order:x.taskboard_order}})},TaskboardController.prototype.taskMove=function(ctx,task,usId,statusId,order){var promise,r,tasks;return r=this.scope.usTasks[task.user_story][task.status].indexOf(task),this.scope.usTasks[task.user_story][task.status].splice(r,1),tasks=this.scope.usTasks[usId][statusId],tasks.splice(order,0,task),task.user_story=usId,task.status=statusId,task.taskboard_order=order,promise=this.repo.save(task),this.rootscope.$broadcast("sprint:task:moved",task),promise.then(function(_this){return function(){return _this.refreshTasksOrder(tasks),_this.loadSprintStats()}}(this)),promise.then(null,function(_this){return function(){return console.log("FAIL TASK SAVE")}}(this))},TaskboardController.prototype.addNewTask=function(type,us){switch(type){case"standard":return this.rootscope.$broadcast("taskform:new",this.scope.sprintId,null!=us?us.id:void 0);case"bulk":return this.rootscope.$broadcast("taskform:bulk",this.scope.sprintId,null!=us?us.id:void 0)}},TaskboardController.prototype.editTaskAssignedTo=function(task){return this.rootscope.$broadcast("assigned-to:add",task)},TaskboardController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("TaskboardController",TaskboardController),TaskboardDirective=function($rootscope){var link;return link=function($scope,$el,$attrs){var $ctrl,tableBodyDom;return $ctrl=$el.controller(),$el.on("click",".toggle-analytics-visibility",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),target.toggleClass("active"),$rootscope.$broadcast("taskboard:graph:toggle-visibility")}),tableBodyDom=$el.find(".taskboard-table-body"),tableBodyDom.on("scroll",function(event){var tableHeaderDom,target;return target=angular.element(event.currentTarget),tableHeaderDom=$el.find(".taskboard-table-header .taskboard-table-inner"),tableHeaderDom.css("left",-1*target.scrollLeft())}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgTaskboard",["$rootScope",TaskboardDirective]),TaskboardTaskDirective=function($rootscope,$loading,$rs,$rs2){var link;return link=function($scope,$el,$attrs,$model){return $el.disableSelection(),$scope.$watch("task",function(task){return task.is_blocked&&!$el.hasClass("blocked")?$el.addClass("blocked"):!task.is_blocked&&$el.hasClass("blocked")?$el.removeClass("blocked"):void 0}),$el.find(".icon-edit").on("click",function(event){return $el.find(".icon-edit").hasClass("noclick")?void 0:$scope.$apply(function(){var currentLoading,target,task;return target=$(event.target),currentLoading=$loading().target(target).timeout(200).removeClasses("icon-edit").start(),task=$scope.task,$rs.tasks.getByRef(task.project,task.ref).then(function(_this){return function(editingTask){return $rs2.attachments.list("task",editingTask.id,editingTask.project).then(function(attachments){return $rootscope.$broadcast("taskform:edit",editingTask,attachments.toJS()),currentLoading.finish()})}}(this))})})},{link:link}},module.directive("tgTaskboardTask",["$rootScope","$tgLoading","$tgResources","tgResources",TaskboardTaskDirective]),TaskboardSquishColumnDirective=function(rs){var avatarWidth,link,maxColumnWidth;return avatarWidth=40,maxColumnWidth=300,link=function($scope,$el,$attrs){var getCeilWidth,recalculateStatusColumnWidth,recalculateTaskboardWidth,refreshTaskboardTableWidth,setStatusColumnWidth;return $scope.$on("sprint:task:moved",function(_this){return function(){return recalculateTaskboardWidth()}}(this)),bindOnce($scope,"usTasks",function(project){return $scope.statusesFolded=rs.tasks.getStatusColumnModes($scope.project.id),$scope.usFolded=rs.tasks.getUsRowModes($scope.project.id,$scope.sprintId),recalculateTaskboardWidth()}),$scope.foldStatus=function(status){return $scope.statusesFolded[status.id]=!$scope.statusesFolded[status.id],rs.tasks.storeStatusColumnModes($scope.projectId,$scope.statusesFolded),recalculateTaskboardWidth()},$scope.foldUs=function(us){return us?$scope.usFolded[us.id]=!$scope.usFolded[us.id]:$scope.usFolded[null]=!$scope.usFolded[null],rs.tasks.storeUsRowModes($scope.projectId,$scope.sprintId,$scope.usFolded),recalculateTaskboardWidth()},getCeilWidth=function(_this){return function(usId,statusId){var tasks,tasksMatrixSize,width;return tasks=$scope.usTasks[usId][statusId].length,$scope.statusesFolded[statusId]?(tasks&&$scope.usFolded[usId]?(tasksMatrixSize=Math.round(Math.sqrt(tasks)),width=avatarWidth*tasksMatrixSize):width=avatarWidth,width):0}}(this),setStatusColumnWidth=function(_this){return function(statusId,width){var column;return column=$el.find(".squish-status-"+statusId),width?column.css("max-width",width):column.css("max-width",maxColumnWidth)}}(this),refreshTaskboardTableWidth=function(_this){return function(){var columnWidths,columns,totalWidth;return columnWidths=[],columns=$el.find(".task-colum-name"),columnWidths=_.map(columns,function(column){return $(column).outerWidth(!0)}),totalWidth=_.reduce(columnWidths,function(total,width){return total+width}),$el.find(".taskboard-table-inner").css("width",totalWidth)}}(this),recalculateStatusColumnWidth=function(_this){return function(statusId){var statusFoldedWidth;return statusFoldedWidth=getCeilWidth(null,statusId),_.forEach($scope.userstories,function(us){var width;return width=getCeilWidth(us.id,statusId),width>statusFoldedWidth?statusFoldedWidth=width:void 0}),setStatusColumnWidth(statusId,statusFoldedWidth)}}(this),recalculateTaskboardWidth=function(_this){return function(){_.forEach($scope.taskStatusList,function(status){return recalculateStatusColumnWidth(status.id)}),refreshTaskboardTableWidth()}}(this)},{link:link}},module.directive("tgTaskboardSquishColumn",["$tgResources",TaskboardSquishColumnDirective]),TaskboardUserDirective=function($log,$translate){var clickable,link;return clickable=!1,link=function($scope,$el,$attrs){var username_label;return username_label=$el.parent().find("a.task-assigned"),username_label.addClass("not-clickable"),$scope.$watch("task.assigned_to",function(assigned_to){var user;return user=$scope.usersById[assigned_to],void 0===user?_.assign($scope,{name:$translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png",clickable:clickable}):_.assign($scope,{name:user.full_name_display,imgurl:user.photo,clickable:clickable}),username_label.text($scope.name)}),bindOnce($scope,"project",function(project){return project.my_permissions.indexOf("modify_task")>-1?(clickable=!0,$el.find(".avatar-assigned-to").on("click",function(_this){return function(event){var $ctrl;if(!$el.find("a").hasClass("noclick"))return $ctrl=$el.controller(),$ctrl.editTaskAssignedTo($scope.task)}}(this)),username_label.removeClass("not-clickable"),username_label.on("click",function(event){var $ctrl;if(!$el.find("a").hasClass("noclick"))return $ctrl=$el.controller(),$ctrl.editTaskAssignedTo($scope.task)})):void 0})},{link:link,templateUrl:"taskboard/taskboard-user.html",scope:{usersById:"=users",project:"=",task:"="}}},module.directive("tgTaskboardUserAvatar",["$log","$translate",TaskboardUserDirective])}.call(this),function(){var TaskboardSortableDirective,bindOnce,groupBy,mixOf,module,scopeDefer,taiga,toggleText;taiga=this.taiga,mixOf=this.taiga.mixOf,toggleText=this.taiga.toggleText,scopeDefer=this.taiga.scopeDefer,bindOnce=this.taiga.bindOnce,groupBy=this.taiga.groupBy,module=angular.module("taigaBacklog"),TaskboardSortableDirective=function($repo,$rs,$rootscope){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,"project",function(project){var deleteElement,itemEl,newParentScope,oldParentScope,tdom;if(project.my_permissions.indexOf("modify_us")>-1)return oldParentScope=null,newParentScope=null,itemEl=null,tdom=$el,deleteElement=function(itemEl){return itemEl.scope().$destroy(),itemEl.off(),itemEl.remove()},tdom.sortable({handle:".taskboard-task-inner",dropOnEmpty:!0,connectWith:".taskboard-tasks-box",revert:400}),tdom.on("sortstop",function(event,ui){var itemIndex,itemTask,newStatusId,newUsId,oldStatusId,oldUsId,parentEl;return parentEl=ui.item.parent(),itemEl=ui.item,itemTask=itemEl.scope().task,itemIndex=itemEl.index(),newParentScope=parentEl.scope(),oldUsId=oldParentScope.us?oldParentScope.us.id:null,oldStatusId=oldParentScope.st.id,newUsId=newParentScope.us?newParentScope.us.id:null,newStatusId=newParentScope.st.id,(newStatusId!==oldStatusId||newUsId!==oldUsId)&&deleteElement(itemEl),$scope.$apply(function(){return $rootscope.$broadcast("taskboard:task:move",itemTask,newUsId,newStatusId,itemIndex)}),ui.item.find("a").removeClass("noclick")}),tdom.on("sortstart",function(event,ui){return oldParentScope=ui.item.parent().scope(),ui.item.find("a").addClass("noclick")})}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgTaskboardSortable",["$tgRepo","$tgResources","$rootScope",TaskboardSortableDirective])}.call(this),function(){var KanbanArchivedStatusHeaderDirective,KanbanArchivedStatusIntroDirective,KanbanController,KanbanDirective,KanbanSquishColumnDirective,KanbanUserDirective,KanbanUserstoryDirective,KanbanWipLimitDirective,bindMethods,bindOnce,defaultViewMode,groupBy,mixOf,module,scopeDefer,taiga,timeout,toggleText,viewModes,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,toggleText=this.taiga.toggleText,scopeDefer=this.taiga.scopeDefer,bindOnce=this.taiga.bindOnce,groupBy=this.taiga.groupBy,timeout=this.taiga.timeout,bindMethods=this.taiga.bindMethods,module=angular.module("taigaKanban"),defaultViewMode="maximized",viewModes=["maximized","minimized"],KanbanController=function(superClass){function KanbanController(scope,rootscope,repo,confirm,rs1,params1,q,location,appMetaService,navUrls,events,analytics,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs1,this.params=params1,this.q=q,this.location=location,this.appMetaService=appMetaService,this.navUrls=navUrls,this.events=events,this.analytics=analytics,this.translate=translate,bindMethods(this),this.scope.sectionName=this.translate.instant("KANBAN.SECTION_NAME"),this.scope.statusViewModes={},this.initializeEventHandlers(),promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("KANBAN.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.translate.instant("KANBAN.PAGE_DESCRIPTION",{projectName:_this.scope.project.name,projectDescription:_this.scope.project.description}),_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(KanbanController,superClass),KanbanController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate"],KanbanController.prototype.initializeEventHandlers=function(){return this.scope.$on("usform:new:success",function(_this){return function(){return _this.loadUserstories(),_this.refreshTagsColors(),_this.analytics.trackEvent("userstory","create","create userstory on kanban",1)}}(this)),this.scope.$on("usform:bulk:success",function(_this){return function(){return _this.loadUserstories(),_this.analytics.trackEvent("userstory","create","bulk create userstory on kanban",1)}}(this)),this.scope.$on("usform:edit:success",function(_this){return function(){return _this.loadUserstories(),_this.refreshTagsColors()}}(this)),this.scope.$on("assigned-to:added",this.onAssignedToChanged),this.scope.$on("kanban:us:move",this.moveUs),this.scope.$on("kanban:show-userstories-for-status",this.loadUserStoriesForStatus),this.scope.$on("kanban:hide-userstories-for-status",this.hideUserStoriesForStatus)},KanbanController.prototype.addNewUs=function(type,statusId){switch(type){case"standard":return this.rootscope.$broadcast("usform:new",this.scope.projectId,statusId,this.scope.usStatusList);case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,statusId)}},KanbanController.prototype.changeUsAssignedTo=function(us){return this.rootscope.$broadcast("assigned-to:add",us)},KanbanController.prototype.onAssignedToChanged=function(ctx,userid,us){var promise;return us.assigned_to=userid,promise=this.repo.save(us),promise.then(null,function(){return console.log("FAIL")})},KanbanController.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then(function(_this){return function(tags_colors){return _this.scope.project.tags_colors=tags_colors}}(this))},KanbanController.prototype.loadUserstories=function(){var params,promise;return params={status__is_archived:!1},promise=this.rs.userstories.listAll(this.scope.projectId,params).then(function(_this){return function(userstories){var i,j,k,len,len1,len2,ref,ref1,ref2,status,us,usByStatus,us_archived;for(_this.scope.userstories=userstories,usByStatus=_.groupBy(userstories,"status"),us_archived=[],ref=_this.scope.usStatusList,i=0,len=ref.length;len>i;i++){if(status=ref[i],null==usByStatus[status.id]&&(usByStatus[status.id]=[]),null!=_this.scope.usByStatus)for(ref1=_this.scope.usByStatus[status.id],j=0,len1=ref1.length;len1>j;j++)us=ref1[j],us.status!==status.id&&us_archived.push(us);if(status.is_archived&&null!=_this.scope.usByStatus&&0!==_this.scope.usByStatus[status.id].length)for(ref2=_this.scope.usByStatus[status.id].concat(us_archived),k=0,len2=ref2.length;len2>k;k++)us=ref2[k],us.status===status.id&&usByStatus[status.id].push(us);usByStatus[status.id]=_.sortBy(usByStatus[status.id],"kanban_order")}return 0===userstories.length&&(status=_this.scope.usStatusList[0],usByStatus[status.id].push({isPlaceholder:!0})),_this.scope.usByStatus=usByStatus,scopeDefer(_this.scope,function(){return _this.scope.$broadcast("userstories:loaded",userstories)}),userstories}}(this)),promise.then(function(_this){return function(){return _this.scope.$broadcast("redraw:wip")}}(this)),promise},KanbanController.prototype.loadUserStoriesForStatus=function(ctx,statusId){var params;return params={status:statusId},this.rs.userstories.listAll(this.scope.projectId,params).then(function(_this){return function(userstories){return _this.scope.usByStatus[statusId]=_.sortBy(userstories,"kanban_order"),_this.scope.$broadcast("kanban:shown-userstories-for-status",statusId,userstories),userstories}}(this))},KanbanController.prototype.hideUserStoriesForStatus=function(ctx,statusId){return this.scope.usByStatus[statusId]=[],this.scope.$broadcast("kanban:hidden-userstories-for-status",statusId)},KanbanController.prototype.loadKanban=function(){return this.q.all([this.refreshTagsColors(),this.loadUserstories()])},KanbanController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.is_kanban_activated||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.projectId=project.id,_this.scope.points=_.sortBy(project.points,"order"),_this.scope.pointsById=groupBy(project.points,function(x){return x.id}),_this.scope.usStatusById=groupBy(project.us_statuses,function(x){return x.id}),_this.scope.usStatusList=_.sortBy(project.us_statuses,"order"),_this.generateStatusViewModes(),_this.scope.$emit("project:loaded",project),project}}(this))},KanbanController.prototype.initializeSubscription=function(){var routingKey1;return routingKey1="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,routingKey1,function(_this){return function(message){return _this.loadUserstories()}}(this))},KanbanController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.initializeSubscription(),_this.loadKanban()}}(this))},KanbanController.prototype.generateStatusViewModes=function(){var i,len,mode,ref,status,storedStatusViewModes;for(storedStatusViewModes=this.rs.kanban.getStatusViewModes(this.scope.projectId),this.scope.statusViewModes={},ref=this.scope.usStatusList,i=0,len=ref.length;len>i;i++)status=ref[i],mode=storedStatusViewModes[status.id]||defaultViewMode,this.scope.statusViewModes[status.id]=mode;return this.storeStatusViewModes()},
KanbanController.prototype.storeStatusViewModes=function(){return this.rs.kanban.storeStatusViewModes(this.scope.projectId,this.scope.statusViewModes)},KanbanController.prototype.updateStatusViewMode=function(statusId,newViewMode){return this.scope.statusViewModes[statusId]=newViewMode,this.storeStatusViewModes()},KanbanController.prototype.isMaximized=function(statusId){var mode;return mode=this.scope.statusViewModes[statusId]||defaultViewMode,"maximized"===mode},KanbanController.prototype.isMinimized=function(statusId){var mode;return mode=this.scope.statusViewModes[statusId]||defaultViewMode,"minimized"===mode},KanbanController.prototype.prepareBulkUpdateData=function(uses,field){return null==field&&(field="kanban_order"),_.map(uses,function(x){return{us_id:x.id,order:x[field]}})},KanbanController.prototype.resortUserStories=function(uses){var i,index,item,items,len;for(items=[],index=i=0,len=uses.length;len>i;index=++i)item=uses[index],item.kanban_order=index,item.isModified()&&items.push(item);return items},KanbanController.prototype.moveUs=function(ctx,us,oldStatusId,newStatusId,index){var itemsToSave,promise,r;return oldStatusId!==newStatusId?(r=this.scope.usByStatus[oldStatusId].indexOf(us),this.scope.usByStatus[oldStatusId].splice(r,1),this.scope.usByStatus[newStatusId].splice(index,0,us),us.status=newStatusId):(r=this.scope.usByStatus[newStatusId].indexOf(us),this.scope.usByStatus[newStatusId].splice(r,1),this.scope.usByStatus[newStatusId].splice(index,0,us)),itemsToSave=this.resortUserStories(this.scope.usByStatus[newStatusId]),this.scope.usByStatus[newStatusId]=_.sortBy(this.scope.usByStatus[newStatusId],"kanban_order"),promise=this.repo.save(us),promise=promise.then(function(_this){return function(){var data;return itemsToSave=_.reject(itemsToSave,{id:us.id}),data=_this.prepareBulkUpdateData(itemsToSave),_this.rs.userstories.bulkUpdateKanbanOrder(us.project,data).then(function(){return itemsToSave})}}(this))},KanbanController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("KanbanController",KanbanController),KanbanDirective=function($repo,$rootscope){var link;return link=function($scope,$el,$attrs){var tableBodyDom;return tableBodyDom=$el.find(".kanban-table-body"),tableBodyDom.on("scroll",function(event){var tableHeaderDom,target;return target=angular.element(event.currentTarget),tableHeaderDom=$el.find(".kanban-table-header .kanban-table-inner"),tableHeaderDom.css("left",-1*target.scrollLeft())}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgKanban",["$tgRepo","$rootScope",KanbanDirective]),KanbanArchivedStatusHeaderDirective=function($rootscope,$translate){var hideArchivedText,link,showArchivedText;return showArchivedText=$translate.instant("KANBAN.ACTION_SHOW_ARCHIVED"),hideArchivedText=$translate.instant("KANBAN.ACTION_HIDE_ARCHIVED"),link=function($scope,$el,$attrs){var hidden,status;return status=$scope.$eval($attrs.tgKanbanArchivedStatusHeader),hidden=!0,$scope["class"]="icon-open-eye",$scope.title=showArchivedText,$el.on("click",function(event){return hidden=!hidden,$scope.$apply(function(){return hidden?($scope["class"]="icon-open-eye",$scope.title=showArchivedText,$rootscope.$broadcast("kanban:hide-userstories-for-status",status.id)):($scope["class"]="icon-closed-eye",$scope.title=hideArchivedText,$rootscope.$broadcast("kanban:show-userstories-for-status",status.id))})}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgKanbanArchivedStatusHeader",["$rootScope","$translate",KanbanArchivedStatusHeaderDirective]),KanbanArchivedStatusIntroDirective=function($translate){var link,userStories;return userStories=[],link=function($scope,$el,$attrs){var hiddenUserStoriexText,status,updateIntroText;return hiddenUserStoriexText=$translate.instant("KANBAN.HIDDEN_USER_STORIES"),status=$scope.$eval($attrs.tgKanbanArchivedStatusIntro),$el.text(hiddenUserStoriexText),updateIntroText=function(){return userStories.length>0?$el.text(""):$el.text(hiddenUserStoriexText)},$scope.$on("kanban:us:move",function(ctx,itemUs,oldStatusId,newStatusId,itemIndex){var r;return status.id===newStatusId?status.id===oldStatusId?(r=userStories.indexOf(itemUs),userStories.splice(r,1),userStories.splice(itemIndex,0,itemUs)):(itemUs.isArchived=!0,userStories.splice(itemIndex,0,itemUs)):status.id===oldStatusId&&(itemUs.isArchived=!1,r=userStories.indexOf(itemUs),userStories.splice(r,1)),updateIntroText()}),$scope.$on("kanban:shown-userstories-for-status",function(ctx,statusId,userStoriesLoaded){return statusId===status.id?(userStories=_.filter(userStoriesLoaded,function(us){return us.status===status.id}),updateIntroText()):void 0}),$scope.$on("kanban:hidden-userstories-for-status",function(ctx,statusId){return statusId===status.id?(userStories=[],updateIntroText()):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgKanbanArchivedStatusIntro",["$translate",KanbanArchivedStatusIntroDirective]),KanbanUserstoryDirective=function($rootscope,$loading,$rs,$rs2){var link;return link=function($scope,$el,$attrs,$model){return $el.disableSelection(),$scope.$watch("us",function(us){return us.is_blocked&&!$el.hasClass("blocked")?$el.addClass("blocked"):!us.is_blocked&&$el.hasClass("blocked")?$el.removeClass("blocked"):void 0}),$el.on("click",".icon-edit",function(event){var currentLoading,target,us;if(!$el.find(".icon-edit").hasClass("noclick"))return target=$(event.target),currentLoading=$loading().target(target).timeout(200).removeClasses("icon-edit").start(),us=$model.$modelValue,$rs.userstories.getByRef(us.project,us.ref).then(function(_this){return function(editingUserStory){return $rs2.attachments.list("us",us.id,us.project).then(function(attachments){return $rootscope.$broadcast("usform:edit",editingUserStory,attachments.toJS()),currentLoading.finish()})}}(this))}),$scope.getTemplateUrl=function(){return $scope.us.isPlaceholder?"common/components/kanban-placeholder.html":"kanban/kanban-task.html"},$scope.$on("$destroy",function(){return $el.off()})},{template:'<ng-include src="getTemplateUrl()"/>',link:link,require:"ngModel"}},module.directive("tgKanbanUserstory",["$rootScope","$tgLoading","$tgResources","tgResources",KanbanUserstoryDirective]),KanbanSquishColumnDirective=function(rs){var link;return link=function($scope,$el,$attrs){var updateTableWidth;return $scope.$on("project:loaded",function(event,project){return $scope.folds=rs.kanban.getStatusColumnModes(project.id),updateTableWidth()}),$scope.foldStatus=function(status){$scope.folds[status.id]=!$scope.folds[status.id],rs.kanban.storeStatusColumnModes($scope.projectId,$scope.folds),updateTableWidth()},updateTableWidth=function(){var columnWidths,totalWidth;return columnWidths=_.map($scope.usStatusList,function(status){return $scope.folds[status.id]?40:310}),totalWidth=_.reduce(columnWidths,function(total,width){return total+width}),$el.find(".kanban-table-inner").css("width",totalWidth)}},{link:link}},module.directive("tgKanbanSquishColumn",["$tgResources",KanbanSquishColumnDirective]),KanbanWipLimitDirective=function(){var link;return link=function($scope,$el,$attrs){var redrawWipLimit,status;return $el.disableSelection(),status=$scope.$eval($attrs.tgKanbanWipLimit),redrawWipLimit=function(_this){return function(){return $el.find(".kanban-wip-limit").remove(),timeout(200,function(){var element;return element=$el.find(".kanban-task")[status.wip_limit],element?angular.element(element).before("<div class='kanban-wip-limit'></div>"):void 0})}}(this),status&&!status.is_archived&&($scope.$on("redraw:wip",redrawWipLimit),$scope.$on("kanban:us:move",redrawWipLimit),$scope.$on("usform:new:success",redrawWipLimit),$scope.$on("usform:bulk:success",redrawWipLimit)),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgKanbanWipLimit",KanbanWipLimitDirective),KanbanUserDirective=function($log,$compile,$translate){var clickable,link,template;return template=_.template('<figure class="avatar">\n    <a href="#" title="{{\'US.ASSIGN\' | translate}}" <% if (!clickable) {%>class="not-clickable"<% } %>>\n        <img src="<%- imgurl %>" alt="<%- name %>" class="avatar">\n    </a>\n</figure>'),clickable=!1,link=function($scope,$el,$attrs,$model){var render,username_label,wtid;return username_label=$el.parent().find("a.task-assigned"),username_label.addClass("not-clickable"),$attrs.tgKanbanUserAvatar?(wtid=$scope.$watch($attrs.tgKanbanUserAvatar,function(v){var user;return null==$scope.usersById?($log.error("KanbanUserDirective requires userById set in scope."),wtid()):(user=$scope.usersById[v],render(user))}),render=function(user){var ctx,html;return ctx=void 0===user?{name:$translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png",clickable:clickable}:{name:user.full_name_display,imgurl:user.photo,clickable:clickable},html=$compile(template(ctx))($scope),$el.html(html),username_label.text(ctx.name)},bindOnce($scope,"project",function(project){return project.my_permissions.indexOf("modify_us")>-1?(clickable=!0,$el.on("click",function(_this){return function(event){var $ctrl,us;if(!$el.find("a").hasClass("noclick"))return us=$model.$modelValue,$ctrl=$el.controller(),$ctrl.changeUsAssignedTo(us)}}(this)),username_label.removeClass("not-clickable"),username_label.on("click",function(event){var $ctrl,us;if(!$el.find("a").hasClass("noclick"))return us=$model.$modelValue,$ctrl=$el.controller(),$ctrl.changeUsAssignedTo(us)})):void 0}),$scope.$on("$destroy",function(){return $el.off()})):$log.error("KanbanUserDirective: no attr is defined")},{link:link,require:"ngModel"}},module.directive("tgKanbanUserAvatar",["$log","$compile","$translate",KanbanUserDirective])}.call(this),function(){var KanbanSortableDirective,bindOnce,groupBy,mixOf,module,scopeDefer,taiga,timeout,toggleText;taiga=this.taiga,mixOf=this.taiga.mixOf,toggleText=this.taiga.toggleText,scopeDefer=this.taiga.scopeDefer,bindOnce=this.taiga.bindOnce,groupBy=this.taiga.groupBy,timeout=this.taiga.timeout,module=angular.module("taigaKanban"),KanbanSortableDirective=function($repo,$rs,$rootscope){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,"project",function(project){var deleteElement,itemEl,newParentScope,oldParentScope,tdom;if(project.my_permissions.indexOf("modify_us")>-1)return oldParentScope=null,newParentScope=null,itemEl=null,tdom=$el,deleteElement=function(itemEl){return itemEl.scope().$destroy(),itemEl.off(),itemEl.remove()},tdom.sortable({handle:".kanban-task-inner",dropOnEmpty:!0,connectWith:".kanban-uses-box",revert:400}),tdom.on("sortstop",function(event,ui){var itemIndex,itemUs,newStatusId,oldStatusId,parentEl;return parentEl=ui.item.parent(),itemEl=ui.item,itemUs=itemEl.scope().us,itemIndex=itemEl.index(),newParentScope=parentEl.scope(),newStatusId=newParentScope.s.id,oldStatusId=oldParentScope.s.id,newStatusId!==oldStatusId&&deleteElement(itemEl),$scope.$apply(function(){return $rootscope.$broadcast("kanban:us:move",itemUs,itemUs.status,newStatusId,itemIndex)}),ui.item.find("a").removeClass("noclick")}),tdom.on("sortstart",function(event,ui){return oldParentScope=ui.item.parent().scope(),ui.item.find("a").addClass("noclick")})}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgKanbanSortable",["$tgRepo","$tgResources","$rootScope",KanbanSortableDirective])}.call(this),function(){var IssueDetailController,IssuePriorityButtonDirective,IssueSeverityButtonDirective,IssueStatusButtonDirective,IssueStatusDisplayDirective,IssueTypeButtonDirective,PromoteIssueToUsButtonDirective,bindMethods,bindOnce,groupBy,joinStr,mixOf,module,taiga,toString,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,toString=this.taiga.toString,joinStr=this.taiga.joinStr,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,bindMethods=this.taiga.bindMethods,module=angular.module("taigaIssues"),IssueDetailController=function(superClass){function IssueDetailController(scope,rootscope,repo,confirm,rs,params,q,location,log,appMetaService,analytics,navUrls,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.log=log,this.appMetaService=appMetaService,this.analytics=analytics,this.navUrls=navUrls,this.translate=translate,bindMethods(this),this.scope.issueRef=this.params.issueref,this.scope.sectionName=this.translate.instant("ISSUES.SECTION_NAME"),this.initializeEventHandlers(),promise=this.loadInitialData(),promise.then(function(_this){return function(){return _this._setMeta(),_this.initializeOnDeleteGoToUrl()}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(IssueDetailController,superClass),IssueDetailController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate"],IssueDetailController.prototype._setMeta=function(){var description,ref,ref1,ref2,ref3,title;return title=this.translate.instant("ISSUE.PAGE_TITLE",{issueRef:"#"+this.scope.issue.ref,issueSubject:this.scope.issue.subject,projectName:this.scope.project.name}),description=this.translate.instant("ISSUE.PAGE_DESCRIPTION",{issueStatus:(null!=(ref=this.scope.statusById[this.scope.issue.status])?ref.name:void 0)||"--",issueType:(null!=(ref1=this.scope.typeById[this.scope.issue.type])?ref1.name:void 0)||"--",issueSeverity:(null!=(ref2=this.scope.severityById[this.scope.issue.severity])?ref2.name:void 0)||"--",issuePriority:(null!=(ref3=this.scope.priorityById[this.scope.issue.priority])?ref3.name:void 0)||"--",issueDescription:angular.element(this.scope.issue.description_html||"").text()}),this.appMetaService.setAll(title,description)},IssueDetailController.prototype.initializeEventHandlers=function(){return this.scope.$on("attachment:create",function(_this){return function(){return _this.analytics.trackEvent("attachment","create","create attachment on issue",1)}}(this)),this.scope.$on("promote-issue-to-us:success",function(_this){return function(){return _this.analytics.trackEvent("issue","promoteToUserstory","promote issue to userstory",1),_this.rootscope.$broadcast("object:updated"),_this.loadIssue()}}(this)),this.scope.$on("comment:new",function(_this){return function(){return _this.loadIssue()}}(this)),this.scope.$on("custom-attributes-values:edit",function(_this){return function(){return _this.rootscope.$broadcast("object:updated")}}(this))},IssueDetailController.prototype.initializeOnDeleteGoToUrl=function(){var ctx;return ctx={project:this.scope.project.slug},this.scope.project.is_issues_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-issues",ctx):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",ctx)},IssueDetailController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.statusList=project.issue_statuses,_this.scope.statusById=groupBy(project.issue_statuses,function(x){return x.id}),_this.scope.typeById=groupBy(project.issue_types,function(x){return x.id}),_this.scope.typeList=_.sortBy(project.issue_types,"order"),_this.scope.severityList=project.severities,_this.scope.severityById=groupBy(project.severities,function(x){return x.id}),_this.scope.priorityList=project.priorities,_this.scope.priorityById=groupBy(project.priorities,function(x){return x.id}),project}}(this))},IssueDetailController.prototype.loadIssue=function(){return this.rs.issues.getByRef(this.scope.projectId,this.params.issueref).then(function(_this){return function(issue){var ctx,ref,ref1;return _this.scope.issue=issue,_this.scope.issueId=issue.id,_this.scope.commentModel=issue,null!=(null!=(ref=_this.scope.issue.neighbors.previous)?ref.ref:void 0)&&(ctx={project:_this.scope.project.slug,ref:_this.scope.issue.neighbors.previous.ref},_this.scope.previousUrl=_this.navUrls.resolve("project-issues-detail",ctx)),null!=(null!=(ref1=_this.scope.issue.neighbors.next)?ref1.ref:void 0)?(ctx={project:_this.scope.project.slug,ref:_this.scope.issue.neighbors.next.ref},_this.scope.nextUrl=_this.navUrls.resolve("project-issues-detail",ctx)):void 0}}(this))},IssueDetailController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.loadIssue()}}(this))},IssueDetailController.prototype.onUpvote=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadIssue(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.issues.upvote(this.scope.issueId).then(onSuccess,onError)},IssueDetailController.prototype.onDownvote=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadIssue(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.issues.downvote(this.scope.issueId).then(onSuccess,onError)},IssueDetailController.prototype.onWatch=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadIssue(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.issues.watch(this.scope.issueId).then(onSuccess,onError)},IssueDetailController.prototype.onUnwatch=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadIssue(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.issues.unwatch(this.scope.issueId).then(onSuccess,onError)},IssueDetailController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("IssueDetailController",IssueDetailController),IssueStatusDisplayDirective=function($template,$compile){var link,template;return template=$template.get("common/components/status-display.html",!0),link=function($scope,$el,$attrs){var render;return render=function(issue){var html,status;return status=$scope.statusById[issue.status],html=template({is_closed:status.is_closed,status:status}),html=$compile(html)($scope),$el.html(html)},$scope.$watch($attrs.ngModel,function(issue){return null!=issue?render(issue):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgIssueStatusDisplay",["$tgTemplate","$compile",IssueStatusDisplayDirective]),IssueStatusButtonDirective=function($rootScope,$repo,$confirm,$loading,$qqueue,$template,$compile){var link,template;return template=$template.get("issue/issues-status-button.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,render,save;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_issue")},render=function(_this){return function(issue){var html,status;return status=$scope.statusById[issue.status],html=template({status:status,statuses:$scope.statusList,editable:isEditable()}),html=$compile(html)($scope),$el.html(html)}}(this),save=$qqueue.bindAdd(function(_this){return function(statusId){var currentLoading,issue,onError,onSuccess;return $.fn.popover().closeAll(),issue=$model.$modelValue.clone(),issue.status=statusId,currentLoading=$loading().target($el).start(),onSuccess=function(){return $model.$setViewValue(issue),$rootScope.$broadcast("object:updated"),currentLoading.finish()},onError=function(){return $confirm.notify("error"),issue.revert(),$model.$setViewValue(issue),currentLoading.finish()},$repo.save(issue).then(onSuccess,onError)}}(this)),$el.on("click",".js-edit-status",function(event){return event.preventDefault(),event.stopPropagation(),isEditable()?$el.find(".pop-status").popover().open():void 0}),$el.on("click",".status",function(event){var target;return event.preventDefault(),event.stopPropagation(),isEditable()?(target=angular.element(event.currentTarget),save(target.data("status-id"))):void 0}),$scope.$watch($attrs.ngModel,function(issue){return issue?render(issue):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgIssueStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate","$compile",IssueStatusButtonDirective]),IssueTypeButtonDirective=function($rootScope,$repo,$confirm,$loading,$qqueue,$template,$compile){var link,template;return template=$template.get("issue/issue-type-button.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,render,save;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_issue")},render=function(_this){return function(issue){var html,type;return type=$scope.typeById[issue.type],html=template({type:type,typees:$scope.typeList,editable:isEditable()}),html=$compile(html)($scope),$el.html(html)}}(this),save=$qqueue.bindAdd(function(_this){return function(type){var currentLoading,issue,onError,onSuccess;return $.fn.popover().closeAll(),issue=$model.$modelValue.clone(),issue.type=type,currentLoading=$loading().target($el.find(".level-name")).start(),onSuccess=function(){return $model.$setViewValue(issue),$rootScope.$broadcast("object:updated"),currentLoading.finish()},onError=function(){return $confirm.notify("error"),issue.revert(),$model.$setViewValue(issue),currentLoading.finish()},$repo.save(issue).then(onSuccess,onError)}}(this)),$el.on("click",".type-data",function(event){return event.preventDefault(),event.stopPropagation(),isEditable()?$el.find(".pop-type").popover().open():void 0}),$el.on("click",".type",function(event){var target,type;return event.preventDefault(),event.stopPropagation(),isEditable()?(target=angular.element(event.currentTarget),type=target.data("type-id"),save(type)):void 0}),$scope.$watch($attrs.ngModel,function(issue){return issue?render(issue):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgIssueTypeButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate","$compile",IssueTypeButtonDirective]),IssueSeverityButtonDirective=function($rootScope,$repo,$confirm,$loading,$qqueue,$template,$compile){var link,template;return template=$template.get("issue/issue-severity-button.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,render,save;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_issue")},render=function(_this){return function(issue){var html,severity;return severity=$scope.severityById[issue.severity],html=template({severity:severity,severityes:$scope.severityList,editable:isEditable()}),html=$compile(html)($scope),$el.html(html)}}(this),save=$qqueue.bindAdd(function(_this){return function(severity){var currentLoading,issue,onError,onSuccess;return $.fn.popover().closeAll(),issue=$model.$modelValue.clone(),issue.severity=severity,currentLoading=$loading().target($el.find(".level-name")).start(),onSuccess=function(){return $model.$setViewValue(issue),$rootScope.$broadcast("object:updated"),currentLoading.finish()},onError=function(){return $confirm.notify("error"),issue.revert(),$model.$setViewValue(issue),currentLoading.finish()},$repo.save(issue).then(onSuccess,onError)}}(this)),$el.on("click",".severity-data",function(event){return event.preventDefault(),event.stopPropagation(),isEditable()?$el.find(".pop-severity").popover().open():void 0}),$el.on("click",".severity",function(event){var severity,target;return event.preventDefault(),event.stopPropagation(),isEditable()?(target=angular.element(event.currentTarget),severity=target.data("severity-id"),save(severity)):void 0}),$scope.$watch($attrs.ngModel,function(issue){return issue?render(issue):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgIssueSeverityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate","$compile",IssueSeverityButtonDirective]),IssuePriorityButtonDirective=function($rootScope,$repo,$confirm,$loading,$qqueue,$template,$compile){var link,template;return template=$template.get("issue/issue-priority-button.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,render,save;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_issue")},render=function(_this){return function(issue){var html,priority;return priority=$scope.priorityById[issue.priority],html=template({priority:priority,priorityes:$scope.priorityList,editable:isEditable()}),html=$compile(html)($scope),$el.html(html)}}(this),save=$qqueue.bindAdd(function(_this){return function(priority){var currentLoading,issue,onError,onSuccess;return $.fn.popover().closeAll(),issue=$model.$modelValue.clone(),issue.priority=priority,currentLoading=$loading().target($el.find(".level-name")).start(),onSuccess=function(){return $model.$setViewValue(issue),$rootScope.$broadcast("object:updated"),currentLoading.finish()},onError=function(){return $confirm.notify("error"),issue.revert(),$model.$setViewValue(issue),currentLoading.finish()},$repo.save(issue).then(onSuccess,onError)}}(this)),$el.on("click",".priority-data",function(event){return event.preventDefault(),event.stopPropagation(),isEditable()?$el.find(".pop-priority").popover().open():void 0}),$el.on("click",".priority",function(event){var priority,target;return event.preventDefault(),event.stopPropagation(),isEditable()?(target=angular.element(event.currentTarget),priority=target.data("priority-id"),save(priority)):void 0}),$scope.$watch($attrs.ngModel,function(issue){return issue?render(issue):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgIssuePriorityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate","$compile",IssuePriorityButtonDirective]),PromoteIssueToUsButtonDirective=function($rootScope,$repo,$confirm,$qqueue,$translate){var link;return link=function($scope,$el,$attrs,$model){var save;return save=$qqueue.bindAdd(function(_this){return function(issue,askResponse){var data,onError,onSuccess;return data={generated_from_issue:issue.id,project:issue.project,subject:issue.subject,description:issue.description,tags:issue.tags,is_blocked:issue.is_blocked,blocked_note:issue.blocked_note},onSuccess=function(){return askResponse.finish(),$confirm.notify("success"),$rootScope.$broadcast("promote-issue-to-us:success")},onError=function(){return askResponse.finish(),$confirm.notify("error")},$repo.create("userstories",data).then(onSuccess,onError)}}(this)),$el.on("click","a",function(event){var issue,message,subtitle,title;return event.preventDefault(),issue=$model.$modelValue,title=$translate.instant("ISSUES.CONFIRM_PROMOTE.TITLE"),message=$translate.instant("ISSUES.CONFIRM_PROMOTE.MESSAGE"),subtitle=issue.subject,$confirm.ask(title,subtitle,message).then(function(_this){return function(response){return save(issue,response)}}(this))}),$scope.$on("$destroy",function(){return $el.off()})},{restrict:"AE",require:"ngModel",templateUrl:"issue/promote-issue-to-us-button.html",link:link}},module.directive("tgPromoteIssueToUsButton",["$rootScope","$tgRepo","$tgConfirm","$tgQqueue","$translate",PromoteIssueToUsButtonDirective])}.call(this),function(){var CreateBulkIssuesDirective,CreateIssueDirective,bindOnce,debounce,module,taiga;taiga=this.taiga,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaIssues"),CreateIssueDirective=function($repo,$confirm,$rootscope,lightboxService,$loading,$q,attachmentsService){var link;return link=function($scope,$el,$attrs){var attachmentsToAdd,createAttachments,form,resetAttachments,submit,submitButton;return form=$el.find("form").checksley(),$scope.issue={},$scope.attachments=Immutable.List(),$scope.$on("issueform:new",function(ctx,project){var attachmentsToAdd;return attachmentsToAdd=Immutable.List(),$el.find(".tag-input").val(""),lightboxService.open($el),$scope.issue={project:project.id,subject:"",status:project.default_issue_status,type:project.default_issue_type,priority:project.default_priority,severity:project.default_severity,tags:[]}}),$scope.$on("$destroy",function(){return $el.off()}),createAttachments=function(obj){var promises;return promises=_.map(attachmentsToAdd.toJS(),function(attachment){return attachmentsService.upload(attachment.file,obj.id,$scope.issue.project,"issue")}),$q.all(promises)},attachmentsToAdd=Immutable.List(),resetAttachments=function(){return attachmentsToAdd=Immutable.List()},$scope.addAttachment=function(attachment){return attachmentsToAdd=attachmentsToAdd.push(attachment)},submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.create("issues",$scope.issue),promise.then(function(data){return createAttachments(data)}),promise.then(function(data){return currentLoading.finish(),$rootscope.$broadcast("issueform:new:success",data),lightboxService.close($el),$confirm.notify("success")}),promise.then(null,function(){return currentLoading.finish(),$confirm.notify("error")})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit)},{link:link}},module.directive("tgLbCreateIssue",["$tgRepo","$tgConfirm","$rootScope","lightboxService","$tgLoading","$q","tgAttachmentsService",CreateIssueDirective]),CreateBulkIssuesDirective=function($repo,$rs,$confirm,$rootscope,$loading,lightboxService){var link;return link=function($scope,$el,attrs){var submit,submitButton;return $scope.$on("issueform:bulk",function(ctx,projectId,status){return lightboxService.open($el),$scope["new"]={projectId:projectId,bulk:""}}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,data,form,projectId,promise;return event.preventDefault(),form=$el.find("form").checksley(),form.validate()?(currentLoading=$loading().target(submitButton).start(),data=$scope["new"].bulk,projectId=$scope["new"].projectId,promise=$rs.issues.bulkCreate(projectId,data),promise.then(function(result){return currentLoading.finish(),$rootscope.$broadcast("issueform:new:success",result),lightboxService.close($el),$confirm.notify("success")}),promise.then(null,function(){return currentLoading.finish(),$confirm.notify("error")})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgLbCreateBulkIssues",["$tgRepo","$tgResources","$tgConfirm","$rootScope","$tgLoading","lightboxService",CreateBulkIssuesDirective])}.call(this),function(){var IssueAssignedToInlineEditionDirective,IssueStatusInlineEditionDirective,IssuesController,IssuesDirective,IssuesFiltersDirective,bindOnce,debounceLeading,groupBy,joinStr,mixOf,module,startswith,taiga,toString,trim,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,trim=this.taiga.trim,
toString=this.taiga.toString,joinStr=this.taiga.joinStr,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,debounceLeading=this.taiga.debounceLeading,startswith=this.taiga.startswith,module=angular.module("taigaIssues"),IssuesController=function(superClass){function IssuesController(scope,rootscope,repo,confirm,rs,urls,params,q,location,appMetaService,navUrls,events,analytics,translate){var filters,promise;return this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.urls=urls,this.params=params,this.q=q,this.location=location,this.appMetaService=appMetaService,this.navUrls=navUrls,this.events=events,this.analytics=analytics,this.translate=translate,this.loadIssues=bind(this.loadIssues,this),this.scope.sectionName="Issues",this.scope.filters={},_.isEmpty(this.location.search())?(filters=this.rs.issues.getFilters(this.params.pslug),filters.page=1,this.location.search(filters),void this.location.replace()):(promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("ISSUES.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.translate.instant("ISSUES.PAGE_DESCRIPTION",{projectName:_this.scope.project.name,projectDescription:_this.scope.project.description}),_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this)),void this.scope.$on("issueform:new:success",function(_this){return function(){return _this.analytics.trackEvent("issue","create","create issue on issues list",1),_this.loadIssues()}}(this)))}return extend(IssuesController,superClass),IssuesController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgUrls","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate"],IssuesController.prototype.initializeSubscription=function(){var routingKey;return routingKey="changes.project."+this.scope.projectId+".issues",this.events.subscribe(this.scope,routingKey,function(_this){return function(message){return _this.loadIssues()}}(this))},IssuesController.prototype.storeFilters=function(){return this.rs.issues.storeFilters(this.params.pslug,this.location.search())},IssuesController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.is_issues_activated||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.issueStatusById=groupBy(project.issue_statuses,function(x){return x.id}),_this.scope.issueStatusList=_.sortBy(project.issue_statuses,"order"),_this.scope.severityById=groupBy(project.severities,function(x){return x.id}),_this.scope.severityList=_.sortBy(project.severities,"order"),_this.scope.priorityById=groupBy(project.priorities,function(x){return x.id}),_this.scope.priorityList=_.sortBy(project.priorities,"order"),_this.scope.issueTypes=_.sortBy(project.issue_types,"order"),_this.scope.issueTypeById=groupBy(project.issue_types,function(x){return x.id}),project}}(this))},IssuesController.prototype.getUrlFilters=function(){var filters;return filters=_.pick(this.location.search(),"page","tags","status","types","q","severities","priorities","assignedTo","createdBy","orderBy"),filters.page||(filters.page=1),filters},IssuesController.prototype.getUrlFilter=function(name){var filters;return filters=_.pick(this.location.search(),name),filters[name]},IssuesController.prototype.loadMyFilters=function(){return this.rs.issues.getMyFilters(this.scope.projectId).then(function(_this){return function(filters){return _.map(filters,function(value,key){return{id:key,name:key,type:"myFilters",selected:!1}})}}(this))},IssuesController.prototype.removeNotExistingFiltersFromUrl=function(){var currentSearch,existingValues,filterName,filterValue,splittedValues,urlfilters;currentSearch=this.location.search(),urlfilters=this.getUrlFilters();for(filterName in urlfilters)filterValue=urlfilters[filterName],"page"!==filterName&&"orderBy"!==filterName&&"q"!==filterName&&(splittedValues="tags"===filterName?_.map((""+filterValue).split(",")):_.map((""+filterValue).split(","),function(x){return"null"===x?null:parseInt(x)}),existingValues=_.intersection(splittedValues,_.map(this.scope.filters[filterName],"id")),splittedValues.length!==existingValues.length&&this.location.search(filterName,existingValues.join()));return currentSearch!==this.location.search()?this.location.replace():void 0},IssuesController.prototype.markSelectedFilters=function(filters,urlfilters){var isSelected,j,key,len,name,obj,ref,ref1,results,searchdata,val,value;searchdata={},ref=_.omit(urlfilters,"page","orderBy");for(name in ref)for(value=ref[name],null==searchdata[name]&&(searchdata[name]={}),ref1=(""+value).split(","),j=0,len=ref1.length;len>j;j++)val=ref1[j],searchdata[name][val]=!0;isSelected=function(type,id){return null!=searchdata[type]&&searchdata[type][id]?!0:!1},results=[];for(key in filters)value=filters[key],results.push(function(){var k,len1,results1;for(results1=[],k=0,len1=value.length;len1>k;k++)obj=value[k],results1.push(obj.selected=isSelected(obj.type,obj.id)?!0:void 0);return results1}());return results},IssuesController.prototype.loadFilters=function(){var loadFilters,promise,urlfilters;return urlfilters=this.getUrlFilters(),urlfilters.q&&(this.scope.filtersQ=urlfilters.q),promise=this.loadMyFilters().then(function(_this){return function(myFilters){return _this.scope.filters.myFilters=myFilters,myFilters}}(this)),loadFilters={},loadFilters.project=this.scope.projectId,loadFilters.tags=urlfilters.tags,loadFilters.status=urlfilters.status,loadFilters.q=urlfilters.q,loadFilters.types=urlfilters.types,loadFilters.severities=urlfilters.severities,loadFilters.priorities=urlfilters.priorities,loadFilters.assigned_to=urlfilters.assignedTo,loadFilters.owner=urlfilters.createdBy,promise=promise.then(function(_this){return function(){return _this.rs.issues.filtersData(loadFilters)}}(this)),promise.then(function(_this){return function(data){var choicesFiltersFormat,tagsFilterFormat,usersFiltersFormat;return usersFiltersFormat=function(users,type,unknownOption){var reformatedUsers,unknownItem;return reformatedUsers=_.map(users,function(t){return t.type=type,t.name=t.full_name?t.full_name:unknownOption,t}),unknownItem=_.remove(reformatedUsers,function(u){return!u.id}),reformatedUsers=_.sortBy(reformatedUsers,function(u){return u.name.toUpperCase()}),unknownItem.length>0&&reformatedUsers.unshift(unknownItem[0]),reformatedUsers},choicesFiltersFormat=function(choices,type,byIdObject){return _.map(choices,function(t){return t.type=type,t})},tagsFilterFormat=function(tags){return _.map(tags,function(t){return t.id=t.name,t.type="tags",t})},_this.scope.filters.status=choicesFiltersFormat(data.statuses,"status",_this.scope.issueStatusById),_this.scope.filters.severities=choicesFiltersFormat(data.severities,"severities",_this.scope.severityById),_this.scope.filters.priorities=choicesFiltersFormat(data.priorities,"priorities",_this.scope.priorityById),_this.scope.filters.assignedTo=usersFiltersFormat(data.assigned_to,"assignedTo","Unassigned"),_this.scope.filters.createdBy=usersFiltersFormat(data.owners,"createdBy","Unknown"),_this.scope.filters.types=choicesFiltersFormat(data.types,"types",_this.scope.issueTypeById),_this.scope.filters.tags=tagsFilterFormat(data.tags),_this.removeNotExistingFiltersFromUrl(),_this.markSelectedFilters(_this.scope.filters,urlfilters),_this.rootscope.$broadcast("filters:loaded",_this.scope.filters)}}(this))},IssuesController.prototype.loadIssuesRequests=0,IssuesController.prototype.loadIssues=function(){var name,promise,ref,values;this.scope.urlFilters=this.getUrlFilters(),this.scope.httpParams={},ref=this.scope.urlFilters;for(name in ref)values=ref[name],"severities"===name?name="severity":"orderBy"===name?name="order_by":"priorities"===name?name="priority":"assignedTo"===name?name="assigned_to":"createdBy"===name?name="owner":"status"===name?name="status":"types"===name&&(name="type"),this.scope.httpParams[name]=values;return promise=this.rs.issues.list(this.scope.projectId,this.scope.httpParams),this.loadIssuesRequests+=1,promise.index=this.loadIssuesRequests,promise.then(function(_this){return function(data){return promise.index===_this.loadIssuesRequests&&(_this.scope.issues=data.models,_this.scope.page=data.current,_this.scope.count=data.count,_this.scope.paginatedBy=data.paginatedBy),data}}(this)),promise},IssuesController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.initializeSubscription(),_this.loadFilters(),_this.loadIssues()}}(this))},IssuesController.prototype.saveCurrentFiltersTo=function(newFilter){var deferred;return deferred=this.q.defer(),this.rs.issues.getMyFilters(this.scope.projectId).then(function(_this){return function(filters){return filters[newFilter]=_this.location.search(),_this.rs.issues.storeMyFilters(_this.scope.projectId,filters).then(function(){return deferred.resolve()})}}(this)),deferred.promise},IssuesController.prototype.deleteMyFilter=function(filter){var deferred;return deferred=this.q.defer(),this.rs.issues.getMyFilters(this.scope.projectId).then(function(_this){return function(filters){return delete filters[filter],_this.rs.issues.storeMyFilters(_this.scope.projectId,filters).then(function(){return deferred.resolve()})}}(this)),deferred.promise},IssuesController.prototype.addNewIssue=function(){return this.rootscope.$broadcast("issueform:new",this.scope.project)},IssuesController.prototype.addIssuesInBulk=function(){return this.rootscope.$broadcast("issueform:bulk",this.scope.projectId)},IssuesController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("IssuesController",IssuesController),IssuesDirective=function($log,$location,$template,$compile){var link,linkOrdering,linkPagination,template;return template=$template.get("issue/issue-paginator.html",!0),linkPagination=function($scope,$el,$attrs,$ctrl){var $pagEl,afterCurrent,atBegin,atEnd,beforeCurrent,getNumPages,renderPagination;return afterCurrent=2,beforeCurrent=4,atBegin=2,atEnd=2,$pagEl=$el.find(".issues-paginator"),getNumPages=function(){var numPages;return numPages=$scope.count/$scope.paginatedBy,numPages=parseInt(numPages,10)<numPages?parseInt(numPages,10)+1:parseInt(numPages,10)},renderPagination=function(){var cpage,html,i,j,numPages,options,pages,ref;if(numPages=getNumPages(),1>=numPages)return void $pagEl.hide();for($pagEl.show(),pages=[],options={},options.pages=pages,options.showPrevious=$scope.page>1,options.showNext=!($scope.page===numPages),cpage=$scope.page,i=j=1,ref=numPages;ref>=1?ref>=j:j>=ref;i=ref>=1?++j:--j)i===cpage+afterCurrent&&numPages>cpage+afterCurrent+atEnd?pages.push({classes:"dots",type:"dots"}):i===cpage-beforeCurrent&&cpage>atBegin+beforeCurrent?pages.push({classes:"dots",type:"dots"}):i>cpage+afterCurrent&&numPages-atEnd>=i||cpage-beforeCurrent>i&&i>atBegin||(i===cpage?pages.push({classes:"active",num:i,type:"page-active"}):pages.push({classes:"page",num:i,type:"page"}));return html=template(options),html=$compile(html)($scope),$pagEl.html(html)},$scope.$watch("issues",function(value){return value?renderPagination():void 0}),$el.on("click",".issues-paginator a.next",function(event){return event.preventDefault(),$scope.$apply(function(){return $ctrl.selectFilter("page",$scope.page+1),$ctrl.loadIssues()})}),$el.on("click",".issues-paginator a.previous",function(event){return event.preventDefault(),$scope.$apply(function(){return $ctrl.selectFilter("page",$scope.page-1),$ctrl.loadIssues()})}),$el.on("click",".issues-paginator li.page > a",function(event){var pagenum,target;return event.preventDefault(),target=angular.element(event.currentTarget),pagenum=target.data("pagenum"),$scope.$apply(function(){return $ctrl.selectFilter("page",pagenum),$ctrl.loadIssues()})})},linkOrdering=function($scope,$el,$attrs,$ctrl){var colHeadElement,currentOrder,icon;return currentOrder=$ctrl.getUrlFilter("orderBy")||"created_date",currentOrder&&(icon=startswith(currentOrder,"-")?"icon-arrow-up":"icon-arrow-bottom",colHeadElement=$el.find(".row.title > div[data-fieldname='"+trim(currentOrder,"-")+"']"),colHeadElement.html(colHeadElement.html()+"<span class='icon "+icon+"'></span>")),$el.on("click",".row.title > div",function(event){var finalOrder,newOrder,target;return target=angular.element(event.currentTarget),currentOrder=$ctrl.getUrlFilter("orderBy"),newOrder=target.data("fieldname"),finalOrder=currentOrder===newOrder?"-"+newOrder:newOrder,$scope.$apply(function(){return $ctrl.replaceFilter("orderBy",finalOrder),$ctrl.storeFilters(),$ctrl.loadIssues().then(function(){return $el.find(".row.title > div > span.icon").remove(),icon=startswith(finalOrder,"-")?"icon-arrow-up":"icon-arrow-bottom",target.html(target.html()+"<span class='icon "+icon+"'></span>")})})})},link=function($scope,$el,$attrs){var $ctrl;return $ctrl=$el.controller(),linkOrdering($scope,$el,$attrs,$ctrl),linkPagination($scope,$el,$attrs,$ctrl),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgIssues",["$log","$tgLocation","$tgTemplate","$compile",IssuesDirective]),IssuesFiltersDirective=function($q,$log,$location,$rs,$confirm,$loading,$template,$translate,$compile,$auth){var link,template,templateSelected;return template=$template.get("issue/issues-filters.html",!0),templateSelected=$template.get("issue/issues-filters-selected.html",!0),link=function($scope,$el,$attrs){var $ctrl,getFiltersType,initializeSelectedFilters,reloadIssues,renderFilters,renderSelectedFilters,selectQFilter,selectedFilters,showCategories,showFilters,toggleFilterSelection,unwatchIssues;return $ctrl=$el.closest(".wrapper").controller(),selectedFilters=[],showFilters=function(title,type){return $el.find(".filters-cats").hide(),$el.find(".filter-list").removeClass("hidden"),$el.find("h2.breadcrumb").removeClass("hidden"),$el.find("h2 a.subfilter span.title").html(title),$el.find("h2 a.subfilter span.title").prop("data-type",type)},showCategories=function(){return $el.find(".filters-cats").show(),$el.find(".filter-list").addClass("hidden"),$el.find("h2.breadcrumb").addClass("hidden")},initializeSelectedFilters=function(filters){var j,len,name,val,values;selectedFilters=[];for(name in filters)for(values=filters[name],j=0,len=values.length;len>j;j++)val=values[j],val.selected&&selectedFilters.push(val);return renderSelectedFilters(selectedFilters)},renderSelectedFilters=function(selectedFilters){var html;return _.filter(selectedFilters,function(_this){return function(f){return f.color?f.style="border-left: 3px solid "+f.color:void 0}}(this)),html=templateSelected({filters:selectedFilters}),html=$compile(html)($scope),$el.find(".filters-applied").html(html),$auth.isAuthenticated()&&selectedFilters.length>0?$el.find(".save-filters").show():$el.find(".save-filters").hide()},renderFilters=function(filters){var html;return _.filter(filters,function(_this){return function(f){return f.color?f.style="border-left: 3px solid "+f.color:void 0}}(this)),html=template({filters:filters}),html=$compile(html)($scope),$el.find(".filter-list").html(html)},getFiltersType=function(){return $el.find("h2 a.subfilter span.title").prop("data-type")},reloadIssues=function(){var currentFiltersType;return currentFiltersType=getFiltersType(),$q.all([$ctrl.loadIssues(),$ctrl.loadFilters()]).then(function(){var filters;return filters=$scope.filters[currentFiltersType],renderFilters(_.reject(filters,"selected"))})},toggleFilterSelection=function(type,id){var currentFiltersType,filter,filterId,filters;return"myFilters"===type?($rs.issues.getMyFilters($scope.projectId).then(function(data){var filters,myFilters;return myFilters=data,filters=myFilters[id],filters.page=1,$ctrl.replaceAllFilters(filters),$ctrl.storeFilters(),$ctrl.loadIssues(),$ctrl.markSelectedFilters($scope.filters,filters),initializeSelectedFilters($scope.filters)}),null):(filters=$scope.filters[type],filterId="tags"===type?taiga.toString(id):id,filter=_.find(filters,{id:filterId}),filter.selected=!filter.selected,null===id&&(id="null"),filter.selected?(selectedFilters.push(filter),$ctrl.selectFilter(type,id),$ctrl.selectFilter("page",1),$ctrl.storeFilters()):(selectedFilters=_.reject(selectedFilters,function(f){return f.id===filter.id&&f.type===filter.type}),$ctrl.unselectFilter(type,id),$ctrl.selectFilter("page",1),$ctrl.storeFilters()),reloadIssues(),renderSelectedFilters(selectedFilters),currentFiltersType=getFiltersType(),type===currentFiltersType?renderFilters(_.reject(filters,"selected")):void 0)},$scope.$on("filters:loaded",function(ctx,filters){return initializeSelectedFilters(filters)}),$scope.$on("filters:issueupdate",function(ctx,filters){var html;return html=template({filters:filters.status}),html=$compile(html)($scope),$el.find(".filter-list").html(html)}),selectQFilter=debounceLeading(100,function(value,oldValue){return void 0!==value&&value!==oldValue?($ctrl.replaceFilter("page",null,!0),0===value.length?($ctrl.replaceFilter("q",null),$ctrl.storeFilters()):($ctrl.replaceFilter("q",value),$ctrl.storeFilters()),reloadIssues()):void 0}),unwatchIssues=$scope.$watch("issues",function(newValue){return _.isUndefined(newValue)?void 0:($scope.$watch("filtersQ",selectQFilter),unwatchIssues())}),$el.on("click",".filters-cats > ul > li > a",function(event){var tags,target;return event.preventDefault(),target=angular.element(event.currentTarget),tags=$scope.filters[target.data("type")],renderFilters(_.reject(tags,"selected")),showFilters(target.attr("title"),target.data("type"))}),$el.on("click",".filters-inner > .filters-step-cat > .breadcrumb > .back",function(event){return event.preventDefault(),showCategories($el)}),$el.on("click",".filters-applied a",function(event){var id,target,type;return event.preventDefault(),target=angular.element(event.currentTarget),id=target.data("id")||null,type=target.data("type"),toggleFilterSelection(type,id)}),$el.on("click",".filter-list .single-filter",function(event){var id,target,type;return event.preventDefault(),target=angular.element(event.currentTarget),target.toggleClass("active"),id=target.data("id")||null,type=target.data("type"),"myFilters"===type&&target.removeClass("active"),toggleFilterSelection(type,id)}),$el.on("click",".filter-list .single-filter .icon-delete",function(event){var customFilterName,message,target,title;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),customFilterName=target.parent().data("id"),title=$translate.instant("ISSUES.FILTERS.CONFIRM_DELETE.TITLE"),message=$translate.instant("ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE",{customFilterName:customFilterName}),$confirm.askOnDelete(title,message).then(function(askResponse){var promise;return promise=$ctrl.deleteMyFilter(customFilterName),promise.then(function(){return promise=$ctrl.loadMyFilters(),promise.then(function(filters){return askResponse.finish(),$scope.filters.myFilters=filters,renderFilters($scope.filters.myFilters)}),promise.then(null,function(){return askResponse.finish()})}),promise.then(null,function(){return askResponse.finish(!1),$confirm.notify("error")})})}),$el.on("click",".save-filters",function(event){return event.preventDefault(),renderFilters($scope.filters.myFilters),showFilters("My filters","myFilters"),$el.find(".save-filters").hide(),$el.find(".my-filter-name").removeClass("hidden"),$el.find(".my-filter-name").focus(),$scope.$apply()}),$el.on("keyup",".my-filter-name",function(event){var currentLoading,newFilter,promise,target;return event.preventDefault(),13===event.keyCode?(target=angular.element(event.currentTarget),newFilter=target.val(),currentLoading=$loading().target($el.find(".new")).start(),promise=$ctrl.saveCurrentFiltersTo(newFilter),promise.then(function(){var loadPromise;return loadPromise=$ctrl.loadMyFilters(),loadPromise.then(function(filters){var currentfilterstype;return currentLoading.finish(),$scope.filters.myFilters=filters,currentfilterstype=$el.find("h2 a.subfilter span.title").prop("data-type"),"myFilters"===currentfilterstype&&renderFilters($scope.filters.myFilters),$el.find(".my-filter-name").addClass("hidden"),$el.find(".save-filters").show()}),loadPromise.then(null,function(){return currentLoading.finish(),$confirm.notify("error","Error loading custom filters")})}),promise.then(null,function(){return currentLoading.finish(),$el.find(".my-filter-name").val(newFilter).focus().select(),$confirm.notify("error","Filter not saved")})):27===event.keyCode?($el.find(".my-filter-name").val(""),$el.find(".my-filter-name").addClass("hidden"),$el.find(".save-filters").show()):void 0})},{link:link}},module.directive("tgIssuesFilters",["$q","$log","$tgLocation","$tgResources","$tgConfirm","$tgLoading","$tgTemplate","$translate","$compile","$tgAuth",IssuesFiltersDirective]),IssueStatusInlineEditionDirective=function($repo,$template,$rootscope){var link,selectionTemplate,updateIssueStatus;return selectionTemplate=$template.get("issue/issue-status-inline-edition-selection.html",!0),updateIssueStatus=function($el,issue,issueStatusById){var issueStatusDom,issueStatusDomParent,status;return issueStatusDomParent=$el.find(".issue-status"),issueStatusDom=$el.find(".issue-status .issue-status-bind"),status=issueStatusById[issue.status],status?(issueStatusDom.text(status.name),issueStatusDom.prop("title",status.name),issueStatusDomParent.css("color",status.color)):void 0},link=function($scope,$el,$attrs){var $ctrl,issue;return $ctrl=$el.controller(),issue=$scope.$eval($attrs.tgIssueStatusInlineEdition),$el.on("click",".issue-status",function(event){return event.preventDefault(),event.stopPropagation(),$el.find(".pop-status").popover().open()}),$el.on("click",".status",function(event){var filter,j,len,ref,target;for(event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),ref=$scope.filters.status,j=0,len=ref.length;len>j;j++)filter=ref[j],filter.id===issue.status&&filter.count--;return issue.status=target.data("status-id"),$el.find(".pop-status").popover().close(),updateIssueStatus($el,issue,$scope.issueStatusById),$scope.$apply(function(){var k,len1,ref1;for($repo.save(issue).then(function(){return $ctrl.loadIssues()}),ref1=$scope.filters.status,k=0,len1=ref1.length;len1>k;k++)filter=ref1[k],filter.id===issue.status&&filter.count++;return $rootscope.$broadcast("filters:issueupdate",$scope.filters)})}),taiga.bindOnce($scope,"project",function(project){return $el.append(selectionTemplate({statuses:project.issue_statuses})),updateIssueStatus($el,issue,$scope.issueStatusById),-1===project.my_permissions.indexOf("modify_issue")?($el.unbind("click"),$el.find("a").addClass("not-clickable")):void 0}),$scope.$watch($attrs.tgIssueStatusInlineEdition,function(_this){return function(val){return updateIssueStatus($el,val,$scope.issueStatusById)}}(this)),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgIssueStatusInlineEdition",["$tgRepo","$tgTemplate","$rootScope",IssueStatusInlineEditionDirective]),IssueAssignedToInlineEditionDirective=function($repo,$rootscope,$translate){var link,template;return template=_.template('<img src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>'),link=function($scope,$el,$attrs){var $ctrl,issue,updateIssue;return updateIssue=function(issue){var ctx,member;return ctx={name:$translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},member=$scope.usersById[issue.assigned_to],member&&(ctx.name=member.full_name_display,ctx.imgurl=member.photo),$el.find(".avatar").html(template(ctx)),$el.find(".issue-assignedto").attr("title",ctx.name)},$ctrl=$el.controller(),issue=$scope.$eval($attrs.tgIssueAssignedToInlineEdition),updateIssue(issue),$el.on("click",".issue-assignedto",function(event){return $rootscope.$broadcast("assigned-to:add",issue)}),taiga.bindOnce($scope,"project",function(project){return-1===project.my_permissions.indexOf("modify_issue")?($el.unbind("click"),$el.find("a").addClass("not-clickable")):void 0}),$scope.$on("assigned-to:added",function(_this){return function(ctx,userId,updatedIssue){return updatedIssue.id===issue.id?(updatedIssue.assigned_to=userId,$repo.save(updatedIssue),updateIssue(updatedIssue)):void 0}}(this)),$scope.$watch($attrs.tgIssueAssignedToInlineEdition,function(_this){return function(val){return updateIssue(val)}}(this)),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgIssueAssignedToInlineEdition",["$tgRepo","$rootScope","$translate",IssueAssignedToInlineEditionDirective])}.call(this),function(){var UsClientRequirementButtonDirective,UsStatusButtonDirective,UsStatusDisplayDirective,UsTeamRequirementButtonDirective,UserStoryDetailController,bindMethods,bindOnce,groupBy,mixOf,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,bindMethods=this.taiga.bindMethods,module=angular.module("taigaUserStories"),UserStoryDetailController=function(superClass){function UserStoryDetailController(scope,rootscope,repo,confirm,rs,params,q,location,log,appMetaService,navUrls,analytics,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.log=log,this.appMetaService=appMetaService,this.navUrls=navUrls,this.analytics=analytics,this.translate=translate,bindMethods(this),this.scope.usRef=this.params.usref,this.scope.sectionName=this.translate.instant("US.SECTION_NAME"),this.initializeEventHandlers(),promise=this.loadInitialData(),promise.then(function(_this){return function(){return _this._setMeta(),_this.initializeOnDeleteGoToUrl()}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(UserStoryDetailController,superClass),UserStoryDetailController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate"],UserStoryDetailController.prototype._setMeta=function(){var closedTasks,description,progressPercentage,ref,title,totalTasks;return totalTasks=this.scope.tasks.length,closedTasks=_.filter(this.scope.tasks,function(_this){return function(t){return _this.scope.taskStatusById[t.status].is_closed}}(this)).length,progressPercentage=totalTasks>0?Math.round(100*closedTasks/totalTasks):0,title=this.translate.instant("US.PAGE_TITLE",{userStoryRef:"#"+this.scope.us.ref,userStorySubject:this.scope.us.subject,projectName:this.scope.project.name}),description=this.translate.instant("US.PAGE_DESCRIPTION",{userStoryStatus:(null!=(ref=this.scope.statusById[this.scope.us.status])?ref.name:void 0)||"--",userStoryPoints:this.scope.us.total_points,userStoryDescription:angular.element(this.scope.us.description_html||"").text(),userStoryClosedTasks:closedTasks,userStoryTotalTasks:totalTasks,userStoryProgressPercentage:progressPercentage}),this.appMetaService.setAll(title,description)},UserStoryDetailController.prototype.initializeEventHandlers=function(){return this.scope.$on("related-tasks:update",function(_this){return function(){var allClosed;return _this.scope.tasks=_.clone(_this.scope.tasks,!1),allClosed=_.every(_this.scope.tasks,function(task){return task.is_closed}),_this.scope.us.is_closed!==allClosed?_this.loadUs():void 0}}(this)),this.scope.$on("attachment:create",function(_this){return function(){return _this.analytics.trackEvent("attachment","create","create attachment on userstory",1)}}(this)),this.scope.$on("comment:new",function(_this){return function(){return _this.loadUs()}}(this))},UserStoryDetailController.prototype.initializeOnDeleteGoToUrl=function(){var ctx;return ctx={project:this.scope.project.slug},this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",ctx),this.scope.project.is_backlog_activated?this.scope.us.milestone?(ctx.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",ctx)):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-backlog",ctx):this.scope.project.is_kanban_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-kanban",ctx):void 0},UserStoryDetailController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.statusList=project.us_statuses,_this.scope.statusById=groupBy(project.us_statuses,function(x){return x.id}),_this.scope.taskStatusById=groupBy(project.task_statuses,function(x){return x.id}),_this.scope.pointsList=_.sortBy(project.points,"order"),_this.scope.pointsById=groupBy(_this.scope.pointsList,function(e){return e.id}),project}}(this))},UserStoryDetailController.prototype.loadUs=function(){var httpParams,kanbanStaus,milestone,noMilestone;return httpParams=_.pick(this.location.search(),"milestone","no-milestone","kanban-status"),milestone=httpParams.milestone,milestone&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:milestone,order_by:"sprint_order"}),noMilestone=httpParams["no-milestone"],noMilestone&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:"null",order_by:"backlog_order"}),kanbanStaus=httpParams["kanban-status"],kanbanStaus&&this.rs.userstories.storeQueryParams(this.scope.projectId,{status:kanbanStaus,order_by:"kanban_order"}),this.rs.userstories.getByRef(this.scope.projectId,this.params.usref).then(function(_this){return function(us){var ctx,ref,ref1;return _this.scope.us=us,_this.scope.usId=us.id,_this.scope.commentModel=us,null!=(null!=(ref=_this.scope.us.neighbors.previous)?ref.ref:void 0)&&(ctx={project:_this.scope.project.slug,ref:_this.scope.us.neighbors.previous.ref},_this.scope.previousUrl=_this.navUrls.resolve("project-userstories-detail",ctx)),null!=(null!=(ref1=_this.scope.us.neighbors.next)?ref1.ref:void 0)&&(ctx={project:_this.scope.project.slug,ref:_this.scope.us.neighbors.next.ref},_this.scope.nextUrl=_this.navUrls.resolve("project-userstories-detail",ctx)),us}}(this))},UserStoryDetailController.prototype.loadSprint=function(){return this.scope.us.milestone?this.rs.sprints.get(this.scope.us.project,this.scope.us.milestone).then(function(_this){return function(sprint){return _this.scope.sprint=sprint,sprint}}(this)):void 0},UserStoryDetailController.prototype.loadTasks=function(){return this.rs.tasks.list(this.scope.projectId,null,this.scope.usId).then(function(_this){return function(tasks){return _this.scope.tasks=tasks,tasks}}(this))},UserStoryDetailController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.loadUs().then(function(){return _this.q.all([_this.loadSprint(),_this.loadTasks()])})}}(this))},UserStoryDetailController.prototype.onUpvote=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadUs(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.userstories.upvote(this.scope.usId).then(onSuccess,onError)},UserStoryDetailController.prototype.onDownvote=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){
return _this.loadUs(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.userstories.downvote(this.scope.usId).then(onSuccess,onError)},UserStoryDetailController.prototype.onWatch=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadUs(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.userstories.watch(this.scope.usId).then(onSuccess,onError)},UserStoryDetailController.prototype.onUnwatch=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadUs(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.userstories.unwatch(this.scope.usId).then(onSuccess,onError)},UserStoryDetailController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("UserStoryDetailController",UserStoryDetailController),UsStatusDisplayDirective=function($template,$compile){var link,template;return template=$template.get("common/components/status-display.html",!0),link=function($scope,$el,$attrs){var render;return render=function(us){var html,status;return status=$scope.statusById[us.status],html=template({is_closed:us.is_closed,status:status}),html=$compile(html)($scope),$el.html(html)},$scope.$watch($attrs.ngModel,function(us){return null!=us?render(us):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgUsStatusDisplay",["$tgTemplate","$compile",UsStatusDisplayDirective]),UsStatusButtonDirective=function($rootScope,$repo,$confirm,$loading,$qqueue,$template){var link,template;return template=$template.get("us/us-status-button.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,render,save;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_us")},render=function(_this){return function(us){var html,status;return status=$scope.statusById[us.status],html=template({status:status,statuses:$scope.statusList,editable:isEditable()}),$el.html(html)}}(this),save=$qqueue.bindAdd(function(_this){return function(status){var currentLoading,onError,onSuccess,us;return us=$model.$modelValue.clone(),us.status=status,$.fn.popover().closeAll(),currentLoading=$loading().target($el).start(),onSuccess=function(){return $model.$setViewValue(us),$rootScope.$broadcast("object:updated"),currentLoading.finish()},onError=function(){return $confirm.notify("error"),currentLoading.finish()},$repo.save(us).then(onSuccess,onError)}}(this)),$el.on("click",".js-edit-status",function(event){return event.preventDefault(),event.stopPropagation(),isEditable()?$el.find(".pop-status").popover().open():void 0}),$el.on("click",".status",function(event){var status,target;return event.preventDefault(),event.stopPropagation(),isEditable()?(target=angular.element(event.currentTarget),status=target.data("status-id"),save(status)):void 0}),$scope.$watch($attrs.ngModel,function(us){return us?render(us):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgUsStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate",UsStatusButtonDirective]),UsTeamRequirementButtonDirective=function($rootscope,$tgrepo,$confirm,$loading,$qqueue,$template,$compile){var link,template;return template=$template.get("us/us-team-requirement-button.html",!0),link=function($scope,$el,$attrs,$model){var canEdit,render,save;return canEdit=function(){return-1!==$scope.project.my_permissions.indexOf("modify_us")},render=function(us){var ctx,html;return ctx={canEdit:canEdit(),isRequired:us.team_requirement},html=template(ctx),html=$compile(html)($scope),$el.html(html)},save=$qqueue.bindAdd(function(_this){return function(team_requirement){var currentLoading,promise,us;return us=$model.$modelValue.clone(),us.team_requirement=team_requirement,currentLoading=$loading().target($el.find("label")).start(),promise=$tgrepo.save(us),promise.then(function(){return $model.$setViewValue(us),currentLoading.finish(),$rootscope.$broadcast("object:updated")}),promise.then(null,function(){return currentLoading.finish(),$confirm.notify("error")})}}(this)),$el.on("click",".team-requirement",function(event){var team_requirement;if(canEdit())return team_requirement=!$model.$modelValue.team_requirement,save(team_requirement)}),$scope.$watch($attrs.ngModel,function(us){return us?render(us):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgUsTeamRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate","$compile",UsTeamRequirementButtonDirective]),UsClientRequirementButtonDirective=function($rootscope,$tgrepo,$confirm,$loading,$qqueue,$template,$compile){var link,template;return template=$template.get("us/us-client-requirement-button.html",!0),link=function($scope,$el,$attrs,$model){var canEdit,render,save;return canEdit=function(){return-1!==$scope.project.my_permissions.indexOf("modify_us")},render=function(us){var ctx,html;return ctx={canEdit:canEdit(),isRequired:us.client_requirement},html=$compile(template(ctx))($scope),$el.html(html)},save=$qqueue.bindAdd(function(_this){return function(client_requirement){var currentLoading,promise,us;return us=$model.$modelValue.clone(),us.client_requirement=client_requirement,currentLoading=$loading().target($el.find("label")).start(),promise=$tgrepo.save(us),promise.then(function(){return $model.$setViewValue(us),currentLoading.finish(),$rootscope.$broadcast("object:updated")}),promise.then(null,function(){return $confirm.notify("error")})}}(this)),$el.on("click",".client-requirement",function(event){var client_requirement;if(canEdit())return client_requirement=!$model.$modelValue.client_requirement,save(client_requirement)}),$scope.$watch($attrs.ngModel,function(us){return us?render(us):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgUsClientRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$tgTemplate","$compile",UsClientRequirementButtonDirective])}.call(this),function(){var TaskDetailController,TaskIsIocaineButtonDirective,TaskStatusButtonDirective,TaskStatusDisplayDirective,bindMethods,groupBy,mixOf,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,groupBy=this.taiga.groupBy,bindMethods=this.taiga.bindMethods,module=angular.module("taigaTasks"),TaskDetailController=function(superClass){function TaskDetailController(scope,rootscope,repo,confirm,rs,params,q,location,log,appMetaService,navUrls,analytics,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.log=log,this.appMetaService=appMetaService,this.navUrls=navUrls,this.analytics=analytics,this.translate=translate,bindMethods(this),this.scope.taskRef=this.params.taskref,this.scope.sectionName=this.translate.instant("TASK.SECTION_NAME"),this.initializeEventHandlers(),promise=this.loadInitialData(),promise.then(function(_this){return function(){return _this._setMeta(),_this.initializeOnDeleteGoToUrl()}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(TaskDetailController,superClass),TaskDetailController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate"],TaskDetailController.prototype._setMeta=function(){var description,ref,title;return title=this.translate.instant("TASK.PAGE_TITLE",{taskRef:"#"+this.scope.task.ref,taskSubject:this.scope.task.subject,projectName:this.scope.project.name}),description=this.translate.instant("TASK.PAGE_DESCRIPTION",{taskStatus:(null!=(ref=this.scope.statusById[this.scope.task.status])?ref.name:void 0)||"--",taskDescription:angular.element(this.scope.task.description_html||"").text()}),this.appMetaService.setAll(title,description)},TaskDetailController.prototype.initializeEventHandlers=function(){return this.scope.$on("attachment:create",function(_this){return function(){return _this.analytics.trackEvent("attachment","create","create attachment on task",1)}}(this)),this.scope.$on("custom-attributes-values:edit",function(_this){return function(){return _this.rootscope.$broadcast("object:updated")}}(this)),this.scope.$on("comment:new",function(_this){return function(){return _this.loadTask()}}(this))},TaskDetailController.prototype.initializeOnDeleteGoToUrl=function(){var ctx;if(ctx={project:this.scope.project.slug},this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",ctx),this.scope.project.is_backlog_activated){if(this.scope.task.milestone)return ctx.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",ctx);if(this.scope.task.us)return ctx.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",ctx)}else if(this.scope.project.is_kanban_activated&&this.scope.us)return ctx.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",ctx)},TaskDetailController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.statusList=project.task_statuses,_this.scope.statusById=groupBy(project.task_statuses,function(x){return x.id}),project}}(this))},TaskDetailController.prototype.loadTask=function(){return this.rs.tasks.getByRef(this.scope.projectId,this.params.taskref).then(function(_this){return function(task){var ctx,ref,ref1;return _this.scope.task=task,_this.scope.taskId=task.id,_this.scope.commentModel=task,null!=(null!=(ref=_this.scope.task.neighbors.previous)?ref.ref:void 0)&&(ctx={project:_this.scope.project.slug,ref:_this.scope.task.neighbors.previous.ref},_this.scope.previousUrl=_this.navUrls.resolve("project-tasks-detail",ctx)),null!=(null!=(ref1=_this.scope.task.neighbors.next)?ref1.ref:void 0)&&(ctx={project:_this.scope.project.slug,ref:_this.scope.task.neighbors.next.ref},_this.scope.nextUrl=_this.navUrls.resolve("project-tasks-detail",ctx)),task}}(this))},TaskDetailController.prototype.loadSprint=function(){return this.scope.task.milestone?this.rs.sprints.get(this.scope.task.project,this.scope.task.milestone).then(function(_this){return function(sprint){return _this.scope.sprint=sprint,sprint}}(this)):void 0},TaskDetailController.prototype.loadUserStory=function(){return this.scope.task.user_story?this.rs.userstories.get(this.scope.task.project,this.scope.task.user_story).then(function(_this){return function(us){return _this.scope.us=us,us}}(this)):void 0},TaskDetailController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.loadTask().then(function(){return _this.q.all([_this.loadSprint(),_this.loadUserStory()])})}}(this))},TaskDetailController.prototype.onUpvote=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadTask(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.tasks.upvote(this.scope.taskId).then(onSuccess,onError)},TaskDetailController.prototype.onDownvote=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadTask(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.tasks.downvote(this.scope.taskId).then(onSuccess,onError)},TaskDetailController.prototype.onWatch=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadTask(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.tasks.watch(this.scope.taskId).then(onSuccess,onError)},TaskDetailController.prototype.onUnwatch=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.loadTask(),_this.rootscope.$broadcast("object:updated")}}(this),onError=function(_this){return function(){return _this.confirm.notify("error")}}(this),this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess,onError)},TaskDetailController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("TaskDetailController",TaskDetailController),TaskStatusDisplayDirective=function($template,$compile){var link,template;return template=$template.get("common/components/status-display.html",!0),link=function($scope,$el,$attrs){var render;return render=function(task){var html,status;return status=$scope.statusById[task.status],html=template({is_closed:status.is_closed,status:status}),html=$compile(html)($scope),$el.html(html)},$scope.$watch($attrs.ngModel,function(task){return null!=task?render(task):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgTaskStatusDisplay",["$tgTemplate","$compile",TaskStatusDisplayDirective]),TaskStatusButtonDirective=function($rootScope,$repo,$confirm,$loading,$qqueue,$compile,$translate,$template){var link,template;return template=$template.get("us/us-status-button.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,render,save;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_task")},render=function(_this){return function(task){var html,status;return status=$scope.statusById[task.status],html=$compile(template({status:status,statuses:$scope.statusList,editable:isEditable()}))($scope),$el.html(html)}}(this),save=$qqueue.bindAdd(function(_this){return function(status){var currentLoading,onError,onSuccess,task;return task=$model.$modelValue.clone(),task.status=status,currentLoading=$loading().target($el).start(),onSuccess=function(){return $model.$setViewValue(task),$rootScope.$broadcast("object:updated"),currentLoading.finish()},onError=function(){return $confirm.notify("error"),currentLoading.finish()},$repo.save(task).then(onSuccess,onError)}}(this)),$el.on("click",".js-edit-status",function(event){return event.preventDefault(),event.stopPropagation(),isEditable()?$el.find(".pop-status").popover().open():void 0}),$el.on("click",".status",function(event){var target;return event.preventDefault(),event.stopPropagation(),isEditable()?(target=angular.element(event.currentTarget),$.fn.popover().closeAll(),save(target.data("status-id"))):void 0}),$scope.$watch($attrs.ngModel,function(task){return task?render(task):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgTaskStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$compile","$translate","$tgTemplate",TaskStatusButtonDirective]),TaskIsIocaineButtonDirective=function($rootscope,$tgrepo,$confirm,$loading,$qqueue,$compile,$template){var link,template;return template=$template.get("issue/iocaine-button.html",!0),link=function($scope,$el,$attrs,$model){var isEditable,render,save;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_task")},render=function(task){var ctx,html;return isEditable()||task.is_iocaine?(ctx={isIocaine:task.is_iocaine,isEditable:isEditable()},html=$compile(template(ctx))($scope),$el.html(html)):void $el.html("")},save=$qqueue.bindAdd(function(_this){return function(is_iocaine){var currentLoading,promise,task;return task=$model.$modelValue.clone(),task.is_iocaine=is_iocaine,currentLoading=$loading().target($el.find("label")).start(),promise=$tgrepo.save(task),promise.then(function(){return $model.$setViewValue(task),$rootscope.$broadcast("object:updated")}),promise.then(null,function(){return $confirm.notify("error")}),promise["finally"](function(){return currentLoading.finish()})}}(this)),$el.on("click",".is-iocaine",function(event){var is_iocaine;if(isEditable())return is_iocaine=!$model.$modelValue.is_iocaine,save(is_iocaine)}),$scope.$watch($attrs.ngModel,function(task){return task?render(task):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgTaskIsIocaineButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQqueue","$compile","$tgTemplate",TaskIsIocaineButtonDirective])}.call(this),function(){var LeaveProjectDirective,TeamController,TeamFiltersDirective,TeamMemberCurrentUserDirective,TeamMemberStatsDirective,TeamMembersDirective,membersFilter,mixOf,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,module=angular.module("taigaTeam"),TeamController=function(superClass){function TeamController(scope,rootscope,repo,rs,params,q,location,navUrls,appMetaService,auth,translate,projectService){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.appMetaService=appMetaService,this.auth=auth,this.translate=translate,this.projectService=projectService,this.scope.sectionName="TEAM.SECTION_NAME",promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("TEAM.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.translate.instant("TEAM.PAGE_DESCRIPTION",{projectName:_this.scope.project.name,projectDescription:_this.scope.project.description}),_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(TeamController,superClass),TeamController.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$location","$tgNavUrls","tgAppMetaService","$tgAuth","$translate","tgProjectService"],TeamController.prototype.setRole=function(role){return role?this.scope.filtersRole=role:this.scope.filtersRole=null},TeamController.prototype.loadMembers=function(){var i,len,member,ref,user;for(user=this.auth.getUser(),this.scope.totals={},ref=this.scope.activeUsers,i=0,len=ref.length;len>i;i++)member=ref[i],this.scope.totals[member.id]=0;return this.scope.currentUser=_.find(this.scope.activeUsers,{id:null!=user?user.id:void 0}),this.scope.memberships=_.reject(this.scope.activeUsers,{id:null!=user?user.id:void 0})},TeamController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.issuesEnabled=project.is_issues_activated,_this.scope.tasksEnabled=project.is_kanban_activated||project.is_backlog_activated,_this.scope.wikiEnabled=project.is_wiki_activated,project}}(this))},TeamController.prototype.loadMemberStats=function(){return this.rs.projects.memberStats(this.scope.projectId).then(function(_this){return function(stats){var totals;return totals={},_.forEach(_this.scope.totals,function(total,userId){var vals;return vals=_.map(stats,function(memberStats,statsKey){return memberStats[userId]}),total=_.reduce(vals,function(sum,el){return sum+el}),_this.scope.totals[userId]=total}),_this.scope.stats=_this._processStats(stats),_this.scope.stats.totals=_this.scope.totals}}(this))},TeamController.prototype._processStat=function(stat){var max,min,singleStat;return max=_.max(stat),min=_.min(stat),singleStat=_.map(stat,function(value,key){return value===min?[key,.1]:value===max?[key,1]:[key,.5*value/max]}),singleStat=_.object(singleStat)},TeamController.prototype._processStats=function(stats){var key,value;for(key in stats)value=stats[key],stats[key]=this._processStat(value);return stats},TeamController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.loadMembers(),_this.loadMemberStats()}}(this))},TeamController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("TeamController",TeamController),TeamFiltersDirective=function(){return{templateUrl:"team/team-filter.html"}},module.directive("tgTeamFilters",[TeamFiltersDirective]),TeamMemberStatsDirective=function(){return{templateUrl:"team/team-member-stats.html",scope:{stats:"=",userId:"=user",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled"}}},module.directive("tgTeamMemberStats",TeamMemberStatsDirective),TeamMemberCurrentUserDirective=function(){return{templateUrl:"team/team-member-current-user.html",scope:{projectId:"=projectid",currentUser:"=currentuser",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled"}}},module.directive("tgTeamCurrentUser",TeamMemberCurrentUserDirective),TeamMembersDirective=function(){var template;return template="team/team-members.html",{templateUrl:template,scope:{memberships:"=",filtersQ:"=filtersq",filtersRole:"=filtersrole",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled"}}},module.directive("tgTeamMembers",TeamMembersDirective),LeaveProjectDirective=function($repo,$confirm,$location,$rs,$navurls,$translate){var link;return link=function($scope,$el,$attrs){return $scope.leave=function(){var confirm_leave_project_text,leave_project_text;return leave_project_text=$translate.instant("TEAM.ACTION_LEAVE_PROJECT"),confirm_leave_project_text=$translate.instant("TEAM.CONFIRM_LEAVE_PROJECT"),$confirm.ask(leave_project_text,confirm_leave_project_text).then(function(_this){return function(response){var promise;return promise=$rs.projects.leave($attrs.projectid),promise.then(function(){return response.finish(),$confirm.notify("success"),$location.path($navurls.resolve("home"))}),promise.then(null,function(response){return response.finish(),$confirm.notify("error",response.data._error_message)})}}(this))}},{scope:{},templateUrl:"team/leave-project.html",link:link}},module.directive("tgLeaveProject",["$tgRepo","$tgConfirm","$tgLocation","$tgResources","$tgNavUrls","$translate",LeaveProjectDirective]),membersFilter=function(){return function(members,filtersQ,filtersRole){return _.filter(members,function(m){return(!filtersRole||m.role===filtersRole.id)&&(!filtersQ||m.full_name.search(new RegExp(filtersQ,"i"))>=0)})}},module.filter("membersFilter",membersFilter)}.call(this),function(){var EditableWikiContentDirective,WikiDetailController,WikiSummaryDirective,bindOnce,debounce,groupBy,mixOf,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaWiki"),WikiDetailController=function(superClass){function WikiDetailController(scope,rootscope,repo,model,confirm,rs,params,q,location,filter,log,appMetaService,navUrls,analytics,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.model=model,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.filter=filter,this.log=log,this.appMetaService=appMetaService,this.navUrls=navUrls,this.analytics=analytics,this.translate=translate,this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.wikiTitle=this.scope.wikiSlug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,promise=this.loadInitialData(),promise.then(function(_this){return function(){return _this._setMeta()}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(WikiDetailController,superClass),WikiDetailController.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$filter","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate"],WikiDetailController.prototype._setMeta=function(){var description,ref,ref1,ref2,title;return title=this.translate.instant("WIKI.PAGE_TITLE",{wikiPageName:this.scope.wikiTitle,projectName:this.scope.project.name}),description=this.translate.instant("WIKI.PAGE_DESCRIPTION",{wikiPageContent:angular.element((null!=(ref=this.scope.wiki)?ref.html:void 0)||"").text(),totalEditions:(null!=(ref1=this.scope.wiki)?ref1.editions:void 0)||0,lastModifiedDate:moment(null!=(ref2=this.scope.wiki)?ref2.modified_date:void 0).format(this.translate.instant("WIKI.DATETIME"))}),this.appMetaService.setAll(title,description)},WikiDetailController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.is_wiki_activated||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),project}}(this))},WikiDetailController.prototype.loadWiki=function(){var promise;return promise=this.rs.wiki.getBySlug(this.scope.projectId,this.params.slug),promise.then(function(_this){return function(wiki){return _this.scope.wiki=wiki,_this.scope.wikiId=wiki.id,_this.scope.wiki}}(this)),promise.then(null,function(_this){return function(xhr){var data;return _this.scope.wikiId=null,-1===_this.scope.project.my_permissions.indexOf("add_wiki_page")?null:(data={project:_this.scope.projectId,slug:_this.scope.wikiSlug,content:""},_this.scope.wiki=_this.model.make_model("wiki",data),_this.scope.wiki)}}(this))},WikiDetailController.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then(function(_this){return function(wikiLinks){var selectedWikiLink;return _this.scope.wikiLinks=wikiLinks,selectedWikiLink=_.find(wikiLinks,{href:_this.scope.wikiSlug}),null!=selectedWikiLink?_this.scope.wikiTitle=selectedWikiLink.title:void 0}}(this))},WikiDetailController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(project){return _this.fillUsersAndRoles(project.members,project.roles),_this.q.all([_this.loadWikiLinks(),_this.loadWiki()]).then(_this.checkLinksPerms.bind(_this))}}(this))},WikiDetailController.prototype.checkLinksPerms=function(){return-1!==this.scope.project.my_permissions.indexOf("modify_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length?this.scope.linksVisible=!0:void 0},WikiDetailController.prototype["delete"]=function(){var message,title;return title=this.translate.instant("WIKI.DELETE_LIGHTBOX_TITLE"),message=this.scope.wikiTitle,this.confirm.askOnDelete(title,message).then(function(_this){return function(askResponse){var onError,onSuccess;return onSuccess=function(){var ctx;return askResponse.finish(),ctx={project:_this.scope.projectSlug},_this.location.path(_this.navUrls.resolve("project-wiki",ctx)),_this.confirm.notify("success")},onError=function(){return askResponse.finish(!1),_this.confirm.notify("error")},_this.repo.remove(_this.scope.wiki).then(onSuccess,onError)}}(this))},WikiDetailController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("WikiDetailController",WikiDetailController),WikiSummaryDirective=function($log,$template,$compile,$translate){var link,template;return template=$template.get("wiki/wiki-summary.html",!0),link=function($scope,$el,$attrs,$model){var render;return render=function(wiki){var ctx,html,user;return null==$scope.usersById?$log.error("WikiSummaryDirective requires userById set in scope."):user=$scope.usersById[wiki.last_modifier],user=void 0===user?{name:"unknown",imgUrl:"/"+window._version+"/images/user-noimage.png"}:{name:user.full_name_display,imgUrl:user.photo},ctx={totalEditions:wiki.editions,lastModifiedDate:moment(wiki.modified_date).format($translate.instant("WIKI.DATETIME")),user:user},html=template(ctx),html=$compile(html)($scope),$el.html(html)},$scope.$watch($attrs.ngModel,function(wikiPage){return wikiPage?render(wikiPage):void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgWikiSummary",["$log","$tgTemplate","$compile","$translate",WikiSummaryDirective]),EditableWikiContentDirective=function($window,$document,$repo,$confirm,$loading,$analytics,$qqueue){var link;return link=function($scope,$el,$attrs,$model){var cancelEdition,disableEdition,getSelectedText,isEditable,save,switchToEditMode,switchToReadMode;return isEditable=function(){return-1!==$scope.project.my_permissions.indexOf("modify_wiki_page")},switchToEditMode=function(){return $el.find(".edit-wiki-content").show(),$el.find(".view-wiki-content").hide(),$el.find("textarea").focus()},switchToReadMode=function(){return $el.find(".edit-wiki-content").hide(),$el.find(".view-wiki-content").show()},disableEdition=function(){return $el.find(".view-wiki-content .edit").remove(),$el.find(".edit-wiki-content").remove()},cancelEdition=function(){return $model.$modelValue.id?($scope.$apply(function(_this){return function(){return $model.$modelValue.revert()}}(this)),switchToReadMode()):void 0},getSelectedText=function(){return $window.getSelection?$window.getSelection().toString():$document.selection?$document.selection.createRange().text:null},save=$qqueue.bindAdd(function(wiki){var currentLoading,onError,onSuccess,promise;return onSuccess=function(wikiPage){return null==wiki.id&&$analytics.trackEvent("wikipage","create","create wiki page",1),$model.$setViewValue(wikiPage.clone()),$confirm.notify("success"),switchToReadMode()},onError=function(){return $confirm.notify("error")},currentLoading=$loading().removeClasses("icon-floppy").target($el.find(".icon-floppy")).start(),promise=null!=wiki.id?$repo.save(wiki).then(onSuccess,onError):$repo.create("wiki",wiki).then(onSuccess,onError),promise["finally"](function(){return currentLoading.finish()})}),$el.on("click","a",function(event){var href,target;return target=angular.element(event.target),href=target.attr("href"),0===href.indexOf("#")?(event.preventDefault(),$("body").scrollTop($(href).offset().top)):void 0}),$el.on("mousedown",".view-wiki-content",function(event){var target;target=angular.element(event.target),isEditable()&&2===event.button}),$el.on("mouseup",".view-wiki-content",function(event){var target;return target=angular.element(event.target),getSelectedText()||!isEditable()||target.is("a")||target.is("pre")?void 0:switchToEditMode()}),$el.on("click",".save",debounce(2e3,function(){return save($scope.wiki)})),$el.on("click",".cancel",function(){return cancelEdition()}),$el.on("keydown","textarea",function(event){return 27===event.keyCode?cancelEdition():void 0}),$scope.$watch($attrs.ngModel,function(wikiPage){return wikiPage?isEditable()?($el.addClass("editable"),null==wikiPage.id||0===$.trim(wikiPage.content).length?switchToEditMode():void 0):disableEdition():void 0;
}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",require:"ngModel",templateUrl:"wiki/editable-wiki-content.html"}},module.directive("tgEditableWikiContent",["$window","$document","$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics","$tgQqueue",EditableWikiContentDirective])}.call(this),function(){var WikiNavDirective,bindOnce,groupBy,mixOf,module,taiga;taiga=this.taiga,mixOf=this.taiga.mixOf,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,module=angular.module("taigaWiki"),WikiNavDirective=function($tgrepo,$log,$location,$confirm,$navUrls,$analytics,$loading,$template,$compile,$translate){var link,template;return template=$template.get("wiki/wiki-nav.html",!0),link=function($scope,$el,$attrs){var $ctrl,render;return $ctrl=$el.controller(),null==$attrs.ngModel?$log.error("WikiNavDirective: no ng-model attr is defined"):(render=function(wikiLinks){var addWikiLinkPermission,deleteWikiLinkPermission,html;return addWikiLinkPermission=$scope.project.my_permissions.indexOf("add_wiki_link")>-1,deleteWikiLinkPermission=$scope.project.my_permissions.indexOf("delete_wiki_link")>-1,html=template({wikiLinks:wikiLinks,projectSlug:$scope.projectSlug,addWikiLinkPermission:addWikiLinkPermission,deleteWikiLinkPermission:deleteWikiLinkPermission}),html=$compile(html)($scope),$el.off(),$el.html(html),$el.on("click",".wiki-link .link-title",function(event){var linkId,linkSlug,target;return event.preventDefault(),target=angular.element(event.currentTarget),linkId=target.parents(".wiki-link").data("id"),linkSlug=$scope.wikiLinks[linkId].href,$scope.$apply(function(){var ctx;return ctx={project:$scope.projectSlug,slug:linkSlug},$location.path($navUrls.resolve("project-wiki-page",ctx))})}),$el.on("click",".add-button",function(event){return event.preventDefault(),$el.find(".new").removeClass("hidden"),$el.find(".new input").focus(),$el.find(".add-button").hide()}),$el.on("click",".wiki-link .icon-delete",function(event){var linkId,message,target,title;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),linkId=target.parents(".wiki-link").data("id"),title=$translate.instant("WIKI.DELETE_LIGHTBOX_TITLE"),message=$scope.wikiLinks[linkId].title,$confirm.askOnDelete(title,message).then(function(_this){return function(askResponse){var promise;return promise=$tgrepo.remove($scope.wikiLinks[linkId]),promise.then(function(){return promise=$ctrl.loadWikiLinks(),promise.then(function(){return askResponse.finish(),render($scope.wikiLinks)}),promise.then(null,function(){return askResponse.finish()})}),promise.then(null,function(){return askResponse.finish(!1),$confirm.notify("error")})}}(this))}),$el.on("keyup",".new input",function(event){var currentLoading,newLink,promise,target;return event.preventDefault(),13===event.keyCode?(target=angular.element(event.currentTarget),newLink=target.val(),currentLoading=$loading().target($el.find(".new")).start(),promise=$tgrepo.create("wiki-links",{project:$scope.projectId,title:newLink}),promise.then(function(){var loadPromise;return $analytics.trackEvent("wikilink","create","create wiki link",1),loadPromise=$ctrl.loadWikiLinks(),loadPromise.then(function(){return currentLoading.finish(),$el.find(".new").addClass("hidden"),$el.find(".new input").val(""),$el.find(".add-button").show(),render($scope.wikiLinks)}),loadPromise.then(null,function(){return currentLoading.finish(),$el.find(".new").addClass("hidden"),$el.find(".new input").val(""),$el.find(".add-button").show(),$confirm.notify("error","Error loading wiki links")})}),promise.then(null,function(error){var ref;return currentLoading.finish(),$el.find(".new input").val(newLink),$el.find(".new input").focus().select(),null!=(null!=error&&null!=(ref=error.__all__)?ref[0]:void 0)?$confirm.notify("error","The link already exists"):$confirm.notify("error")})):27===event.keyCode?(target=angular.element(event.currentTarget),$el.find(".new").addClass("hidden"),$el.find(".new input").val(""),$el.find(".add-button").show()):void 0})},bindOnce($scope,$attrs.ngModel,render))},{link:link}},module.directive("tgWikiNav",["$tgRepo","$log","$tgLocation","$tgConfirm","$tgNavUrls","$tgAnalytics","$tgLoading","$tgTemplate","$compile","$translate",WikiNavDirective])}.call(this),function(){var CreateMembersDirective,MAX_MEMBERSHIP_FIELDSETS,debounce,module,taiga;taiga=this.taiga,debounce=this.taiga.debounce,module=angular.module("taigaKanban"),MAX_MEMBERSHIP_FIELDSETS=4,CreateMembersDirective=function($rs,$rootScope,$confirm,$loading,lightboxService,$compile){var extraTextTemplate,link,template;return extraTextTemplate='<fieldset class="extra-text">\n    <textarea ng-attr-placeholder="{{\'LIGHTBOX.CREATE_MEMBER.PLACEHOLDER_INVITATION_TEXT\' | translate}}"\n              maxlength="255"></textarea>\n</fieldset>',template=_.template('<div class="add-member-wrapper">\n    <fieldset>\n        <input tg-capslock type="email" placeholder="{{\'LIGHTBOX.CREATE_MEMBER.PLACEHOLDER_TYPE_EMAIL\' | translate}}"\n               <% if(required) { %> data-required="true" <% } %> data-type="email" />\n    </fieldset>\n    <fieldset>\n        <select <% if(required) { %> data-required="true" <% } %> data-required="true">\n            <% _.each(roleList, function(role) { %>\n            <option value="<%- role.id %>"><%- role.name %></option>\n            <% }); %>\n        </select>\n        <a class="icon icon-plus add-fieldset" href=""></a>\n    </fieldset>\n</div>'),link=function($scope,$el,$attrs){var createFieldSet,resetForm,submit,submitButton;return createFieldSet=function(required){var ctx;return null==required&&(required=!0),ctx={roleList:$scope.project.roles,required:required},$compile(template(ctx))($scope)},resetForm=function(){var fieldSet,invitations;return $el.find("form textarea").remove(),$el.find("form .add-member-wrapper").remove(),invitations=$el.find(".add-member-forms"),invitations.html($compile(extraTextTemplate)($scope)),fieldSet=createFieldSet(),invitations.prepend(fieldSet)},$scope.$on("membersform:new",function(){return resetForm(),lightboxService.open($el)}),$scope.$on("$destroy",function(){return $el.off()}),$el.on("click",".delete-fieldset",function(event){var fieldSet,lastActionButton,target;return event.preventDefault(),target=angular.element(event.currentTarget),fieldSet=target.closest(".add-member-wrapper"),fieldSet.remove(),lastActionButton=$el.find(".add-member-wrapper fieldset:last > a"),lastActionButton.hasClass("icon-delete delete-fieldset")?lastActionButton.removeClass("icon-delete delete-fieldset").addClass("icon-plus add-fieldset"):void 0}),$el.on("click",".add-fieldset",function(event){var fieldSet,newFieldSet,target;return event.preventDefault(),target=angular.element(event.currentTarget),fieldSet=target.closest(".add-member-wrapper"),target.removeClass("icon-plus add-fieldset").addClass("icon-delete delete-fieldset"),newFieldSet=createFieldSet(!1),fieldSet.after(newFieldSet),$scope.$digest(),$el.find(".add-member-wrapper").length===MAX_MEMBERSHIP_FIELDSETS?$el.find(".add-member-wrapper fieldset:last > a").removeClass("icon-plus add-fieldset").addClass("icon-delete delete-fieldset"):void 0}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,form,invitation_extra_text,invitations,memberWrappers,onError,onSuccess,promise;return event.preventDefault(),currentLoading=$loading().target(submitButton).start(),onSuccess=function(data){return currentLoading.finish(),lightboxService.close($el),$confirm.notify("success"),$rootScope.$broadcast("membersform:new:success")},onError=function(data){return currentLoading.finish(),lightboxService.close($el),$confirm.notify("error"),$rootScope.$broadcast("membersform:new:error")},form=$el.find("form").checksley(),form.destroy(),form.initialize(),form.validate()?(memberWrappers=$el.find("form .add-member-wrapper"),memberWrappers=_.filter(memberWrappers,function(mw){return angular.element(mw).find("input").hasClass("checksley-ok")}),invitations=_.map(memberWrappers,function(mw){var email,memberWrapper,role;return memberWrapper=angular.element(mw),email=memberWrapper.find("input"),role=memberWrapper.find("select"),{email:email.val(),role_id:role.val()}}),invitations.length?(invitation_extra_text=$el.find("form textarea").val(),promise=$rs.memberships.bulkCreateMemberships($scope.project.id,invitations,invitation_extra_text),promise.then(onSuccess,onError)):void 0):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit)},{link:link}},module.directive("tgLbCreateMembers",["$tgResources","$rootScope","$tgConfirm","$tgLoading","lightboxService","$compile",CreateMembersDirective])}.call(this),function(){var MembershipsController,MembershipsDirective,MembershipsRowActionsDirective,MembershipsRowAdminCheckboxDirective,MembershipsRowAvatarDirective,MembershipsRowRoleSelectorDirective,bindMethods,mixOf,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,bindMethods=this.taiga.bindMethods,module=angular.module("taigaAdmin"),MembershipsController=function(superClass){function MembershipsController(scope,rootscope,repo,confirm,rs,params,q,location,navUrls,analytics,appMetaService,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.analytics=analytics,this.appMetaService=appMetaService,this.translate=translate,bindMethods(this),this.scope.project={},this.scope.filters={},promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("ADMIN.MEMBERSHIPS.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this)),this.scope.$on("membersform:new:success",function(_this){return function(){return _this.loadMembers(),_this.analytics.trackEvent("membership","create","create memberships on admin",1)}}(this))}return extend(MembershipsController,superClass),MembershipsController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAnalytics","tgAppMetaService","$translate"],MembershipsController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.i_am_owner||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),project}}(this))},MembershipsController.prototype.loadMembers=function(){var httpFilters;return httpFilters=this.getUrlFilters(),this.rs.memberships.list(this.scope.projectId,httpFilters).then(function(_this){return function(data){return _this.scope.memberships=_.filter(data.models,function(membership){return null===membership.user||membership.is_user_active}),_this.scope.page=data.current,_this.scope.count=data.count,_this.scope.paginatedBy=data.paginatedBy,data}}(this))},MembershipsController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(){return _this.loadMembers()}}(this)),promise},MembershipsController.prototype.getUrlFilters=function(){var filters;return filters=_.pick(this.location.search(),"page"),filters.page||(filters.page=1),filters},MembershipsController.prototype.addNewMembers=function(){return this.rootscope.$broadcast("membersform:new")},MembershipsController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("MembershipsController",MembershipsController),MembershipsDirective=function($template,$compile){var link,linkPagination,template;return template=$template.get("admin/admin-membership-paginator.html",!0),linkPagination=function($scope,$el,$attrs,$ctrl){var $pagEl,afterCurrent,atBegin,atEnd,beforeCurrent,getNumPages,renderPagination;return afterCurrent=2,beforeCurrent=4,atBegin=2,atEnd=2,$pagEl=$el.find(".memberships-paginator"),getNumPages=function(){var numPages;return numPages=$scope.count/$scope.paginatedBy,numPages=parseInt(numPages,10)<numPages?parseInt(numPages,10)+1:parseInt(numPages,10)},renderPagination=function(){var cpage,html,i,j,numPages,options,pages,ref;if(numPages=getNumPages(),1>=numPages)return void $pagEl.hide();for(pages=[],options={},options.pages=pages,options.showPrevious=$scope.page>1,options.showNext=!($scope.page===numPages),cpage=$scope.page,i=j=1,ref=numPages;ref>=1?ref>=j:j>=ref;i=ref>=1?++j:--j)i===cpage+afterCurrent&&numPages>cpage+afterCurrent+atEnd?pages.push({classes:"dots",type:"dots"}):i===cpage-beforeCurrent&&cpage>atBegin+beforeCurrent?pages.push({classes:"dots",type:"dots"}):i>cpage+afterCurrent&&numPages-atEnd>=i||cpage-beforeCurrent>i&&i>atBegin||(i===cpage?pages.push({classes:"active",num:i,type:"page-active"}):pages.push({classes:"page",num:i,type:"page"}));return html=template(options),html=$compile(html)($scope),$pagEl.html(html),$pagEl.show()},$scope.$watch("memberships",function(value){return value?renderPagination():void 0}),$el.on("click",".memberships-paginator a.next",function(event){return event.preventDefault(),$scope.$apply(function(){return $ctrl.selectFilter("page",$scope.page+1),$ctrl.loadMembers()})}),$el.on("click",".memberships-paginator a.previous",function(event){return event.preventDefault(),$scope.$apply(function(){return $ctrl.selectFilter("page",$scope.page-1),$ctrl.loadMembers()})}),$el.on("click",".memberships-paginator li.page > a",function(event){var pagenum,target;return event.preventDefault(),target=angular.element(event.currentTarget),pagenum=target.data("pagenum"),$scope.$apply(function(){return $ctrl.selectFilter("page",pagenum),$ctrl.loadMembers()})})},link=function($scope,$el,$attrs){var $ctrl;return $ctrl=$el.controller(),linkPagination($scope,$el,$attrs,$ctrl),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgMemberships",["$tgTemplate","$compile",MembershipsDirective]),MembershipsRowAvatarDirective=function($log,$template,$translate){var link,template;return template=$template.get("admin/memberships-row-avatar.html",!0),link=function($scope,$el,$attrs){var member,pending,render;return pending=$translate.instant("ADMIN.MEMBERSHIP.STATUS_PENDING"),render=function(member){var ctx,html;return ctx={full_name:member.full_name?member.full_name:"",email:member.user_email?member.user_email:member.email,imgurl:member.photo?member.photo:"/"+window._version+"/images/unnamed.png",pending:member.is_user_active?"":pending},html=template(ctx),$el.html(html)},null==$attrs.tgMembershipsRowAvatar?$log.error("MembershipsRowAvatarDirective: the directive need a member"):(member=$scope.$eval($attrs.tgMembershipsRowAvatar),render(member),$scope.$on("$destroy",function(){return $el.off()}))},{link:link}},module.directive("tgMembershipsRowAvatar",["$log","$tgTemplate","$translate",MembershipsRowAvatarDirective]),MembershipsRowAdminCheckboxDirective=function($log,$repo,$confirm,$template,$compile){var link,template;return template=$template.get("admin/admin-memberships-row-checkbox.html",!0),link=function($scope,$el,$attrs){var html,member,render;return render=function(member){var ctx,html;return ctx={inputId:"is-admin-"+member.id},html=template(ctx),html=$compile(html)($scope),$el.html(html)},null==$attrs.tgMembershipsRowAdminCheckbox?$log.error("MembershipsRowAdminCheckboxDirective: the directive need a member"):(member=$scope.$eval($attrs.tgMembershipsRowAdminCheckbox),html=render(member),member.is_owner&&$el.find(":checkbox").prop("checked",!0),$el.on("click",":checkbox",function(_this){return function(event){var onError,onSuccess,target;return onSuccess=function(){return $confirm.notify("success")},onError=function(data){return member.revert(),$el.find(":checkbox").prop("checked",member.is_owner),$confirm.notify("error",data.is_owner[0])},target=angular.element(event.currentTarget),member.is_owner=target.prop("checked"),$repo.save(member).then(onSuccess,onError)}}(this)),$scope.$on("$destroy",function(){return $el.off()}))},{link:link}},module.directive("tgMembershipsRowAdminCheckbox",["$log","$tgRepo","$tgConfirm","$tgTemplate","$compile",MembershipsRowAdminCheckboxDirective]),MembershipsRowRoleSelectorDirective=function($log,$repo,$confirm){var link,template;return template=_.template('<select>\n    <% _.each(roleList, function(role) { %>\n    <option value="<%- role.id %>" <% if(selectedRole === role.id){ %>selected="selected"<% } %>>\n        <%- role.name %>\n    </option>\n    <% }); %>\n</select>'),link=function($scope,$el,$attrs){var $ctrl,html,member,render;return render=function(member){var ctx,html;return ctx={roleList:$scope.project.roles,selectedRole:member.role},html=template(ctx),$el.html(html)},null==$attrs.tgMembershipsRowRoleSelector?$log.error("MembershipsRowRoleSelectorDirective: the directive need a member"):($ctrl=$el.controller(),member=$scope.$eval($attrs.tgMembershipsRowRoleSelector),html=render(member),$el.on("change","select",function(_this){return function(event){var newRole,onError,onSuccess,target;return onSuccess=function(){return $confirm.notify("success")},onError=function(){return $confirm.notify("error")},target=angular.element(event.currentTarget),newRole=parseInt(target.val(),10),member.role!==newRole?(member.role=newRole,$repo.save(member).then(onSuccess,onError)):void 0}}(this)),$scope.$on("$destroy",function(){return $el.off()}))},{link:link}},module.directive("tgMembershipsRowRoleSelector",["$log","$tgRepo","$tgConfirm",MembershipsRowRoleSelectorDirective]),MembershipsRowActionsDirective=function($log,$repo,$rs,$confirm,$compile,$translate){var activedTemplate,link,pendingTemplate;return activedTemplate='<div class="active"\n     translate="ADMIN.MEMBERSHIP.STATUS_ACTIVE">\n</div>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <span class="icon icon-delete"></span>\n</a>',pendingTemplate='<a class="resend js-resend" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.RESEND\' | translate }}"\n   translate="ADMIN.MEMBERSHIP.RESEND">\n</a>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <span class="icon icon-delete"></span>\n</a>',link=function($scope,$el,$attrs){var $ctrl,member,render;return render=function(member){var html;return html=member.user?$compile(activedTemplate)($scope):$compile(pendingTemplate)($scope),$el.html(html)},null==$attrs.tgMembershipsRowActions?$log.error("MembershipsRowActionsDirective: the directive need a member"):($ctrl=$el.controller(),member=$scope.$eval($attrs.tgMembershipsRowActions),render(member),$el.on("click",".js-resend",function(event){var onError,onSuccess;return event.preventDefault(),onSuccess=function(){var text;return text=$translate.instant("ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION",{email:$scope.member.email}),$confirm.notify("success",text)},onError=function(){var text;return text=$translate.instant("ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION"),$confirm.notify("error",text)},$rs.memberships.resendInvitation($scope.member.id).then(onSuccess,onError)}),$el.on("click",".delete",function(event){var defaultMsg,message,title;return event.preventDefault(),title=$translate.instant("ADMIN.MEMBERSHIP.DELETE_MEMBER"),defaultMsg=$translate.instant("ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE",{email:member.email}),message=member.user?member.full_name:defaultMsg,$confirm.askOnDelete(title,message).then(function(askResponse){var onError,onSuccess;return onSuccess=function(_this){return function(){var text;return askResponse.finish(),$scope.page>1&&$scope.count-1<=$scope.paginatedBy&&$ctrl.selectFilter("page",$scope.page-1),$ctrl.loadMembers(),text=$translate.instant("ADMIN.MEMBERSHIP.SUCCESS_DELETE"),$confirm.notify("success",null,text)}}(this),onError=function(_this){return function(){var text;return askResponse.finish(!1),text=$translate.instant("ADMIN.MEMBERSHIP.ERROR_DELETE",{message:message}),$confirm.notify("error",null,text)}}(this),$repo.remove(member).then(onSuccess,onError)})}),$scope.$on("$destroy",function(){return $el.off()}))},{link:link}},module.directive("tgMembershipsRowActions",["$log","$tgRepo","$tgResources","$tgConfirm","$compile","$translate",MembershipsRowActionsDirective])}.call(this),function(){var AdminNavigationDirective,module;AdminNavigationDirective=function(){var link;return link=function($scope,$el,$attrs){var section;return section=$attrs.tgAdminNavigation,$el.find(".active").removeClass("active"),$el.find("#adminmenu-"+section+" a").addClass("active"),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module=angular.module("taigaAdmin"),module.directive("tgAdminNavigation",AdminNavigationDirective)}.call(this),function(){var CsvExporterController,CsvExporterIssuesController,CsvExporterTasksController,CsvExporterUserstoriesController,CsvIssueDirective,CsvTaskDirective,CsvUsDirective,ProjectDefaultValuesDirective,ProjectExportDirective,ProjectLogoDirective,ProjectLogoModelDirective,ProjectModulesDirective,ProjectProfileController,ProjectProfileDirective,bindOnce,debounce,groupBy,joinStr,mixOf,module,taiga,toString,trim,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};taiga=this.taiga,mixOf=this.taiga.mixOf,trim=this.taiga.trim,toString=this.taiga.toString,joinStr=this.taiga.joinStr,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaAdmin"),ProjectProfileController=function(superClass){function ProjectProfileController(scope,rootscope,repo,confirm,rs,params,q,location,navUrls,appMetaService,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.appMetaService=appMetaService,this.translate=translate,this.scope.project={},promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,sectionName,title;return sectionName=_this.translate.instant(_this.scope.sectionName),title=_this.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:sectionName,projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:loaded",function(_this){return function(){var description,sectionName,title;return sectionName=_this.translate.instant(_this.scope.sectionName),title=_this.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:sectionName,projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this))}return extend(ProjectProfileController,superClass),ProjectProfileController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],ProjectProfileController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.i_am_owner||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.pointsList=_.sortBy(project.points,"order"),_this.scope.usStatusList=_.sortBy(project.us_statuses,"order"),_this.scope.taskStatusList=_.sortBy(project.task_statuses,"order"),_this.scope.prioritiesList=_.sortBy(project.priorities,"order"),_this.scope.severitiesList=_.sortBy(project.severities,"order"),_this.scope.issueTypesList=_.sortBy(project.issue_types,"order"),_this.scope.issueStatusList=_.sortBy(project.issue_statuses,"order"),_this.scope.$emit("project:loaded",project),project}}(this))},ProjectProfileController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject()},ProjectProfileController.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.project)},ProjectProfileController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("ProjectProfileController",ProjectProfileController),ProjectProfileDirective=function($repo,$confirm,$loading,$navurls,$location,projectService,currentUserService){var link;return link=function($scope,$el,$attrs){var $ctrl,form,submit,submitButton;return $ctrl=$el.controller(),form=$el.find("form").checksley({onlyOneErrorElement:!0}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.save($scope.project),promise.then(function(){var newUrl;return currentLoading.finish(),$confirm.notify("success"),newUrl=$navurls.resolve("project-admin-project-profile-details",{project:$scope.project.slug}),$location.path(newUrl),$ctrl.loadInitialData(),projectService.fetchProject(),currentUserService.loadProjects()}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit)},{link:link}},module.directive("tgProjectProfile",["$tgRepo","$tgConfirm","$tgLoading","$tgNavUrls","$tgLocation","tgProjectService","tgCurrentUserService",ProjectProfileDirective]),ProjectDefaultValuesDirective=function($repo,$confirm,$loading){var link;return link=function($scope,$el,$attrs){var form,submit,submitButton;return form=$el.find("form").checksley({onlyOneErrorElement:!0}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.save($scope.project),promise.then(function(){return currentLoading.finish(),$confirm.notify("success")}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgProjectDefaultValues",["$tgRepo","$tgConfirm","$tgLoading",ProjectDefaultValuesDirective]),ProjectModulesDirective=function($repo,$confirm,$loading,projectService){var link;return link=function($scope,$el,$attrs){var submit;return submit=function(_this){return function(){var currentLoading,form,promise,target;return form=$el.find("form").checksley(),form.validate()?(target=angular.element(".admin-functionalities .submit-button"),currentLoading=$loading().target(target).start(),promise=$repo.save($scope.project),promise.then(function(){return currentLoading.finish(),$confirm.notify("success"),$scope.$emit("project:loaded",$scope.project),projectService.fetchProject()}),promise.then(null,function(data){return currentLoading.finish(),$confirm.notify("error",data._error_message)})):void 0}}(this),$el.on("submit","form",function(event){return event.preventDefault(),submit()}),$el.on("click",".admin-functionalities a.button-green",function(event){return event.preventDefault(),submit()}),$scope.$watch("isVideoconferenceActivated",function(isVideoconferenceActivated){return isVideoconferenceActivated?$el.find(".videoconference-attributes").removeClass("hidden"):($el.find(".videoconference-attributes").addClass("hidden"),$scope.project.videoconferences=null,$scope.project.videoconferences_extra_data="")}),$scope.$watch("project",function(project){return null!=project.videoconferences?$scope.isVideoconferenceActivated=!0:$scope.isVideoconferenceActivated=!1})},{link:link}},module.directive("tgProjectModules",["$tgRepo","$tgConfirm","$tgLoading","tgProjectService",ProjectModulesDirective]),ProjectExportDirective=function($window,$rs,$confirm,$translate){var link;return link=function($scope,$el,$attrs){var asyn_message,buttonsEl,dump_ready_text,hideButtons,hideResult,hideSpinner,loading_msg,loading_title,resultEl,resultMessageEl,resultTitleEl,setAsyncMessage,setAsyncTitle,setLoadingMessage,setLoadingTitle,setSyncMessage,setSyncTitle,showButtons,showErrorMode,showExportResultAsyncMode,showExportResultSyncMode,showLoadingMode,showResult,showSpinner,spinnerEl,syn_message;return buttonsEl=$el.find(".admin-project-export-buttons"),showButtons=function(){return buttonsEl.removeClass("hidden")},hideButtons=function(){return buttonsEl.addClass("hidden")},resultEl=$el.find(".admin-project-export-result"),showResult=function(){return resultEl.removeClass("hidden")},hideResult=function(){return resultEl.addClass("hidden")},spinnerEl=$el.find(".spin"),showSpinner=function(){return spinnerEl.removeClass("hidden")},hideSpinner=function(){return spinnerEl.addClass("hidden")},resultTitleEl=$el.find(".result-title"),loading_title=$translate.instant("ADMIN.PROJECT_EXPORT.LOADING_TITLE"),loading_msg=$translate.instant("ADMIN.PROJECT_EXPORT.LOADING_MESSAGE"),dump_ready_text=function(){return resultTitleEl.html($translate.instant("ADMIN.PROJECT_EXPORT.DUMP_READY"))},asyn_message=function(){return resultTitleEl.html($translate.instant("ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE"))},syn_message=function(url){return resultTitleEl.html($translate.instant("ADMIN.PROJECT_EXPORT.SYNC_MESSAGE",{url:url}))},setLoadingTitle=function(){return resultTitleEl.html(loading_title)},setAsyncTitle=function(){return resultTitleEl.html(loading_msg)},setSyncTitle=function(){return resultTitleEl.html(dump_ready_text)},resultMessageEl=$el.find(".result-message "),setLoadingMessage=function(){return resultMessageEl.html(loading_msg)},setAsyncMessage=function(){return resultMessageEl.html(asyn_message)},setSyncMessage=function(url){return resultMessageEl.html(syn_message(url))},showLoadingMode=function(){return showSpinner(),setLoadingTitle(),setLoadingMessage(),hideButtons(),showResult()},showExportResultAsyncMode=function(){return hideSpinner(),setAsyncTitle(),setAsyncMessage()},showExportResultSyncMode=function(url){return hideSpinner(),setSyncTitle(),setSyncMessage(url)},showErrorMode=function(){return hideSpinner(),hideResult(),showButtons()},$el.on("click","a.button-export",debounce(2e3,function(_this){return function(event){var onError,onSuccess;return event.preventDefault(),onSuccess=function(result){var dumpUrl;return 202===result.status?showExportResultAsyncMode():(dumpUrl=result.data.url,showExportResultSyncMode(dumpUrl),$window.open(dumpUrl,"_blank"))},onError=function(result){var errorMsg,ref;return showErrorMode(),errorMsg=$translate.instant("ADMIN.PROJECT_EXPORT.ERROR"),429===result.status?errorMsg=$translate.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY"):(null!=(ref=result.data)?ref._error_message:void 0)&&(errorMsg=$translate.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY",{message:result.data._error_message})),$confirm.notify("error",errorMsg)},showLoadingMode(),$rs.projects["export"]($scope.projectId).then(onSuccess,onError)}}(this)))},{link:link}},module.directive("tgProjectExport",["$window","$tgResources","$tgConfirm","$translate",ProjectExportDirective]),CsvExporterController=function(superClass){function CsvExporterController(scope,rootscope,urls,confirm,rs,translate){this.scope=scope,this.rootscope=rootscope,this.urls=urls,this.confirm=confirm,
this.rs=rs,this.translate=translate,this._generateUuid=bind(this._generateUuid,this),this.setCsvUuid=bind(this.setCsvUuid,this),this.rootscope.$on("project:loaded",this.setCsvUuid),this.scope.$watch("csvUuid",function(_this){return function(value){return value?_this.scope.csvUrl=_this.urls.resolveAbsolute(_this.type+"-csv",value):_this.scope.csvUrl=""}}(this))}return extend(CsvExporterController,superClass),CsvExporterController.$inject=["$scope","$rootScope","$tgUrls","$tgConfirm","$tgResources","$translate"],CsvExporterController.prototype.setCsvUuid=function(){return this.scope.csvUuid=this.scope.project[this.type+"_csv_uuid"]},CsvExporterController.prototype._generateUuid=function(response){var promise;return null==response&&(response=null),promise=this.rs.projects["regenerate_"+this.type+"_csv_uuid"](this.scope.projectId),promise.then(function(_this){return function(data){var ref;return _this.scope.csvUuid=null!=(ref=data.data)?ref.uuid:void 0}}(this)),promise.then(null,function(_this){return function(){return _this.confirm.notify("error")}}(this)),promise["finally"](function(){return response?response.finish():void 0}),promise},CsvExporterController.prototype.regenerateUuid=function(){var subtitle,title;return this.scope.csvUuid?(title=this.translate.instant("ADMIN.REPORTS.REGENERATE_TITLE"),subtitle=this.translate.instant("ADMIN.REPORTS.REGENERATE_SUBTITLE"),this.confirm.ask(title,subtitle).then(this._generateUuid)):this._generateUuid()},CsvExporterController}(taiga.Controller),CsvExporterUserstoriesController=function(superClass){function CsvExporterUserstoriesController(){return CsvExporterUserstoriesController.__super__.constructor.apply(this,arguments)}return extend(CsvExporterUserstoriesController,superClass),CsvExporterUserstoriesController.prototype.type="userstories",CsvExporterUserstoriesController}(CsvExporterController),CsvExporterTasksController=function(superClass){function CsvExporterTasksController(){return CsvExporterTasksController.__super__.constructor.apply(this,arguments)}return extend(CsvExporterTasksController,superClass),CsvExporterTasksController.prototype.type="tasks",CsvExporterTasksController}(CsvExporterController),CsvExporterIssuesController=function(superClass){function CsvExporterIssuesController(){return CsvExporterIssuesController.__super__.constructor.apply(this,arguments)}return extend(CsvExporterIssuesController,superClass),CsvExporterIssuesController.prototype.type="issues",CsvExporterIssuesController}(CsvExporterController),module.controller("CsvExporterUserstoriesController",CsvExporterUserstoriesController),module.controller("CsvExporterTasksController",CsvExporterTasksController),module.controller("CsvExporterIssuesController",CsvExporterIssuesController),CsvUsDirective=function($translate){var link;return link=function($scope){return $scope.sectionTitle="ADMIN.CSV.SECTION_TITLE_US"},{controller:"CsvExporterUserstoriesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:link,scope:!0}},module.directive("tgCsvUs",["$translate",CsvUsDirective]),CsvTaskDirective=function($translate){var link;return link=function($scope){return $scope.sectionTitle="ADMIN.CSV.SECTION_TITLE_TASK"},{controller:"CsvExporterTasksController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:link,scope:!0}},module.directive("tgCsvTask",["$translate",CsvTaskDirective]),CsvIssueDirective=function($translate){var link;return link=function($scope){return $scope.sectionTitle="ADMIN.CSV.SECTION_TITLE_ISSUE"},{controller:"CsvExporterIssuesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:link,scope:!0}},module.directive("tgCsvIssue",["$translate",CsvIssueDirective]),ProjectLogoDirective=function($auth,$model,$rs,$confirm){var link;return link=function($scope,$el,$attrs){var onError,onSuccess,showSizeInfo;return showSizeInfo=function(){return $el.find(".size-info").addClass("active")},onSuccess=function(response){var project;return project=$model.make_model("projects",response.data),$scope.project=project,$el.find(".loading-overlay").removeClass("active"),$confirm.notify("success")},onError=function(response){return 413===response.status&&showSizeInfo(),$el.find(".loading-overlay").removeClass("active"),$confirm.notify("error",response.data._error_message)},$el.on("click",".js-change-logo",function(){return $el.find("#logo-field").click()}),$el.on("change","#logo-field",function(event){return $scope.logoAttachment?($el.find(".loading-overlay").addClass("active"),$rs.projects.changeLogo($scope.project.id,$scope.logoAttachment).then(onSuccess,onError)):void 0}),$el.on("click","a.js-use-default-logo",function(event){return $el.find(".loading-overlay").addClass("active"),$rs.projects.removeLogo($scope.project.id).then(onSuccess,onError)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgProjectLogo",["$tgAuth","$tgModel","$tgResources","$tgConfirm",ProjectLogoDirective]),ProjectLogoModelDirective=function($parse){var link;return link=function($scope,$el,$attrs){var model,modelSetter;return model=$parse($attrs.tgProjectLogoModel),modelSetter=model.assign,$el.bind("change",function(){return $scope.$apply(function(){return modelSetter($scope,$el[0].files[0])})})},{link:link}},module.directive("tgProjectLogoModel",["$parse",ProjectLogoModelDirective])}.call(this),function(){var ColorSelectionDirective,DATE_TYPE,MULTILINE_TYPE,ProjectCustomAttributesController,ProjectCustomAttributesDirective,ProjectValuesController,ProjectValuesDirective,ProjectValuesSectionController,TEXT_TYPE,TYPE_CHOICES,bindOnce,debounce,groupBy,joinStr,mixOf,module,taiga,toString,trim,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};taiga=this.taiga,mixOf=this.taiga.mixOf,trim=this.taiga.trim,toString=this.taiga.toString,joinStr=this.taiga.joinStr,groupBy=this.taiga.groupBy,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaAdmin"),ProjectValuesSectionController=function(superClass){function ProjectValuesSectionController(scope,rootscope,repo,confirm,rs,params,q,location,navUrls,appMetaService,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.appMetaService=appMetaService,this.translate=translate,this.scope.project={},promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,sectionName,title;return sectionName=_this.translate.instant(_this.scope.sectionName),title=_this.translate.instant("ADMIN.PROJECT_VALUES.PAGE_TITLE",{sectionName:sectionName,projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(ProjectValuesSectionController,superClass),ProjectValuesSectionController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],ProjectValuesSectionController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.i_am_owner||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),project}}(this))},ProjectValuesSectionController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject()},ProjectValuesSectionController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("ProjectValuesSectionController",ProjectValuesSectionController),ProjectValuesController=function(superClass){function ProjectValuesController(scope,rootscope,repo,confirm,rs){this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.moveValue=bind(this.moveValue,this),this.loadValues=bind(this.loadValues,this),this.scope.$on("admin:project-values:move",this.moveValue),this.rootscope.$on("project:loaded",this.loadValues)}return extend(ProjectValuesController,superClass),ProjectValuesController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],ProjectValuesController.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then(function(_this){return function(values){return _this.scope.values=values,_this.scope.maxValueOrder=_.max(values,"order").order,values}}(this))},ProjectValuesController.prototype.moveValue=function(ctx,itemValue,itemIndex){var r,values;return values=this.scope.values,r=values.indexOf(itemValue),values.splice(r,1),values.splice(itemIndex,0,itemValue),_.each(values,function(value,index){return value.order=index}),this.repo.saveAll(values)},ProjectValuesController}(taiga.Controller),module.controller("ProjectValuesController",ProjectValuesController),ProjectValuesDirective=function($log,$repo,$confirm,$location,animationFrame,$translate,$rootscope){var link,linkDragAndDrop,linkValue;return linkDragAndDrop=function($scope,$el,$attrs){var itemEl,newParentScope,oldParentScope,tdom;return oldParentScope=null,newParentScope=null,itemEl=null,tdom=$el.find(".sortable"),tdom.sortable({handle:".row.table-main.visualization",dropOnEmpty:!0,connectWith:".project-values-body",revert:400,axis:"y"}),tdom.on("sortstop",function(event,ui){var itemIndex,itemValue;return itemEl=ui.item,itemValue=itemEl.scope().value,itemIndex=itemEl.index(),$scope.$broadcast("admin:project-values:move",itemValue,itemIndex)}),$scope.$on("$destroy",function(){return $el.off()})},linkValue=function($scope,$el,$attrs){var $ctrl,cancel,goToBottomList,initializeNewValue,initializeTextTranslations,objName,saveNewValue,saveValue,valueType;return $ctrl=$el.controller(),valueType=$attrs.type,objName=$attrs.objname,initializeNewValue=function(){return $scope.newValue={name:"",is_closed:!1,is_archived:!1}},initializeTextTranslations=function(){return $scope.addNewElementText=$translate.instant("ADMIN.PROJECT_VALUES_"+objName.toUpperCase()+".ACTION_ADD")},initializeNewValue(),initializeTextTranslations(),$rootscope.$on("$translateChangeEnd",function(){return $scope.$evalAsync(initializeTextTranslations)}),goToBottomList=function(_this){return function(focus){var table;return null==focus&&(focus=!1),table=$el.find(".table-main"),$(document.body).scrollTop(table.offset().top+table.height()),focus?$el.find(".new-value input:visible").first().focus():void 0}}(this),saveValue=function(target){var form,formEl,promise,value;return formEl=target.parents("form"),form=formEl.checksley(),form.validate()?(value=formEl.scope().value,promise=$repo.save(value),promise.then(function(_this){return function(){var row;return row=target.parents(".row.table-main"),row.addClass("hidden"),row.siblings(".visualization").removeClass("hidden")}}(this)),promise.then(null,function(data){return form.setErrors(data)})):void 0},saveNewValue=function(target){var form,formEl,promise;return formEl=target.parents("form"),form=formEl.checksley(),form.validate()?($scope.newValue.project=$scope.project.id,$scope.newValue.order=$scope.maxValueOrder?$scope.maxValueOrder+1:1,promise=$repo.create(valueType,$scope.newValue),promise.then(function(_this){return function(data){return target.addClass("hidden"),$scope.values.push(data),$scope.maxValueOrder=data.order,initializeNewValue()}}(this)),promise.then(null,function(data){return form.setErrors(data)})):void 0},cancel=function(target){var formEl,row,value;return row=target.parents(".row.table-main"),formEl=target.parents("form"),value=formEl.scope().value,$scope.$apply(function(){return row.addClass("hidden"),value.revert(),row.siblings(".visualization").removeClass("hidden")})},$el.on("click",".show-add-new",function(event){return event.preventDefault(),$el.find(".new-value").removeClass("hidden"),goToBottomList(!0)}),$el.on("click",".add-new",debounce(2e3,function(event){var target;return event.preventDefault(),target=$el.find(".new-value"),saveNewValue(target)})),$el.on("click",".delete-new",function(event){return event.preventDefault(),$el.find(".new-value").addClass("hidden"),initializeNewValue()}),$el.on("click",".edit-value",function(event){var editionRow,row,target;return event.preventDefault(),target=angular.element(event.currentTarget),row=target.parents(".row.table-main"),row.addClass("hidden"),editionRow=row.siblings(".edition"),editionRow.removeClass("hidden"),editionRow.find("input:visible").first().focus().select()}),$el.on("keyup",".edition input",function(event){var target;return 13===event.keyCode?(target=angular.element(event.currentTarget),saveValue(target)):27===event.keyCode?(target=angular.element(event.currentTarget),cancel(target)):void 0}),$el.on("keyup",".new-value input",function(event){var target;return 13===event.keyCode?(target=$el.find(".new-value"),saveNewValue(target)):27===event.keyCode?($el.find(".new-value").addClass("hidden"),initializeNewValue()):void 0}),$el.on("click",".save",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),saveValue(target)}),$el.on("click",".cancel",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),cancel(target)}),$el.on("click",".delete-value",function(event){var choices,formEl,subtitle,target,text,title,value;return event.preventDefault(),target=angular.element(event.currentTarget),formEl=target.parents("form"),value=formEl.scope().value,choices={},_.each($scope.values,function(option){return value.id!==option.id?choices[option.id]=option.name:void 0}),subtitle=value.name,0===_.keys(choices).length?$confirm.error($translate.instant("ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL")):(title=$translate.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE"),text=$translate.instant("ADMIN.PROJECT_VALUES.REPLACEMENT"),$confirm.askChoice(title,subtitle,choices,text).then(function(response){var onError,onSucces;return onSucces=function(){return $ctrl.loadValues()["finally"](function(){return response.finish()})},onError=function(){return $confirm.notify("error")},$repo.remove(value,{moveTo:response.selected}).then(onSucces,onError)}))})},link=function($scope,$el,$attrs){return linkDragAndDrop($scope,$el,$attrs),linkValue($scope,$el,$attrs),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgProjectValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope",ProjectValuesDirective]),ColorSelectionDirective=function(){var link;return link=function($scope,$el,$attrs,$model){var $ctrl;return $ctrl=$el.controller(),$scope.$watch($attrs.ngModel,function(element){return $scope.color=element.color}),$el.on("click",".current-color",function(event){var body,target;return event.preventDefault(),event.stopPropagation(),target=angular.element(event.currentTarget),$el.find(".select-color").hide(),target.siblings(".select-color").show(),body=angular.element("body"),body.on("click",function(_this){return function(event){return 0===angular.element(event.target).parent(".select-color").length?($el.find(".select-color").hide(),body.unbind("click")):void 0}}(this))}),$el.on("click",".select-color .color",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),$scope.$apply(function(){return $model.$modelValue.color=target.data("color")}),$el.find(".select-color").hide()}),$el.on("click",".select-color .selected-color",function(event){return event.preventDefault(),$scope.$apply(function(){return $model.$modelValue.color=$scope.color}),$el.find(".select-color").hide()}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,require:"ngModel"}},module.directive("tgColorSelection",ColorSelectionDirective),TEXT_TYPE="text",MULTILINE_TYPE="multiline",DATE_TYPE="date",TYPE_CHOICES=[{key:TEXT_TYPE,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT"},{key:MULTILINE_TYPE,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI"},{key:DATE_TYPE,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE"}],ProjectCustomAttributesController=function(superClass){function ProjectCustomAttributesController(scope,rootscope,repo,rs,params,q,location,navUrls,appMetaService,translate){this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.appMetaService=appMetaService,this.translate=translate,this.moveCustomAttributes=bind(this.moveCustomAttributes,this),this.deleteCustomAttribute=bind(this.deleteCustomAttribute,this),this.saveCustomAttribute=bind(this.saveCustomAttribute,this),this.createCustomAttribute=bind(this.createCustomAttribute,this),this.loadCustomAttributes=bind(this.loadCustomAttributes,this),this.scope.TYPE_CHOICES=TYPE_CHOICES,this.scope.project={},this.rootscope.$on("project:loaded",function(_this){return function(){var description,sectionName,title;return _this.loadCustomAttributes(),sectionName=_this.translate.instant(_this.scope.sectionName),title=_this.translate.instant("ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE",{sectionName:sectionName,projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this))}return extend(ProjectCustomAttributesController,superClass),ProjectCustomAttributesController.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],ProjectCustomAttributesController.prototype.loadCustomAttributes=function(){return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then(function(_this){return function(customAttributes){return _this.scope.customAttributes=customAttributes,_this.scope.maxOrder=_.max(customAttributes,"order").order,customAttributes}}(this))},ProjectCustomAttributesController.prototype.createCustomAttribute=function(attrValues){return this.repo.create("custom-attributes/"+this.scope.type,attrValues)},ProjectCustomAttributesController.prototype.saveCustomAttribute=function(attrModel){return this.repo.save(attrModel)},ProjectCustomAttributesController.prototype.deleteCustomAttribute=function(attrModel){return this.repo.remove(attrModel)},ProjectCustomAttributesController.prototype.moveCustomAttributes=function(attrModel,newIndex){var customAttributes,r;return customAttributes=this.scope.customAttributes,r=customAttributes.indexOf(attrModel),customAttributes.splice(r,1),customAttributes.splice(newIndex,0,attrModel),_.each(customAttributes,function(val,idx){return val.order=idx}),this.repo.saveAll(customAttributes)},ProjectCustomAttributesController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("ProjectCustomAttributesController",ProjectCustomAttributesController),ProjectCustomAttributesDirective=function($log,$confirm,animationFrame,$translate){var link;return link=function($scope,$el,$attrs){var $ctrl,cancelCreate,cancelUpdate,create,deleteCustomAttribute,hideAddButton,hideCancelButton,hideCreateForm,hideEditForm,resetNewAttr,revertChangesInCustomAttribute,showAddButton,showCancelButton,showCreateForm,showEditForm,sortableEl,update;return $ctrl=$el.controller(),$scope.$on("$destroy",function(){return $el.off()}),sortableEl=$el.find(".js-sortable"),sortableEl.sortable({handle:".js-view-custom-field",dropOnEmpty:!0,revert:400,axis:"y"}),sortableEl.on("sortstop",function(event,ui){var itemAttr,itemEl,itemIndex;return itemEl=ui.item,itemAttr=itemEl.scope().attr,itemIndex=itemEl.index(),$ctrl.moveCustomAttributes(itemAttr,itemIndex)}),showCreateForm=function(){return $el.find(".js-new-custom-field").removeClass("hidden"),$el.find(".js-new-custom-field input:visible").first().focus()},hideCreateForm=function(){return $el.find(".js-new-custom-field").addClass("hidden")},showAddButton=function(){return $el.find(".js-add-custom-field-button").removeClass("hidden")},hideAddButton=function(){return $el.find(".js-add-custom-field-button").addClass("hidden")},showCancelButton=function(){return $el.find(".js-cancel-new-custom-field-button").removeClass("hidden")},hideCancelButton=function(){return $el.find(".js-cancel-new-custom-field-button").addClass("hidden")},resetNewAttr=function(){return $scope.newAttr={}},create=function(formEl){var attr,form,onError,onSucces;return form=formEl.checksley(),form.validate()?(onSucces=function(_this){return function(){return $ctrl.loadCustomAttributes(),hideCreateForm(),resetNewAttr(),$confirm.notify("success")}}(this),onError=function(_this){return function(data){return form.setErrors(data)}}(this),attr=$scope.newAttr,attr.project=$scope.projectId,attr.order=$scope.maxOrder?$scope.maxOrder+1:1,$ctrl.createCustomAttribute(attr).then(onSucces,onError)):void 0},cancelCreate=function(){return hideCreateForm(),resetNewAttr()},$scope.$watch("customAttributes",function(customAttributes){return customAttributes?0===customAttributes.length?(hideCancelButton(),hideAddButton(),showCreateForm()):(hideCreateForm(),showAddButton(),showCancelButton()):void 0}),$el.on("click",".js-add-custom-field-button",function(event){return event.preventDefault(),showCreateForm()}),$el.on("click",".js-create-custom-field-button",debounce(2e3,function(event){var formEl,target;return event.preventDefault(),target=angular.element(event.currentTarget),formEl=target.closest("form"),create(formEl)})),$el.on("click",".js-cancel-new-custom-field-button",function(event){return event.preventDefault(),cancelCreate()}),$el.on("keyup",".js-new-custom-field input",function(event){var formEl,target;return 13===event.keyCode?(target=angular.element(event.currentTarget),formEl=target.closest("form"),create(formEl)):27===event.keyCode?cancelCreate():void 0}),showEditForm=function(formEl){return formEl.find(".js-view-custom-field").addClass("hidden"),formEl.find(".js-edit-custom-field").removeClass("hidden"),formEl.find(".js-edit-custom-field input:visible").first().focus().select()},hideEditForm=function(formEl){return formEl.find(".js-edit-custom-field").addClass("hidden"),formEl.find(".js-view-custom-field").removeClass("hidden")},revertChangesInCustomAttribute=function(formEl){return $scope.$apply(function(){return formEl.scope().attr.revert()})},update=function(formEl){var attr,form,onError,onSucces;return form=formEl.checksley(),form.validate()?(onSucces=function(_this){return function(){return $ctrl.loadCustomAttributes(),hideEditForm(formEl),$confirm.notify("success")}}(this),onError=function(_this){return function(data){return form.setErrors(data)}}(this),attr=formEl.scope().attr,$ctrl.saveCustomAttribute(attr).then(onSucces,onError)):void 0},cancelUpdate=function(formEl){return hideEditForm(formEl),revertChangesInCustomAttribute(formEl)},$el.on("click",".js-edit-custom-field-button",function(event){var formEl,target;return event.preventDefault(),target=angular.element(event.currentTarget),formEl=target.closest("form"),showEditForm(formEl)}),$el.on("click",".js-update-custom-field-button",debounce(2e3,function(event){var formEl,target;return event.preventDefault(),target=angular.element(event.currentTarget),formEl=target.closest("form"),update(formEl)})),$el.on("click",".js-cancel-edit-custom-field-button",function(event){var formEl,target;return event.preventDefault(),target=angular.element(event.currentTarget),formEl=target.closest("form"),cancelUpdate(formEl)}),$el.on("keyup",".js-edit-custom-field input",function(event){var formEl,target;return 13===event.keyCode?(target=angular.element(event.currentTarget),formEl=target.closest("form"),update(formEl)):27===event.keyCode?(target=angular.element(event.currentTarget),formEl=target.closest("form"),cancelUpdate(formEl)):void 0}),deleteCustomAttribute=function(formEl){var attr,message,text,title;return attr=formEl.scope().attr,message=attr.name,title=$translate.instant("COMMON.CUSTOM_ATTRIBUTES.DELETE"),text=$translate.instant("COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE"),$confirm.ask(title,text,message).then(function(response){var onError,onSucces;return onSucces=function(){return $ctrl.loadCustomAttributes()["finally"](function(){return response.finish()})},onError=function(){return $confirm.notify("error",null,"We have not been able to delete '"+message+"'.")},$ctrl.deleteCustomAttribute(attr).then(onSucces,onError)})},$el.on("click",".js-delete-custom-field-button",debounce(2e3,function(event){var formEl,target;return event.preventDefault(),target=angular.element(event.currentTarget),formEl=target.closest("form"),deleteCustomAttribute(formEl)}))},{link:link}},module.directive("tgProjectCustomAttributes",["$log","$tgConfirm","animationFrame","$translate",ProjectCustomAttributesDirective])}.call(this),function(){var EditRoleDirective,NewRoleDirective,RolePermissionsDirective,RolesController,RolesDirective,bindMethods,bindOnce,debounce,mixOf,module,taiga,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};taiga=this.taiga,mixOf=this.taiga.mixOf,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,bindMethods=this.taiga.bindMethods,module=angular.module("taigaAdmin"),RolesController=function(superClass){function RolesController(scope,rootscope,repo,confirm,rs,params,q,location,navUrls,appMetaService,translate){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.appMetaService=appMetaService,this.translate=translate,this._disableComputable=bind(this._disableComputable,this),this._enableComputable=bind(this._enableComputable,this),bindMethods(this),this.scope.sectionName="ADMIN.MENU.PERMISSIONS",this.scope.project={},this.scope.anyComputableRole=!0,promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("ADMIN.ROLES.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(RolesController,superClass),RolesController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],RolesController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.i_am_owner||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.anyComputableRole=_.some(_.map(project.roles,function(point){return point.computable})),project}}(this))},RolesController.prototype.loadRoles=function(){return this.rs.roles.list(this.scope.projectId).then(function(_this){return function(roles){var public_permission;return roles=roles.map(function(role){return role.external_user=!1,role}),public_permission={name:_this.translate.instant("ADMIN.ROLES.EXTERNAL_USER"),permissions:_this.scope.project.public_permissions,external_user:!0},roles.push(public_permission),_this.scope.roles=roles,_this.scope.role=_this.scope.roles[0],roles}}(this))},RolesController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(){return _this.loadRoles()}}(this)),promise},RolesController.prototype.setRole=function(role){return this.scope.role=role,this.scope.$broadcast("role:changed",this.scope.role)},RolesController.prototype["delete"]=function(){var choices,i,len,ref,replacement,role,subtitle,title,warning;for(choices={},ref=this.scope.roles,i=0,len=ref.length;len>i;i++)role=ref[i],role.id!==this.scope.role.id&&(choices[role.id]=role.name);return 0===_.keys(choices).length?this.confirm.error(this.translate.instant("ADMIN.ROLES.ERROR_DELETE_ALL")):(title=this.translate.instant("ADMIN.ROLES.TITLE_DELETE_ROLE"),subtitle=this.scope.role.name,replacement=this.translate.instant("ADMIN.ROLES.REPLACEMENT_ROLE"),warning=this.translate.instant("ADMIN.ROLES.WARNING_DELETE_ROLE"),this.confirm.askChoice(title,subtitle,choices,replacement,warning).then(function(_this){return function(response){var onError,onSuccess;return onSuccess=function(){return _this.loadProject(),_this.loadRoles()["finally"](function(){return response.finish()})},onError=function(){return _this.confirm.notify("error")},_this.repo.remove(_this.scope.role,{moveTo:response.selected}).then(onSuccess,onError)}}(this)))},RolesController.prototype._enableComputable=function(){var onError,onSuccess;return onSuccess=function(_this){return function(){return _this.confirm.notify("success"),_this.loadProject()}}(this),onError=function(_this){return function(){return _this.confirm.notify("error"),_this.scope.role.revert()}}(this),this.repo.save(this.scope.role).then(onSuccess,onError)},RolesController.prototype._disableComputable=function(){var askOnError,askOnSuccess,message,subtitle,title;return askOnSuccess=function(_this){return function(response){var onError,onSuccess;return onSuccess=function(){return response.finish(),_this.confirm.notify("success"),_this.loadProject()},onError=function(){return response.finish(),_this.confirm.notify("error"),_this.scope.role.revert()},_this.repo.save(_this.scope.role).then(onSuccess,onError)}}(this),askOnError=function(_this){return function(response){return _this.scope.role.revert()}}(this),title=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE"),subtitle=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE",{roleName:this.scope.role.name}),message=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_MESSAGE"),this.confirm.ask(title,subtitle,message).then(askOnSuccess,askOnError)},RolesController.prototype.toggleComputable=debounce(2e3,function(){return this.scope.role.computable?this._enableComputable():this._disableComputable()}),RolesController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("RolesController",RolesController),EditRoleDirective=function($repo,$confirm){var link;return link=function($scope,$el,$attrs){var submit,toggleView;return toggleView=function(){return $el.find(".total").toggle(),$el.find(".edit-role").toggle()},submit=function(){var promise;return $scope.role.name=$el.find("input").val(),promise=$repo.save($scope.role),promise.then(function(){return $confirm.notify("success")}),promise.then(null,function(data){return $confirm.notify("error")}),toggleView()},$el.on("click","a.icon-edit",function(){return toggleView(),$el.find("input").focus(),$el.find("input").val($scope.role.name)}),$el.on("click","a.save",submit),$el.on("keyup","input",function(event){return 13===event.keyCode?submit():27===event.keyCode?toggleView():void 0}),$scope.$on("role:changed",function(){return $el.find(".edit-role").is(":visible")?toggleView():void 0}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgEditRole",["$tgRepo","$tgConfirm",EditRoleDirective]),RolesDirective=function(){var link;return link=function($scope,$el,$attrs){var $ctrl;return $ctrl=$el.controller(),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgRoles",RolesDirective),NewRoleDirective=function($tgrepo,$confirm){
var DEFAULT_PERMISSIONS,link;return DEFAULT_PERMISSIONS=["view_project","view_milestones","view_us","view_tasks","view_issues"],link=function($scope,$el,$attrs){var $ctrl;return $ctrl=$el.controller(),$scope.$on("$destroy",function(){return $el.off()}),$el.on("click","a.add-button",function(event){return event.preventDefault(),$el.find(".new").removeClass("hidden"),$el.find(".new").focus(),$el.find(".add-button").hide()}),$el.on("keyup",".new",function(event){var newRole,onError,onSuccess,target;return event.preventDefault(),13===event.keyCode?(target=angular.element(event.currentTarget),newRole={project:$scope.projectId,name:target.val(),permissions:DEFAULT_PERMISSIONS,order:_.max($scope.roles,function(r){return r.order}).order+1,computable:!1},$el.find(".new").addClass("hidden"),$el.find(".new").val(""),onSuccess=function(role){var insertPosition;return insertPosition=$scope.roles.length-1,$scope.roles.splice(insertPosition,0,role),$ctrl.setRole(role),$el.find(".add-button").show(),$ctrl.loadProject()},onError=function(){return $confirm.notify("error")},$tgrepo.create("roles",newRole).then(onSuccess,onError)):27===event.keyCode?(target=angular.element(event.currentTarget),$el.find(".new").addClass("hidden"),$el.find(".new").val(""),$el.find(".add-button").show()):void 0})},{link:link}},module.directive("tgNewRole",["$tgRepo","$tgConfirm",NewRoleDirective]),RolePermissionsDirective=function($rootscope,$repo,$confirm,$compile){var baseTemplate,categoryTemplate,link,resumeTemplate;return resumeTemplate=_.template('<div class="resume-title" translate="<%- category.name %>"></div>\n<div class="summary-role">\n    <div class="count"><%- category.activePermissions %>/<%- category.permissions.length %></div>\n    <% _.each(category.permissions, function(permission) { %>\n        <div class="role-summary-single <% if(permission.active) { %>active<% } %>"\n             title="{{ \'<%- permission.name %>\' | translate }}"></div>\n    <% }) %>\n</div>\n<div class="icon icon-arrow-bottom"></div>'),categoryTemplate=_.template('<div class="category-config" data-id="<%- index %>">\n    <div class="resume">\n    </div>\n    <div class="category-items">\n        <div class="items-container">\n        <% _.each(category.permissions, function(permission) { %>\n            <div class="category-item" data-id="<%- permission.key %>">\n                <span translate="<%- permission.name %>"></span>\n                <div class="check">\n                    <input type="checkbox"\n                           <% if(!permission.editable) { %> disabled="disabled" <% } %>\n                           <% if(permission.active) { %> checked="checked" <% } %>/>\n                    <div></div>\n                    <span class="check-text check-yes" translate="COMMON.YES"></span>\n                    <span class="check-text check-no" translate="COMMON.NO"></span>\n                </div>\n            </div>\n        <% }) %>\n        </div>\n    </div>\n</div>'),baseTemplate=_.template('<div class="category-config-list"></div>'),link=function($scope,$el,$attrs){var $ctrl,generateCategoriesFromRole,renderCategory,renderPermissions,renderResume;return $ctrl=$el.controller(),generateCategoriesFromRole=function(role){var categories,isPermissionEditable,issuePermissions,milestonePermissions,setActivePermissions,setActivePermissionsPerCategory,taskPermissions,userStoryPermissions,wikiPermissions;return setActivePermissions=function(permissions){return _.map(permissions,function(x){var ref;return _.extend({},x,{active:(ref=x.key,indexOf.call(role.permissions,ref)>=0)})})},isPermissionEditable=function(permission,role,project){return role.external_user&&!project.is_private&&0===permission.key.indexOf("view_")?!1:!0},setActivePermissionsPerCategory=function(category){return _.map(category,function(cat){return cat.permissions=cat.permissions.map(function(permission){return permission.editable=isPermissionEditable(permission,role,$scope.project),permission}),_.extend({},cat,{activePermissions:_.filter(cat.permissions,"active").length})})},categories=[],milestonePermissions=[{key:"view_milestones",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS"},{key:"add_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS"},{key:"modify_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS"},{key:"delete_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS"}],categories.push({name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME",permissions:setActivePermissions(milestonePermissions)}),userStoryPermissions=[{key:"view_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES"},{key:"add_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES"},{key:"modify_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES"},{key:"delete_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES"}],categories.push({name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME",permissions:setActivePermissions(userStoryPermissions)}),taskPermissions=[{key:"view_tasks",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS"},{key:"add_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS"},{key:"modify_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS"},{key:"delete_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS"}],categories.push({name:"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME",permissions:setActivePermissions(taskPermissions)}),issuePermissions=[{key:"view_issues",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES"},{key:"add_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES"},{key:"modify_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES"},{key:"delete_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES"}],categories.push({name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME",permissions:setActivePermissions(issuePermissions)}),wikiPermissions=[{key:"view_wiki_pages",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES"},{key:"add_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES"},{key:"modify_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES"},{key:"delete_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES"},{key:"view_wiki_links",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS"},{key:"add_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS"},{key:"delete_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS"}],categories.push({name:"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME",permissions:setActivePermissions(wikiPermissions)}),setActivePermissionsPerCategory(categories)},renderResume=function(element,category){return element.find(".resume").html($compile(resumeTemplate({category:category}))($scope))},renderCategory=function(category,index){var html;return html=categoryTemplate({category:category,index:index}),html=angular.element(html),renderResume(html,category),$compile(html)($scope)},renderPermissions=function(){var html;return $el.off(),html=baseTemplate(),_.each(generateCategoriesFromRole($scope.role),function(category,index){return html=angular.element(html).append(renderCategory(category,index))}),$el.html(html),$el.on("click",".resume",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),target.next().toggleClass("open")}),$el.on("change",".category-item input",function(event){var getActivePermissions,onError,onSuccess,target;return getActivePermissions=function(){var activePermissions;return activePermissions=_.filter($el.find(".category-item input"),function(t){return angular.element(t).is(":checked")}),activePermissions=_.sortBy(_.map(activePermissions,function(t){var permission;return permission=angular.element(t).parents(".category-item").data("id")})),activePermissions.length&&activePermissions.push("view_project"),activePermissions},target=angular.element(event.currentTarget),$scope.role.permissions=getActivePermissions(),onSuccess=function(){var categories,categoryId;return categories=generateCategoriesFromRole($scope.role),categoryId=target.parents(".category-config").data("id"),renderResume(target.parents(".category-config"),categories[categoryId]),$rootscope.$broadcast("projects:reload"),$confirm.notify("success"),$ctrl.loadProject()},onError=function(){return $confirm.notify("error"),target.prop("checked",!target.prop("checked")),$scope.role.permissions=getActivePermissions()},$scope.role.external_user?($scope.project.public_permissions=$scope.role.permissions,$scope.project.anon_permissions=$scope.role.permissions.filter(function(permission){return 0===permission.indexOf("view_")}),$repo.save($scope.project).then(onSuccess,onError)):$repo.save($scope.role).then(onSuccess,onError)})},$scope.$on("$destroy",function(){return $el.off()}),$scope.$on("role:changed",function(){return renderPermissions()}),bindOnce($scope,$attrs.ngModel,renderPermissions)},{link:link}},module.directive("tgRolePermissions",["$rootScope","$tgRepo","$tgConfirm","$compile",RolePermissionsDirective])}.call(this),function(){var BitbucketController,BitbucketWebhooksDirective,GithubController,GithubWebhooksDirective,GitlabController,GitlabWebhooksDirective,NewWebhookDirective,SelectInputText,ValidOriginIpsDirective,WebhookDirective,WebhooksController,bindMethods,debounce,mixOf,module,taiga,timeout,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,bindMethods=this.taiga.bindMethods,debounce=this.taiga.debounce,timeout=this.taiga.timeout,module=angular.module("taigaAdmin"),WebhooksController=function(superClass){function WebhooksController(scope,repo,rs,params,location,navUrls,appMetaService,translate){var promise;this.scope=scope,this.repo=repo,this.rs=rs,this.params=params,this.location=location,this.navUrls=navUrls,this.appMetaService=appMetaService,this.translate=translate,bindMethods(this),this.scope.sectionName="ADMIN.WEBHOOKS.SECTION_NAME",this.scope.project={},promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("ADMIN.WEBHOOKS.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this)),this.scope.$on("webhooks:reload",this.loadWebhooks)}return extend(WebhooksController,superClass),WebhooksController.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],WebhooksController.prototype.loadWebhooks=function(){return this.rs.webhooks.list(this.scope.projectId).then(function(_this){return function(webhooks){return _this.scope.webhooks=webhooks}}(this))},WebhooksController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return project.i_am_owner||_this.location.path(_this.navUrls.resolve("permission-denied")),_this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),project}}(this))},WebhooksController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(){return _this.loadWebhooks()}}(this)),promise},WebhooksController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("WebhooksController",WebhooksController),WebhookDirective=function($rs,$repo,$confirm,$loading,$translate){var link;return link=function($scope,$el,$attrs){var cancel,openHistory,save,showEditMode,showVisualizationMode,updateLogs,updateShowHideHistoryText,webhook;return webhook=$scope.$eval($attrs.tgWebhook),updateLogs=function(){var prettyDate;return prettyDate=$translate.instant("ADMIN.WEBHOOKS.DATE"),$rs.webhooklogs.list(webhook.id).then(function(_this){return function(webhooklogs){var i,len,log,ref;for(i=0,len=webhooklogs.length;len>i;i++)log=webhooklogs[i],log.validStatus=200<=(ref=log.status)&&300>ref,log.prettySentHeaders=_.map(_.pairs(log.request_headers),function(arg){var header,value;return header=arg[0],value=arg[1],header+": "+value}).join("\n"),log.prettySentData=JSON.stringify(log.request_data),log.prettyDate=moment(log.created).format(prettyDate);return webhook.logs_counter=webhooklogs.length,webhook.logs=webhooklogs,updateShowHideHistoryText()}}(this))},updateShowHideHistoryText=function(){var historyElement,text,textElement,title;return textElement=$el.find(".toggle-history"),historyElement=textElement.parents(".single-webhook-wrapper").find(".webhooks-history"),historyElement.hasClass("open")?(text=$translate.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY"),title=$translate.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE")):(text=$translate.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY"),title=$translate.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE")),textElement.text(text),textElement.prop("title",title)},showVisualizationMode=function(){return $el.find(".edition-mode").addClass("hidden"),$el.find(".visualization-mode").removeClass("hidden")},showEditMode=function(){return $el.find(".visualization-mode").addClass("hidden"),$el.find(".edition-mode").removeClass("hidden")},openHistory=function(){return $el.find(".webhooks-history").addClass("open")},cancel=function(){return showVisualizationMode(),$scope.$apply(function(){return webhook.revert()})},save=debounce(2e3,function(target){var form,promise;return form=target.parents("form").checksley(),form.validate()?(promise=$repo.save(webhook),promise.then(function(_this){return function(){return showVisualizationMode()}}(this)),promise.then(null,function(data){return $confirm.notify("error"),form.setErrors(data)})):void 0}),$el.on("click",".test-webhook",function(){return openHistory(),$rs.webhooks.test(webhook.id).then(function(_this){return function(){return updateLogs()}}(this))}),$el.on("click",".edit-webhook",function(){return showEditMode()}),$el.on("click",".cancel-existing",function(){return cancel()}),$el.on("click",".edit-existing",function(event){var target;return event.preventDefault(),target=angular.element(event.currentTarget),save(target)}),$el.on("keyup",".edition-mode input",function(event){var target;return 13===event.keyCode?(target=angular.element(event.currentTarget),save(target)):27===event.keyCode?(target=angular.element(event.currentTarget),cancel(target)):void 0}),$el.on("click",".delete-webhook",function(){var message,title;return title=$translate.instant("ADMIN.WEBHOOKS.DELETE"),message=$translate.instant("ADMIN.WEBHOOKS.WEBHOOK_NAME",{name:webhook.name}),$confirm.askOnDelete(title,message).then(function(_this){return function(askResponse){var onError,onSucces;return onSucces=function(){return askResponse.finish(),$scope.$emit("webhooks:reload")},onError=function(){return askResponse.finish(!1),$confirm.notify("error")},$repo.remove(webhook).then(onSucces,onError)}}(this))}),$el.on("click",".toggle-history",function(event){var target;return target=angular.element(event.currentTarget),null==webhook.logs||0===webhook.logs.length?updateLogs().then(function(){return timeout(0,function(){return $el.find(".webhooks-history").toggleClass("open"),updateShowHideHistoryText()})}):($el.find(".webhooks-history").toggleClass("open"),$scope.$apply(function(){return updateShowHideHistoryText()}))}),$el.on("click",".history-single",function(event){var target;return target=angular.element(event.currentTarget),target.toggleClass("history-single-open"),target.siblings(".history-single-response").toggleClass("open")}),$el.on("click",".resend-request",function(event){var log,target;return target=angular.element(event.currentTarget),log=target.data("log"),$rs.webhooklogs.resend(log).then(function(_this){return function(){return updateLogs()}}(this))})},{link:link}},module.directive("tgWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$translate",WebhookDirective]),NewWebhookDirective=function($rs,$repo,$confirm,$loading){var link;return link=function($scope,$el,$attrs){var addWebhookDOMNode,formDOMNode,initializeNewValue,save,webhook;return webhook=$scope.$eval($attrs.tgWebhook),formDOMNode=$el.find(".new-webhook-form"),addWebhookDOMNode=$el.find(".add-webhook"),initializeNewValue=function(){return $scope.newValue={name:"",url:"",key:""}},initializeNewValue(),$scope.$watch("webhooks",function(webhooks){return null!=webhooks?0===webhooks.length?(formDOMNode.removeClass("hidden"),addWebhookDOMNode.addClass("hidden"),formDOMNode.find("input")[0].focus()):(formDOMNode.addClass("hidden"),addWebhookDOMNode.removeClass("hidden")):void 0}),save=debounce(2e3,function(){var form,promise;return form=formDOMNode.checksley(),form.validate()?($scope.newValue.project=$scope.project.id,promise=$repo.create("webhooks",$scope.newValue),promise.then(function(_this){return function(){return $scope.$emit("webhooks:reload"),initializeNewValue()}}(this)),promise.then(null,function(data){return $confirm.notify("error"),form.setErrors(data)})):void 0}),formDOMNode.on("click",".add-new",function(event){return event.preventDefault(),save()}),formDOMNode.on("keyup","input",function(event){return 13===event.keyCode?save():void 0}),formDOMNode.on("click",".cancel-new",function(event){return $scope.$apply(function(){return initializeNewValue()})}),addWebhookDOMNode.on("click",function(event){return formDOMNode.removeClass("hidden"),formDOMNode.find("input")[0].focus()})},{link:link}},module.directive("tgNewWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading",NewWebhookDirective]),GithubController=function(superClass){function GithubController(scope,repo,rs,params,appMetaService,translate){var promise;this.scope=scope,this.repo=repo,this.rs=rs,this.params=params,this.appMetaService=appMetaService,this.translate=translate,bindMethods(this),this.scope.sectionName=this.translate.instant("ADMIN.GITHUB.SECTION_NAME"),this.scope.project={},promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("ADMIN.GITHUB.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this))}return extend(GithubController,superClass),GithubController.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate"],GithubController.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"github").then(function(_this){return function(github){return _this.scope.github=github}}(this))},GithubController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),project}}(this))},GithubController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(){return _this.loadModules()}}(this)),promise},GithubController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("GithubController",GithubController),GitlabController=function(superClass){function GitlabController(scope,repo,rs,params,appMetaService,translate){var promise;this.scope=scope,this.repo=repo,this.rs=rs,this.params=params,this.appMetaService=appMetaService,this.translate=translate,bindMethods(this),this.scope.sectionName=this.translate.instant("ADMIN.GITLAB.SECTION_NAME"),this.scope.project={},promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("ADMIN.GITLAB.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",function(_this){return function(){return _this.loadModules()}}(this))}return extend(GitlabController,superClass),GitlabController.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate"],GitlabController.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gitlab").then(function(_this){return function(gitlab){return _this.scope.gitlab=gitlab}}(this))},GitlabController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),project}}(this))},GitlabController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(){return _this.loadModules()}}(this)),promise},GitlabController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("GitlabController",GitlabController),BitbucketController=function(superClass){function BitbucketController(scope,repo,rs,params,appMetaService,translate){var promise;this.scope=scope,this.repo=repo,this.rs=rs,this.params=params,this.appMetaService=appMetaService,this.translate=translate,bindMethods(this),this.scope.sectionName=this.translate.instant("ADMIN.BITBUCKET.SECTION_NAME"),this.scope.project={},promise=this.loadInitialData(),promise.then(function(_this){return function(){var description,title;return title=_this.translate.instant("ADMIN.BITBUCKET.PAGE_TITLE",{projectName:_this.scope.project.name}),description=_this.scope.project.description,_this.appMetaService.setAll(title,description)}}(this)),promise.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",function(_this){return function(){return _this.loadModules()}}(this))}return extend(BitbucketController,superClass),BitbucketController.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate"],BitbucketController.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"bitbucket").then(function(_this){return function(bitbucket){return _this.scope.bitbucket=bitbucket}}(this))},BitbucketController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),project}}(this))},BitbucketController.prototype.loadInitialData=function(){var promise;return promise=this.loadProject(),promise.then(function(_this){return function(){return _this.loadModules()}}(this)),promise},BitbucketController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),module.controller("BitbucketController",BitbucketController),SelectInputText=function(){var link;return link=function($scope,$el,$attrs){return $el.on("click",".select-input-content",function(){return $el.find("input").select(),$el.find(".help-copy").addClass("visible")})},{link:link}},module.directive("tgSelectInputText",SelectInputText),GithubWebhooksDirective=function($repo,$confirm,$loading){var link;return link=function($scope,$el,$attrs){var form,submit,submitButton;return form=$el.find("form").checksley({onlyOneErrorElement:!0}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.saveAttribute($scope.github,"github"),promise.then(function(){return currentLoading.finish(),$confirm.notify("success")}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit)},{link:link}},module.directive("tgGithubWebhooks",["$tgRepo","$tgConfirm","$tgLoading",GithubWebhooksDirective]),GitlabWebhooksDirective=function($repo,$confirm,$loading){var link;return link=function($scope,$el,$attrs){var form,submit,submitButton;return form=$el.find("form").checksley({onlyOneErrorElement:!0}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.saveAttribute($scope.gitlab,"gitlab"),promise.then(function(){return currentLoading.finish(),$confirm.notify("success"),$scope.$emit("project:modules:reload")}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit)},{link:link}},module.directive("tgGitlabWebhooks",["$tgRepo","$tgConfirm","$tgLoading",GitlabWebhooksDirective]),BitbucketWebhooksDirective=function($repo,$confirm,$loading){var link;return link=function($scope,$el,$attrs){var form,submit,submitButton;return form=$el.find("form").checksley({onlyOneErrorElement:!0}),submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.saveAttribute($scope.bitbucket,"bitbucket"),promise.then(function(){return currentLoading.finish(),$confirm.notify("success"),$scope.$emit("project:modules:reload")}),promise.then(null,function(data){return currentLoading.finish(),form.setErrors(data),data._error_message?$confirm.notify("error",data._error_message):void 0})):void 0}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit)},{link:link}},module.directive("tgBitbucketWebhooks",["$tgRepo","$tgConfirm","$tgLoading",BitbucketWebhooksDirective]),ValidOriginIpsDirective=function(){var link;return link=function($scope,$el,$attrs,$ngModel){return $ngModel.$parsers.push(function(value){return value=$.trim(value),""===value?[]:value.split(",")})},{link:link,restrict:"EA",require:"ngModel"}},module.directive("tgValidOriginIps",ValidOriginIpsDirective)}.call(this),function(){var CreateProject,DeleteProjectDirective,bindOnce,debounce,module,taiga,timeout;taiga=this.taiga,bindOnce=this.taiga.bindOnce,timeout=this.taiga.timeout,debounce=this.taiga.debounce,module=angular.module("taigaProject"),CreateProject=function($rootscope,$repo,$confirm,$location,$navurls,$rs,$projectUrl,$loading,lightboxService,$cacheFactory,$translate,currentUserService){var directive,link;return link=function($scope,$el,attrs){var currentLoading,form,onErrorSubmit,onSuccessSubmit,openLightbox,submit,submitButton;return $scope.data={},$scope.templates=[],currentLoading=null,form=$el.find("form").checksley({onlyOneErrorElement:!0}),onSuccessSubmit=function(response){return $cacheFactory.get("$http").removeAll(),currentLoading.finish(),$rootscope.$broadcast("projects:reload"),$confirm.notify("success",$translate.instant("COMMON.SAVE")),$location.url($projectUrl.get(response)),lightboxService.close($el),currentUserService.loadProjects()},onErrorSubmit=function(response){var error_field,error_step,i,len,ref,selectors;for(currentLoading.finish(),form.setErrors(response),selectors=[],ref=_.keys(response),i=0,len=ref.length;len>i;i++)error_field=ref[i],selectors.push("[name="+error_field+"]");return $el.find(".active").removeClass("active"),error_step=$el.find(selectors.join(",")).first().parents(".wizard-step"),error_step.addClass("active"),$el.find(".progress-bar").removeClass().addClass("progress-bar").addClass(error_step.data("step"))},submit=function(_this){return function(event){var promise;return event.preventDefault(),form.validate()?(currentLoading=$loading().target(submitButton).start(),promise=$repo.create("projects",$scope.data),promise.then(onSuccessSubmit,onErrorSubmit)):void 0}}(this),openLightbox=function(){return $scope.data={},$scope.templates.length?$scope.data.creation_template=_.head(_.filter($scope.templates,function(x){return"scrum"===x.slug})).id:$rs.projects.templates().then(function(_this){return function(result){return $scope.templates=result,$scope.data.creation_template=_.head(_.filter($scope.templates,function(x){return"scrum"===x.slug})).id}}(this)),$el.find(".active").removeClass("active"),$el.find(".create-step1").addClass("active"),lightboxService.open($el),timeout(600,function(){return $el.find(".progress-bar").addClass("step1")})},$el.on("click",".button-next",function(event){var current,field,i,len,next,ref,step,valid;for(event.preventDefault(),current=$el.find(".active"),valid=!0,ref=form.fields,i=0,len=ref.length;len>i;i++)field=ref[i],current.find("[name="+field.element.attr("name")+"]").length&&(valid=field.validate()!==!1&&valid);return valid?(next=current.next(),current.toggleClass("active"),next.toggleClass("active"),step=next.data("step"),$el.find(".progress-bar").removeClass().addClass("progress-bar").addClass(step)):void 0}),$el.on("click",".button-prev",function(event){var current,prev,step;return event.preventDefault(),current=$el.find(".active"),prev=current.prev(),current.toggleClass("active"),prev.toggleClass("active"),step=prev.data("step"),$el.find(".progress-bar").removeClass().addClass("progress-bar").addClass(step)}),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$el.on("click",".close",function(event){return event.preventDefault(),lightboxService.close($el)}),$scope.$on("$destroy",function(){return $el.off()}),openLightbox()},directive={link:link,templateUrl:"project/wizard-create-project.html",scope:{}}},module.directive("tgLbCreateProject",["$rootScope","$tgRepo","$tgConfirm","$location","$tgNavUrls","$tgResources","$projectUrl","$tgLoading","lightboxService","$cacheFactory","$translate","tgCurrentUserService",CreateProject]),DeleteProjectDirective=function($repo,$rootscope,$auth,$location,$navUrls,$confirm,lightboxService,tgLoader,currentUserService){var link;return link=function($scope,$el,$attrs){var projectToDelete,submit;return projectToDelete=null,$scope.$on("deletelightbox:new",function(ctx,project){return lightboxService.open($el),projectToDelete=project}),$scope.$on("$destroy",function(){return $el.off()}),submit=function(){var promise;return tgLoader.start(),lightboxService.close($el),promise=$repo.remove(projectToDelete),promise.then(function(data){return tgLoader.pageLoaded(),$rootscope.$broadcast("projects:reload"),$location.path($navUrls.resolve("home")),$confirm.notify("success"),currentUserService.loadProjects()}),promise.then(null,function(){return $confirm.notify("error"),lightboxService.close($el)})},$el.on("click",".button-red",function(event){return event.preventDefault(),lightboxService.close($el)}),$el.on("click",".button-green",function(event){return event.preventDefault(),submit()})},{link:link}},module.directive("tgLbDeleteProject",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","$tgConfirm","lightboxService","tgLoader","tgCurrentUserService",DeleteProjectDirective])}.call(this),function(){var BindHtmlDirective,BindOnceAltDirective,BindOnceBindDirective,BindOnceHrefDirective,BindOnceHtmlDirective,BindOnceRefDirective,BindOnceSrcDirective,BindOnceTitleDirective,BindTitleDirective,bindOnce,module;bindOnce=this.taiga.bindOnce,BindOnceBindDirective=function(){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.tgBoBind,function(val){return $el.text(val)})},{link:link}},BindOnceHtmlDirective=function(){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.tgBoHtml,function(val){return $el.html(val)})},{link:link}},BindOnceRefDirective=function(){var link;return link=function($scope,$el,$attrs){
return bindOnce($scope,$attrs.tgBoRef,function(val){return $el.html("#"+val+" ")})},{link:link}},BindOnceSrcDirective=function(){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.tgBoSrc,function(val){return $el.attr("src",val)})},{link:link}},BindOnceHrefDirective=function(){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.tgBoHref,function(val){return $el.attr("href",val)})},{link:link}},BindOnceAltDirective=function(){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.tgBoAlt,function(val){return $el.attr("alt",val)})},{link:link}},BindOnceTitleDirective=function(){var link;return link=function($scope,$el,$attrs){return bindOnce($scope,$attrs.tgBoTitle,function(val){return $el.attr("title",val)})},{link:link}},BindTitleDirective=function(){var link;return link=function($scope,$el,$attrs){return $scope.$watch($attrs.tgTitleHtml,function(val){return null!=val?$el.attr("title",val):void 0})},{link:link}},BindHtmlDirective=function(){var link;return link=function($scope,$el,$attrs){return $scope.$watch($attrs.tgBindHtml,function(val){return null!=val?$el.html(val):void 0})},{link:link}},module=angular.module("taigaBase"),module.directive("tgBoBind",BindOnceBindDirective),module.directive("tgBoHtml",BindOnceHtmlDirective),module.directive("tgBoRef",BindOnceRefDirective),module.directive("tgBoSrc",BindOnceSrcDirective),module.directive("tgBoHref",BindOnceHrefDirective),module.directive("tgBoAlt",BindOnceAltDirective),module.directive("tgBoTitle",BindOnceTitleDirective),module.directive("tgBindTitle",BindTitleDirective),module.directive("tgBindHtml",BindHtmlDirective)}.call(this),function(){var ConfigurationService,module;ConfigurationService=function(){function ConfigurationService(){this.config=window.taigaConfig}return ConfigurationService.prototype.get=function(key,defaultValue){return null==defaultValue&&(defaultValue=null),_.has(this.config,key)?this.config[key]:defaultValue},ConfigurationService}(),module=angular.module("taigaBase"),module.service("$tgConfig",ConfigurationService)}.call(this),function(){var ContribController,module,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;module=angular.module("taigaBase"),ContribController=function(superClass){function ContribController(rootScope,scope,params,repo,rs,confirm){var promise;this.rootScope=rootScope,this.scope=scope,this.params=params,this.repo=repo,this.rs=rs,this.confirm=confirm,this.scope.currentPlugin=_.first(_.where(this.rootScope.adminPlugins,{slug:this.params.plugin})),this.scope.projectSlug=this.params.pslug,promise=this.loadInitialData(),promise.then(null,function(_this){return function(){return _this.confirm.notify("error")}}(this))}return extend(ContribController,superClass),ContribController.$inject=["$rootScope","$scope","$routeParams","$tgRepo","$tgResources","$tgConfirm"],ContribController.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(_this){return function(project){return _this.scope.projectId=project.id,_this.scope.project=project,_this.scope.$emit("project:loaded",project),_this.scope.$broadcast("project:loaded",project),project}}(this))},ContribController.prototype.loadInitialData=function(){return this.loadProject()},ContribController}(taiga.Controller),module.controller("ContribController",ContribController)}.call(this),function(){var FiltersStorageService,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,FiltersStorageService=function(superClass){function FiltersStorageService(storage,params){this.storage=storage,this.params=params}return extend(FiltersStorageService,superClass),FiltersStorageService.$inject=["$tgStorage","$routeParams"],FiltersStorageService.prototype.generateHash=function(components){return null==components&&(components=[]),components=_.map(components,function(x){return JSON.stringify(x)}),hex_sha1(components.join(":"))},FiltersStorageService}(taiga.Service)}.call(this),function(){var HttpService,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,HttpService=function(superClass){function HttpService(http,q,storage,rootScope,cacheFactory,translate){this.http=http,this.q=q,this.storage=storage,this.rootScope=rootScope,this.cacheFactory=cacheFactory,this.translate=translate,HttpService.__super__.constructor.call(this),this.cache=this.cacheFactory("httpget")}return extend(HttpService,superClass),HttpService.$inject=["$http","$q","$tgStorage","$rootScope","$cacheFactory","$translate"],HttpService.prototype.headers=function(){var headers,lang,token;return headers={},token=this.storage.get("token"),token&&(headers.Authorization="Bearer "+token),lang=this.translate.preferredLanguage(),lang&&(headers["Accept-Language"]=lang),headers},HttpService.prototype.request=function(options){return options.headers=_.merge({},options.headers||{},this.headers()),this.http(options)},HttpService.prototype.get=function(url,params,options){return options=_.merge({method:"GET",url:url},options),params&&(options.params=params),options.cache=this.cache,this.request(options)["finally"](function(_this){return function(data){return _this.cache.removeAll()}}(this))},HttpService.prototype.post=function(url,data,params,options){return options=_.merge({method:"POST",url:url},options),data&&(options.data=data),params&&(options.params=params),this.request(options)},HttpService.prototype.put=function(url,data,params,options){return options=_.merge({method:"PUT",url:url},options),data&&(options.data=data),params&&(options.params=params),this.request(options)},HttpService.prototype.patch=function(url,data,params,options){return options=_.merge({method:"PATCH",url:url},options),data&&(options.data=data),params&&(options.params=params),this.request(options)},HttpService.prototype["delete"]=function(url,data,params,options){return options=_.merge({method:"DELETE",url:url},options),data&&(options.data=data),params&&(options.params=params),this.request(options)},HttpService}(taiga.Service),module=angular.module("taigaBase"),module.service("$tgHttp",HttpService)}.call(this),function(){var locationFactory,module;locationFactory=function($location,$route,$rootscope){return $location.noreload=function(scope){var lastRoute,un;return lastRoute=$route.current,un=scope.$on("$locationChangeSuccess",function(){return $route.current=lastRoute,un()}),$location},$location.isInCurrentRouteParams=function(name,value){var params;return params=$location.search()||{},params[name]===value},$location},module=angular.module("taigaBase"),module.factory("$tgLocation",["$location","$route","$rootScope",locationFactory])}.call(this),function(){var Model,ModelService,module,provider,taiga,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Model=function(){function Model(name,data,dataTypes){this._attrs=data,this._name=name,this._dataTypes=dataTypes,this.setAttrs(data),this.initialize()}return Model.prototype.clone=function(){var instance;return instance=new Model(this._name,this._attrs,this._dataTypes),instance._modifiedAttrs=this._modifiedAttrs,instance._isModified=this._isModified,instance},Model.prototype.applyCasts=function(){var attrName,castMethod,castName,ref,results;ref=this._dataTypes,results=[];for(attrName in ref)castName=ref[attrName],castMethod=service.casts[castName],castMethod&&results.push(this._attrs[attrName]=castMethod(this._attrs[attrName]));return results},Model.prototype.getIdAttrName=function(){return"id"},Model.prototype.getName=function(){return this._name},Model.prototype.getAttrs=function(patch){return null==patch&&(patch=!1),null!=this._attrs.version&&(this._modifiedAttrs.version=this._attrs.version),patch?_.extend({},this._modifiedAttrs):_.extend({},this._attrs,this._modifiedAttrs)},Model.prototype.setAttrs=function(attrs){return this._attrs=attrs,this._modifiedAttrs={},this.applyCasts(),this._isModified=!1},Model.prototype.setAttr=function(name,value){return this._modifiedAttrs[name]=value,this._isModified=!0},Model.prototype.initialize=function(){var getter,self,setter;return self=this,getter=function(name){return function(){return"string"==typeof name&&"__"===name.substr(0,2)?self[name]:indexOf.call(_.keys(self._modifiedAttrs),name)<0?self._attrs[name]:self._modifiedAttrs[name]}},setter=function(name){return function(value){return"string"==typeof name&&"__"===name.substr(0,2)?void(self[name]=value):void(self._attrs[name]!==value?(self._modifiedAttrs[name]=value,self._isModified=!0):delete self._modifiedAttrs[name])}},_.each(this._attrs,function(value,name){var options;return options={get:getter(name),set:setter(name),enumerable:!0,configurable:!0},Object.defineProperty(self,name,options)})},Model.prototype.serialize=function(){var data;return data={data:_.clone(this._attrs),name:this._name},JSON.stringify(data)},Model.prototype.isModified=function(){return this._isModified},Model.prototype.isAttributeModified=function(attribute){return null!=this._modifiedAttrs[attribute]},Model.prototype.markSaved=function(){return this._isModified=!1,this._attrs=this.getAttrs(),this._modifiedAttrs={}},Model.prototype.revert=function(){return this._modifiedAttrs={},this._isModified=!1},Model.desSerialize=function(sdata){var ddata,model;return ddata=JSON.parse(sdata),model=new Model(ddata.url,ddata.data)},Model}(),taiga=this.taiga,ModelService=function(superClass){function ModelService(q,urls,storage,http){this.q=q,this.urls=urls,this.storage=storage,this.http=http,ModelService.__super__.constructor.call(this)}return extend(ModelService,superClass),ModelService.$inject=["$q","$tgUrls","$tgStorage","$tgHttp"],ModelService}(taiga.Service),provider=function($q,$http,$gmUrls,$gmStorage){var service;return service={},service.make_model=function(name,data,cls,dataTypes){return null==cls&&(cls=Model),null==dataTypes&&(dataTypes={}),new cls(name,data,dataTypes)},service.cls=Model,service.casts={"int":function(value){return parseInt(value,10)},"float":function(value){return parseFloat(value,10)}},service},module=angular.module("taigaBase"),module.factory("$tgModel",["$q","$http","$tgUrls","$tgStorage",provider])}.call(this),function(){var NavigationUrlsDirective,NavigationUrlsService,bindOnce,module,taiga,trim,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,trim=this.taiga.trim,bindOnce=this.taiga.bindOnce,module=angular.module("taigaBase"),NavigationUrlsService=function(superClass){function NavigationUrlsService(){this.urls={}}return extend(NavigationUrlsService,superClass),NavigationUrlsService.prototype.update=function(urls){return this.urls=_.merge({},this.urls,urls||{})},NavigationUrlsService.prototype.formatUrl=function(url,ctx){var replacer;return null==ctx&&(ctx={}),replacer=function(match){return match=trim(match,":"),ctx[match]||"undefined"},url.replace(/(:\w+)/g,replacer)},NavigationUrlsService.prototype.resolve=function(name,ctx){var url;return url=this.urls[name],url?ctx?this.formatUrl(url,ctx):url:""},NavigationUrlsService}(taiga.Service),module.service("$tgNavUrls",NavigationUrlsService),NavigationUrlsDirective=function($navurls,$auth,$q,$location){var bindOnceP,link,parseNav;return bindOnceP=function($scope,attr){var defered;return defered=$q.defer(),bindOnce($scope,attr,function(v){return defered.resolve(v)}),defered.promise},parseNav=function(data,$scope){var index,name,obj,params,promises,ref,result,values;if(ref=_.map(data.split(":"),trim),name=ref[0],params=ref[1],params)for(result=params.split(/(\w+)=/),result=_.filter(result,function(str){return str.length}),result=_.map(result,function(str){return trim(str.replace(/,$/g,""))}),params=[],index=0;index<result.length;)obj={},obj[result[index]]=result[index+1],params.push(obj),index+=2;else params=[];return values=_.map(params,function(param){return _.values(param)[0]}),promises=_.map(values,function(x){return bindOnceP($scope,x)}),$q.all(promises).then(function(){var i,key,len,options,param,value;for(options={},i=0,len=params.length;len>i;i++)param=params[i],key=Object.keys(param)[0],value=param[key],options[key]=$scope.$eval(value);return[name,options]})},link=function($scope,$el,$attrs){return $el.is("a")&&$el.attr("href","#"),$el.on("mouseenter",function(event){var target;return target=$(event.currentTarget),target.data("fullUrl")&&$attrs.tgNavGetParams===target.data("params")?void 0:parseNav($attrs.tgNav,$scope).then(function(result){var fullUrl,getURLParams,getURLParamsStr,name,options,url,user;return name=result[0],options=result[1],user=$auth.getUser(),user&&(options.user=user.username),url=$navurls.resolve(name),fullUrl=$navurls.formatUrl(url,options),$attrs.tgNavGetParams&&(getURLParams=JSON.parse($attrs.tgNavGetParams),getURLParamsStr=$.param(getURLParams),fullUrl=fullUrl+"?"+getURLParamsStr,target.data("params",$attrs.tgNavGetParams)),target.data("fullUrl",fullUrl),target.is("a")&&target.attr("href",fullUrl),$el.on("click",function(event){if(!event.metaKey&&!event.ctrlKey&&(event.preventDefault(),target=$(event.currentTarget),!target.hasClass("noclick")))switch(fullUrl=target.data("fullUrl"),event.which){case 1:return $location.url(fullUrl),$scope.$apply();case 2:return window.open(fullUrl)}})})}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgNav",["$tgNavUrls","$tgAuth","$q","$tgLocation",NavigationUrlsDirective])}.call(this),function(){var RepositoryService,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,RepositoryService=function(superClass){function RepositoryService(q,model1,storage,http,urls){this.q=q,this.model=model1,this.storage=storage,this.http=http,this.urls=urls,RepositoryService.__super__.constructor.call(this)}return extend(RepositoryService,superClass),RepositoryService.$inject=["$q","$tgModel","$tgStorage","$tgHttp","$tgUrls"],RepositoryService.prototype.resolveUrlForModel=function(model){var idAttrName;return idAttrName=model.getIdAttrName(),this.urls.resolve(model.getName())+"/"+model[idAttrName]},RepositoryService.prototype.resolveUrlForAttributeModel=function(model){return this.urls.resolve(model.getName(),model.parent)},RepositoryService.prototype.create=function(name,data,dataTypes,extraParams){var defered,promise,url;return null==dataTypes&&(dataTypes={}),null==extraParams&&(extraParams={}),defered=this.q.defer(),url=this.urls.resolve(name),promise=this.http.post(url,JSON.stringify(data)),promise.success(function(_this){return function(_data,_status){return defered.resolve(_this.model.make_model(name,_data,null,dataTypes))}}(this)),promise.error(function(_this){return function(data,status){return defered.reject(data)}}(this)),defered.promise},RepositoryService.prototype.remove=function(model,params){var defered,promise,url;return null==params&&(params={}),defered=this.q.defer(),url=this.resolveUrlForModel(model),promise=this.http["delete"](url,{},params),promise.success(function(data,status){return defered.resolve(model)}),promise.error(function(data,status){return defered.reject(model)}),defered.promise},RepositoryService.prototype.saveAll=function(models,patch){var promises;return null==patch&&(patch=!0),promises=_.map(models,function(_this){return function(x){return _this.save(x,!0)}}(this)),this.q.all(promises)},RepositoryService.prototype.save=function(model,patch){var data,defered,promise,url;return null==patch&&(patch=!0),defered=this.q.defer(),!model.isModified()&&patch?(defered.resolve(model),defered.promise):(url=this.resolveUrlForModel(model),data=JSON.stringify(model.getAttrs(patch)),promise=patch?this.http.patch(url,data):this.http.put(url,data),promise.success(function(_this){return function(data,status){return model._isModified=!1,model._attrs=_.extend(model.getAttrs(),data),model._modifiedAttrs={},model.applyCasts(),defered.resolve(model)}}(this)),promise.error(function(data,status){return defered.reject(data)}),defered.promise)},RepositoryService.prototype.saveAttribute=function(model,attribute,patch){var data,defered,promise,url;return null==patch&&(patch=!0),defered=this.q.defer(),!model.isModified()&&patch?(defered.resolve(model),defered.promise):(url=this.resolveUrlForAttributeModel(model),data={},data[attribute]=model.getAttrs(),promise=patch?this.http.patch(url,data):this.http.put(url,data),promise.success(function(_this){return function(data,status){return model._isModified=!1,model._attrs=_.extend(model.getAttrs(),data),model._modifiedAttrs={},model.applyCasts(),defered.resolve(model)}}(this)),promise.error(function(data,status){return defered.reject(data)}),defered.promise)},RepositoryService.prototype.refresh=function(model){var defered,promise,url;return defered=this.q.defer(),url=this.resolveUrlForModel(model),promise=this.http.get(url),promise.success(function(data,status){return model._modifiedAttrs={},model._attrs=data,model._isModified=!1,model.applyCasts(),defered.resolve(model)}),promise.error(function(data,status){return defered.reject(data)}),defered.promise},RepositoryService.prototype.queryMany=function(name,params,options,headers){var httpOptions,url;return null==options&&(options={}),null==headers&&(headers=!1),url=this.urls.resolve(name),httpOptions={headers:{}},options.enablePagination||(httpOptions.headers["x-disable-pagination"]="1"),this.http.get(url,params,httpOptions).then(function(_this){return function(data){var result;return result=_.map(data.data,function(x){return _this.model.make_model(name,x)}),headers?[result,data.headers]:result}}(this))},RepositoryService.prototype.queryOneAttribute=function(name,id,attribute,params,options){var httpOptions,url;return null==options&&(options={}),url=this.urls.resolve(name,id),httpOptions={headers:{}},options.enablePagination||(httpOptions.headers["x-disable-pagination"]="1"),this.http.get(url,params,httpOptions).then(function(_this){return function(data){var model;return model=_this.model.make_model(name,data.data[attribute]),model.parent=id,model}}(this))},RepositoryService.prototype.queryOne=function(name,id,params,options){var httpOptions,url;return null==options&&(options={}),url=this.urls.resolve(name),id&&(url=url+"/"+id),httpOptions={headers:{}},options.enablePagination||(httpOptions.headers["x-disable-pagination"]="1"),this.http.get(url,params,httpOptions).then(function(_this){return function(data){return _this.model.make_model(name,data.data)}}(this))},RepositoryService.prototype.queryOneRaw=function(name,id,params,options){var httpOptions,url;return null==options&&(options={}),url=this.urls.resolve(name),id&&(url=url+"/"+id),httpOptions=_.merge({headers:{}},options),options.enablePagination||(httpOptions.headers["x-disable-pagination"]="1"),this.http.get(url,params,httpOptions).then(function(_this){return function(data){return data.data}}(this))},RepositoryService.prototype.queryPaginated=function(name,params,options){var httpOptions,url;return null==options&&(options={}),url=this.urls.resolve(name),httpOptions=_.merge({headers:{}},options),this.http.get(url,params,httpOptions).then(function(_this){return function(data){var headers,result;return headers=data.headers(),result={},result.models=_.map(data.data,function(x){return _this.model.make_model(name,x)}),result.count=parseInt(headers["x-pagination-count"],10),result.current=parseInt(headers["x-pagination-current"]||1,10),result.paginatedBy=parseInt(headers["x-paginated-by"],10),result}}(this))},RepositoryService.prototype.queryOnePaginatedRaw=function(name,id,params,options){var httpOptions,url;return null==options&&(options={}),url=this.urls.resolve(name),id&&(url=url+"/"+id),httpOptions=_.merge({headers:{}},options),this.http.get(url,params,httpOptions).then(function(_this){return function(data){var headers,result;return headers=data.headers(),result={},result.data=data.data,result.count=parseInt(headers["x-pagination-count"],10),result.current=parseInt(headers["x-pagination-current"]||1,10),result.paginatedBy=parseInt(headers["x-paginated-by"],10),result}}(this))},RepositoryService.prototype.resolve=function(options){var cache,params;return params={},null!=options.pslug&&(params.project=options.pslug),null!=options.usref&&(params.us=options.usref),null!=options.taskref&&(params.task=options.taskref),null!=options.issueref&&(params.issue=options.issueref),null!=options.sslug&&(params.milestone=options.sslug),null!=options.wikipage&&(params.wikipage=options.wikipage),cache=!(options.wikipage||options.sslug),this.queryOneRaw("resolver",null,params,{cache:cache})},RepositoryService}(taiga.Service),module=angular.module("taigaBase"),module.service("$tgRepo",RepositoryService)}.call(this),function(){var StorageService,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,StorageService=function(superClass){function StorageService($rootScope){StorageService.__super__.constructor.call(this)}return extend(StorageService,superClass),StorageService.$inject=["$rootScope"],StorageService.prototype.get=function(key,_default){var serializedValue;return serializedValue=localStorage.getItem(key),null===serializedValue?_default||null:JSON.parse(serializedValue)},StorageService.prototype.set=function(key,val){return _.isObject(key)?_.each(key,function(_this){return function(val,key){return _this.set(key,val)}}(this)):localStorage.setItem(key,JSON.stringify(val))},StorageService.prototype.contains=function(key){var value;return value=this.get(key),null!==value},StorageService.prototype.remove=function(key){return localStorage.removeItem(key)},StorageService.prototype.clear=function(){return localStorage.clear()},StorageService}(taiga.Service),module=angular.module("taigaBase"),module.service("$tgStorage",StorageService)}.call(this),function(){var UrlsService,format,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;format=function(fmt,obj){return obj=_.clone(obj),fmt.replace(/%s/g,function(match){return String(obj.shift())})},taiga=this.taiga,UrlsService=function(superClass){function UrlsService(config){this.config=config,this.urls={},this.mainUrl=this.config.get("api")}return extend(UrlsService,superClass),UrlsService.$inject=["$tgConfig"],UrlsService.prototype.update=function(urls){return this.urls=_.merge(this.urls,urls)},UrlsService.prototype.resolve=function(){var args,name,url;if(args=_.toArray(arguments),0===args.length)throw Error("wrong arguments to setUrls");return name=args.slice(0,1)[0],url=format(this.urls[name],args.slice(1)),format("%s/%s",[_.str.rtrim(this.mainUrl,"/"),_.str.ltrim(url,"/")])},UrlsService.prototype.resolveAbsolute=function(){var url;return url=this.resolve.apply(this,arguments),/^https?:\/\//i.test(url)?url:/^\//.test(url)?window.location.protocol+"//"+window.location.host+url:window.location.protocol+"//"+window.location.host+"/"+url},UrlsService}(taiga.Service),module=angular.module("taigaBase"),module.service("$tgUrls",UrlsService)}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo){var _get,service;return _get=function(objectId,resource){return $repo.queryOne(resource,objectId)},service={userstory:{get:function(objectId){return _get(objectId,"custom-attributes-values/userstory")}},task:{get:function(objectId){return _get(objectId,"custom-attributes-values/task")}},issue:{get:function(objectId){return _get(objectId,"custom-attributes-values/issue")}}},function(instance){return instance.customAttributesValues=service}},module=angular.module("taigaResources"),module.factory("$tgCustomAttributesValuesResourcesProvider",["$tgRepo",resourceProvider])}.call(this),function(){var module,resourceProvider,sizeFormat,taiga;taiga=this.taiga,sizeFormat=this.taiga.sizeFormat,resourceProvider=function($repo){var _list,service;return _list=function(projectId,resource){return $repo.queryMany(resource,{project:projectId})},service={userstory:{list:function(projectId){return _list(projectId,"custom-attributes/userstory")}},task:{list:function(projectId){return _list(projectId,"custom-attributes/task")}},issue:{list:function(projectId){return _list(projectId,"custom-attributes/issue")}}},function(instance){return instance.customAttributes=service}},module=angular.module("taigaResources"),module.factory("$tgCustomAttributesResourcesProvider",["$tgRepo",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo,$http,$urls){var service;return service={},service.get=function(type,objectId){return $repo.queryOneRaw("history/"+type,objectId)},service.deleteComment=function(type,objectId,activityId){var params,url;return url=$urls.resolve("history/"+type),url=url+"/"+objectId+"/delete_comment",params={id:activityId},$http.post(url,null,params).then(function(_this){return function(data){return data.data}}(this))},service.undeleteComment=function(type,objectId,activityId){var params,url;return url=$urls.resolve("history/"+type),url=url+"/"+objectId+"/undelete_comment",params={id:activityId},$http.post(url,null,params).then(function(_this){return function(data){return data.data}}(this))},function(instance){return instance.history=service}},module=angular.module("taigaResources"),module.factory("$tgHistoryResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo){var service;return service={},service.get=function(token){return $repo.queryOne("invitations",token)},function(instance){return instance.invitations=service}},module=angular.module("taigaResources"),module.factory("$tgInvitationsResourcesProvider",["$tgRepo",resourceProvider])}.call(this),function(){var generateHash,module,resourceProvider,taiga;taiga=this.taiga,generateHash=taiga.generateHash,resourceProvider=function($repo,$http,$urls,$storage,$q){var filtersHashSuffix,hashSuffix,myFiltersHashSuffix,service;return service={},hashSuffix="issues-queryparams",filtersHashSuffix="issues-filters",myFiltersHashSuffix="issues-my-filters",service.get=function(projectId,issueId){var params;return params=service.getQueryParams(projectId),params.project=projectId,$repo.queryOne("issues",issueId,params)},service.getByRef=function(projectId,ref){var params;return params=service.getQueryParams(projectId),params.project=projectId,params.ref=ref,$repo.queryOne("issues","by_ref",params)},service.listInAllProjects=function(filters){return $repo.queryMany("issues",filters)},service.list=function(projectId,filters,options){var params;return params={project:projectId},params=_.extend({},params,filters||{}),service.storeQueryParams(projectId,params),$repo.queryPaginated("issues",params,options)},service.bulkCreate=function(projectId,data){var params,url;return url=$urls.resolve("bulk-create-issues"),params={project_id:projectId,bulk_issues:data},$http.post(url,params)},service.upvote=function(issueId){var url;return url=$urls.resolve("issue-upvote",issueId),$http.post(url)},service.downvote=function(issueId){var url;return url=$urls.resolve("issue-downvote",issueId),$http.post(url)},service.watch=function(issueId){var url;return url=$urls.resolve("issue-watch",issueId),$http.post(url)},service.unwatch=function(issueId){var url;return url=$urls.resolve("issue-unwatch",issueId),$http.post(url)},service.stats=function(projectId){return $repo.queryOneRaw("projects",projectId+"/issues_stats")},service.filtersData=function(params){return $repo.queryOneRaw("issues-filters",null,params)},service.listValues=function(projectId,type){var params;return params={project:projectId},service.storeQueryParams(projectId,params),$repo.queryMany(type,params)},service.storeQueryParams=function(projectId,params){var hash,ns;return ns=projectId+":"+hashSuffix,hash=generateHash([projectId,ns]),$storage.set(hash,params)},service.getQueryParams=function(projectId){var hash,ns;return ns=projectId+":"+hashSuffix,hash=generateHash([projectId,ns]),$storage.get(hash)||{}},service.storeFilters=function(projectSlug,params){var hash,ns;return ns=projectSlug+":"+filtersHashSuffix,hash=generateHash([projectSlug,ns]),$storage.set(hash,params)},service.getFilters=function(projectSlug){var hash,ns;return ns=projectSlug+":"+filtersHashSuffix,hash=generateHash([projectSlug,ns]),$storage.get(hash)||{}},service.storeMyFilters=function(projectId,myFilters){var deferred,hash,ns,promise,url;return deferred=$q.defer(),url=$urls.resolve("user-storage"),ns=projectId+":"+myFiltersHashSuffix,hash=generateHash([projectId,ns]),_.isEmpty(myFilters)?(promise=$http["delete"](url+"/"+hash,{key:hash,value:myFilters}),promise.then(function(){return deferred.resolve()}),promise.then(null,function(){return deferred.reject()})):(promise=$http.put(url+"/"+hash,{key:hash,value:myFilters}),promise.then(function(data){return deferred.resolve()}),promise.then(null,function(data){var innerPromise;return innerPromise=$http.post(""+url,{key:hash,value:myFilters}),innerPromise.then(function(){return deferred.resolve()}),innerPromise.then(null,function(){return deferred.reject()})})),deferred.promise},service.getMyFilters=function(projectId){var deferred,hash,ns,promise,url;return deferred=$q.defer(),url=$urls.resolve("user-storage"),ns=projectId+":"+myFiltersHashSuffix,hash=generateHash([projectId,ns]),promise=$http.get(url+"/"+hash),promise.then(function(data){return deferred.resolve(data.data.value)}),promise.then(null,function(data){return deferred.resolve({})}),deferred.promise},function(instance){return instance.issues=service}},module=angular.module("taigaResources"),module.factory("$tgIssuesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",resourceProvider])}.call(this),function(){var generateHash,module,resourceProvider,taiga;taiga=this.taiga,generateHash=taiga.generateHash,resourceProvider=function($storage){var hashSuffixStatusColumnModes,hashSuffixStatusViewModes,service;return service={},hashSuffixStatusViewModes="kanban-statusviewmodels",hashSuffixStatusColumnModes="kanban-statuscolumnmodels",service.storeStatusViewModes=function(projectId,params){var hash,ns;return ns=projectId+":"+hashSuffixStatusViewModes,hash=generateHash([projectId,ns]),$storage.set(hash,params)},service.getStatusViewModes=function(projectId){
var hash,ns;return ns=projectId+":"+hashSuffixStatusViewModes,hash=generateHash([projectId,ns]),$storage.get(hash)||{}},service.storeStatusColumnModes=function(projectId,params){var hash,ns;return ns=projectId+":"+hashSuffixStatusColumnModes,hash=generateHash([projectId,ns]),$storage.set(hash,params)},service.getStatusColumnModes=function(projectId){var hash,ns;return ns=projectId+":"+hashSuffixStatusColumnModes,hash=generateHash([projectId,ns]),$storage.get(hash)||{}},function(instance){return instance.kanban=service}},module=angular.module("taigaResources"),module.factory("$tgKanbanResourcesProvider",["$tgStorage",resourceProvider])}.call(this),function(){var module,resourceProvider,sizeFormat,taiga;taiga=this.taiga,sizeFormat=this.taiga.sizeFormat,resourceProvider=function($repo){var service;return service={list:function(){return $repo.queryMany("locales")}},function(instance){return instance.locales=service}},module=angular.module("taigaResources"),module.factory("$tgLocalesResourcesProvider",["$tgRepo",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo,$urls,$http){var service;return service={},service.render=function(projectId,content){var params,url;return(null==content||""===content)&&(content=" "),params={project_id:projectId,content:content},url=$urls.resolve("wiki"),$http.post(url+"/render",params).then(function(_this){return function(data){return data.data}}(this))},function(instance){return instance.mdrender=service}},module=angular.module("taigaResources"),module.factory("$tgMdRenderResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo,$http,$urls){var service;return service={},service.get=function(id){return $repo.queryOne("memberships",id)},service.list=function(projectId,filters,enablePagination){var options,params;return null==enablePagination&&(enablePagination=!0),params={project:projectId},params=_.extend({},params,filters||{}),enablePagination?$repo.queryPaginated("memberships",params):$repo.queryMany("memberships",params,options={enablePagination:enablePagination})},service.listByUser=function(userId,filters){var params;return params={user:userId},params=_.extend({},params,filters||{}),$repo.queryPaginated("memberships",params)},service.resendInvitation=function(id){var url;return url=$urls.resolve("memberships"),$http.post(url+"/"+id+"/resend_invitation",{})},service.bulkCreateMemberships=function(projectId,data,invitation_extra_text){var params,url;return url=$urls.resolve("bulk-create-memberships"),params={project_id:projectId,bulk_memberships:data,invitation_extra_text:invitation_extra_text},$http.post(url,params)},function(instance){return instance.memberships=service}},module=angular.module("taigaResources"),module.factory("$tgMembershipsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",resourceProvider])}.call(this),function(){var module,resourceProvider;resourceProvider=function($repo){var service;return service={},service.list=function(projectId,module){return $repo.queryOneAttribute("project-modules",projectId,module)},function(instance){return instance.modules=service}},module=angular.module("taigaResources"),module.factory("$tgModulesResourcesProvider",["$tgRepo",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo,$http,$urls){var service;return service={},service.get=function(id){return $repo.queryOne("notify-policies",id)},service.list=function(filters){var params;return params=_.extend({},params,filters||{}),$repo.queryMany("notify-policies",params)},function(instance){return instance.notifyPolicies=service}},module=angular.module("taigaResources"),module.factory("$tgNotifyPoliciesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",resourceProvider])}.call(this),function(){var module,resourceProvider,sizeFormat,taiga;taiga=this.taiga,sizeFormat=this.taiga.sizeFormat,resourceProvider=function($config,$repo,$http,$urls,$auth,$q,$translate){var service;return service={},service.get=function(projectId){return $repo.queryOne("projects",projectId)},service.getBySlug=function(projectSlug){return $repo.queryOne("projects","by_slug?slug="+projectSlug)},service.list=function(){return $repo.queryMany("projects")},service.listByMember=function(memberId){var params;return params={member:memberId,order_by:"memberships__user_order"},$repo.queryMany("projects",params)},service.templates=function(){return $repo.queryMany("project-templates")},service.usersList=function(projectId){var params;return params={project:projectId},$repo.queryMany("users",params)},service.rolesList=function(projectId){var params;return params={project:projectId},$repo.queryMany("roles",params)},service.stats=function(projectId){return $repo.queryOneRaw("projects",projectId+"/stats")},service.bulkUpdateOrder=function(bulkData){var url;return url=$urls.resolve("bulk-update-projects-order"),$http.post(url,bulkData)},service.regenerate_userstories_csv_uuid=function(projectId){var url;return url=$urls.resolve("projects")+"/"+projectId+"/regenerate_userstories_csv_uuid",$http.post(url)},service.regenerate_issues_csv_uuid=function(projectId){var url;return url=$urls.resolve("projects")+"/"+projectId+"/regenerate_issues_csv_uuid",$http.post(url)},service.regenerate_tasks_csv_uuid=function(projectId){var url;return url=$urls.resolve("projects")+"/"+projectId+"/regenerate_tasks_csv_uuid",$http.post(url)},service.leave=function(projectId){var url;return url=$urls.resolve("projects")+"/"+projectId+"/leave",$http.post(url)},service.memberStats=function(projectId){return $repo.queryOneRaw("projects",projectId+"/member_stats")},service.tagsColors=function(projectId){return $repo.queryOne("projects",projectId+"/tags_colors")},service["export"]=function(projectId){var url;return url=$urls.resolve("exporter")+"/"+projectId,$http.get(url)},service["import"]=function(file,statusUpdater){var complete,data,defered,errorMsg,failed,maxFileSize,response,uploadComplete,uploadFailed,uploadProgress,xhr;return defered=$q.defer(),maxFileSize=$config.get("maxUploadFileSize",null),maxFileSize&&file.size>maxFileSize?(errorMsg=$translate.instant("PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED",{fileName:file.name,fileSize:sizeFormat(file.size),maxFileSize:sizeFormat(maxFileSize)}),response={status:413,data:{_error_message:errorMsg}},defered.reject(response),defered.promise):(uploadProgress=function(_this){return function(evt){var message,percent;return percent=Math.round(evt.loaded/evt.total*100),message=$translate.instant("PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE",{uploadedSize:sizeFormat(evt.loaded),totalSize:sizeFormat(evt.total)}),statusUpdater("in-progress",null,message,percent)}}(this),uploadComplete=function(_this){return function(evt){return statusUpdater("done",$translate.instant("PROJECT.IMPORT.TITLE"),$translate.instant("PROJECT.IMPORT.DESCRIPTION"))}}(this),uploadFailed=function(_this){return function(evt){return statusUpdater("error")}}(this),complete=function(_this){return function(evt){var ref;response={};try{response.data=JSON.parse(evt.target.responseText)}catch(error){response.data={}}return response.status=evt.target.status,(201===(ref=response.status)||202===ref)&&defered.resolve(response),defered.reject(response)}}(this),failed=function(_this){return function(evt){return defered.reject("fail")}}(this),data=new FormData,data.append("dump",file),xhr=new XMLHttpRequest,xhr.upload.addEventListener("progress",uploadProgress,!1),xhr.upload.addEventListener("load",uploadComplete,!1),xhr.upload.addEventListener("error",uploadFailed,!1),xhr.upload.addEventListener("abort",uploadFailed,!1),xhr.addEventListener("load",complete,!1),xhr.addEventListener("error",failed,!1),xhr.open("POST",$urls.resolve("importer")),xhr.setRequestHeader("Authorization","Bearer "+$auth.getToken()),xhr.setRequestHeader("Accept","application/json"),xhr.send(data),defered.promise)},service.changeLogo=function(projectId,file){var data,defered,maxFileSize,options,response,url;return maxFileSize=$config.get("maxUploadFileSize",null),maxFileSize&&file.size>maxFileSize?(response={status:413,data:{_error_message:"'"+file.name+"' ("+sizeFormat(file.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+sizeFormat(maxFileSize)+")"}},defered=$q.defer(),defered.reject(response),defered.promise):(data=new FormData,data.append("logo",file),options={transformRequest:angular.identity,headers:{"Content-Type":void 0}},url=$urls.resolve("projects")+"/"+projectId+"/change_logo",$http.post(url,data,{},options))},service.removeLogo=function(projectId){var url;return url=$urls.resolve("projects")+"/"+projectId+"/remove_logo",$http.post(url)},function(instance){return instance.projects=service}},module=angular.module("taigaResources"),module.factory("$tgProjectsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$tgAuth","$q","$translate",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo,$http,$urls){var service;return service={},service.get=function(id){return $repo.queryOne("roles",id)},service.list=function(projectId){return $repo.queryMany("roles",{project:projectId})},function(instance){return instance.roles=service}},module=angular.module("taigaResources"),module.factory("$tgRolesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo,$urls,$http,$q){var service;return service={},service["do"]=function(projectId,term){var deferredAbort,params,request,url;return deferredAbort=$q.defer(),url=$urls.resolve("search"),params={url:url,method:"GET",timeout:deferredAbort.promise,cancelable:!0,params:{project:projectId,text:term,get_all:!1}},request=$http.request(params).then(function(data){return data.data}),request.abort=function(){return deferredAbort.resolve()},request["finally"]=function(){return request.abort=angular.noop,deferredAbort=request=null},request},function(instance){return instance.search=service}},module=angular.module("taigaResources"),module.factory("$tgSearchResourcesProvider",["$tgRepo","$tgUrls","$tgHttp","$q",resourceProvider])}.call(this),function(){var generateHash,module,resourceProvider,taiga;taiga=this.taiga,generateHash=taiga.generateHash,resourceProvider=function($repo,$model,$storage){var service;return service={},service.get=function(projectId,sprintId){return $repo.queryOne("milestones",sprintId).then(function(sprint){var uses;return uses=sprint.user_stories,uses=_.map(uses,function(u){return $model.make_model("userstories",u)}),sprint._attrs.user_stories=uses,sprint})},service.stats=function(projectId,sprintId){return $repo.queryOneRaw("milestones",sprintId+"/stats")},service.list=function(projectId,filters){var params;return params={project:projectId},params=_.extend({},params,filters||{}),$repo.queryMany("milestones",params,{},!0).then(function(_this){return function(result){var headers,i,len,m,milestones,uses;for(milestones=result[0],headers=result[1],i=0,len=milestones.length;len>i;i++)m=milestones[i],uses=m.user_stories,uses=_.map(uses,function(u){return $model.make_model("userstories",u)}),m._attrs.user_stories=uses;return{milestones:milestones,closed:parseInt(headers("Taiga-Info-Total-Closed-Milestones"),10),open:parseInt(headers("Taiga-Info-Total-Opened-Milestones"),10)}}}(this))},function(instance){return instance.sprints=service}},module=angular.module("taigaResources"),module.factory("$tgSprintsResourcesProvider",["$tgRepo","$tgModel","$tgStorage",resourceProvider])}.call(this),function(){var generateHash,module,resourceProvider,taiga;taiga=this.taiga,generateHash=taiga.generateHash,resourceProvider=function($repo,$http,$urls,$storage){var hashSuffix,hashSuffixStatusColumnModes,hashSuffixUsRowModes,service;return service={},hashSuffix="tasks-queryparams",hashSuffixStatusColumnModes="tasks-statuscolumnmodels",hashSuffixUsRowModes="tasks-usrowmodels",service.get=function(projectId,taskId){var params;return params=service.getQueryParams(projectId),params.project=projectId,$repo.queryOne("tasks",taskId,params)},service.getByRef=function(projectId,ref){var params;return params=service.getQueryParams(projectId),params.project=projectId,params.ref=ref,$repo.queryOne("tasks","by_ref",params)},service.listInAllProjects=function(filters){return $repo.queryMany("tasks",filters)},service.list=function(projectId,sprintId,userStoryId){var params;return null==sprintId&&(sprintId=null),null==userStoryId&&(userStoryId=null),params={project:projectId},sprintId&&(params.milestone=sprintId),userStoryId&&(params.user_story=userStoryId),service.storeQueryParams(projectId,params),$repo.queryMany("tasks",params)},service.bulkCreate=function(projectId,sprintId,usId,data){var params,url;return url=$urls.resolve("bulk-create-tasks"),params={project_id:projectId,sprint_id:sprintId,us_id:usId,bulk_tasks:data},$http.post(url,params).then(function(result){return result.data})},service.upvote=function(taskId){var url;return url=$urls.resolve("task-upvote",taskId),$http.post(url)},service.downvote=function(taskId){var url;return url=$urls.resolve("task-downvote",taskId),$http.post(url)},service.watch=function(taskId){var url;return url=$urls.resolve("task-watch",taskId),$http.post(url)},service.unwatch=function(taskId){var url;return url=$urls.resolve("task-unwatch",taskId),$http.post(url)},service.bulkUpdateTaskTaskboardOrder=function(projectId,data){var params,url;return url=$urls.resolve("bulk-update-task-taskboard-order"),params={project_id:projectId,bulk_tasks:data},$http.post(url,params)},service.listValues=function(projectId,type){var params;return params={project:projectId},$repo.queryMany(type,params)},service.storeQueryParams=function(projectId,params){var hash,ns;return ns=projectId+":"+hashSuffix,hash=generateHash([projectId,ns]),$storage.set(hash,params)},service.getQueryParams=function(projectId){var hash,ns;return ns=projectId+":"+hashSuffix,hash=generateHash([projectId,ns]),$storage.get(hash)||{}},service.storeStatusColumnModes=function(projectId,params){var hash,ns;return ns=projectId+":"+hashSuffixStatusColumnModes,hash=generateHash([projectId,ns]),$storage.set(hash,params)},service.getStatusColumnModes=function(projectId){var hash,ns;return ns=projectId+":"+hashSuffixStatusColumnModes,hash=generateHash([projectId,ns]),$storage.get(hash)||{}},service.storeUsRowModes=function(projectId,sprintId,params){var hash,ns;return ns=projectId+":"+hashSuffixUsRowModes,hash=generateHash([projectId,sprintId,ns]),$storage.set(hash,params)},service.getUsRowModes=function(projectId,sprintId){var hash,ns;return ns=projectId+":"+hashSuffixUsRowModes,hash=generateHash([projectId,sprintId,ns]),$storage.get(hash)||{}},function(instance){return instance.tasks=service}},module=angular.module("taigaResources"),module.factory("$tgTasksResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",resourceProvider])}.call(this),function(){var module,resourceProvider,sizeFormat,taiga;taiga=this.taiga,sizeFormat=this.taiga.sizeFormat,resourceProvider=function($config,$repo,$http,$urls,$q){var service;return service={},service.changeAvatar=function(file){var data,defered,maxFileSize,options,response,url;return maxFileSize=$config.get("maxUploadFileSize",null),maxFileSize&&file.size>maxFileSize?(response={status:413,data:{_error_message:"'"+file.name+"' ("+sizeFormat(file.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+sizeFormat(maxFileSize)+")"}},defered=$q.defer(),defered.reject(response),defered.promise):(data=new FormData,data.append("avatar",file),options={transformRequest:angular.identity,headers:{"Content-Type":void 0}},url=$urls.resolve("users")+"/change_avatar",$http.post(url,data,{},options))},service.removeAvatar=function(){var url;return url=$urls.resolve("users")+"/remove_avatar",$http.post(url)},service.changePassword=function(currentPassword,newPassword){var data,url;return url=$urls.resolve("users")+"/change_password",data={current_password:currentPassword,password:newPassword},$http.post(url,data)},function(instance){return instance.userSettings=service}},module=angular.module("taigaResources"),module.factory("$tgUserSettingsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$q",resourceProvider])}.call(this),function(){var module,resourceProvider,sizeFormat,taiga;taiga=this.taiga,sizeFormat=this.taiga.sizeFormat,resourceProvider=function($http,$urls){var service;return service={},service.contacts=function(userId,options){var httpOptions,url;return null==options&&(options={}),url=$urls.resolve("user-contacts",userId),httpOptions={headers:{}},options.enablePagination||(httpOptions.headers["x-disable-pagination"]="1"),$http.get(url,{},httpOptions).then(function(result){return result.data})},function(instance){return instance.users=service}},module=angular.module("taigaResources"),module.factory("$tgUsersResourcesProvider",["$tgHttp","$tgUrls","$q",resourceProvider])}.call(this),function(){var generateHash,module,resourceProvider,taiga;taiga=this.taiga,generateHash=taiga.generateHash,resourceProvider=function($repo,$http,$urls,$storage){var hashSuffix,service;return service={},hashSuffix="userstories-queryparams",service.get=function(projectId,usId){var params;return params=service.getQueryParams(projectId),params.project=projectId,$repo.queryOne("userstories",usId,params)},service.getByRef=function(projectId,ref){var params;return params=service.getQueryParams(projectId),params.project=projectId,params.ref=ref,$repo.queryOne("userstories","by_ref",params)},service.listInAllProjects=function(filters){return $repo.queryMany("userstories",filters)},service.filtersData=function(params){return $repo.queryOneRaw("userstories-filters",null,params)},service.listUnassigned=function(projectId,filters){var params;return params={project:projectId,milestone:"null"},params=_.extend({},params,filters||{}),service.storeQueryParams(projectId,params),$repo.queryMany("userstories",params)},service.listAll=function(projectId,filters){var params;return params={project:projectId},params=_.extend({},params,filters||{}),service.storeQueryParams(projectId,params),$repo.queryMany("userstories",params)},service.bulkCreate=function(projectId,status,bulk){var data,url;return data={project_id:projectId,status_id:status,bulk_stories:bulk},url=$urls.resolve("bulk-create-us"),$http.post(url,data)},service.upvote=function(userStoryId){var url;return url=$urls.resolve("userstory-upvote",userStoryId),$http.post(url)},service.downvote=function(userStoryId){var url;return url=$urls.resolve("userstory-downvote",userStoryId),$http.post(url)},service.watch=function(userStoryId){var url;return url=$urls.resolve("userstory-watch",userStoryId),$http.post(url)},service.unwatch=function(userStoryId){var url;return url=$urls.resolve("userstory-unwatch",userStoryId),$http.post(url)},service.bulkUpdateBacklogOrder=function(projectId,data){var params,url;return url=$urls.resolve("bulk-update-us-backlog-order"),params={project_id:projectId,bulk_stories:data},$http.post(url,params)},service.bulkUpdateSprintOrder=function(projectId,data){var params,url;return url=$urls.resolve("bulk-update-us-sprint-order"),params={project_id:projectId,bulk_stories:data},$http.post(url,params)},service.bulkUpdateKanbanOrder=function(projectId,data){var params,url;return url=$urls.resolve("bulk-update-us-kanban-order"),params={project_id:projectId,bulk_stories:data},$http.post(url,params)},service.listValues=function(projectId,type){var params;return params={project:projectId},service.storeQueryParams(projectId,params),$repo.queryMany(type,params)},service.storeQueryParams=function(projectId,params){var hash,ns;return ns=projectId+":"+hashSuffix,hash=generateHash([projectId,ns]),$storage.set(hash,params)},service.getQueryParams=function(projectId){var hash,ns;return ns=projectId+":"+hashSuffix,hash=generateHash([projectId,ns]),$storage.get(hash)||{}},service.storeShowTags=function(projectId,showTags){var hash;return hash=generateHash([projectId,"showTags"]),$storage.set(hash,showTags)},service.getShowTags=function(projectId){var hash;return hash=generateHash([projectId,"showTags"]),$storage.get(hash)||null},function(instance){return instance.userstories=service}},module=angular.module("taigaResources"),module.factory("$tgUserstoriesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",resourceProvider])}.call(this),function(){var module,resourceProvider;resourceProvider=function($repo,$urls,$http){var service;return service={},service.list=function(webhookId){var params;return params={webhook:webhookId},$repo.queryMany("webhooklogs",params)},service.resend=function(webhooklogId){var url;return url=$urls.resolve("webhooklogs-resend",webhooklogId),$http.post(url)},function(instance){return instance.webhooklogs=service}},module=angular.module("taigaResources"),module.factory("$tgWebhookLogsResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",resourceProvider])}.call(this),function(){var module,resourceProvider;resourceProvider=function($repo,$urls,$http){var service;return service={},service.list=function(projectId){var params;return params={project:projectId},$repo.queryMany("webhooks",params)},service.test=function(webhookId){var url;return url=$urls.resolve("webhooks-test",webhookId),$http.post(url)},function(instance){return instance.webhooks=service}},module=angular.module("taigaResources"),module.factory("$tgWebhooksResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",resourceProvider])}.call(this),function(){var module,resourceProvider,taiga;taiga=this.taiga,resourceProvider=function($repo,$http,$urls){var service;return service={},service.get=function(wikiId){return $repo.queryOne("wiki",wikiId)},service.getBySlug=function(projectId,slug){return $repo.queryOne("wiki","by_slug?project="+projectId+"&slug="+slug)},service.listLinks=function(projectId){return $repo.queryMany("wiki-links",{project:projectId})},function(instance){return instance.wiki=service}},module=angular.module("taigaResources"),module.factory("$tgWikiResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",resourceProvider])}.call(this),function(){var UserChangePasswordController,UserChangePasswordDirective,debounce,mixOf,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,debounce=this.taiga.debounce,module=angular.module("taigaUserSettings"),UserChangePasswordController=function(superClass){function UserChangePasswordController(scope,rootscope,repo,confirm,rs,params,q,location,navUrls,auth,translate){this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.auth=auth,this.translate=translate,this.scope.sectionName=this.translate.instant("CHANGE_PASSWORD.SECTION_NAME"),this.scope.user=this.auth.getUser()}return extend(UserChangePasswordController,superClass),UserChangePasswordController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate"],UserChangePasswordController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("UserChangePasswordController",UserChangePasswordController),UserChangePasswordDirective=function($rs,$confirm,$loading,$translate){var link;return link=function($scope,$el,$attrs,ctrl){var submit,submitButton;return submit=debounce(2e3,function(_this){return function(event){var currentLoading,promise;return event.preventDefault(),$scope.newPassword1!==$scope.newPassword2?void $confirm.notify("error",$translate.instant("CHANGE_PASSWORD.ERROR_PASSWORD_MATCH")):(currentLoading=$loading().target(submitButton).start(),promise=$rs.userSettings.changePassword($scope.currentPassword,$scope.newPassword1),promise.then(function(){return currentLoading.finish(),$confirm.notify("success")}),promise.then(null,function(response){return currentLoading.finish(),$confirm.notify("error",response.data._error_message)}))}}(this)),submitButton=$el.find(".submit-button"),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgUserChangePassword",["$tgResources","$tgConfirm","$tgLoading","$translate",UserChangePasswordDirective])}.call(this),function(){var DeleteUserDirective,bindOnce,debounce,module,taiga;taiga=this.taiga,bindOnce=this.taiga.bindOnce,debounce=this.taiga.debounce,module=angular.module("taigaUserSettings"),DeleteUserDirective=function($repo,$rootscope,$auth,$location,$navUrls,lightboxService){var link;return link=function($scope,$el,$attrs){var submit;return $scope.$on("deletelightbox:new",function(ctx,user){return lightboxService.open($el)}),$scope.$on("$destroy",function(){return $el.off()}),submit=function(){var promise;return promise=$repo.remove($scope.user),promise.then(function(data){return lightboxService.close($el),$auth.logout(),$location.path($navUrls.resolve("login"))}),promise.then(null,function(){return console.log("FAIL")})},$el.on("click",".button-red",function(event){return event.preventDefault(),lightboxService.close($el)}),$el.on("click",".button-green",debounce(2e3,function(event){return event.preventDefault(),submit()}))},{link:link,templateUrl:"user/lightbox/lightbox-delete-account.html"}},module.directive("tgLbDeleteUser",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","lightboxService",DeleteUserDirective])}.call(this),function(){var TaigaAvatarModelDirective,UserAvatarDirective,UserProfileDirective,UserSettingsController,debounce,mixOf,module,sizeFormat,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,sizeFormat=this.taiga.sizeFormat,module=angular.module("taigaUserSettings"),debounce=this.taiga.debounce,UserSettingsController=function(superClass){function UserSettingsController(scope,rootscope,config,repo,confirm,rs,params,q,location,navUrls,auth,translate){var maxFileSize,promise,text;this.scope=scope,this.rootscope=rootscope,this.config=config,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.auth=auth,this.translate=translate,this.scope.sectionName="USER_SETTINGS.MENU.SECTION_TITLE",this.scope.project={},this.scope.user=this.auth.getUser(),this.scope.user||(this.location.path(this.navUrls.resolve("permission-denied")),this.location.replace()),this.scope.lang=this.getLan(),this.scope.theme=this.getTheme(),maxFileSize=this.config.get("maxUploadFileSize",null),maxFileSize&&(text=this.translate.instant("USER_SETTINGS.AVATAR_MAX_SIZE",{maxFileSize:sizeFormat(maxFileSize)}),this.scope.maxFileSizeMsg=text),promise=this.loadInitialData(),promise.then(null,this.onInitialDataError.bind(this))}return extend(UserSettingsController,superClass),UserSettingsController.$inject=["$scope","$rootScope","$tgConfig","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate"],UserSettingsController.prototype.loadInitialData=function(){return this.scope.availableThemes=this.config.get("themes",[]),this.rs.locales.list().then(function(_this){return function(locales){return _this.scope.locales=locales,locales}}(this))},UserSettingsController.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.user)},UserSettingsController.prototype.getLan=function(){return this.scope.user.lang||this.translate.preferredLanguage()},UserSettingsController.prototype.getTheme=function(){return this.scope.user.theme||this.config.get("defaultTheme")||"taiga"},UserSettingsController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("UserSettingsController",UserSettingsController),UserProfileDirective=function($confirm,$auth,$repo,$translate){var link;return link=function($scope,$el,$attrs){var submit;return submit=debounce(2e3,function(_this){return function(event){var changeEmail,form,onError,onSuccess;return event.preventDefault(),form=$el.find("form").checksley(),form.validate()?(changeEmail=$scope.user.isAttributeModified("email"),$scope.user.lang=$scope.lang,$scope.user.theme=$scope.theme,onSuccess=function(data){var text;return $auth.setUser(data),changeEmail?(text=$translate.instant("USER_PROFILE.CHANGE_EMAIL_SUCCESS"),$confirm.success(text)):$confirm.notify("success")},onError=function(data){return form.setErrors(data),$confirm.notify("error",data._error_message)},$repo.save($scope.user).then(onSuccess,onError)):void 0}}(this)),$el.on("submit","form",submit),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgUserProfile",["$tgConfirm","$tgAuth","$tgRepo","$translate",UserProfileDirective]),UserAvatarDirective=function($auth,$model,$rs,$confirm){var link;return link=function($scope,$el,$attrs){var onError,onSuccess,showSizeInfo;return showSizeInfo=function(){return $el.find(".size-info").removeClass("hidden")},onSuccess=function(response){var user;return user=$model.make_model("users",response.data),$auth.setUser(user),$scope.user=user,$el.find(".loading-overlay").removeClass("active"),$confirm.notify("success")},onError=function(response){return 413===response.status&&showSizeInfo(),$el.find(".loading-overlay").removeClass("active"),$confirm.notify("error",response.data._error_message)},$el.on("click",".js-change-avatar",function(){return $el.find("#avatar-field").click()}),$el.on("change","#avatar-field",function(event){return $scope.avatarAttachment?($el.find(".loading-overlay").addClass("active"),$rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess,onError)):void 0}),$el.on("click","a.js-use-gravatar",function(event){return $el.find(".loading-overlay").addClass("active"),$rs.userSettings.removeAvatar().then(onSuccess,onError)}),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgUserAvatar",["$tgAuth","$tgModel","$tgResources","$tgConfirm",UserAvatarDirective]),TaigaAvatarModelDirective=function($parse){var link;return link=function($scope,$el,$attrs){var model,modelSetter;return model=$parse($attrs.tgAvatarModel),modelSetter=model.assign,$el.bind("change",function(){return $scope.$apply(function(){return modelSetter($scope,$el[0].files[0])})})},{link:link}},module.directive("tgAvatarModel",["$parse",TaigaAvatarModelDirective])}.call(this),function(){var UserSettingsNavigationDirective,module;UserSettingsNavigationDirective=function(){var link;return link=function($scope,$el,$attrs){var section;return section=$attrs.tgUserSettingsNavigation,$el.find(".active").removeClass("active"),$el.find("#usersettingsmenu-"+section+" a").addClass("active"),$scope.$on("$destroy",function(){return $el.off()})},{link:link}},module=angular.module("taigaUserSettings"),module.directive("tgUserSettingsNavigation",UserSettingsNavigationDirective)}.call(this),function(){var UserNotificationsController,UserNotificationsDirective,UserNotificationsListDirective,bindOnce,mixOf,module,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,bindOnce=this.taiga.bindOnce,module=angular.module("taigaUserSettings"),UserNotificationsController=function(superClass){
function UserNotificationsController(scope,rootscope,repo,confirm,rs,params,q,location,navUrls,auth){var promise;this.scope=scope,this.rootscope=rootscope,this.repo=repo,this.confirm=confirm,this.rs=rs,this.params=params,this.q=q,this.location=location,this.navUrls=navUrls,this.auth=auth,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.SECTION_NAME",this.scope.user=this.auth.getUser(),promise=this.loadInitialData(),promise.then(null,this.onInitialDataError.bind(this))}return extend(UserNotificationsController,superClass),UserNotificationsController.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth"],UserNotificationsController.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then(function(_this){return function(notifyPolicies){return _this.scope.notifyPolicies=notifyPolicies,notifyPolicies}}(this))},UserNotificationsController}(mixOf(taiga.Controller,taiga.PageMixin)),module.controller("UserNotificationsController",UserNotificationsController),UserNotificationsDirective=function(){var link;return link=function($scope,$el,$attrs){return $scope.$on("$destroy",function(){return $el.off()})},{link:link}},module.directive("tgUserNotifications",UserNotificationsDirective),UserNotificationsListDirective=function($repo,$confirm,$compile){var link,template;return template=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-involved">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-none">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </fieldset>\n  </div>\n</div>\n<% }) %>'),link=function($scope,$el,$attrs){var render;return render=function(){var ctx,html;return $el.off(),ctx={notifyPolicies:$scope.notifyPolicies},html=template(ctx),$el.html($compile(html)($scope)),$el.on("change","input[type=radio]",function(event){var onError,onSuccess,policy,policyIndex,prev_level,target;return target=angular.element(event.currentTarget),policyIndex=target.parents(".policy-table-row").data("index"),policy=$scope.notifyPolicies[policyIndex],prev_level=policy.notify_level,policy.notify_level=parseInt(target.val(),10),onSuccess=function(){return $confirm.notify("success")},onError=function(){return $confirm.notify("error"),target.parents(".policy-table-row").find("input[value="+prev_level+"]").prop("checked",!0)},$repo.save(policy).then(onSuccess,onError)})},$scope.$on("$destroy",function(){return $el.off()}),bindOnce($scope,$attrs.ngModel,render)},{link:link}},module.directive("tgUserNotificationsList",["$tgRepo","$tgConfirm","$compile",UserNotificationsListDirective])}.call(this),function(){angular.module("taigaComponents",[])}.call(this),function(){var module;module=angular.module("taigaDiscover",[])}.call(this),function(){var module;module=angular.module("taigaExternalApps",[])}.call(this),function(){var module;module=angular.module("taigaHome",[])}.call(this),function(){angular.module("taigaNavigationBar",[])}.call(this),function(){var module;module=angular.module("taigaProfile",[])}.call(this),function(){angular.module("taigaProjects",[])}.call(this),function(){angular.module("taigaResources2",[])}.call(this),function(){angular.module("taigaUserTimeline",[])}.call(this),function(){var AttachmentLinkDirective;AttachmentLinkDirective=function($parse,lightboxFactory){var link;return link=function(scope,el,attrs){var attachment;return attachment=$parse(attrs.tgAttachmentLink)(scope),el.on("click",function(event){return taiga.isImage(attachment.getIn(["file","name"]))?(event.preventDefault(),scope.$apply(function(){return lightboxFactory.create("tg-lb-attachment-preview",{"class":"lightbox lightbox-block"},{file:attachment.get("file")})})):void 0}),scope.$on("$destroy",function(){return el.off()})},{link:link}},AttachmentLinkDirective.$inject=["$parse","tgLightboxFactory"],angular.module("taigaComponents").directive("tgAttachmentLink",AttachmentLinkDirective)}.call(this),function(){var AttachmentGalleryDirective;AttachmentGalleryDirective=function(){var link;return link=function(scope,el,attrs,ctrl){},{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment-gallery.html",link:link}},AttachmentGalleryDirective.$inject=[],angular.module("taigaComponents").directive("tgAttachmentGallery",AttachmentGalleryDirective)}.call(this),function(){var AttachmentController;AttachmentController=function(){function AttachmentController(attachmentsService,translate){this.attachmentsService=attachmentsService,this.translate=translate,this.form={},this.form.description=this.attachment.getIn(["file","description"]),this.form.is_deprecated=this.attachment.get(["file","is_deprecated"]),this.title=this.translate.instant("ATTACHMENT.TITLE",{fileName:this.attachment.get("name"),date:moment(this.attachment.get("created_date")).format(this.translate.instant("ATTACHMENT.DATE"))})}return AttachmentController.$inject=["tgAttachmentsService","$translate"],AttachmentController.prototype.editMode=function(mode){var attachment;return attachment=this.attachment.set("editable",mode),this.onUpdate({attachment:attachment})},AttachmentController.prototype["delete"]=function(){return this.onDelete({attachment:this.attachment})},AttachmentController.prototype.save=function(){var attachment;return attachment=this.attachment.set("loading",!0),this.onUpdate({attachment:attachment}),attachment=this.attachment.merge({editable:!1,loading:!1}),attachment=attachment.mergeIn(["file"],{description:this.form.description,is_deprecated:!!this.form.is_deprecated}),this.onUpdate({attachment:attachment})},AttachmentController}(),angular.module("taigaComponents").controller("Attachment",AttachmentController)}.call(this),function(){var AttachmentDirective;AttachmentDirective=function(){var link;return link=function(scope,el,attrs,ctrl){},{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment.html",link:link}},AttachmentDirective.$inject=[],angular.module("taigaComponents").directive("tgAttachment",AttachmentDirective)}.call(this),function(){var AttachmentsDropDirective;AttachmentsDropDirective=function($parse){var link;return link=function(scope,el,attrs){var eventAttr;return eventAttr=$parse(attrs.tgAttachmentsDrop),el.on("dragover",function(e){return e.preventDefault(),!1}),el.on("drop",function(e){var dataTransfer;return e.stopPropagation(),e.preventDefault(),dataTransfer=e.dataTransfer||e.originalEvent&&e.originalEvent.dataTransfer,scope.$apply(function(){return eventAttr(scope,{files:dataTransfer.files})})}),scope.$on("$destroy",function(){return el.off()})},{link:link}},AttachmentsDropDirective.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsDrop",AttachmentsDropDirective)}.call(this),function(){var AttachmentsFullController,sizeFormat;sizeFormat=this.taiga.sizeFormat,AttachmentsFullController=function(){function AttachmentsFullController(translate,confirm,config,storage,attachmentsFullService){this.translate=translate,this.confirm=confirm,this.config=config,this.storage=storage,this.attachmentsFullService=attachmentsFullService,this.mode=this.storage.get("attachment-mode","list"),this.maxFileSize=this.config.get("maxUploadFileSize",null),this.maxFileSize&&(this.maxFileSize=sizeFormat(this.maxFileSize)),this.maxFileSizeMsg=this.maxFileSize?this.translate.instant("ATTACHMENT.MAX_UPLOAD_SIZE",{maxFileSize:this.maxFileSize}):"",taiga.defineImmutableProperty(this,"attachments",function(_this){return function(){return _this.attachmentsFullService.attachments}}(this)),taiga.defineImmutableProperty(this,"deprecatedsCount",function(_this){return function(){return _this.attachmentsFullService.deprecatedsCount}}(this)),taiga.defineImmutableProperty(this,"attachmentsVisible",function(_this){return function(){return _this.attachmentsFullService.attachmentsVisible}}(this)),taiga.defineImmutableProperty(this,"deprecatedsVisible",function(_this){return function(){return _this.attachmentsFullService.deprecatedsVisible}}(this))}return AttachmentsFullController.$inject=["$translate","$tgConfirm","$tgConfig","$tgStorage","tgAttachmentsFullService"],AttachmentsFullController.prototype.uploadingAttachments=function(){return this.attachmentsFullService.uploadingAttachments},AttachmentsFullController.prototype.addAttachment=function(file){var editable;return editable="list"===this.mode,this.attachmentsFullService.addAttachment(this.projectId,this.objId,this.type,file,editable)},AttachmentsFullController.prototype.setMode=function(mode){return this.mode=mode,this.storage.set("attachment-mode",mode)},AttachmentsFullController.prototype.toggleDeprecatedsVisible=function(){return this.attachmentsFullService.toggleDeprecatedsVisible()},AttachmentsFullController.prototype.addAttachments=function(files){return _.forEach(files,function(_this){return function(file){return _this.addAttachment(file)}}(this))},AttachmentsFullController.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments(this.type,this.objId,this.projectId)},AttachmentsFullController.prototype.deleteAttachment=function(toDeleteAttachment){var message,title;return title=this.translate.instant("ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT"),message=this.translate.instant("ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT",{fileName:toDeleteAttachment.getIn(["file","name"])}),this.confirm.askOnDelete(title,message).then(function(_this){return function(askResponse){var onError,onSuccess;return onError=function(){return message=_this.translate.instant("ATTACHMENT.ERROR_DELETE_ATTACHMENT",{errorMessage:message}),_this.confirm.notify("error",null,message),askResponse.finish(!1)},onSuccess=function(){return askResponse.finish()},_this.attachmentsFullService.deleteAttachment(toDeleteAttachment,_this.type).then(onSuccess,onError)}}(this))},AttachmentsFullController.prototype.reorderAttachment=function(attachment,newIndex){return this.attachmentsFullService.reorderAttachment(this.type,attachment,newIndex)},AttachmentsFullController.prototype.updateAttachment=function(toUpdateAttachment){return this.attachmentsFullService.updateAttachment(toUpdateAttachment,this.type)},AttachmentsFullController}(),angular.module("taigaComponents").controller("AttachmentsFull",AttachmentsFullController)}.call(this),function(){var AttachmentsFullDirective,bindOnce;bindOnce=this.taiga.bindOnce,AttachmentsFullDirective=function(){var link;return link=function(scope,el,attrs,ctrl){return bindOnce(scope,"vm.objId",function(value){return ctrl.loadAttachments()})},{scope:{},bindToController:{type:"@",objId:"=",projectId:"="},controller:"AttachmentsFull",controllerAs:"vm",templateUrl:"components/attachments-full/attachments-full.html",link:link}},AttachmentsFullDirective.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsFull",AttachmentsFullDirective)}.call(this),function(){var AttachmentsFullService,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;AttachmentsFullService=function(superClass){function AttachmentsFullService(attachmentsService,rootScope){this.attachmentsService=attachmentsService,this.rootScope=rootScope,this._attachments=Immutable.List(),this._deprecatedsCount=0,this._attachmentsVisible=Immutable.List(),this._deprecatedsVisible=!1,this.uploadingAttachments=[],taiga.defineImmutableProperty(this,"attachments",function(_this){return function(){return _this._attachments}}(this)),taiga.defineImmutableProperty(this,"deprecatedsCount",function(_this){return function(){return _this._deprecatedsCount}}(this)),taiga.defineImmutableProperty(this,"attachmentsVisible",function(_this){return function(){return _this._attachmentsVisible}}(this)),taiga.defineImmutableProperty(this,"deprecatedsVisible",function(_this){return function(){return _this._deprecatedsVisible}}(this))}return extend(AttachmentsFullService,superClass),AttachmentsFullService.$inject=["tgAttachmentsService","$rootScope"],AttachmentsFullService.prototype.toggleDeprecatedsVisible=function(){return this._deprecatedsVisible=!this._deprecatedsVisible,this.regenerate()},AttachmentsFullService.prototype.regenerate=function(){return this._deprecatedsCount=this._attachments.count(function(it){return it.getIn(["file","is_deprecated"])}),this._deprecatedsVisible?this._attachmentsVisible=this._attachments:this._attachmentsVisible=this._attachments.filter(function(it){return!it.getIn(["file","is_deprecated"])})},AttachmentsFullService.prototype.addAttachment=function(projectId,objId,type,file,editable){return null==editable&&(editable=!0),new Promise(function(_this){return function(resolve,reject){var promise;return _this.attachmentsService.validate(file)?(_this.uploadingAttachments.push(file),promise=_this.attachmentsService.upload(file,objId,projectId,type),promise.then(function(file){var attachment;return _this.uploadingAttachments=_this.uploadingAttachments.filter(function(uploading){return uploading.name!==file.get("name")}),attachment=Immutable.Map(),attachment=attachment.merge({file:file,editable:editable,loading:!1}),_this._attachments=_this._attachments.push(attachment),_this.regenerate(),_this.rootScope.$broadcast("attachment:create"),resolve(attachment)})):reject(file)}}(this))},AttachmentsFullService.prototype.loadAttachments=function(type,objId,projectId){return this.attachmentsService.list(type,objId,projectId).then(function(_this){return function(files){return _this._attachments=files.map(function(file){var attachment;return attachment=Immutable.Map(),attachment.merge({loading:!1,editable:!1,file:file})}),_this.regenerate()}}(this))},AttachmentsFullService.prototype.deleteAttachment=function(toDeleteAttachment,type){var onSuccess;return onSuccess=function(_this){return function(){return _this._attachments=_this._attachments.filter(function(attachment){return attachment!==toDeleteAttachment}),_this.regenerate()}}(this),this.attachmentsService["delete"](type,toDeleteAttachment.getIn(["file","id"])).then(onSuccess)},AttachmentsFullService.prototype.reorderAttachment=function(type,attachment,newIndex){var attachments,oldIndex,promises;return oldIndex=this.attachments.findIndex(function(it){return it===attachment}),oldIndex!==newIndex?(attachments=this.attachments.remove(oldIndex),attachments=attachments.splice(newIndex,0,attachment),attachments=attachments.map(function(x,i){return x.setIn(["file","order"],i+1)}),promises=[],attachments.forEach(function(_this){return function(attachment){var patch;return patch={order:attachment.getIn(["file","order"])},promises.push(_this.attachmentsService.patch(attachment.getIn(["file","id"]),type,patch))}}(this)),Promise.all(promises).then(function(_this){return function(){return _this._attachments=attachments,_this.regenerate()}}(this))):void 0},AttachmentsFullService.prototype.updateAttachment=function(toUpdateAttachment,type){var index,oldAttachment,patch;return index=this._attachments.findIndex(function(attachment){return attachment.getIn(["file","id"])===toUpdateAttachment.getIn(["file","id"])}),oldAttachment=this._attachments.get(index),patch=taiga.patch(oldAttachment.get("file"),toUpdateAttachment.get("file")),toUpdateAttachment.get("loading")?(this._attachments=this._attachments.set(index,toUpdateAttachment),this.regenerate()):this.attachmentsService.patch(toUpdateAttachment.getIn(["file","id"]),type,patch).then(function(_this){return function(){return _this._attachments=_this._attachments.set(index,toUpdateAttachment),_this.regenerate()}}(this))},AttachmentsFullService}(taiga.Service),angular.module("taigaComponents").service("tgAttachmentsFullService",AttachmentsFullService)}.call(this),function(){var AttachmentsSimpleController;AttachmentsSimpleController=function(){function AttachmentsSimpleController(attachmentsService){this.attachmentsService=attachmentsService}return AttachmentsSimpleController.$inject=["tgAttachmentsService"],AttachmentsSimpleController.prototype.addAttachment=function(file){var attachment;return attachment=Immutable.fromJS({file:file,name:file.name,size:file.size}),this.attachmentsService.validate(file)&&(this.attachments=this.attachments.push(attachment),this.onAdd)?this.onAdd({attachment:attachment}):void 0},AttachmentsSimpleController.prototype.addAttachments=function(files){return _.forEach(files,this.addAttachment.bind(this))},AttachmentsSimpleController.prototype.deleteAttachment=function(toDeleteAttachment){return this.attachments=this.attachments.filter(function(attachment){return attachment!==toDeleteAttachment}),this.onDelete?this.onDelete({attachment:toDeleteAttachment}):void 0},AttachmentsSimpleController}(),angular.module("taigaComponents").controller("AttachmentsSimple",AttachmentsSimpleController)}.call(this),function(){var AttachmentsSimpleDirective;AttachmentsSimpleDirective=function(){var link;return link=function(scope,el,attrs,ctrl){},{scope:{},bindToController:{attachments:"=",onAdd:"&",onDelete:"&"},controller:"AttachmentsSimple",controllerAs:"vm",templateUrl:"components/attachments-simple/attachments-simple.html",link:link}},AttachmentsSimpleDirective.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsSimple",AttachmentsSimpleDirective)}.call(this),function(){var AttachmentSortableDirective;AttachmentSortableDirective=function($parse){var link;return link=function(scope,el,attrs){var callback;return callback=$parse(attrs.tgAttachmentsSortable),el.sortable({items:"div[tg-bind-scope]",handle:"a.settings.icon.icon-drag-v",containment:".attachments",dropOnEmpty:!0,helper:"clone",scroll:!1,tolerance:"pointer",placeholder:"sortable-placeholder single-attachment"}),el.on("sortstop",function(event,ui){var attachment,newIndex;return attachment=ui.item.scope().attachment,newIndex=ui.item.index(),scope.$apply(function(){return callback(scope,{attachment:attachment,index:newIndex})})}),scope.$on("$destroy",function(){return el.off()})},{link:link}},AttachmentSortableDirective.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsSortable",AttachmentSortableDirective)}.call(this),function(){var AutoSelectDirective;AutoSelectDirective=function($timeout){return{link:function(scope,elm){return $timeout(function(){return elm[0].select()})}}},AutoSelectDirective.$inject=["$timeout"],angular.module("taigaComponents").directive("tgAutoSelect",AutoSelectDirective)}.call(this),function(){var FileChangeDirective;FileChangeDirective=function($parse){var link;return link=function(scope,el,attrs,ctrl){var eventAttr;return eventAttr=$parse(attrs.tgFileChange),el.on("change",function(event){return scope.$apply(function(){return eventAttr(scope,{files:event.currentTarget.files})})}),scope.$on("$destroy",function(){return el.off()})},{require:"ngModel",restrict:"A",link:link}},FileChangeDirective.$inject=["$parse"],angular.module("taigaComponents").directive("tgFileChange",FileChangeDirective)}.call(this),function(){var JoyRideDirective,taiga;taiga=this.taiga,JoyRideDirective=function($rootScope,currentUserService,joyRideService,$location,$translate){var link;return link=function(scope,el,attrs,ctrl){var initJoyrRide,intro,unsuscribe;return unsuscribe=null,intro=introJs(),intro.oncomplete(function(){return $("html,body").scrollTop(0)}),intro.onexit(function(){return currentUserService.disableJoyRide()}),initJoyrRide=function(next,config){return config[next.joyride]?(intro.setOptions({exitOnEsc:!1,exitOnOverlayClick:!1,showStepNumbers:!1,nextLabel:$translate.instant("JOYRIDE.NAV.NEXT")+" &rarr;",prevLabel:"&larr; "+$translate.instant("JOYRIDE.NAV.BACK"),skipLabel:$translate.instant("JOYRIDE.NAV.SKIP"),doneLabel:$translate.instant("JOYRIDE.NAV.DONE"),disableInteraction:!0}),intro.setOption("steps",joyRideService.get(next.joyride)),intro.start()):void 0},$rootScope.$on("$routeChangeSuccess",function(event,next){return next.joyride&&currentUserService.isAuthenticated()?(intro.oncomplete(function(){return currentUserService.disableJoyRide(next.joyride)}),next.loader?unsuscribe=$rootScope.$on("loader:end",function(){return currentUserService.loadJoyRideConfig().then(function(config){return initJoyrRide(next,config)}),unsuscribe()}):currentUserService.loadJoyRideConfig().then(function(config){return initJoyrRide(next,config)})):(intro.exit(),void(unsuscribe&&unsuscribe()))})},{scope:{},link:link}},JoyRideDirective.$inject=["$rootScope","tgCurrentUserService","tgJoyRideService","$location","$translate"],angular.module("taigaComponents").directive("tgJoyRide",JoyRideDirective)}.call(this),function(){var JoyRideService,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;JoyRideService=function(superClass){function JoyRideService(translate,checkPermissionsService){this.translate=translate,this.checkPermissionsService=checkPermissionsService}return extend(JoyRideService,superClass),JoyRideService.$inject=["$translate","tgCheckPermissionsService"],JoyRideService.prototype.getConfig=function(){return{dashboard:function(_this){return function(){var steps;return steps=[{element:".project-list > section:not(.ng-hide)",position:"left",joyride:{title:_this.translate.instant("JOYRIDE.DASHBOARD.STEP1.TITLE"),text:_this.translate.instant("JOYRIDE.DASHBOARD.STEP1.TEXT")}},{element:".working-on-container",position:"right",joyride:{title:_this.translate.instant("JOYRIDE.DASHBOARD.STEP2.TITLE"),text:_this.translate.instant("JOYRIDE.DASHBOARD.STEP2.TEXT")}},{element:".watching-container",position:"right",joyride:{title:_this.translate.instant("JOYRIDE.DASHBOARD.STEP3.TITLE"),text:[_this.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT1"),_this.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT2")]}}],$(".project-list .create-project-button").is(":hidden")||steps.push({element:".project-list .create-project-button",position:"bottom",joyride:{title:_this.translate.instant("JOYRIDE.DASHBOARD.STEP4.TITLE"),text:[_this.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT1"),_this.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT2")]}}),steps}}(this),backlog:function(_this){return function(){var steps;return steps=[{element:".summary",position:"bottom",joyride:{title:_this.translate.instant("JOYRIDE.BACKLOG.STEP1.TITLE"),text:[_this.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT1"),_this.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT2")]}},{element:".backlog-table-empty",position:"bottom",joyride:{title:_this.translate.instant("JOYRIDE.BACKLOG.STEP2.TITLE"),text:_this.translate.instant("JOYRIDE.BACKLOG.STEP2.TEXT")}},{element:".sprints",position:"left",joyride:{title:_this.translate.instant("JOYRIDE.BACKLOG.STEP3.TITLE"),text:_this.translate.instant("JOYRIDE.BACKLOG.STEP3.TEXT")}}],_this.checkPermissionsService.check("add_us")&&steps.push({element:".new-us",position:"rigth",joyride:{title:_this.translate.instant("JOYRIDE.BACKLOG.STEP4.TITLE"),text:_this.translate.instant("JOYRIDE.BACKLOG.STEP4.TEXT")}}),steps}}(this),kanban:function(_this){return function(){var steps;return steps=[{element:".kanban-table-inner",position:"bottom",joyride:{title:_this.translate.instant("JOYRIDE.KANBAN.STEP1.TITLE"),text:_this.translate.instant("JOYRIDE.KANBAN.STEP1.TEXT")}},{element:".card-placeholder",position:"right",joyride:{title:_this.translate.instant("JOYRIDE.KANBAN.STEP2.TITLE"),text:_this.translate.instant("JOYRIDE.KANBAN.STEP2.TEXT")}}],_this.checkPermissionsService.check("add_us")&&steps.push({element:".icon-plus",position:"bottom",joyride:{title:_this.translate.instant("JOYRIDE.KANBAN.STEP3.TITLE"),text:[_this.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT1"),_this.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT2")]}}),steps}}(this)}},JoyRideService.prototype.get=function(name){var joyRide,joyRides;return joyRides=this.getConfig(),joyRide=joyRides[name].call(this),_.map(joyRide,function(item){var html;return html="",item.joyride.title&&(html+="<h3>"+item.joyride.title+"</h3>"),_.isArray(item.joyride.text)?_.forEach(item.joyride.text,function(text){return html+="<p>"+text+"</p>"}):html+="<p>"+item.joyride.text+"</p>",item.intro=html,item})},JoyRideService}(taiga.Service),angular.module("taigaComponents").service("tgJoyRideService",JoyRideService)}.call(this),function(){var LiveAnnouncementDirective;LiveAnnouncementDirective=function(liveAnnouncementService){var link;return link=function(scope,el,attrs){},{restrict:"AE",scope:{},controllerAs:"vm",controller:function(){return this.close=function(){return liveAnnouncementService.open=!1},Object.defineProperties(this,{open:{get:function(){return liveAnnouncementService.open}},title:{get:function(){return liveAnnouncementService.title}},desc:{get:function(){return liveAnnouncementService.desc}}})},link:link,templateUrl:"components/live-announcement/live-announcement.html"}},LiveAnnouncementDirective.$inject=["tgLiveAnnouncementService"],angular.module("taigaComponents").directive("tgLiveAnnouncement",LiveAnnouncementDirective)}.call(this),function(){var LiveAnnouncementService,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;LiveAnnouncementService=function(superClass){function LiveAnnouncementService(){this.open=!1,this.title="",this.desc=""}return extend(LiveAnnouncementService,superClass),LiveAnnouncementService.prototype.show=function(title,desc){return this.open=!0,this.title=title,this.desc=desc},LiveAnnouncementService}(taiga.Service),angular.module("taigaComponents").service("tgLiveAnnouncementService",LiveAnnouncementService)}.call(this),function(){var COLORS,IMAGES,LOGOS,ProjectLogoSrcDirective,modulo=function(a,b){return(+a%(b=+b)+b)%b};IMAGES=["/"+window._version+"/images/project-logos/project-logo-01.png","/"+window._version+"/images/project-logos/project-logo-02.png","/"+window._version+"/images/project-logos/project-logo-03.png","/"+window._version+"/images/project-logos/project-logo-04.png","/"+window._version+"/images/project-logos/project-logo-05.png"],COLORS=["rgba( 153,  214, 220, 1 )","rgba( 213,  156,  156, 1 )","rgba( 214, 161, 212,  1 )","rgba( 164, 162, 219, 1 )","rgba( 152, 224, 168,  1 )"],LOGOS=_.cartesianProduct(IMAGES,COLORS),ProjectLogoSrcDirective=function($parse){var _getDefaultProjectLogo,link;return _getDefaultProjectLogo=function(project){var idx,key,logo;return key=project.get("slug")+"-"+project.get("id"),idx=modulo(murmurhash3_32_gc(key,42),LOGOS.length),logo=LOGOS[idx],{src:logo[0],color:logo[1]}},link=function(scope,el,attrs){return scope.$watch("project",function(project){var logo,projectLogo;return(project=Immutable.fromJS(project))?(projectLogo=project.get("logo_big_url"),projectLogo?(el.attr("src",projectLogo),el.css("background","")):(logo=_getDefaultProjectLogo(project),el.attr("src",logo.src),el.css("background",logo.color))):void 0}),scope.$on("$destroy",function(){return el.off()})},{link:link,scope:{project:"=tgProjectLogoSrc"}}},ProjectLogoSrcDirective.$inject=["$parse"],angular.module("taigaComponents").directive("tgProjectLogoSrc",ProjectLogoSrcDirective)}.call(this),function(){var ProjectMenuController;ProjectMenuController=function(){function ProjectMenuController(projectService,lightboxFactory){this.projectService=projectService,this.lightboxFactory=lightboxFactory,this.project=null,this.menu=Immutable.Map()}return ProjectMenuController.$inject=["tgProjectService","tgLightboxFactory"],ProjectMenuController.prototype.show=function(){return this.project=this.projectService.project,this.active=this._getActiveSection(),this._setVideoConference(),this._setMenuPermissions()},ProjectMenuController.prototype.hide=function(){return this.project=null,this.menu={}},ProjectMenuController.prototype.search=function(){return this.lightboxFactory.create("tg-search-box",{"class":"lightbox lightbox-search"})},ProjectMenuController.prototype._setVideoConference=function(){var videoconferenceUrl;return videoconferenceUrl=this._videoConferenceUrl(),videoconferenceUrl?this.project=this.project.set("videoconferenceUrl",videoconferenceUrl):void 0},ProjectMenuController.prototype._setMenuPermissions=function(){return this.menu=Immutable.Map({backlog:!1,kanban:!1,issues:!1,wiki:!1}),this.project.get("is_backlog_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("backlog",!0)),this.project.get("is_kanban_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("kanban",!0)),this.project.get("is_issues_activated")&&-1!==this.project.get("my_permissions").indexOf("view_issues")&&(this.menu=this.menu.set("issues",!0)),this.project.get("is_wiki_activated")&&-1!==this.project.get("my_permissions").indexOf("view_wiki_pages")?this.menu=this.menu.set("wiki",!0):void 0},ProjectMenuController.prototype._getActiveSection=function(){var indexBacklog,indexKanban,oldSectionName,sectionName,sectionsBreadcrumb;return sectionName=this.projectService.section,sectionsBreadcrumb=this.projectService.sectionsBreadcrumb,indexBacklog=sectionsBreadcrumb.lastIndexOf("backlog"),indexKanban=sectionsBreadcrumb.lastIndexOf("kanban"),(-1!==indexBacklog||-1!==indexKanban)&&(oldSectionName=-1===indexKanban||indexBacklog>indexKanban?"backlog":"kanban"),"backlog-kanban"===sectionName&&("backlog"===oldSectionName||"kanban"===oldSectionName?sectionName=oldSectionName:this.project.get("is_backlog_activated")&&!this.project.get("is_kanban_activated")?sectionName="backlog":!this.project.get("is_backlog_activated")&&this.project.get("is_kanban_activated")&&(sectionName="kanban")),sectionName},ProjectMenuController.prototype._videoConferenceUrl=function(){var baseUrl,url;if("appear-in"===this.project.get("videoconferences"))baseUrl="https://appear.in/";else{if("talky"!==this.project.get("videoconferences"))return"jitsi"===this.project.get("videoconferences")?(baseUrl="https://meet.jit.si/",url=this.project.get("slug")+"-"+taiga.slugify(this.project.get("videoconferences_extra_data")),url=url.replace(/-/g,""),baseUrl+url):"custom"===this.project.get("videoconferences")?this.project.get("videoconferences_extra_data"):"";baseUrl="https://talky.io/"}return url=this.project.get("videoconferences_extra_data")?this.project.get("slug")+"-"+this.project.get("videoconferences_extra_data"):this.project.get("slug"),
baseUrl+url},ProjectMenuController}(),angular.module("taigaComponents").controller("ProjectMenu",ProjectMenuController)}.call(this),function(){var ProjectMenuDirective,taiga;taiga=this.taiga,ProjectMenuDirective=function(projectService,lightboxFactory){var link;return link=function(scope,el,attrs,ctrl){var projectChange;return projectChange=function(){return projectService.project?ctrl.show():ctrl.hide()},scope.$watch(function(){return projectService.project},projectChange),scope.vm.fixed=!1,$(window).on("scroll",function(){var position;return position=$(window).scrollTop(),position>100&&scope.vm.fixed===!1?(scope.vm.fixed=!0,scope.$digest()):100>position&&scope.vm.fixed===!0?(scope.vm.fixed=!1,scope.$digest()):void 0})},{scope:{},controller:"ProjectMenu",controllerAs:"vm",templateUrl:"components/project-menu/project-menu.html",link:link}},ProjectMenuDirective.$inject=["tgProjectService","tgLightboxFactory"],angular.module("taigaComponents").directive("tgProjectMenu",ProjectMenuDirective)}.call(this),function(){var TermsOfServiceAndPrivacyPolicyNoticeDirective;TermsOfServiceAndPrivacyPolicyNoticeDirective=function($config){var link;return link=function(scope,el,attrs){return scope.privacyPolicyUrl=$config.get("privacyPolicyUrl"),scope.termsOfServiceUrl=$config.get("termsOfServiceUrl")},{restrict:"AE",scope:{},link:link,templateUrl:"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html"}},angular.module("taigaComponents").directive("tgTermsOfServiceAndPrivacyPolicyNotice",["$tgConfig",TermsOfServiceAndPrivacyPolicyNoticeDirective])}.call(this),function(){var VoteButtonController;VoteButtonController=function(){function VoteButtonController(currentUserService){this.currentUserService=currentUserService,this.user=this.currentUserService.getUser(),this.isMouseOver=!1,this.loading=!1}return VoteButtonController.$inject=["tgCurrentUserService"],VoteButtonController.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},VoteButtonController.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},VoteButtonController.prototype.toggleVote=function(){var promise;return this.loading=!0,promise=this.item.is_voter?this._downvote():this._upvote(),promise["finally"](function(_this){return function(){return _this.loading=!1}}(this)),promise},VoteButtonController.prototype._upvote=function(){return this.onUpvote().then(function(_this){return function(){return _this.showTextWhenMouseIsLeave()}}(this))},VoteButtonController.prototype._downvote=function(){return this.onDownvote()},VoteButtonController}(),angular.module("taigaComponents").controller("VoteButton",VoteButtonController)}.call(this),function(){var VoteButtonDirective;VoteButtonDirective=function(){return{scope:{},controller:"VoteButton",bindToController:{item:"=",onUpvote:"=",onDownvote:"="},controllerAs:"vm",templateUrl:"components/vote-button/vote-button.html"}},angular.module("taigaComponents").directive("tgVoteButton",VoteButtonDirective)}.call(this),function(){var WatchButtonController;WatchButtonController=function(){function WatchButtonController(currentUserService,rootScope){this.currentUserService=currentUserService,this.rootScope=rootScope,this.user=this.currentUserService.getUser(),this.isMouseOver=!1,this.loading=!1}return WatchButtonController.$inject=["tgCurrentUserService","$rootScope"],WatchButtonController.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},WatchButtonController.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},WatchButtonController.prototype.openWatchers=function(){return this.rootScope.$broadcast("watcher:add",this.item)},WatchButtonController.prototype.getPerms=function(){var name,perms;return this.item?(name=this.item._name,perms={userstories:"modify_us",issues:"modify_issue",tasks:"modify_task"},perms[name]):""},WatchButtonController.prototype.toggleWatch=function(){var promise;return this.loading=!0,promise=this.item.is_watcher?this._unwatch():this._watch(),promise["finally"](function(_this){return function(){return _this.loading=!1}}(this)),promise},WatchButtonController.prototype._watch=function(){return this.onWatch().then(function(_this){return function(){return _this.showTextWhenMouseIsLeave()}}(this))},WatchButtonController.prototype._unwatch=function(){return this.onUnwatch()},WatchButtonController}(),angular.module("taigaComponents").controller("WatchButton",WatchButtonController)}.call(this),function(){var WatchButtonDirective;WatchButtonDirective=function(){return{scope:{},controller:"WatchButton",bindToController:{item:"=",onWatch:"=",onUnwatch:"="},controllerAs:"vm",templateUrl:function(item,attributes){return"components/watch-button/watch-button-"+attributes.environment+".html"}}},angular.module("taigaComponents").directive("tgWatchButton",WatchButtonDirective)}.call(this),function(){var DiscoverHomeOrderByController;DiscoverHomeOrderByController=function(){function DiscoverHomeOrderByController(translate){this.translate=translate,this.is_open=!1,this.texts={week:this.translate.instant("DISCOVER.FILTERS.WEEK"),month:this.translate.instant("DISCOVER.FILTERS.MONTH"),year:this.translate.instant("DISCOVER.FILTERS.YEAR"),all:this.translate.instant("DISCOVER.FILTERS.ALL_TIME")}}return DiscoverHomeOrderByController.$inject=["$translate"],DiscoverHomeOrderByController.prototype.currentText=function(){return this.texts[this.currentOrderBy]},DiscoverHomeOrderByController.prototype.open=function(){return this.is_open=!0},DiscoverHomeOrderByController.prototype.close=function(){return this.is_open=!1},DiscoverHomeOrderByController.prototype.orderBy=function(type){return this.currentOrderBy=type,this.is_open=!1,this.onChange({orderBy:this.currentOrderBy})},DiscoverHomeOrderByController}(),angular.module("taigaDiscover").controller("DiscoverHomeOrderBy",DiscoverHomeOrderByController)}.call(this),function(){var DiscoverHomeOrderByDirective;DiscoverHomeOrderByDirective=function(){var link;return link=function(scope,el,attrs){},{controller:"DiscoverHomeOrderBy",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-home-order-by/discover-home-order-by.html",scope:{currentOrderBy:"=orderBy",onChange:"&"},link:link}},DiscoverHomeOrderByDirective.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverHomeOrderBy",DiscoverHomeOrderByDirective)}.call(this),function(){var DiscoverSearchBarController;DiscoverSearchBarController=function(){function DiscoverSearchBarController(discoverProjectsService){this.discoverProjectsService=discoverProjectsService,taiga.defineImmutableProperty(this,"projects",function(_this){return function(){return _this.discoverProjectsService.projectsCount}}(this)),this.discoverProjectsService.fetchStats()}return DiscoverSearchBarController.$inject=["tgDiscoverProjectsService"],DiscoverSearchBarController.prototype.selectFilter=function(filter){return this.onChange({filter:filter,q:this.q})},DiscoverSearchBarController.prototype.submitFilter=function(){return this.onChange({filter:this.filter,q:this.q})},DiscoverSearchBarController}(),angular.module("taigaDiscover").controller("DiscoverSearchBar",DiscoverSearchBarController)}.call(this),function(){var DiscoverSearchBarDirective;DiscoverSearchBarDirective=function(){var link;return link=function(scope,el,attrs,ctrl){},{controller:"DiscoverSearchBar",controllerAs:"vm",templateUrl:"discover/components/discover-search-bar/discover-search-bar.html",bindToController:!0,scope:{q:"=",filter:"=",onChange:"&"},link:link}},DiscoverSearchBarDirective.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchBar",DiscoverSearchBarDirective)}.call(this),function(){var DiscoverSearchListHeaderController;DiscoverSearchListHeaderController=function(){function DiscoverSearchListHeaderController(){this.like_is_open=0===this.orderBy.indexOf("-total_fans"),this.activity_is_open=0===this.orderBy.indexOf("-total_activity")}return DiscoverSearchListHeaderController.$inject=[],DiscoverSearchListHeaderController.prototype.openLike=function(){return this.like_is_open=!0,this.activity_is_open=!1,this.setOrderBy("-total_fans_last_week")},DiscoverSearchListHeaderController.prototype.openActivity=function(){return this.activity_is_open=!0,this.like_is_open=!1,this.setOrderBy("-total_activity_last_week")},DiscoverSearchListHeaderController.prototype.setOrderBy=function(type){return null==type&&(type=""),type||(this.like_is_open=!1,this.activity_is_open=!1),this.onChange({orderBy:type})},DiscoverSearchListHeaderController}(),angular.module("taigaDiscover").controller("DiscoverSearchListHeader",DiscoverSearchListHeaderController)}.call(this),function(){var DiscoverSearchListHeaderDirective;DiscoverSearchListHeaderDirective=function(){var link;return link=function(scope,el,attrs){},{controller:"DiscoverSearchListHeader",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-search-list-header/discover-search-list-header.html",scope:{onChange:"&",orderBy:"="},link:link}},DiscoverSearchListHeaderDirective.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchListHeader",DiscoverSearchListHeaderDirective)}.call(this),function(){var FeaturedProjectsController;FeaturedProjectsController=function(){function FeaturedProjectsController(discoverProjectsService){this.discoverProjectsService=discoverProjectsService,taiga.defineImmutableProperty(this,"featured",function(_this){return function(){return _this.discoverProjectsService.featured}}(this)),this.discoverProjectsService.fetchFeatured()}return FeaturedProjectsController.$inject=["tgDiscoverProjectsService"],FeaturedProjectsController}(),angular.module("taigaDiscover").controller("FeaturedProjects",FeaturedProjectsController)}.call(this),function(){var FeaturedProjectsDirective;FeaturedProjectsDirective=function(){var link;return link=function(scope,el,attrs){},{controller:"FeaturedProjects",controllerAs:"vm",templateUrl:"discover/components/featured-projects/featured-projects.html",scope:{},link:link}},FeaturedProjectsDirective.$inject=[],angular.module("taigaDiscover").directive("tgFeaturedProjects",FeaturedProjectsDirective)}.call(this),function(){var HighlightedDirective;HighlightedDirective=function(){return{templateUrl:"discover/components/highlighted/highlighted.html",scope:{loading:"=",highlighted:"=",orderBy:"="}}},HighlightedDirective.$inject=[],angular.module("taigaDiscover").directive("tgHighlighted",HighlightedDirective)}.call(this),function(){var MostActiveController;MostActiveController=function(){function MostActiveController(discoverProjectsService){this.discoverProjectsService=discoverProjectsService,taiga.defineImmutableProperty(this,"highlighted",function(_this){return function(){return _this.discoverProjectsService.mostActive}}(this)),this.currentOrderBy="week",this.order_by=this.getOrderBy()}return MostActiveController.$inject=["tgDiscoverProjectsService"],MostActiveController.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostActive({order_by:this.order_by}).then(function(_this){return function(){return _this.loading=!1}}(this))},MostActiveController.prototype.orderBy=function(type){return this.currentOrderBy=type,this.fetch()},MostActiveController.prototype.getOrderBy=function(type){return"all"===this.currentOrderBy?"-total_activity":"-total_activity_last_"+this.currentOrderBy},MostActiveController}(),angular.module("taigaDiscover").controller("MostActive",MostActiveController)}.call(this),function(){var MostActiveDirective;MostActiveDirective=function(){var link;return link=function(scope,el,attrs,ctrl){return ctrl.fetch()},{controller:"MostActive",controllerAs:"vm",templateUrl:"discover/components/most-active/most-active.html",scope:{},link:link}},MostActiveDirective.$inject=[],angular.module("taigaDiscover").directive("tgMostActive",MostActiveDirective)}.call(this),function(){var MostLikedController;MostLikedController=function(){function MostLikedController(discoverProjectsService){this.discoverProjectsService=discoverProjectsService,taiga.defineImmutableProperty(this,"highlighted",function(_this){return function(){return _this.discoverProjectsService.mostLiked}}(this)),this.currentOrderBy="week",this.order_by=this.getOrderBy()}return MostLikedController.$inject=["tgDiscoverProjectsService"],MostLikedController.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostLiked({order_by:this.order_by}).then(function(_this){return function(){return _this.loading=!1}}(this))},MostLikedController.prototype.orderBy=function(type){return this.currentOrderBy=type,this.fetch()},MostLikedController.prototype.getOrderBy=function(){return"all"===this.currentOrderBy?"-total_fans":"-total_fans_last_"+this.currentOrderBy},MostLikedController}(),angular.module("taigaDiscover").controller("MostLiked",MostLikedController)}.call(this),function(){var MostLikedDirective;MostLikedDirective=function(){var link;return link=function(scope,el,attrs,ctrl){return ctrl.fetch()},{controller:"MostLiked",controllerAs:"vm",templateUrl:"discover/components/most-liked/most-liked.html",scope:{},link:link}},MostLikedDirective.$inject=[],angular.module("taigaDiscover").directive("tgMostLiked",MostLikedDirective)}.call(this),function(){var DiscoverHomeController;DiscoverHomeController=function(){function DiscoverHomeController(location,navUrls,appMetaService,translate){var description,title;this.location=location,this.navUrls=navUrls,this.appMetaService=appMetaService,this.translate=translate,title=this.translate.instant("DISCOVER.PAGE_TITLE"),description=this.translate.instant("DISCOVER.PAGE_DESCRIPTION"),this.appMetaService.setAll(title,description)}return DiscoverHomeController.$inject=["$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],DiscoverHomeController.prototype.onSubmit=function(q){var url;return url=this.navUrls.resolve("discover-search"),this.location.search("text",q).path(url)},DiscoverHomeController}(),angular.module("taigaDiscover").controller("DiscoverHome",DiscoverHomeController)}.call(this),function(){var DiscoverSearchController;DiscoverSearchController=function(){function DiscoverSearchController(routeParams,discoverProjectsService,route,appMetaService,translate){var description,title;this.routeParams=routeParams,this.discoverProjectsService=discoverProjectsService,this.route=route,this.appMetaService=appMetaService,this.translate=translate,this.page=1,taiga.defineImmutableProperty(this,"searchResult",function(_this){return function(){return _this.discoverProjectsService.searchResult}}(this)),taiga.defineImmutableProperty(this,"nextSearchPage",function(_this){return function(){return _this.discoverProjectsService.nextSearchPage}}(this)),this.q=this.routeParams.text,this.filter=this.routeParams.filter||"all",this.orderBy=this.routeParams.order_by||"",this.loadingGlobal=!1,this.loadingList=!1,this.loadingPagination=!1,title=this.translate.instant("DISCOVER.SEARCH.PAGE_TITLE"),description=this.translate.instant("DISCOVER.SEARCH.PAGE_DESCRIPTION"),this.appMetaService.setAll(title,description)}return DiscoverSearchController.$inject=["$routeParams","tgDiscoverProjectsService","$route","tgAppMetaService","$translate"],DiscoverSearchController.prototype.fetch=function(){return this.page=1,this.discoverProjectsService.resetSearchList(),this.search()},DiscoverSearchController.prototype.fetchByGlobalSearch=function(){return this.loadingGlobal?void 0:(this.loadingGlobal=!0,this.fetch().then(function(_this){return function(){return _this.loadingGlobal=!1}}(this)))},DiscoverSearchController.prototype.fetchByOrderBy=function(){return this.loadingList?void 0:(this.loadingList=!0,this.fetch().then(function(_this){return function(){return _this.loadingList=!1}}(this)))},DiscoverSearchController.prototype.showMore=function(){return this.loadingPagination?void 0:(this.loadingPagination=!0,this.page++,this.search().then(function(_this){return function(){return _this.loadingPagination=!1}}(this)))},DiscoverSearchController.prototype.search=function(){var filter,params;return filter=this.getFilter(),params={page:this.page,q:this.q,order_by:this.orderBy},_.assign(params,filter),this.discoverProjectsService.fetchSearch(params)},DiscoverSearchController.prototype.getFilter=function(){return"people"===this.filter?{is_looking_for_people:!0}:"scrum"===this.filter?{is_backlog_activated:!0}:"kanban"===this.filter?{is_kanban_activated:!0}:{}},DiscoverSearchController.prototype.onChangeFilter=function(filter,q){return this.filter=filter,this.q=q,this.route.updateParams({filter:this.filter,text:this.q}),this.fetchByGlobalSearch()},DiscoverSearchController.prototype.onChangeOrder=function(orderBy){return this.orderBy=orderBy,this.route.updateParams({order_by:orderBy}),this.fetchByOrderBy()},DiscoverSearchController}(),angular.module("taigaDiscover").controller("DiscoverSearch",DiscoverSearchController)}.call(this),function(){var DiscoverSearchDirective;DiscoverSearchDirective=function(){var link;return link=function(scope,element,attrs,ctrl){return ctrl.fetch()},{controller:"DiscoverSearch",controllerAs:"vm",link:link}},DiscoverSearchDirective.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearch",DiscoverSearchDirective)}.call(this),function(){var DiscoverProjectsService,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,DiscoverProjectsService=function(superClass){function DiscoverProjectsService(rs,projectsService){this.rs=rs,this.projectsService=projectsService,this._mostLiked=Immutable.List(),this._mostActive=Immutable.List(),this._featured=Immutable.List(),this._searchResult=Immutable.List(),this._projectsCount=0,this.decorate=this.projectsService._decorate.bind(this.projectsService),taiga.defineImmutableProperty(this,"mostLiked",function(_this){return function(){return _this._mostLiked}}(this)),taiga.defineImmutableProperty(this,"mostActive",function(_this){return function(){return _this._mostActive}}(this)),taiga.defineImmutableProperty(this,"featured",function(_this){return function(){return _this._featured}}(this)),taiga.defineImmutableProperty(this,"searchResult",function(_this){return function(){return _this._searchResult}}(this)),taiga.defineImmutableProperty(this,"nextSearchPage",function(_this){return function(){return _this._nextSearchPage}}(this)),taiga.defineImmutableProperty(this,"projectsCount",function(_this){return function(){return _this._projectsCount}}(this))}return extend(DiscoverProjectsService,superClass),DiscoverProjectsService.$inject=["tgResources","tgProjectsService"],DiscoverProjectsService.prototype.fetchMostLiked=function(params){return this.rs.projects.getProjects(params,!1).then(function(_this){return function(result){var data,projects;return data=result.data.slice(0,5),projects=Immutable.fromJS(data),projects=projects.map(_this.decorate),_this._mostLiked=projects}}(this))},DiscoverProjectsService.prototype.fetchMostActive=function(params){return this.rs.projects.getProjects(params,!1).then(function(_this){return function(result){var data,projects;return data=result.data.slice(0,5),projects=Immutable.fromJS(data),projects=projects.map(_this.decorate),_this._mostActive=projects}}(this))},DiscoverProjectsService.prototype.fetchFeatured=function(){var params;return params={is_featured:!0},this.rs.projects.getProjects(params,!1).then(function(_this){return function(result){var data,projects;return data=result.data.slice(0,4),projects=Immutable.fromJS(data),projects=projects.map(_this.decorate),_this._featured=projects}}(this))},DiscoverProjectsService.prototype.resetSearchList=function(){return this._searchResult=Immutable.List()},DiscoverProjectsService.prototype.fetchStats=function(){return this.rs.stats.discover().then(function(_this){return function(discover){return _this._projectsCount=discover.getIn(["projects","total"])}}(this))},DiscoverProjectsService.prototype.fetchSearch=function(params){return this.rs.projects.getProjects(params).then(function(_this){return function(result){var projects;return _this._nextSearchPage=!!result.headers("X-Pagination-Next"),projects=Immutable.fromJS(result.data),projects=projects.map(_this.decorate),_this._searchResult=_this._searchResult.concat(projects)}}(this))},DiscoverProjectsService}(taiga.Service),angular.module("taigaDiscover").service("tgDiscoverProjectsService",DiscoverProjectsService)}.call(this),function(){var ExternalAppController,taiga,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,ExternalAppController=function(superClass){function ExternalAppController(routeParams,externalAppsService,window,currentUserService,location,navUrls,xhrError,loader){var loginUrl,nextUrl;this.routeParams=routeParams,this.externalAppsService=externalAppsService,this.window=window,this.currentUserService=currentUserService,this.location=location,this.navUrls=navUrls,this.xhrError=xhrError,this.loader=loader,this.createApplicationToken=bind(this.createApplicationToken,this),this._getApplicationToken=bind(this._getApplicationToken,this),this._redirect=bind(this._redirect,this),this.loader.start(!1),this._applicationId=this.routeParams.application,this._state=this.routeParams.state,this._getApplicationToken(),this._user=this.currentUserService.getUser(),this._application=null,nextUrl=encodeURIComponent(this.location.url()),loginUrl=this.navUrls.resolve("login"),this.loginWithAnotherUserUrl=loginUrl+"?next="+nextUrl,taiga.defineImmutableProperty(this,"user",function(_this){return function(){return _this._user}}(this)),taiga.defineImmutableProperty(this,"application",function(_this){return function(){return _this._application}}(this))}return extend(ExternalAppController,superClass),ExternalAppController.$inject=["$routeParams","tgExternalAppsService","$window","tgCurrentUserService","$location","$tgNavUrls","tgXhrErrorService","tgLoader"],ExternalAppController.prototype._redirect=function(applicationToken){var nextUrl;return nextUrl=applicationToken.get("next_url"),this.window.open(nextUrl,"_self")},ExternalAppController.prototype._getApplicationToken=function(){return this.externalAppsService.getApplicationToken(this._applicationId,this._state).then(function(_this){return function(data){return _this._application=data.get("application"),data.get("auth_code")?_this._redirect(data):_this.loader.pageLoaded()}}(this))["catch"](function(_this){return function(xhr){return _this.loader.pageLoaded(),_this.xhrError.response(xhr)}}(this))},ExternalAppController.prototype.cancel=function(){return this.window.history.back()},ExternalAppController.prototype.createApplicationToken=function(){return this.externalAppsService.authorizeApplicationToken(this._applicationId,this._state).then(function(_this){return function(data){return _this._redirect(data)}}(this))["catch"](function(_this){return function(xhr){return _this.xhrError.response(xhr)}}(this))},ExternalAppController}(taiga.Controller),angular.module("taigaExternalApps").controller("ExternalApp",ExternalAppController)}.call(this),function(){var ExternalAppsService,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ExternalAppsService=function(superClass){function ExternalAppsService(rs){this.rs=rs}return extend(ExternalAppsService,superClass),ExternalAppsService.$inject=["tgResources"],ExternalAppsService.prototype.getApplicationToken=function(applicationId,state){return this.rs.externalapps.getApplicationToken(applicationId,state)},ExternalAppsService.prototype.authorizeApplicationToken=function(applicationId,state){return this.rs.externalapps.authorizeApplicationToken(applicationId,state)},ExternalAppsService}(taiga.Service),angular.module("taigaExternalApps").service("tgExternalAppsService",ExternalAppsService)}.call(this),function(){var FeedbackService,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;FeedbackService=function(superClass){function FeedbackService(lightboxFactory){this.lightboxFactory=lightboxFactory}return extend(FeedbackService,superClass),FeedbackService.$inject=["tgLightboxFactory"],FeedbackService.prototype.sendFeedback=function(){return this.lightboxFactory.create("tg-lb-feedback",{"class":"lightbox lightbox-feedback lightbox-generic-form"})},FeedbackService}(taiga.Service),angular.module("taigaFeedback").service("tgFeedbackService",FeedbackService)}.call(this),function(){var DutyDirective;DutyDirective=function(navurls,$translate){var link;return link=function(scope,el,attrs,ctrl){return scope.vm={},scope.vm.duty=scope.duty,scope.vm.getDutyType=function(){if(scope.vm.duty){if("userstories"===scope.vm.duty.get("_name"))return $translate.instant("COMMON.USER_STORY");if("tasks"===scope.vm.duty.get("_name"))return $translate.instant("COMMON.TASK");if("issues"===scope.vm.duty.get("_name"))return $translate.instant("COMMON.ISSUE")}}},{templateUrl:"home/duties/duty.html",scope:{duty:"=tgDuty"},link:link}},DutyDirective.$inject=["$tgNavUrls","$translate"],angular.module("taigaHome").directive("tgDuty",DutyDirective)}.call(this),function(){var HomeController;HomeController=function(){function HomeController(currentUserService,location,navUrls){this.currentUserService=currentUserService,this.location=location,this.navUrls=navUrls,this.currentUserService.getUser()||this.location.path(this.navUrls.resolve("discover"))}return HomeController.$inject=["tgCurrentUserService","$location","$tgNavUrls"],HomeController}(),angular.module("taigaHome").controller("Home",HomeController)}.call(this),function(){var HomeService,groupBy,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;groupBy=this.taiga.groupBy,HomeService=function(superClass){function HomeService(navurls,rs,projectsService){this.navurls=navurls,this.rs=rs,this.projectsService=projectsService}return extend(HomeService,superClass),HomeService.$inject=["$tgNavUrls","tgResources","tgProjectsService"],HomeService.prototype._attachProjectInfoToWorkInProgress=function(workInProgress,projectsById){var _attachProjectInfoToDuty,_duties,assignedTo,watching;return _attachProjectInfoToDuty=function(_this){return function(duty,objType){var ctx,project,url;return project=projectsById.get(String(duty.get("project"))),ctx={project:project.get("slug"),ref:duty.get("ref")},url=_this.navurls.resolve("project-"+objType+"-detail",ctx),duty=duty.set("url",url),duty=duty.set("projectName",project.get("name")),duty=duty.set("_name",objType)}}(this),assignedTo=workInProgress.get("assignedTo"),assignedTo.get("userStories")&&(_duties=assignedTo.get("userStories").map(function(duty){return _attachProjectInfoToDuty(duty,"userstories")}),assignedTo=assignedTo.set("userStories",_duties)),assignedTo.get("tasks")&&(_duties=assignedTo.get("tasks").map(function(duty){return _attachProjectInfoToDuty(duty,"tasks")}),assignedTo=assignedTo.set("tasks",_duties)),assignedTo.get("issues")&&(_duties=assignedTo.get("issues").map(function(duty){return _attachProjectInfoToDuty(duty,"issues")}),assignedTo=assignedTo.set("issues",_duties)),watching=workInProgress.get("watching"),watching.get("userStories")&&(_duties=watching.get("userStories").filter(function(duty){return!!projectsById.get(String(duty.get("project")))}),_duties=_duties.map(function(duty){return _attachProjectInfoToDuty(duty,"userstories")}),watching=watching.set("userStories",_duties)),watching.get("tasks")&&(_duties=watching.get("tasks").filter(function(duty){return!!projectsById.get(String(duty.get("project")))}),_duties=_duties.map(function(duty){return _attachProjectInfoToDuty(duty,"tasks")}),watching=watching.set("tasks",_duties)),watching.get("issues")&&(_duties=watching.get("issues").filter(function(duty){return!!projectsById.get(String(duty.get("project")))}),_duties=_duties.map(function(duty){return _attachProjectInfoToDuty(duty,"issues")}),watching=watching.set("issues",_duties)),workInProgress=workInProgress.set("assignedTo",assignedTo),workInProgress=workInProgress.set("watching",watching)},HomeService.prototype.getWorkInProgress=function(userId){var assignedIssuesPromise,assignedTasksPromise,assignedTo,assignedUserStoriesPromise,params,params_us,projectsById,projectsPromise,watching,watchingIssuesPromise,watchingTasksPromise,watchingUserStoriesPromise,workInProgress;return projectsById=Immutable.Map(),projectsPromise=this.projectsService.getProjectsByUserId(userId).then(function(projects){return projectsById=Immutable.fromJS(groupBy(projects.toJS(),function(p){return p.id}))}),assignedTo=Immutable.Map(),params={status__is_closed:!1,assigned_to:userId},params_us={is_closed:!1,assigned_to:userId},assignedUserStoriesPromise=this.rs.userstories.listInAllProjects(params_us).then(function(userstories){return assignedTo=assignedTo.set("userStories",userstories)}),assignedTasksPromise=this.rs.tasks.listInAllProjects(params).then(function(tasks){return assignedTo=assignedTo.set("tasks",tasks)}),assignedIssuesPromise=this.rs.issues.listInAllProjects(params).then(function(issues){return assignedTo=assignedTo.set("issues",issues)}),params={status__is_closed:!1,watchers:userId},params_us={is_closed:!1,watchers:userId},watching=Immutable.Map(),watchingUserStoriesPromise=this.rs.userstories.listInAllProjects(params_us).then(function(userstories){return watching=watching.set("userStories",userstories)}),watchingTasksPromise=this.rs.tasks.listInAllProjects(params).then(function(tasks){return watching=watching.set("tasks",tasks)}),watchingIssuesPromise=this.rs.issues.listInAllProjects(params).then(function(issues){return watching=watching.set("issues",issues)}),workInProgress=Immutable.Map(),Promise.all([projectsPromise,assignedUserStoriesPromise,assignedTasksPromise,assignedIssuesPromise,watchingUserStoriesPromise,watchingTasksPromise,watchingIssuesPromise]).then(function(_this){return function(){return workInProgress=workInProgress.set("assignedTo",assignedTo),workInProgress=workInProgress.set("watching",watching),workInProgress=_this._attachProjectInfoToWorkInProgress(workInProgress,projectsById)}}(this))},HomeService}(taiga.Service),angular.module("taigaHome").service("tgHomeService",HomeService)}.call(this),function(){var HomeProjectListDirective;HomeProjectListDirective=function(currentUserService,projectsService){var directive,link;return link=function(scope,el,attrs,ctrl){return scope.vm={},taiga.defineImmutableProperty(scope.vm,"projects",function(){return currentUserService.projects.get("recents")}),scope.vm.newProject=function(){return projectsService.newProject()}},directive={templateUrl:"home/projects/home-project-list.html",scope:{},link:link}},HomeProjectListDirective.$inject=["tgCurrentUserService","tgProjectsService"],angular.module("taigaHome").directive("tgHomeProjectList",HomeProjectListDirective)}.call(this),function(){var WorkingOnController;WorkingOnController=function(){function WorkingOnController(homeService){
this.homeService=homeService,this.assignedTo=Immutable.Map(),this.watching=Immutable.Map()}return WorkingOnController.$inject=["tgHomeService"],WorkingOnController.prototype._setAssignedTo=function(workInProgress){var issues,tasks,userStories;return userStories=workInProgress.get("assignedTo").get("userStories"),tasks=workInProgress.get("assignedTo").get("tasks"),issues=workInProgress.get("assignedTo").get("issues"),this.assignedTo=userStories.concat(tasks).concat(issues),this.assignedTo.size>0?this.assignedTo=this.assignedTo.sortBy(function(elem){return elem.get("modified_date")}).reverse():void 0},WorkingOnController.prototype._setWatching=function(workInProgress){var issues,tasks,userStories;return userStories=workInProgress.get("watching").get("userStories"),tasks=workInProgress.get("watching").get("tasks"),issues=workInProgress.get("watching").get("issues"),this.watching=userStories.concat(tasks).concat(issues),this.watching.size>0?this.watching=this.watching.sortBy(function(elem){return elem.get("modified_date")}).reverse():void 0},WorkingOnController.prototype.getWorkInProgress=function(userId){return this.homeService.getWorkInProgress(userId).then(function(_this){return function(workInProgress){return _this._setAssignedTo(workInProgress),_this._setWatching(workInProgress)}}(this))},WorkingOnController}(),angular.module("taigaHome").controller("WorkingOn",WorkingOnController)}.call(this),function(){var WorkingOnDirective;WorkingOnDirective=function(homeService,currentUserService){var link;return link=function(scope,el,attrs,ctrl){var user,userId;return user=currentUserService.getUser(),user?(userId=user.get("id"),ctrl.getWorkInProgress(userId)):void 0},{controller:"WorkingOn",controllerAs:"vm",templateUrl:"home/working-on/working-on.html",scope:{},link:link}},WorkingOnDirective.$inject=["tgHomeService","tgCurrentUserService"],angular.module("taigaHome").directive("tgWorkingOn",WorkingOnDirective)}.call(this),function(){var DropdownProjectListDirective;DropdownProjectListDirective=function(currentUserService,projectsService){var directive,link;return link=function(scope,el,attrs,ctrl){return scope.vm={},taiga.defineImmutableProperty(scope.vm,"projects",function(){return currentUserService.projects.get("recents")}),scope.vm.newProject=function(){return projectsService.newProject()}},directive={templateUrl:"navigation-bar/dropdown-project-list/dropdown-project-list.html",scope:{},link:link}},DropdownProjectListDirective.$inject=["tgCurrentUserService","tgProjectsService"],angular.module("taigaNavigationBar").directive("tgDropdownProjectList",DropdownProjectListDirective)}.call(this),function(){var DropdownUserDirective;DropdownUserDirective=function(authService,configService,locationService,navUrlsService,feedbackService){var directive,link;return link=function(scope,el,attrs,ctrl){return scope.vm={},scope.vm.isFeedbackEnabled=configService.get("feedbackEnabled"),taiga.defineImmutableProperty(scope.vm,"user",function(){return authService.userData}),scope.vm.logout=function(){return authService.logout(),locationService.url(navUrlsService.resolve("discover")),locationService.search({})},scope.vm.sendFeedback=function(){return feedbackService.sendFeedback()}},directive={templateUrl:"navigation-bar/dropdown-user/dropdown-user.html",scope:{},link:link}},DropdownUserDirective.$inject=["$tgAuth","$tgConfig","$tgLocation","$tgNavUrls","tgFeedbackService"],angular.module("taigaNavigationBar").directive("tgDropdownUser",DropdownUserDirective)}.call(this),function(){var NavigationBarDirective;NavigationBarDirective=function(currentUserService,navigationBarService,locationService,navUrlsService){var directive,link;return link=function(scope,el,attrs,ctrl){return scope.vm={},scope.$on("$routeChangeSuccess",function(){return"/"===locationService.path()?scope.vm.active=!0:scope.vm.active=!1}),taiga.defineImmutableProperty(scope.vm,"projects",function(){return currentUserService.projects.get("recents")}),taiga.defineImmutableProperty(scope.vm,"isAuthenticated",function(){return currentUserService.isAuthenticated()}),taiga.defineImmutableProperty(scope.vm,"isEnabledHeader",function(){return navigationBarService.isEnabledHeader()}),scope.vm.login=function(){var nextUrl;return nextUrl=encodeURIComponent(locationService.url()),locationService.url(navUrlsService.resolve("login")),locationService.search({next:nextUrl})},scope.vm.register=function(){var nextUrl;return nextUrl=encodeURIComponent(locationService.url()),locationService.url(navUrlsService.resolve("register")),locationService.search({next:nextUrl})}},directive={templateUrl:"navigation-bar/navigation-bar.html",scope:{},link:link}},NavigationBarDirective.$inject=["tgCurrentUserService","tgNavigationBarService","$tgLocation","$tgNavUrls"],angular.module("taigaNavigationBar").directive("tgNavigationBar",NavigationBarDirective)}.call(this),function(){var NavigationBarService,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;NavigationBarService=function(superClass){function NavigationBarService(){this.disableHeader()}return extend(NavigationBarService,superClass),NavigationBarService.prototype.enableHeader=function(){return this.enabledHeader=!0},NavigationBarService.prototype.disableHeader=function(){return this.enabledHeader=!1},NavigationBarService.prototype.isEnabledHeader=function(){return this.enabledHeader},NavigationBarService}(taiga.Service),angular.module("taigaNavigationBar").service("tgNavigationBarService",NavigationBarService)}.call(this),function(){var ProfileBarController;ProfileBarController=function(){function ProfileBarController(userService){this.userService=userService,this.loadStats()}return ProfileBarController.$inject=["tgUserService"],ProfileBarController.prototype.loadStats=function(){return this.userService.getStats(this.user.get("id")).then(function(_this){return function(stats){return _this.stats=stats}}(this))},ProfileBarController}(),angular.module("taigaProfile").controller("ProfileBar",ProfileBarController)}.call(this),function(){var ProfileBarDirective;ProfileBarDirective=function(){return{templateUrl:"profile/profile-bar/profile-bar.html",controller:"ProfileBar",controllerAs:"vm",scope:{user:"=user",isCurrentUser:"=iscurrentuser"},bindToController:!0}},angular.module("taigaProfile").directive("tgProfileBar",ProfileBarDirective)}.call(this),function(){var ProfileContactsController;ProfileContactsController=function(){function ProfileContactsController(userService,currentUserService){this.userService=userService,this.currentUserService=currentUserService,this.currentUser=this.currentUserService.getUser(),this.isCurrentUser=!1,this.currentUser&&this.currentUser.get("id")===this.user.get("id")&&(this.isCurrentUser=!0)}return ProfileContactsController.$inject=["tgUserService","tgCurrentUserService"],ProfileContactsController.prototype.loadContacts=function(){return this.userService.getContacts(this.user.get("id")).then(function(_this){return function(contacts){return _this.contacts=contacts}}(this))},ProfileContactsController}(),angular.module("taigaProfile").controller("ProfileContacts",ProfileContactsController)}.call(this),function(){var ProfileContactsDirective;ProfileContactsDirective=function(){var link;return link=function(scope,elm,attrs,ctrl){return ctrl.loadContacts()},{templateUrl:"profile/profile-contacts/profile-contacts.html",scope:{user:"="},controllerAs:"vm",controller:"ProfileContacts",link:link,bindToController:!0}},angular.module("taigaProfile").directive("tgProfileContacts",ProfileContactsDirective)}.call(this),function(){var FavItemDirective;FavItemDirective=function(){var link,templateUrl;return link=function(scope,el,attrs,ctrl){return scope.vm={item:scope.item}},templateUrl=function(el,attrs){return"project"===attrs.itemType?"profile/profile-favs/items/project.html":"profile/profile-favs/items/ticket.html"},{scope:{item:"=tgFavItem"},link:link,templateUrl:templateUrl}},angular.module("taigaProfile").directive("tgFavItem",FavItemDirective)}.call(this),function(){var FavsBaseController,ProfileLikedController,ProfileVotedController,ProfileWatchedController,debounceLeading,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;debounceLeading=this.taiga.debounceLeading,FavsBaseController=function(){function FavsBaseController(){this._init()}return FavsBaseController.prototype._init=function(){return this.enableFilterByAll=!0,this.enableFilterByProjects=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._resetList(),this.q=null,this.type=null},FavsBaseController.prototype._resetList=function(){return this.items=Immutable.List(),this.scrollDisabled=!1,this._page=1},FavsBaseController.prototype._enableLoadingSpinner=function(){return this.isLoading=!0},FavsBaseController.prototype._disableLoadingSpinner=function(){return this.isLoading=!1},FavsBaseController.prototype._enableScroll=function(){return this.scrollDisabled=!1},FavsBaseController.prototype._disableScroll=function(){return this.scrollDisabled=!0},FavsBaseController.prototype._checkIfHasMorePages=function(hasNext){return hasNext?(this._page+=1,this._enableScroll()):this._disableScroll()},FavsBaseController.prototype._checkIfHasNoResults=function(){return this.hasNoResults=0===this.items.size},FavsBaseController.prototype.loadItems=function(){return this._enableLoadingSpinner(),this._disableScroll(),this._getItems(this.user.get("id"),this._page,this.type,this.q).then(function(_this){return function(response){return _this.items=_this.items.concat(response.get("data")),_this._checkIfHasMorePages(response.get("next")),_this._checkIfHasNoResults(),_this._disableLoadingSpinner(),_this.items}}(this))["catch"](function(_this){return function(){return _this._disableLoadingSpinner(),_this.items}}(this))},FavsBaseController.prototype.filterByTextQuery=debounceLeading(500,function(){return this._resetList(),this.loadItems()}),FavsBaseController.prototype.showAll=function(){return null!==this.type?(this.type=null,this._resetList(),this.loadItems()):void 0},FavsBaseController.prototype.showProjectsOnly=function(){return"project"!==this.type?(this.type="project",this._resetList(),this.loadItems()):void 0},FavsBaseController.prototype.showUserStoriesOnly=function(){return"userstory"!==this.type?(this.type="userstory",this._resetList(),this.loadItems()):void 0},FavsBaseController.prototype.showTasksOnly=function(){return"task"!==this.type?(this.type="task",this._resetList(),this.loadItems()):void 0},FavsBaseController.prototype.showIssuesOnly=function(){return"issue"!==this.type?(this.type="issue",this._resetList(),this.loadItems()):void 0},FavsBaseController}(),ProfileLikedController=function(superClass){function ProfileLikedController(userService){this.userService=userService,ProfileLikedController.__super__.constructor.call(this),this.enableFilterByAll=!1,this.enableFilterByProjects=!1,this.enableFilterByUserStories=!1,this.enableFilterByTasks=!1,this.enableFilterByIssues=!1,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getLiked}return extend(ProfileLikedController,superClass),ProfileLikedController.$inject=["tgUserService"],ProfileLikedController}(FavsBaseController),angular.module("taigaProfile").controller("ProfileLiked",ProfileLikedController),ProfileVotedController=function(superClass){function ProfileVotedController(userService){this.userService=userService,ProfileVotedController.__super__.constructor.call(this),this.enableFilterByAll=!0,this.enableFilterByProjects=!1,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getVoted}return extend(ProfileVotedController,superClass),ProfileVotedController.$inject=["tgUserService"],ProfileVotedController}(FavsBaseController),angular.module("taigaProfile").controller("ProfileVoted",ProfileVotedController),ProfileWatchedController=function(superClass){function ProfileWatchedController(userService){this.userService=userService,ProfileWatchedController.__super__.constructor.call(this),this._getItems=this.userService.getWatched}return extend(ProfileWatchedController,superClass),ProfileWatchedController.$inject=["tgUserService"],ProfileWatchedController}(FavsBaseController),angular.module("taigaProfile").controller("ProfileWatched",ProfileWatchedController)}.call(this),function(){var ProfileLikedDirective,ProfileVotedDirective,ProfileWatchedDirective,base;base={scope:{},bindToController:{user:"=",type:"@",q:"@",scrollDisabled:"@",isLoading:"@",hasNoResults:"@"},controller:null,controllerAs:"vm",templateUrl:"profile/profile-favs/profile-favs.html"},ProfileLikedDirective=function(){return _.extend({},base,{controller:"ProfileLiked"})},angular.module("taigaProfile").directive("tgProfileLiked",ProfileLikedDirective),ProfileVotedDirective=function(){return _.extend({},base,{controller:"ProfileVoted"})},angular.module("taigaProfile").directive("tgProfileVoted",ProfileVotedDirective),ProfileWatchedDirective=function(){return _.extend({},base,{controller:"ProfileWatched"})},angular.module("taigaProfile").directive("tgProfileWatched",ProfileWatchedDirective)}.call(this),function(){var ProfileHints;ProfileHints=function(){function ProfileHints(translate){var hintKey;this.translate=translate,hintKey=Math.floor(Math.random()*this.HINTS.length)+1,this.hint=this.HINTS[hintKey-1],this.hint.linkText=this.hint.linkText||"HINTS.LINK",this.hint.title=this.translate.instant("HINTS.HINT"+hintKey+"_TITLE"),this.hint.text=this.translate.instant("HINTS.HINT"+hintKey+"_TEXT")}return ProfileHints.prototype.HINTS=[{url:"https://taiga.io/support/import-export-projects/"},{url:"https://taiga.io/support/custom-fields/"},{},{}],ProfileHints}(),ProfileHints.$inject=["$translate"],angular.module("taigaProfile").controller("ProfileHints",ProfileHints)}.call(this),function(){var ProfileHints;ProfileHints=function($translate){return{scope:{},controller:"ProfileHints",controllerAs:"vm",templateUrl:"profile/profile-hints/profile-hints.html"}},ProfileHints.$inject=["$translate"],angular.module("taigaProfile").directive("tgProfileHints",ProfileHints)}.call(this),function(){var ProfileProjectsController;ProfileProjectsController=function(){function ProfileProjectsController(projectsService,userService){this.projectsService=projectsService,this.userService=userService}return ProfileProjectsController.$inject=["tgProjectsService","tgUserService"],ProfileProjectsController.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this.user.get("id")).then(function(_this){return function(projects){return _this.userService.attachUserContactsToProjects(_this.user.get("id"),projects)}}(this)).then(function(_this){return function(projects){return _this.projects=projects}}(this))},ProfileProjectsController}(),angular.module("taigaProfile").controller("ProfileProjects",ProfileProjectsController)}.call(this),function(){var ProfileProjectsDirective;ProfileProjectsDirective=function(){var link;return link=function(scope,elm,attr,ctrl){return ctrl.loadProjects()},{templateUrl:"profile/profile-projects/profile-projects.html",scope:{user:"="},link:link,bindToController:!0,controllerAs:"vm",controller:"ProfileProjects"}},angular.module("taigaProfile").directive("tgProfileProjects",ProfileProjectsDirective)}.call(this),function(){var ProfileTabDirective;ProfileTabDirective=function(){var link;return link=function(scope,element,attrs,ctrl,transclude){return scope.tab={},attrs.$observe("tgProfileTab",function(name){return scope.tab.name=name}),attrs.$observe("tabTitle",function(title){return scope.tab.title=title}),scope.tab.icon=attrs.tabIcon,scope.tab.active=!!attrs.tabActive,scope.$eval(attrs.tabDisabled)!==!0?ctrl.addTab(scope.tab):void 0},{templateUrl:"profile/profile-tab/profile-tab.html",scope:{},require:"^tgProfileTabs",link:link,transclude:!0}},angular.module("taigaProfile").directive("tgProfileTab",ProfileTabDirective)}.call(this),function(){var ProfileTabsController;ProfileTabsController=function(){function ProfileTabsController(){this.tabs=[]}return ProfileTabsController.prototype.addTab=function(tab){return this.tabs.push(tab)},ProfileTabsController.prototype.toggleTab=function(tab){return _.map(this.tabs,function(tab){return tab.active=!1}),tab.active=!0},ProfileTabsController}(),angular.module("taigaProfile").controller("ProfileTabs",ProfileTabsController)}.call(this),function(){var ProfileTabsDirective;ProfileTabsDirective=function(){return{scope:{},controller:"ProfileTabs",controllerAs:"vm",templateUrl:"profile/profile-tabs/profile-tabs.html",transclude:!0}},angular.module("taigaProfile").directive("tgProfileTabs",ProfileTabsDirective)}.call(this),function(){var ProfileController;ProfileController=function(){function ProfileController(appMetaService,currentUserService,routeParams,userService,xhrError,translate){this.appMetaService=appMetaService,this.currentUserService=currentUserService,this.routeParams=routeParams,this.userService=userService,this.xhrError=xhrError,this.translate=translate,this.isCurrentUser=!1,this.routeParams.slug?this.userService.getUserByUserName(this.routeParams.slug).then(function(_this){return function(user){return user.get("is_active")?(_this.user=user,_this.isCurrentUser=!1,_this._setMeta(_this.user),user):_this.xhrError.notFound()}}(this))["catch"](function(_this){return function(xhr){return _this.xhrError.response(xhr)}}(this)):(this.user=this.currentUserService.getUser(),this.isCurrentUser=!0,this._setMeta(this.user))}return ProfileController.$inject=["tgAppMetaService","tgCurrentUserService","$routeParams","tgUserService","tgXhrErrorService","$translate"],ProfileController.prototype._setMeta=function(user){var ctx,description,title;return ctx={userFullName:user.get("full_name_display"),userUsername:user.get("username")},title=this.translate.instant("USER.PROFILE.PAGE_TITLE",ctx),description=user.get("bio"),this.appMetaService.setAll(title,description)},ProfileController}(),angular.module("taigaProfile").controller("Profile",ProfileController)}.call(this),function(){var LikeProjectButtonController;LikeProjectButtonController=function(){function LikeProjectButtonController(confirm,likeButtonService){this.confirm=confirm,this.likeButtonService=likeButtonService,this.isMouseOver=!1,this.loading=!1}return LikeProjectButtonController.$inject=["$tgConfirm","tgLikeProjectButtonService"],LikeProjectButtonController.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},LikeProjectButtonController.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},LikeProjectButtonController.prototype.toggleLike=function(){var promise;return this.loading=!0,promise=this.project.get("is_fan")?this._unlike():this._like(),promise["finally"](function(_this){return function(){return _this.loading=!1}}(this)),promise},LikeProjectButtonController.prototype._like=function(){return this.likeButtonService.like(this.project.get("id")).then(function(_this){return function(){return _this.showTextWhenMouseIsLeave()}}(this))["catch"](function(_this){return function(){return _this.confirm.notify("error")}}(this))},LikeProjectButtonController.prototype._unlike=function(){return this.likeButtonService.unlike(this.project.get("id"))["catch"](function(_this){return function(){return _this.confirm.notify("error")}}(this))},LikeProjectButtonController}(),angular.module("taigaProjects").controller("LikeProjectButton",LikeProjectButtonController)}.call(this),function(){var LikeProjectButtonDirective;LikeProjectButtonDirective=function(){return{scope:{},controller:"LikeProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/like-project-button/like-project-button.html"}},angular.module("taigaProjects").directive("tgLikeProjectButton",LikeProjectButtonDirective)}.call(this),function(){var LikeProjectButtonService,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,LikeProjectButtonService=function(superClass){function LikeProjectButtonService(rs,currentUserService,projectService){this.rs=rs,this.currentUserService=currentUserService,this.projectService=projectService}return extend(LikeProjectButtonService,superClass),LikeProjectButtonService.$inject=["tgResources","tgCurrentUserService","tgProjectService"],LikeProjectButtonService.prototype._getProjectIndex=function(projectId){return this.currentUserService.projects.get("all").findIndex(function(project){return project.get("id")===projectId})},LikeProjectButtonService.prototype._updateProjects=function(projectId,isFan){var projectIndex,projects;return projectIndex=this._getProjectIndex(projectId),-1!==projectIndex?(projects=this.currentUserService.projects.get("all").update(projectIndex,function(project){var totalFans;return totalFans=project.get("total_fans"),isFan?totalFans++:totalFans--,project.merge({is_fan:isFan,total_fans:totalFans})}),this.currentUserService.setProjects(projects)):void 0},LikeProjectButtonService.prototype._updateCurrentProject=function(isFan){var project,totalFans;return totalFans=this.projectService.project.get("total_fans"),isFan?totalFans++:totalFans--,project=this.projectService.project.merge({is_fan:isFan,total_fans:totalFans}),this.projectService.setProject(project)},LikeProjectButtonService.prototype.like=function(projectId){return this.rs.projects.likeProject(projectId).then(function(_this){return function(){return _this._updateProjects(projectId,!0),_this._updateCurrentProject(!0)}}(this))},LikeProjectButtonService.prototype.unlike=function(projectId){return this.rs.projects.unlikeProject(projectId).then(function(_this){return function(){return _this._updateProjects(projectId,!1),_this._updateCurrentProject(!1)}}(this))},LikeProjectButtonService}(taiga.Service),angular.module("taigaProjects").service("tgLikeProjectButtonService",LikeProjectButtonService)}.call(this),function(){var SortProjectsDirective;SortProjectsDirective=function(currentUserService){var directive,link;return link=function(scope,el,attrs,ctrl){var itemEl;return itemEl=null,el.sortable({dropOnEmpty:!0,revert:200,axis:"y",opacity:.95,placeholder:"placeholder",cancel:".project-name"}),el.on("sortstop",function(event,ui){var i,index,len,project,sortData,sorted_project_ids,value;for(itemEl=ui.item,project=itemEl.scope().project,index=itemEl.index(),sorted_project_ids=_.map(scope.projects.toJS(),function(p){return p.id}),sorted_project_ids=_.without(sorted_project_ids,project.get("id")),sorted_project_ids.splice(index,0,project.get("id")),sortData=[],index=i=0,len=sorted_project_ids.length;len>i;index=++i)value=sorted_project_ids[index],sortData.push({project_id:value,order:index});return currentUserService.bulkUpdateProjectsOrder(sortData)})},directive={scope:{projects:"=tgSortProjects"},link:link}},angular.module("taigaProjects").directive("tgSortProjects",["tgCurrentUserService",SortProjectsDirective])}.call(this),function(){var WatchProjectButtonController;WatchProjectButtonController=function(){function WatchProjectButtonController(confirm,watchButtonService){this.confirm=confirm,this.watchButtonService=watchButtonService,this.showWatchOptions=!1,this.loading=!1}return WatchProjectButtonController.$inject=["$tgConfirm","tgWatchProjectButtonService"],WatchProjectButtonController.prototype.toggleWatcherOptions=function(){return this.showWatchOptions=!this.showWatchOptions},WatchProjectButtonController.prototype.closeWatcherOptions=function(){return this.showWatchOptions=!1},WatchProjectButtonController.prototype.watch=function(notifyLevel){return notifyLevel!==this.project.get("notify_level")?(this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.watch(this.project.get("id"),notifyLevel)["catch"](function(_this){return function(){return _this.confirm.notify("error")}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))):void 0},WatchProjectButtonController.prototype.unwatch=function(){return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.unwatch(this.project.get("id"))["catch"](function(_this){return function(){return _this.confirm.notify("error")}}(this))["finally"](function(_this){return function(){return _this.loading=!1}}(this))},WatchProjectButtonController}(),angular.module("taigaProjects").controller("WatchProjectButton",WatchProjectButtonController)}.call(this),function(){var WatchProjectButtonDirective;WatchProjectButtonDirective=function(){return{scope:{},controller:"WatchProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/watch-project-button/watch-project-button.html"}},angular.module("taigaProjects").directive("tgWatchProjectButton",WatchProjectButtonDirective)}.call(this),function(){var WatchProjectButtonService,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,WatchProjectButtonService=function(superClass){function WatchProjectButtonService(rs,currentUserService,projectService){this.rs=rs,this.currentUserService=currentUserService,this.projectService=projectService}return extend(WatchProjectButtonService,superClass),WatchProjectButtonService.$inject=["tgResources","tgCurrentUserService","tgProjectService"],WatchProjectButtonService.prototype._getProjectIndex=function(projectId){return this.currentUserService.projects.get("all").findIndex(function(project){return project.get("id")===projectId})},WatchProjectButtonService.prototype._updateProjects=function(projectId,notifyLevel,isWatcher){var projectIndex,projects;return projectIndex=this._getProjectIndex(projectId),-1!==projectIndex?(projects=this.currentUserService.projects.get("all").update(projectIndex,function(_this){return function(project){var totalWatchers;return totalWatchers=project.get("total_watchers"),!_this.projectService.project.get("is_watcher")&&isWatcher?totalWatchers++:_this.projectService.project.get("is_watcher")&&!isWatcher&&totalWatchers--,project.merge({is_watcher:isWatcher,total_watchers:totalWatchers,notify_level:notifyLevel})}}(this)),this.currentUserService.setProjects(projects)):void 0},WatchProjectButtonService.prototype._updateCurrentProject=function(notifyLevel,isWatcher){var project,totalWatchers;return totalWatchers=this.projectService.project.get("total_watchers"),!this.projectService.project.get("is_watcher")&&isWatcher?totalWatchers++:this.projectService.project.get("is_watcher")&&!isWatcher&&totalWatchers--,project=this.projectService.project.merge({is_watcher:isWatcher,notify_level:notifyLevel,total_watchers:totalWatchers}),this.projectService.setProject(project)},WatchProjectButtonService.prototype.watch=function(projectId,notifyLevel){return this.rs.projects.watchProject(projectId,notifyLevel).then(function(_this){return function(){return _this._updateProjects(projectId,notifyLevel,!0),_this._updateCurrentProject(notifyLevel,!0)}}(this))},WatchProjectButtonService.prototype.unwatch=function(projectId){return this.rs.projects.unwatchProject(projectId).then(function(_this){return function(){return _this._updateProjects(projectId,null,!1),_this._updateCurrentProject(null,!1)}}(this))},WatchProjectButtonService}(taiga.Service),angular.module("taigaProjects").service("tgWatchProjectButtonService",WatchProjectButtonService)}.call(this),function(){var ProjectsListingController;ProjectsListingController=function(){function ProjectsListingController(currentUserService,projectsService){this.currentUserService=currentUserService,this.projectsService=projectsService,taiga.defineImmutableProperty(this,"projects",function(_this){return function(){return _this.currentUserService.projects.get("all")}}(this))}return ProjectsListingController.$inject=["tgCurrentUserService","tgProjectsService"],ProjectsListingController.prototype.newProject=function(){return this.projectsService.newProject()},ProjectsListingController}(),angular.module("taigaProjects").controller("ProjectsListing",ProjectsListingController)}.call(this),function(){var ProjectController;ProjectController=function(){function ProjectController(routeParams,appMetaService,auth,translate,projectService){var projectSlug;this.routeParams=routeParams,this.appMetaService=appMetaService,this.auth=auth,this.translate=translate,this.projectService=projectService,projectSlug=this.routeParams.pslug,this.user=this.auth.userData,taiga.defineImmutableProperty(this,"project",function(_this){return function(){return _this.projectService.project}}(this)),taiga.defineImmutableProperty(this,"members",function(_this){return function(){return _this.projectService.activeMembers}}(this)),this.appMetaService.setfn(this._setMeta.bind(this))}return ProjectController.$inject=["$routeParams","tgAppMetaService","$tgAuth","$translate","tgProjectService"],ProjectController.prototype._setMeta=function(project){var ctx,metas;return this.project?(metas={},ctx={projectName:this.project.get("name")},metas.title=this.translate.instant("PROJECT.PAGE_TITLE",ctx),metas.description=this.project.get("description"),metas):null},ProjectController}(),angular.module("taigaProjects").controller("Project",ProjectController)}.call(this),function(){var ProjectsService,groupBy,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,groupBy=this.taiga.groupBy,ProjectsService=function(superClass){function ProjectsService(rs,projectUrl,lightboxFactory){this.rs=rs,this.projectUrl=projectUrl,this.lightboxFactory=lightboxFactory}return extend(ProjectsService,superClass),ProjectsService.$inject=["tgResources","$projectUrl","tgLightboxFactory"],ProjectsService.prototype.getProjectBySlug=function(projectSlug){return this.rs.projects.getProjectBySlug(projectSlug).then(function(_this){return function(project){return _this._decorate(project)}}(this))},ProjectsService.prototype.getProjectStats=function(projectId){return this.rs.projects.getProjectStats(projectId)},ProjectsService.prototype.getProjectsByUserId=function(userId,paginate){return this.rs.projects.getProjectsByUserId(userId,paginate).then(function(_this){return function(projects){return projects.map(_this._decorate.bind(_this))}}(this))},ProjectsService.prototype._decorate=function(project){var colorized_tags,tags,url;return url=this.projectUrl.get(project.toJS()),project=project.set("url",url),colorized_tags=[],project.get("tags")&&(tags=project.get("tags").sort(),colorized_tags=tags.map(function(tag){var color;return color=project.get("tags_colors").get(tag),Immutable.fromJS({name:tag,color:color})}),project=project.set("colorized_tags",colorized_tags)),project},ProjectsService.prototype.newProject=function(){return this.lightboxFactory.create("tg-lb-create-project",{"class":"wizard-create-project"})},ProjectsService.prototype.bulkUpdateProjectsOrder=function(sortData){return this.rs.projects.bulkUpdateOrder(sortData)},ProjectsService}(taiga.Service),angular.module("taigaProjects").service("tgProjectsService",ProjectsService);
}.call(this),function(){var Resource,module,sizeFormat,taiga;taiga=this.taiga,sizeFormat=this.taiga.sizeFormat,Resource=function(urlsService,http,config,$rootScope,$q,storage){var service;return service={},service.list=function(type,objectId,projectId){var httpOptions,params,url,urlname;return urlname="attachments/"+type,params={object_id:objectId,project:projectId},httpOptions={headers:{"x-disable-pagination":"1"}},url=urlsService.resolve(urlname),http.get(url,params,httpOptions).then(function(result){return Immutable.fromJS(result.data)})},service["delete"]=function(type,id){var url,urlname;return urlname="attachments/"+type,url=urlsService.resolve(urlname)+("/"+id),http["delete"](url)},service.patch=function(type,id,patch){var url,urlname;return urlname="attachments/"+type,url=urlsService.resolve(urlname)+("/"+id),http.patch(url,patch)},service.create=function(type,projectId,objectId,file){var data,defered,maxFileSize,response,token,uploadComplete,uploadFailed,uploadProgress,url,urlname,xhr;return urlname="attachments/"+type,url=urlsService.resolve(urlname),defered=$q.defer(),void 0===file?(defered.reject(null),defered.promise):(maxFileSize=config.get("maxUploadFileSize",null),maxFileSize&&file.size>maxFileSize?(response={status:413,data:{_error_message:"'"+file.name+"' ("+sizeFormat(file.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+sizeFormat(maxFileSize)+")"}},defered.reject(response),defered.promise):(uploadProgress=function(_this){return function(evt){return $rootScope.$apply(function(){return file.status="in-progress",file.size=sizeFormat(evt.total),file.progressMessage="upload "+sizeFormat(evt.loaded)+" of "+sizeFormat(evt.total),file.progressPercent=Math.round(evt.loaded/evt.total*100)+"%"})}}(this),uploadComplete=function(_this){return function(evt){return $rootScope.$apply(function(){var attachment,ref,status;file.status="done",status=evt.target.status;try{attachment=JSON.parse(evt.target.responseText)}catch(error){attachment={}}return status>=200&&400>status?(attachment=Immutable.fromJS(attachment),defered.resolve(attachment)):(response={status:status,data:{_error_message:null!=(ref=data.attached_file)?ref[0]:void 0}},defered.reject(response))})}}(this),uploadFailed=function(_this){return function(evt){return $rootScope.$apply(function(){return file.status="error",defered.reject("fail")})}}(this),data=new FormData,data.append("project",projectId),data.append("object_id",objectId),data.append("attached_file",file),xhr=new XMLHttpRequest,xhr.upload.addEventListener("progress",uploadProgress,!1),xhr.addEventListener("load",uploadComplete,!1),xhr.addEventListener("error",uploadFailed,!1),token=storage.get("token"),xhr.open("POST",url),xhr.setRequestHeader("Authorization","Bearer "+token),xhr.setRequestHeader("Accept","application/json"),xhr.send(data),defered.promise))},function(){return{attachments:service}}},Resource.$inject=["$tgUrls","$tgHttp","$tgConfig","$rootScope","$q","$tgStorage"],module=angular.module("taigaResources2"),module.factory("tgAttachmentsResource",Resource)}.call(this),function(){var Resource,module;Resource=function(urlsService,http){var service;return service={},service.getApplicationToken=function(applicationId,state){var url;return url=urlsService.resolve("applications"),url=url+"/"+applicationId+"/token?state="+state,http.get(url).then(function(result){return Immutable.fromJS(result.data)})},service.authorizeApplicationToken=function(applicationId,state){var data,url;return url=urlsService.resolve("application-tokens"),url+="/authorize",data={state:state,application:applicationId},http.post(url,data).then(function(result){return Immutable.fromJS(result.data)})},function(){return{externalapps:service}}},Resource.$inject=["$tgUrls","$tgHttp"],module=angular.module("taigaResources2"),module.factory("tgExternalAppsResource",Resource)}.call(this),function(){var Resource,module;Resource=function(urlsService,http){var service;return service={},service.listInAllProjects=function(params){var httpOptions,url;return url=urlsService.resolve("issues"),httpOptions={headers:{"x-disable-pagination":"1"}},http.get(url,params,httpOptions).then(function(result){return Immutable.fromJS(result.data)})},function(){return{issues:service}}},Resource.$inject=["$tgUrls","$tgHttp"],module=angular.module("taigaResources2"),module.factory("tgIssuesResource",Resource)}.call(this),function(){var Resource,module,pagination;pagination=function(){},Resource=function(urlsService,http,paginateResponseService){var service;return service={},service.getProjects=function(params,pagination){var httpOptions,url;return null==params&&(params={}),null==pagination&&(pagination=!0),url=urlsService.resolve("projects"),httpOptions={},pagination||(httpOptions={headers:{"x-lazy-pagination":!0}}),http.get(url,params,httpOptions)},service.getProjectBySlug=function(projectSlug){var url;return url=urlsService.resolve("projects"),url=url+"/by_slug?slug="+projectSlug,http.get(url).then(function(result){return Immutable.fromJS(result.data)})},service.getProjectsByUserId=function(userId,paginate){var httpOptions,params,url;return null==paginate&&(paginate=!1),url=urlsService.resolve("projects"),httpOptions={},paginate||(httpOptions.headers={"x-disable-pagination":"1"}),params={member:userId,order_by:"memberships__user_order"},http.get(url,params,httpOptions).then(function(result){return Immutable.fromJS(result.data)})},service.getProjectStats=function(projectId){var url;return url=urlsService.resolve("projects"),url=url+"/"+projectId,http.get(url).then(function(result){return Immutable.fromJS(result.data)})},service.bulkUpdateOrder=function(bulkData){var url;return url=urlsService.resolve("bulk-update-projects-order"),http.post(url,bulkData)},service.getTimeline=function(projectId,page){var params,url;return params={page:page,only_relevant:!0},url=urlsService.resolve("timeline-project"),url=url+"/"+projectId,http.get(url,params,{headers:{"x-lazy-pagination":!0}}).then(function(result){return result=Immutable.fromJS(result),paginateResponseService(result)})},service.likeProject=function(projectId){var url;return url=urlsService.resolve("project-like",projectId),http.post(url)},service.unlikeProject=function(projectId){var url;return url=urlsService.resolve("project-unlike",projectId),http.post(url)},service.watchProject=function(projectId,notifyLevel){var data,url;return data={notify_level:notifyLevel},url=urlsService.resolve("project-watch",projectId),http.post(url,data)},service.unwatchProject=function(projectId){var url;return url=urlsService.resolve("project-unwatch",projectId),http.post(url)},function(){return{projects:service}}},Resource.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],module=angular.module("taigaResources2"),module.factory("tgProjectsResources",Resource)}.call(this),function(){var Resources,services;services=["tgProjectsResources","tgUserResources","tgUsersResources","tgUserstoriesResource","tgTasksResource","tgIssuesResource","tgExternalAppsResource","tgAttachmentsResource","tgStatsResource"],Resources=function($injector){var i,j,len,len1,ref,service,serviceFn,serviceName,serviceProperty;for(i=0,len=services.length;len>i;i++)for(serviceName=services[i],serviceFn=$injector.get(serviceName),service=$injector.invoke(serviceFn),ref=Object.keys(service),j=0,len1=ref.length;len1>j;j++)serviceProperty=ref[j],this[serviceProperty]&&console.warm("repeated resource "+serviceProperty),this[serviceProperty]=service[serviceProperty];return this},Resources.$inject=["$injector"],angular.module("taigaResources2").service("tgResources",Resources)}.call(this),function(){var Resource,module;Resource=function(urlsService,http){var service;return service={},service.discover=function(applicationId,state){var url;return url=urlsService.resolve("stats-discover"),http.get(url).then(function(result){return Immutable.fromJS(result.data)})},function(){return{stats:service}}},Resource.$inject=["$tgUrls","$tgHttp"],module=angular.module("taigaResources2"),module.factory("tgStatsResource",Resource)}.call(this),function(){var Resource,module;Resource=function(urlsService,http){var service;return service={},service.listInAllProjects=function(params){var httpOptions,url;return url=urlsService.resolve("tasks"),httpOptions={headers:{"x-disable-pagination":"1"}},http.get(url,params,httpOptions).then(function(result){return Immutable.fromJS(result.data)})},function(){return{tasks:service}}},Resource.$inject=["$tgUrls","$tgHttp"],module=angular.module("taigaResources2"),module.factory("tgTasksResource",Resource)}.call(this),function(){var Resource,module;Resource=function(urlsService,http,paginateResponseService){var service;return service={},service.getUserStorage=function(key){var httpOptions,url;return url=urlsService.resolve("user-storage"),key&&(url+="/"+key),httpOptions={},http.get(url,{}).then(function(response){return response.data.value})},service.setUserStorage=function(key,value){var params,url;return url=urlsService.resolve("user-storage")+"/"+key,params={key:key,value:value},http.put(url,params)},service.createUserStorage=function(key,value){var params,url;return url=urlsService.resolve("user-storage"),params={key:key,value:value},http.post(url,params)},function(){return{user:service}}},Resource.$inject=["$tgUrls","$tgHttp"],module=angular.module("taigaResources2"),module.factory("tgUserResources",Resource)}.call(this),function(){var Resource,module;Resource=function(urlsService,http,paginateResponseService){var service;return service={},service.getUserByUsername=function(username){var httpOptions,params,url;return url=urlsService.resolve("by_username"),httpOptions={headers:{"x-disable-pagination":"1"}},params={username:username},http.get(url,params,httpOptions).then(function(result){return Immutable.fromJS(result.data)})},service.getStats=function(userId){var httpOptions,url;return url=urlsService.resolve("user-stats",userId),httpOptions={headers:{"x-disable-pagination":"1"}},http.get(url,{},httpOptions).then(function(result){return Immutable.fromJS(result.data)})},service.getContacts=function(userId){var httpOptions,url;return url=urlsService.resolve("user-contacts",userId),httpOptions={headers:{"x-disable-pagination":"1"}},http.get(url,{},httpOptions).then(function(result){return Immutable.fromJS(result.data)})},service.getLiked=function(userId,page,type,q){var params,url;return url=urlsService.resolve("user-liked",userId),params={},null!=page&&(params.page=page),null!=type&&(params.type=type),null!=q&&(params.q=q),params.only_relevant=!0,http.get(url,params,{headers:{"x-lazy-pagination":!0}}).then(function(result){return result=Immutable.fromJS(result),paginateResponseService(result)})},service.getVoted=function(userId,page,type,q){var params,url;return url=urlsService.resolve("user-voted",userId),params={},null!=page&&(params.page=page),null!=type&&(params.type=type),null!=q&&(params.q=q),http.get(url,params,{headers:{"x-lazy-pagination":!0}}).then(function(result){return result=Immutable.fromJS(result),paginateResponseService(result)})},service.getWatched=function(userId,page,type,q){var params,url;return url=urlsService.resolve("user-watched",userId),params={},null!=page&&(params.page=page),null!=type&&(params.type=type),null!=q&&(params.q=q),http.get(url,params,{headers:{"x-lazy-pagination":!0}}).then(function(result){return result=Immutable.fromJS(result),paginateResponseService(result)})},service.getProfileTimeline=function(userId,page){var params,url;return params={page:page},url=urlsService.resolve("timeline-profile"),url=url+"/"+userId,http.get(url,params,{headers:{"x-lazy-pagination":!0}}).then(function(result){return result=Immutable.fromJS(result),paginateResponseService(result)})},service.getUserTimeline=function(userId,page){var params,url;return params={page:page,only_relevant:!0},url=urlsService.resolve("timeline-user"),url=url+"/"+userId,http.get(url,params,{headers:{"x-lazy-pagination":!0}}).then(function(result){return result=Immutable.fromJS(result),paginateResponseService(result)})},function(){return{users:service}}},Resource.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],module=angular.module("taigaResources2"),module.factory("tgUsersResources",Resource)}.call(this),function(){var Resource,module;Resource=function(urlsService,http){var service;return service={},service.listInAllProjects=function(params){var httpOptions,url;return url=urlsService.resolve("userstories"),httpOptions={headers:{"x-disable-pagination":"1"}},http.get(url,params,httpOptions).then(function(result){return Immutable.fromJS(result.data)})},function(){return{userstories:service}}},Resource.$inject=["$tgUrls","$tgHttp"],module=angular.module("taigaResources2"),module.factory("tgUserstoriesResource",Resource)}.call(this),function(){var AppMetaService,taiga,truncate;taiga=this.taiga,truncate=taiga.truncate,AppMetaService=function(){function AppMetaService(rootScope){this.rootScope=rootScope}return AppMetaService.$inject=["$rootScope"],AppMetaService.prototype._set=function(key,value){var meta;if(key)return"title"===key?(meta=$("title"),0===meta.length&&(meta=$("<title></title>"),$("head").append(meta)),meta.text(value||"")):0===key.indexOf("og:")?(meta=$("meta[property='"+key+"']"),0===meta.length&&(meta=$("<meta property='"+key+"'/>"),$("head").append(meta)),meta.attr("content",value||"")):(meta=$("meta[name='"+key+"']"),0===meta.length&&(meta=$("<meta name='"+key+"'/>"),$("head").append(meta)),meta.attr("content",value||""))},AppMetaService.prototype.setTitle=function(title){return this._set("title",title)},AppMetaService.prototype.setDescription=function(description){return this._set("description",truncate(description,250))},AppMetaService.prototype.setTwitterMetas=function(title,description){return this._set("twitter:card","summary"),this._set("twitter:site","@taigaio"),this._set("twitter:title",title),this._set("twitter:description",truncate(description,300)),this._set("twitter:image",window.location.origin+"/"+window._version+"/images/logo-color.png")},AppMetaService.prototype.setOpenGraphMetas=function(title,description){return this._set("og:type","object"),this._set("og:site_name","Taiga - Love your projects"),this._set("og:title",title),this._set("og:description",truncate(description,300)),this._set("og:image",window.location.origin+"/"+window._version+"/images/logo-color.png"),this._set("og:url",window.location.href)},AppMetaService.prototype.setAll=function(title,description){return this.setTitle(title),this.setDescription(description),this.setTwitterMetas(title,description),this.setOpenGraphMetas(title,description)},AppMetaService.prototype.addMobileViewport=function(){return $("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">')},AppMetaService.prototype.removeMobileViewport=function(){return $('meta[name="viewport"]').remove()},AppMetaService.prototype.setfn=function(fn){return this.listener&&this._listener(),this._listener=this.rootScope.$watchCollection(fn,function(_this){return function(metas){return metas?(_this.setAll(metas.title,metas.description),_this._listener()):void 0}}(this))},AppMetaService}(),angular.module("taigaCommon").service("tgAppMetaService",AppMetaService)}.call(this),function(){var AttachmentsService,sizeFormat;sizeFormat=this.taiga.sizeFormat,AttachmentsService=function(){function AttachmentsService(confirm,config,translate,rs){this.confirm=confirm,this.config=config,this.translate=translate,this.rs=rs,this.maxFileSize=this.getMaxFileSize(),this.maxFileSize&&(this.maxFileSizeFormated=sizeFormat(this.maxFileSize))}return AttachmentsService.$inject=["$tgConfirm","$tgConfig","$translate","tgResources"],AttachmentsService.prototype.sizeError=function(file){var message;return message=this.translate.instant("ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED",{fileName:file.name,fileSize:sizeFormat(file.size),maxFileSize:this.maxFileSizeFormated}),this.confirm.notify("error",message)},AttachmentsService.prototype.validate=function(file){return this.maxFileSize&&file.size>this.maxFileSize?(this.sizeError(file),!1):!0},AttachmentsService.prototype.getMaxFileSize=function(){return this.config.get("maxUploadFileSize",null)},AttachmentsService.prototype.list=function(type,objId,projectId){return this.rs.attachments.list(type,objId,projectId).then(function(_this){return function(attachments){return attachments.sortBy(function(attachment){return attachment.get("order")})}}(this))},AttachmentsService.prototype["delete"]=function(type,id){return this.rs.attachments["delete"](type,id)},AttachmentsService.prototype.saveError=function(file,data){var message;return message="",file&&(message=this.translate.instant("ATTACHMENT.ERROR_UPLOAD_ATTACHMENT",{fileName:file.name,errorMessage:data.data._error_message})),this.confirm.notify("error",message)},AttachmentsService.prototype.upload=function(file,objId,projectId,type){var promise;return promise=this.rs.attachments.create(type,projectId,objId,file),promise.then(null,this.saveError.bind(this,file)),promise},AttachmentsService.prototype.patch=function(id,type,patch){var promise;return promise=this.rs.attachments.patch(type,id,patch),promise.then(null,this.saveError.bind(this,null)),promise},AttachmentsService}(),angular.module("taigaCommon").service("tgAttachmentsService",AttachmentsService)}.call(this),function(){var ChekcPermissionsService,taiga;taiga=this.taiga,ChekcPermissionsService=function(){function ChekcPermissionsService(projectService){this.projectService=projectService}return ChekcPermissionsService.$inject=["tgProjectService"],ChekcPermissionsService.prototype.check=function(permission){return-1!==this.projectService.project.get("my_permissions").indexOf(permission)},ChekcPermissionsService}(),angular.module("taigaCommon").service("tgCheckPermissionsService",ChekcPermissionsService)}.call(this),function(){var CurrentUserService,groupBy,taiga;taiga=this.taiga,groupBy=this.taiga.groupBy,CurrentUserService=function(){function CurrentUserService(projectsService,storageService,rs){this.projectsService=projectsService,this.storageService=storageService,this.rs=rs,this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null,taiga.defineImmutableProperty(this,"projects",function(_this){return function(){return _this._projects}}(this)),taiga.defineImmutableProperty(this,"projectsById",function(_this){return function(){return _this._projectsById}}(this))}return CurrentUserService.$inject=["tgProjectsService","$tgStorage","tgResources"],CurrentUserService.prototype.isAuthenticated=function(){return null!==this.getUser()?!0:!1},CurrentUserService.prototype.getUser=function(){var userData;return this._user||(userData=this.storageService.get("userInfo"),userData&&(userData=Immutable.fromJS(userData),this.setUser(userData))),this._user},CurrentUserService.prototype.removeUser=function(){return this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null},CurrentUserService.prototype.setUser=function(user){return this._user=user,this._loadUserInfo()},CurrentUserService.prototype.bulkUpdateProjectsOrder=function(sortData){return this.projectsService.bulkUpdateProjectsOrder(sortData).then(function(_this){return function(){return _this.loadProjects()}}(this))},CurrentUserService.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this._user.get("id")).then(function(_this){return function(projects){return _this.setProjects(projects)}}(this))},CurrentUserService.prototype.disableJoyRide=function(section){return section?this._joyride[section]=!1:this._joyride={backlog:!1,kanban:!1,dashboard:!1},this.rs.user.setUserStorage("joyride",this._joyride)},CurrentUserService.prototype.loadJoyRideConfig=function(){return new Promise(function(_this){return function(resolve){return null!==_this._joyride?void resolve(_this._joyride):_this.rs.user.getUserStorage("joyride").then(function(config){return _this._joyride=config,resolve(_this._joyride)})["catch"](function(){return _this._joyride={backlog:!0,kanban:!0,dashboard:!0},_this.rs.user.createUserStorage("joyride",_this._joyride),resolve(_this._joyride)})}}(this))},CurrentUserService.prototype._loadUserInfo=function(){return Promise.all([this.loadProjects()])},CurrentUserService.prototype.setProjects=function(projects){return this._projects=this._projects.set("all",projects),this._projects=this._projects.set("recents",projects.slice(0,10)),this._projectsById=Immutable.fromJS(groupBy(projects.toJS(),function(p){return p.id})),this.projects},CurrentUserService}(),angular.module("taigaCommon").service("tgCurrentUserService",CurrentUserService)}.call(this),function(){var LightboxFactory;LightboxFactory=function(){function LightboxFactory(rootScope,compile){this.rootScope=rootScope,this.compile=compile}return LightboxFactory.$inject=["$rootScope","$compile"],LightboxFactory.prototype.create=function(name,attrs,scopeAttrs){var elm,html,scope;scope=this.rootScope.$new(),scope=_.merge(scope,scopeAttrs),elm=$("<div>").attr(name,!0).attr("tg-bind-scope",!0),attrs&&elm.attr(attrs),elm.addClass("remove-on-close"),html=this.compile(elm)(scope),$(document.body).append(html)},LightboxFactory}(),angular.module("taigaCommon").service("tgLightboxFactory",LightboxFactory)}.call(this),function(){var PaginateResponse;PaginateResponse=function(){return function(result){var paginateResponse;return paginateResponse=Immutable.Map({data:result.get("data"),next:!!result.get("headers")("x-pagination-next"),prev:!!result.get("headers")("x-pagination-prev"),current:result.get("headers")("x-pagination-current"),count:result.get("headers")("x-pagination-count")})}},angular.module("taigaCommon").factory("tgPaginateResponseService",PaginateResponse)}.call(this),function(){var ProjectService,taiga;taiga=this.taiga,ProjectService=function(){function ProjectService(projectsService,xhrError){this.projectsService=projectsService,this.xhrError=xhrError,this._project=null,this._section=null,this._sectionsBreadcrumb=Immutable.List(),this._activeMembers=Immutable.List(),taiga.defineImmutableProperty(this,"project",function(_this){return function(){return _this._project}}(this)),taiga.defineImmutableProperty(this,"section",function(_this){return function(){return _this._section}}(this)),taiga.defineImmutableProperty(this,"sectionsBreadcrumb",function(_this){return function(){return _this._sectionsBreadcrumb}}(this)),taiga.defineImmutableProperty(this,"activeMembers",function(_this){return function(){return _this._activeMembers}}(this))}return ProjectService.$inject=["tgProjectsService","tgXhrErrorService"],ProjectService.prototype.setSection=function(section){return this._section=section,section?this._sectionsBreadcrumb=this._sectionsBreadcrumb.push(this._section):this._sectionsBreadcrumb=Immutable.List()},ProjectService.prototype.setProjectBySlug=function(pslug){return new Promise(function(_this){return function(resolve,reject){return _this.project&&_this.project.get("slug")===pslug?resolve():_this.projectsService.getProjectBySlug(pslug).then(function(project){return _this.setProject(project),resolve()})["catch"](function(xhr){return _this.xhrError.response(xhr)})}}(this))},ProjectService.prototype.setProject=function(project){return this._project=project,this._activeMembers=this._project.get("members").filter(function(member){return member.get("is_active")})},ProjectService.prototype.cleanProject=function(){return this._project=null,this._activeMembers=Immutable.List(),this._section=null,this._sectionsBreadcrumb=Immutable.List()},ProjectService.prototype.hasPermission=function(permission){return-1!==this._project.get("my_permissions").indexOf(permission)},ProjectService.prototype.fetchProject=function(){var pslug;return pslug=this.project.get("slug"),this.projectsService.getProjectBySlug(pslug).then(function(_this){return function(project){return _this.setProject(project)}}(this))},ProjectService}(),angular.module("taigaCommon").service("tgProjectService",ProjectService)}.call(this),function(){var ScopeEvent;ScopeEvent=function(){function ScopeEvent(){}return ScopeEvent.prototype.scopes={},ScopeEvent.prototype._searchDuplicatedScopes=function(id){return _.find(Object.keys(this.scopes),function(_this){return function(key){return _this.scopes[key].$id===id}}(this))},ScopeEvent.prototype._create=function(name,scope){var duplicatedScopeName;if(duplicatedScopeName=this._searchDuplicatedScopes(scope.$id))throw new Error('scopeEvent: this scope is already register with the name "'+duplicatedScopeName+'"');if(this.scopes[name])throw new Error('scopeEvent: "'+name+'" already in use');return scope._tgEmitter=new EventEmitter2,scope.$on("$destroy",function(_this){return function(){return scope._tgEmitter.removeAllListeners(),delete _this.scopes[name]}}(this)),this.scopes[name]=scope},ScopeEvent.prototype.emitter=function(name,scope){if(scope)scope=this._create(name,scope);else{if(!this.scopes[name])throw new Error('scopeEvent: "'+name+"\" scope doesn't exist'");scope=this.scopes[name]}return scope._tgEmitter},ScopeEvent}(),angular.module("taigaCommon").service("tgScopeEvent",ScopeEvent)}.call(this),function(){var ThemeService,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,ThemeService=function(superClass){function ThemeService(){return ThemeService.__super__.constructor.apply(this,arguments)}return extend(ThemeService,superClass),ThemeService}(taiga.Service=function(){return{use:function(themeName){var stylesheetEl;return stylesheetEl=$("link[rel='stylesheet']:first"),0===stylesheetEl.length&&(stylesheetEl=$("<link rel='stylesheet' href='' type='text/css'>"),$("head").append(stylesheetEl)),stylesheetEl.attr("href","/"+window._version+"/styles/theme-"+themeName+".css")}}}),angular.module("taigaCommon").service("tgThemeService",ThemeService)}.call(this),function(){var UserService,bindMethods,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,bindMethods=taiga.bindMethods,UserService=function(superClass){function UserService(rs){this.rs=rs,bindMethods(this)}return extend(UserService,superClass),UserService.$inject=["tgResources"],UserService.prototype.getUserByUserName=function(username){return this.rs.users.getUserByUsername(username)},UserService.prototype.getContacts=function(userId){return this.rs.users.getContacts(userId)},UserService.prototype.getLiked=function(userId,pageNumber,objectType,textQuery){return this.rs.users.getLiked(userId,pageNumber,objectType,textQuery)},UserService.prototype.getVoted=function(userId,pageNumber,objectType,textQuery){return this.rs.users.getVoted(userId,pageNumber,objectType,textQuery)},UserService.prototype.getWatched=function(userId,pageNumber,objectType,textQuery){return this.rs.users.getWatched(userId,pageNumber,objectType,textQuery)},UserService.prototype.getStats=function(userId){return this.rs.users.getStats(userId)},UserService.prototype.attachUserContactsToProjects=function(userId,projects){return this.getContacts(userId).then(function(contacts){return projects=projects.map(function(project){var contactsFiltered;return contactsFiltered=contacts.filter(function(contact){var contactId;return contactId=contact.get("id"),-1!==project.get("members").indexOf(contactId)}),project=project.set("contacts",contactsFiltered)})})},UserService}(taiga.Service),angular.module("taigaCommon").service("tgUserService",UserService)}.call(this),function(){var xhrError,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;xhrError=function(superClass){function xhrError(q,location,navUrls){this.q=q,this.location=location,this.navUrls=navUrls}return extend(xhrError,superClass),xhrError.$inject=["$q","$location","$tgNavUrls"],xhrError.prototype.notFound=function(){return this.location.path(this.navUrls.resolve("not-found")),this.location.replace()},xhrError.prototype.permissionDenied=function(){return this.location.path(this.navUrls.resolve("permission-denied")),this.location.replace()},xhrError.prototype.response=function(xhr){return xhr&&(404===xhr.status?this.notFound():403===xhr.status&&this.permissionDenied()),this.q.reject(xhr)},xhrError}(taiga.Service),angular.module("taigaCommon").service("tgXhrErrorService",xhrError)}.call(this),function(){var UserTimelineAttachmentDirective;UserTimelineAttachmentDirective=function(template,$compile){var isImage,link,validFileExtensions;return validFileExtensions=[".jpg",".jpeg",".bmp",".gif",".png"],isImage=function(url){return url=url.toLowerCase(),_.some(validFileExtensions,function(extension){return-1!==url.indexOf(extension,url-extension.length)})},link=function(scope,el){var is_image,templateHtml;return is_image=isImage(scope.attachment.get("url")),templateHtml=is_image?template.get("user-timeline/user-timeline-attachment/user-timeline-attachment-image.html"):template.get("user-timeline/user-timeline-attachment/user-timeline-attachment.html"),el.html(templateHtml),$compile(el.contents())(scope),el.find("img").error(function(){return this.remove()})},{link:link,scope:{attachment:"=tgUserTimelineAttachment"}}},UserTimelineAttachmentDirective.$inject=["$tgTemplate","$compile"],angular.module("taigaUserTimeline").directive("tgUserTimelineAttachment",UserTimelineAttachmentDirective)}.call(this),function(){var UserTimelineItemTitle,unslugify;unslugify=this.taiga.unslugify,UserTimelineItemTitle=function(){function UserTimelineItemTitle(translate,sce){this.translate=translate,this.sce=sce}return UserTimelineItemTitle.$inject=["$translate","$sce"],UserTimelineItemTitle.prototype._fieldTranslationKey={status:"COMMON.FIELDS.STATUS",subject:"COMMON.FIELDS.SUBJECT",description_diff:"COMMON.FIELDS.DESCRIPTION",points:"COMMON.FIELDS.POINTS",assigned_to:"COMMON.FIELDS.ASSIGNED_TO",severity:"ISSUES.FIELDS.SEVERITY",priority:"ISSUES.FIELDS.PRIORITY",type:"ISSUES.FIELDS.TYPE",is_iocaine:"TASK.FIELDS.IS_IOCAINE",is_blocked:"COMMON.FIELDS.IS_BLOCKED"},UserTimelineItemTitle.prototype._params={username:function(timeline,event){var title_attr,url,user;return user=timeline.getIn(["data","user"]),user.get("is_profile_visible")?(title_attr=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:user.get("username")}),url="user-profile:username=timeline.getIn(['data', 'user', 'username'])",this._getLink(url,user.get("name"),title_attr)):this._getUsernameSpan(user.get("name"))},field_name:function(timeline,event){var field_name;return field_name=timeline.getIn(["data","value_diff","key"]),this.translate.instant(this._fieldTranslationKey[field_name])},project_name:function(timeline,event){var url;return url="project:project=timeline.getIn(['data', 'project', 'slug'])",this._getLink(url,timeline.getIn(["data","project","name"]))},new_value:function(timeline,event){var new_value,value;return _.isArray(timeline.getIn(["data","value_diff","value"]).toJS())?(value=timeline.getIn(["data","value_diff","value"]).get(1),null===value&&"assigned_to"===timeline.getIn(["data","value_diff","key"])&&(value=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED")),new_value=value):new_value=timeline.getIn(["data","value_diff","value"]).first().get(1),_.escape(new_value)},sprint_name:function(timeline,event){var url;return url="project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])",
this._getLink(url,timeline.getIn(["data","milestone","name"]))},us_name:function(timeline,event){var event_us,obj,text,url;return obj=this._getTimelineObj(timeline,event).get("userstory"),event_us={obj:"parent_userstory"},url=this._getDetailObjUrl(event_us),text="#"+obj.get("ref")+" "+obj.get("subject"),this._getLink(url,text)},obj_name:function(timeline,event){var obj,text,url;return obj=this._getTimelineObj(timeline,event),url=this._getDetailObjUrl(event),text="wikipage"===event.obj?unslugify(obj.get("slug")):"milestone"===event.obj?obj.get("name"):"#"+obj.get("ref")+" "+obj.get("subject"),this._getLink(url,text)},role_name:function(timeline,event){return _.escape(timeline.getIn(["data","value_diff","value"]).keySeq().first())}},UserTimelineItemTitle.prototype._translateTitleParams=function(param,timeline,event){return this._params[param].call(this,timeline,event)},UserTimelineItemTitle.prototype._getTimelineObj=function(timeline,event){return timeline.getIn(["data",event.obj])},UserTimelineItemTitle.prototype._getDetailObjUrl=function(event){var url;return url={issue:["project-issues-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],wikipage:["project-wiki-page",":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])"],task:["project-tasks-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],parent_userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])"],milestone:["project-taskboard",":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])"]},url[event.obj][0]+url[event.obj][1]},UserTimelineItemTitle.prototype._getLink=function(url,text,title){return title=title||text,$("<a>").attr("tg-nav",url).text(text).attr("title",title).prop("outerHTML")},UserTimelineItemTitle.prototype._getUsernameSpan=function(text){var title;return title=title||text,$("<span>").addClass("username").text(text).prop("outerHTML")},UserTimelineItemTitle.prototype._getParams=function(timeline,event,timeline_type){var params;return params={},timeline_type.translate_params.forEach(function(_this){return function(param){return params[param]=_this._translateTitleParams(param,timeline,event)}}(this)),params},UserTimelineItemTitle.prototype.getTitle=function(timeline,event,type){var params,paramsKeys,translation;return params=this._getParams(timeline,event,type),paramsKeys={},Object.keys(params).forEach(function(key){return paramsKeys[key]="{{"+key+"}}"}),translation=this.translate.instant(type.key,paramsKeys),Object.keys(params).forEach(function(key){var find;return find="{{"+key+"}}",translation=translation.replace(new RegExp(find,"g"),params[key])}),translation},UserTimelineItemTitle}(),angular.module("taigaUserTimeline").service("tgUserTimelineItemTitle",UserTimelineItemTitle)}.call(this),function(){var UserTimelineType,timelineType;timelineType=function(timeline,event){var types;return types=[{check:function(timeline,event){return"membership"===event.obj},key:"TIMELINE.NEW_MEMBER",translate_params:["project_name"],member:function(timeline){return Immutable.Map({user:timeline.getIn(["data","user"]),role:timeline.getIn(["data","role"])})}},{check:function(timeline,event){return"project"===event.obj&&"create"===event.type},key:"TIMELINE.NEW_PROJECT",translate_params:["username","project_name"],description:function(timeline){return timeline.getIn(["data","project","description"])}},{check:function(timeline,event){return"change"===event.type&&timeline.hasIn(["data","value_diff"])&&"attachments"===timeline.getIn(["data","value_diff","key"])},key:"TIMELINE.UPLOAD_ATTACHMENT",translate_params:["username","obj_name"]},{check:function(timeline,event){return"userstory"===event.obj&&"create"===event.type},key:"TIMELINE.US_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(timeline,event){return"issue"===event.obj&&"create"===event.type},key:"TIMELINE.ISSUE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(timeline,event){return"wikipage"===event.obj&&"create"===event.type},key:"TIMELINE.WIKI_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(timeline,event){return"task"===event.obj&&"create"===event.type&&!timeline.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(timeline,event){return"task"===event.obj&&"create"===event.type&&timeline.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED_WITH_US",translate_params:["username","project_name","obj_name","us_name"]},{check:function(timeline,event){return"milestone"===event.obj&&"create"===event.type},key:"TIMELINE.MILESTONE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(timeline,event){return timeline.getIn(["data","comment"])&&"userstory"===event.obj},key:"TIMELINE.NEW_COMMENT_US",translate_params:["username","obj_name"],description:function(timeline){var text;return text=timeline.getIn(["data","comment_html"]),$($.parseHTML(text)).text()}},{check:function(timeline,event){return timeline.getIn(["data","comment"])&&"issue"===event.obj},key:"TIMELINE.NEW_COMMENT_ISSUE",translate_params:["username","obj_name"],description:function(timeline){var text;return text=timeline.getIn(["data","comment_html"]),$($.parseHTML(text)).text()}},{check:function(timeline,event){return timeline.getIn(["data","comment"])&&"task"===event.obj},key:"TIMELINE.NEW_COMMENT_TASK",translate_params:["username","obj_name"],description:function(timeline){var text;return text=timeline.getIn(["data","comment_html"]),$($.parseHTML(text)).text()}},{check:function(timeline,event){return timeline.hasIn(["data","value_diff"])&&"moveInBacklog"===timeline.getIn(["data","value_diff","key"])&&timeline.hasIn(["data","value_diff","value","backlog_order"])&&"change"===event.type},key:"TIMELINE.US_MOVED",translate_params:["username","obj_name"]},{check:function(timeline,event){return timeline.hasIn(["data","value_diff"])&&"moveInBacklog"===timeline.getIn(["data","value_diff","key"])&&"change"===event.type&&"userstory"===event.obj?null===timeline.getIn(["data","value_diff","value","milestone"]).get(1):!1},key:"TIMELINE.US_REMOVED_FROM_MILESTONE",translate_params:["username","obj_name"]},{check:function(timeline,event){return timeline.hasIn(["data","value_diff"])&&"moveInBacklog"===timeline.getIn(["data","value_diff","key"])&&"change"===event.type&&"userstory"===event.obj},key:"TIMELINE.US_ADDED_MILESTONE",translate_params:["username","obj_name","sprint_name"]},{check:function(timeline,event){return timeline.hasIn(["data","value_diff"])&&"blocked"===timeline.getIn(["data","value_diff","key"])&&"change"===event.type?timeline.getIn(["data","value_diff","value","is_blocked"]).get(1)===!0:!1},key:"TIMELINE.BLOCKED",translate_params:["username","obj_name"],description:function(timeline){var text;return timeline.hasIn(["data","value_diff","value","blocked_note_html"])?(text=timeline.getIn(["data","value_diff","value","blocked_note_html"]).get(1),$($.parseHTML(text)).text()):!1}},{check:function(timeline,event){return timeline.hasIn(["data","value_diff"])&&"blocked"===timeline.getIn(["data","value_diff","key"])&&"change"===event.type?timeline.getIn(["data","value_diff","value","is_blocked"]).get(1)===!1:!1},key:"TIMELINE.UNBLOCKED",translate_params:["username","obj_name"]},{check:function(timeline,event){return"milestone"===event.obj&&"change"===event.type},key:"TIMELINE.MILESTONE_UPDATED",translate_params:["username","obj_name"]},{check:function(timeline,event){return"wikipage"===event.obj&&"change"===event.type},key:"TIMELINE.WIKI_UPDATED",translate_params:["username","obj_name"]},{check:function(timeline,event){return"userstory"===event.obj&&"change"===event.type&&timeline.hasIn(["data","value_diff"])&&"points"===timeline.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED_POINTS",translate_params:["username","field_name","obj_name","new_value","role_name"]},{check:function(timeline,event){return"userstory"===event.obj&&"change"===event.type&&timeline.hasIn(["data","value_diff"])&&"description_diff"===timeline.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(timeline,event){return"userstory"===event.obj&&"change"===event.type},key:"TIMELINE.US_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(timeline,event){return"issue"===event.obj&&"change"===event.type&&timeline.hasIn(["data","value_diff"])&&"description_diff"===timeline.getIn(["data","value_diff","key"])},key:"TIMELINE.ISSUE_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(timeline,event){return"issue"===event.obj&&"change"===event.type},key:"TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(timeline,event){return"task"===event.obj&&"change"===event.type&&!timeline.getIn(["data","task","userstory"])&&timeline.hasIn(["data","value_diff"])&&"description_diff"===timeline.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(timeline,event){return"task"===event.obj&&"change"===event.type&&timeline.getIn(["data","task","userstory"])&&timeline.hasIn(["data","value_diff"])&&"description_diff"===timeline.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED_WITH_US",translate_params:["username","field_name","obj_name","us_name"]},{check:function(timeline,event){return"task"===event.obj&&"change"===event.type&&!timeline.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(timeline,event){return"task"===event.obj&&"change"===event.type&&timeline.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE",translate_params:["username","field_name","obj_name","us_name","new_value"]},{check:function(timeline,event){return"user"===event.obj&&"create"===event.type},key:"TIMELINE.NEW_USER",translate_params:["username"]}],_.find(types,function(obj){return obj.check(timeline,event)})},UserTimelineType=function(){function UserTimelineType(){}return UserTimelineType.prototype.getType=function(timeline,event){return timelineType(timeline,event)},UserTimelineType}(),angular.module("taigaUserTimeline").service("tgUserTimelineItemType",UserTimelineType)}.call(this),function(){var UserTimelineItemDirective;UserTimelineItemDirective=function(){return{templateUrl:"user-timeline/user-timeline-item/user-timeline-item.html",scope:{timeline:"=tgUserTimelineItem"}}},angular.module("taigaUserTimeline").directive("tgUserTimelineItem",UserTimelineItemDirective)}.call(this),function(){var UserTimelinePaginationSequence;UserTimelinePaginationSequence=function(){var obj;return obj={},obj.generate=function(config){var getContent,items,next,page;return page=1,items=Immutable.List(),config.minItems=config.minItems||20,next=function(){return items=Immutable.List(),getContent()},getContent=function(){return config.fetch(page).then(function(response){var data;return page++,data=response.get("data"),config.filter&&(data=config.filter(data)),config.map&&(data=data.map(config.map)),items=items.concat(data),items.size<config.minItems&&response.get("next")?getContent():Immutable.Map({items:items,next:response.get("next")})})},{next:function(){return next()}}},obj},angular.module("taigaUserTimeline").factory("tgUserTimelinePaginationSequenceService",UserTimelinePaginationSequence)}.call(this),function(){var UserTimelineController,mixOf,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,mixOf=this.taiga.mixOf,UserTimelineController=function(superClass){function UserTimelineController(userTimelineService){this.userTimelineService=userTimelineService,this.timelineList=Immutable.List(),this.scrollDisabled=!1,this.timeline=null,this.projectId?this.timeline=this.userTimelineService.getProjectTimeline(this.projectId):this.currentUser?this.timeline=this.userTimelineService.getProfileTimeline(this.user.get("id")):this.timeline=this.userTimelineService.getUserTimeline(this.user.get("id"))}return extend(UserTimelineController,superClass),UserTimelineController.$inject=["tgUserTimelineService"],UserTimelineController.prototype.loadTimeline=function(){return this.scrollDisabled=!0,this.timeline.next().then(function(_this){return function(response){return _this.timelineList=_this.timelineList.concat(response.get("items")),response.get("next")&&(_this.scrollDisabled=!1),_this.timelineList}}(this))},UserTimelineController}(mixOf(taiga.Controller,taiga.PageMixin,taiga.FiltersMixin)),angular.module("taigaUserTimeline").controller("UserTimeline",UserTimelineController)}.call(this),function(){var UserTimelineDirective;UserTimelineDirective=function(){return{templateUrl:"user-timeline/user-timeline/user-timeline.html",controller:"UserTimeline",controllerAs:"vm",scope:{projectId:"=projectid",user:"=",currentUser:"="},bindToController:!0}},angular.module("taigaProfile").directive("tgUserTimeline",UserTimelineDirective)}.call(this),function(){var UserTimelineService,taiga,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;taiga=this.taiga,UserTimelineService=function(superClass){function UserTimelineService(rs,userTimelinePaginationSequenceService,userTimelineItemType,userTimelineItemTitle){this.rs=rs,this.userTimelinePaginationSequenceService=userTimelinePaginationSequenceService,this.userTimelineItemType=userTimelineItemType,this.userTimelineItemTitle=userTimelineItemTitle}return extend(UserTimelineService,superClass),UserTimelineService.$inject=["tgResources","tgUserTimelinePaginationSequenceService","tgUserTimelineItemType","tgUserTimelineItemTitle"],UserTimelineService.prototype._valid_fields=["status","subject","description_diff","assigned_to","points","severity","priority","type","attachments","is_iocaine","content_diff","name","estimated_finish","estimated_start","blocked","moveInBacklog","milestone"],UserTimelineService.prototype._invalid=[{check:function(timeline){var fieldKey,value_diff;if(value_diff=timeline.get("data").get("value_diff")){if(fieldKey=value_diff.get("key"),-1===this._valid_fields.indexOf(fieldKey))return!0;if("attachments"===fieldKey&&0===value_diff.get("value").get("new").size)return!0}return!1}},{check:function(timeline){var event,value_diff;return event=timeline.get("event_type").split("."),value_diff=timeline.get("data").get("value_diff"),"change"===event[2]&&void 0===value_diff}},{check:function(timeline){var event;return event=timeline.get("event_type").split("."),"delete"===event[2]}},{check:function(timeline){var event;return event=timeline.get("event_type").split("."),"project"===event[1]&&"change"===event[2]}},{check:function(timeline){return!!timeline.get("data").get("comment_deleted")}},{check:function(timeline){var event,value_diff;return event=timeline.get("event_type").split("."),value_diff=timeline.get("data").get("value_diff"),value_diff&&"task"===event[1]&&"change"===event[2]&&"milestone"===value_diff.get("key")?timeline.get("data").get("value_diff").get("value"):!1}}],UserTimelineService.prototype._isInValidTimeline=function(timeline){return _.some(this._invalid,function(_this){return function(invalid){return invalid.check.call(_this,timeline)}}(this))},UserTimelineService.prototype._parseEventType=function(event_type){return event_type=event_type.split("."),{section:event_type[0],obj:event_type[1],type:event_type[2]}},UserTimelineService.prototype._getTimelineObject=function(timeline,event){return timeline.get("data").get(event.obj)?timeline.get("data").get(event.obj):void 0},UserTimelineService.prototype._attachExtraInfoToTimelineEntry=function(timeline,event,type){var title;return title=this.userTimelineItemTitle.getTitle(timeline,event,type),timeline=timeline.set("title_html",title),timeline=timeline.set("obj",this._getTimelineObject(timeline,event)),type.description&&(timeline=timeline.set("description",type.description(timeline))),type.member&&(timeline=timeline.set("member",type.member(timeline))),"attachments"===timeline.getIn(["data","value_diff","key"])&&timeline.hasIn(["data","value_diff","value","new"])&&(timeline=timeline.set("attachments",timeline.getIn(["data","value_diff","value","new"]))),timeline},UserTimelineService.prototype._parseTimeline=function(response){var newdata;return newdata=Immutable.List(),response.get("data").forEach(function(_this){return function(item){var data,event,newItem,values_diff;return event=_this._parseEventType(item.get("event_type")),data=item.get("data"),values_diff=data.get("values_diff"),values_diff&&values_diff.count()?(values_diff.has("is_blocked")&&(values_diff=Immutable.Map({blocked:values_diff})),values_diff.has("milestone")?values_diff="userstory"===event.obj?Immutable.Map({moveInBacklog:values_diff}):values_diff.deleteIn(["values_diff","milestone"]):"milestone"===event.obj&&(values_diff=Immutable.Map({milestone:values_diff})),values_diff.forEach(function(value,key){var newItem,obj;return obj=Immutable.Map({key:key,value:value}),newItem=item.setIn(["data","value_diff"],obj),newItem=newItem.deleteIn(["data","values_diff"]),newdata=newdata.push(newItem)})):(newItem=item.deleteIn(["data","values_diff"]),newdata=newdata.push(newItem))}}(this)),response.set("data",newdata)},UserTimelineService.prototype._addEntyAttributes=function(item){var event,type;return event=this._parseEventType(item.get("event_type")),type=this.userTimelineItemType.getType(item,event),this._attachExtraInfoToTimelineEntry(item,event,type)},UserTimelineService.prototype.getProfileTimeline=function(userId){var config;return config={},config.fetch=function(_this){return function(page){return _this.rs.users.getProfileTimeline(userId,page).then(function(response){return _this._parseTimeline(response)})}}(this),config.map=function(_this){return function(obj){return _this._addEntyAttributes(obj)}}(this),config.filter=function(_this){return function(items){return items.filterNot(function(item){return _this._isInValidTimeline(item)})}}(this),this.userTimelinePaginationSequenceService.generate(config)},UserTimelineService.prototype.getUserTimeline=function(userId){var config;return config={},config.fetch=function(_this){return function(page){return _this.rs.users.getUserTimeline(userId,page).then(function(response){return _this._parseTimeline(response)})}}(this),config.map=function(_this){return function(obj){return _this._addEntyAttributes(obj)}}(this),config.filter=function(_this){return function(items){return items.filterNot(function(item){return _this._isInValidTimeline(item)})}}(this),this.userTimelinePaginationSequenceService.generate(config)},UserTimelineService.prototype.getProjectTimeline=function(projectId){var config;return config={},config.fetch=function(_this){return function(page){return _this.rs.projects.getTimeline(projectId,page).then(function(response){return _this._parseTimeline(response)})}}(this),config.map=function(_this){return function(obj){return _this._addEntyAttributes(obj)}}(this),config.filter=function(_this){return function(items){return items.filterNot(function(item){return _this._isInValidTimeline(item)})}}(this),this.userTimelinePaginationSequenceService.generate(config)},UserTimelineService}(taiga.Service),angular.module("taigaUserTimeline").service("tgUserTimelineService",UserTimelineService)}.call(this);
//# sourceMappingURL=maps/app.js.map
